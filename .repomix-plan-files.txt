This file is a merged representation of a subset of the codebase, containing specifically included files and files not matching ignore patterns, combined into a single document by Repomix.
The content has been processed where empty lines have been removed.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of a subset of the repository's contents that is considered the most important context.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Only files matching these patterns are included: **/*, .cursorrules, .cursor/rules/*, .clinerules, CLAUDE.md
- Files matching these patterns are excluded: .*.*, **/*.pbxproj, **/node_modules/**, **/dist/**, **/build/**, **/compile/**, **/*.spec.*, **/*.pyc, **/.env, **/.env.*, **/*.env, **/*.env.*, **/*.lock, **/*.lockb, **/package-lock.*, **/pnpm-lock.*, **/*.tsbuildinfo, **/certdata.txt
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Empty lines have been removed from all files
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
context/
  PROJECT.md
local-research/
  nip17-current-state.md
  nip17-implementation-plan.md
  nip17-spec-details.md
  nip60-61-summary.md
public/
  vite.svg
scripts/
  test-wallet.ts
  wallet-helpers.ts
src/
  components/
    content/
      ContentRenderer.tsx
      ContentRendererDemo.tsx
      EmbeddedArticle.tsx
      EmbeddedNote.tsx
      index.ts
      MediaEmbed.tsx
    layout/
      Layout.tsx
    media/
      MediaGrid.tsx
    navigation/
      BottomNav.tsx
      NavItems.tsx
      RelaySelector.tsx
      Sidebar.tsx
      UserMenu.tsx
    nostr/
    thread/
      ThreadNoteCard.tsx
    ui/
      alert.tsx
      Avatar.tsx
      button.tsx
      card.tsx
      dialog.tsx
      dropdown-menu.tsx
      FAB.tsx
      FollowButton.tsx
      input.tsx
      label.tsx
      select.tsx
      tabs.tsx
      textarea.tsx
      UserAvatar.tsx
    wallet/
      DepositModal.tsx
      index.ts
      MintConfiguration.tsx
      ProfessionalWallet.tsx
      QRScanner.tsx
      README.md
      TransactionButton.tsx
      TransactionModal.tsx
      Wallet.tsx
      WalletBalance.tsx
      WalletBalanceBadge.tsx
      WalletIntegration.tsx
      WalletWidget.tsx
      ZapButton.tsx
  config/
    auth.ts
    ndk.ts
  contexts/
  features/
    auth/
      utils/
        logout.ts
      LoginButton.tsx
      LoginModal.tsx
      useAutoLogin.ts
    classifieds/
      components/
        CategorySection.tsx
        FilterButton.tsx
        ListingCard.tsx
        ListingForm.tsx
        ListingGrid.tsx
        PriceTag.tsx
      hooks/
        useCreateListing.ts
        useListings.ts
      types.ts
    feed/
      ComposeNote.tsx
      NoteCard.tsx
      NoteFeed.tsx
    followPacks/
      components/
        FollowPackCard.tsx
        PackCard.tsx
        ProfileAvatar.tsx
      hooks/
        useFollowPacks.ts
        useProfileFollowPacks.ts
      mockData.ts
    profile/
      ProfileEditor.tsx
    settings/
      BlossomSettings.tsx
      NotificationSettings.tsx
      PrivacySettings.tsx
      ProfileSettings.tsx
      RelaySettings.tsx
      ThemeSettings.tsx
    trades/
      hooks/
        useAvailableCurrencies.ts
      CompactFilters.tsx
      CreateOrderModal.tsx
      MobileFilters.tsx
      OrderBook.tsx
      OrderCard.tsx
      QuickFilters.tsx
      TakeOrderModal.tsx
      TradeFilters.tsx
  hooks/
    wallet/
      eventHandlers.ts
      initialization.ts
      operations.ts
      types.ts
      useWallet.ts
    useWallet.ts
    useZap.ts
  i18n/
    locales/
      en.json
      es.json
    config.ts
  lib/
    utils.ts
  pages/
    marketplace/
      CreateListingPage.tsx
      ListingDetailPage.tsx
      MarketplacePage.tsx
    ComposePage.tsx
    FollowPackDetailPage.tsx
    FollowPacksPage.tsx
    FollowPacksPageImproved.tsx
    HomePage.tsx
    NoteDetailPage.tsx
    NotificationsPage.tsx
    ProfilePage.tsx
    SettingsPage.tsx
    TradePage.tsx
    WalletPage.tsx
    WalletSettingsPage.tsx
  stores/
    followPacksStore.ts
    settingsStore.ts
    walletStore.ts
  styles/
  tools/
    dynamic/
  types/
  utils/
    followUtils.ts
    walletErrors.ts
    walletLogger.ts
  .repomix-output.txt
  app.css
  App.tsx
  index.css
  main.tsx
.gitignore
eslint.config.js
index.html
package.json
postcss.config.js
README.md
tailwind.config.js
tsconfig.app.json
tsconfig.json
tsconfig.node.json
vite.config.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="local-research/nip17-current-state.md">
Packing repository using Repomix...
Analyzing repository using gemini-2.5-flash...
The project "Voces" is a modern React-based Nostr client that utilizes the Nostr Development Kit (NDK) for interaction with the Nostr network.

Here's an analysis of the existing messaging/DM functionality, encryption utilities, and overall architecture for handling Nostr events:

### 1. Messaging or DM functionality

The project currently implements **public threading and replies** rather than private direct messages (DMs).

*   **Public Replies/Threading**:
    *   `src/features/feed/NoteCard.tsx` includes UI for a "MessageCircle" icon, which is intended for public replies to notes. The associated `onClick` handler has a `TODO: Implement reply`, indicating future development for this feature.
    *   `src/pages/NoteDetailPage.tsx` is dedicated to displaying a single Nostr note and its replies, creating a thread. The `handleReply` function in this file creates new `NDKKind.Text` events, linking them to the parent note using `e` tags with `reply` and `root` markers. This is a standard Nostr approach for public conversations.
*   **Implicit Messaging for Trades**:
    *   `src/features/trades/TakeOrderModal.tsx` includes a "Trade Safely" warning that advises users to "Communicate only through secure channels" and "Check your messages for next steps." While this implies that a communication channel is expected for P2P trades, the modal itself does not implement any direct messaging capabilities. It suggests that such communication would happen via an external or implicitly integrated messaging system.

**Conclusion**: The project does not currently include explicit implementation for NIP-04 encrypted direct messaging (private DMs). The existing "messaging" functionality is focused on public replies and threading within the feed.

### 2. Encryption utilities

The project relies primarily on the `@nostr-dev-kit/ndk` library for cryptographic operations and secure key handling, rather than implementing custom encryption utilities directly in its application logic.

*   **Authentication and Key Management**:
    *   `src/features/auth/LoginModal.tsx` and `src/features/auth/useAutoLogin.ts` handle user authentication using various signers provided by `ndk-hooks`:
        *   `NDKPrivateKeySigner`: This signer requires the application to handle the user's private key (nsec or hex). While `localStorage` is used for demonstration purposes, the codebase notes that for production, a more secure storage mechanism would be needed. The NDK library then uses this private key for signing Nostr events. The application does not apply additional encryption to event content using this key, beyond what NDK does internally for standard event formats.
        *   `NDKNip07Signer`: This signer delegates private key operations to a browser extension (e.g., Alby, nos2x). The private key remains within the secure confines of the extension and is never exposed to the application, enhancing security.
        *   `NDKNip46Signer`: This is used for remote signers (like Nostr Bunkers), where the private key is held and managed by an external service. The application communicates with this service to request event signing.
*   **NIP-60/61 (Nutzaps)**:
    *   `local-research/nip60-61-summary.md` describes Nutzaps as a token-based micropayment system where payments are "locked with the recipient‚Äôs public key (P2PK)" and "cryptographically binding payments to recipients and events." This cryptographic binding is handled by the `NDKNutzap` and `NDKCashuWallet` classes from `@nostr-dev-kit/ndk-wallet`, abstracting the underlying encryption details from the application code.
*   **Absence of Custom Encryption**:
    *   There are no explicit implementations of cryptographic algorithms like AES, ECDH, or custom key derivation functions within the application's source files. The project delegates these concerns to the NDK library and the chosen signer implementations.

**Conclusion**: The project's encryption strategy is to leverage NDK's built-in cryptographic capabilities for event signing and NIP-specific operations (like NIP-60/61). For NIP-07 and NIP-46, the handling of private keys and cryptographic signing is externalized. There is no custom encryption of application data or message content implemented by the project itself, nor is there any NIP-04 specific encryption code.

### 3. Overall architecture for handling Nostr events

The project's architecture for handling Nostr events is centered around the `@nostr-dev-kit/ndk` library and its React hooks (`@nostr-dev-kit/ndk-hooks`), providing a robust and reactive client-side structure.

*   **NDK Core Setup (`src/main.tsx`)**:
    *   A single `NDKHeadless` instance serves as the central client for interacting with the Nostr network.
    *   **Relay Management**: Relay URLs are dynamically configured based on user settings stored in `src/stores/settingsStore.ts`. This allows users to add, remove, enable/disable relays, and select a single relay or all enabled relays. The `RelaySelector` component (`src/components/navigation/RelaySelector.tsx`) provides the UI for this.
    *   **Caching**: `NDKCacheAdapterDexie` is integrated to provide client-side caching of Nostr events using IndexedDB, significantly improving performance and user experience.
    *   **Session Management**: `NDKSessionLocalStorage` is used for persisting user sessions, including followed profiles and active authentication methods.
*   **Authentication and User Context (`src/features/auth/`)**:
    *   The `useNDKCurrentUser` hook provides global access to the authenticated user's NDKUser object.
    *   `LoginButton` and `LoginModal` facilitate various login methods (browser extension, remote signer, private key) and manage the `ndk.signer` instance.
    *   `useAutoLogin` provides a mechanism for automatic re-authentication upon app load based on saved preferences.
*   **Data Fetching and Real-time Updates**:
    *   The `useSubscribe` hook from `ndk-hooks` is extensively used across various features (e.g., `NoteFeed`, `useListings`, `OrderBook`, `ProfilePage`, `FollowPackDetailPage`). This hook sets up persistent subscriptions to Nostr relays based on NDK filters, ensuring real-time updates for displayed content.
    *   `ndk.fetchEvent` and `ndk.fetchEvents` are used for one-time fetches of specific events or sets of events (e.g., retrieving parent notes in a thread on `NoteDetailPage`).
*   **Event Publishing**:
    *   New Nostr events are created as instances of `NDKEvent` (e.g., in `ComposeNote` for text notes, `useCreateListing` for marketplace listings, `CreateOrderModal` for P2P trade orders).
    *   Events are populated with their `kind`, `content`, and relevant `tags` (e.g., `e` tags for replies, `p` tags for mentions, `title`, `price`, `image` tags for classifieds).
    *   The `event.sign()` method uses the active `ndk.signer` to cryptographically sign the event.
    *   `event.publish()` sends the signed event to the configured Nostr relays.
*   **State Management beyond NDK**:
    *   **Zustand**: `src/stores/walletStore.ts`, `src/stores/settingsStore.ts`, and `src/stores/followPacksStore.ts` utilize Zustand for managing application-specific global state (e.g., wallet balance, preferred mints, UI settings, subscribed follow packs). These stores are often hydrated from or persist to `localStorage`.
    *   **React `useState`/`useEffect`/`useMemo`/`useCallback`**: Standard React hooks are used for local component state, side effects, and performance optimizations.
*   **Nostr NIPs Implemented**:
    *   **NIP-01 (Basic Protocol)**: Fundamental to all event creation, signing, and publishing.
    *   **NIP-02 (Contact List and Petnames)**: Managed via `NDKUser.follow()` and `NDKUser.unfollow()` (exposed through `src/utils/followUtils.ts` and `src/components/ui/FollowButton.tsx`).
    *   **NIP-05 (Profile Metadata)**: Profile data is fetched and displayed using `useProfile` hooks.
    *   **NIP-19 (Bech32 Encoding)**: Used for encoding and decoding Nostr identifiers (`npub`, `note`, `nevent`, `nprofile`, `naddr`) for navigation and display.
    *   **NIP-60 & NIP-61 (Cashu Wallets and Nutzaps)**: Integrated via `ndk-wallet` for Cashu token management, deposits, and sending Nutzaps. The `useWallet` hook (`src/hooks/wallet/useWallet.ts`) encapsulates this functionality.
    *   **NIP-99 (Classifieds)**: Implemented for the marketplace feature (kind 30402 events) in `src/features/classifieds/`.
    *   **Kind 38383 (P2P Trades)**: Used for P2P trading orders, handled in `src/features/trades/`.
    *   **NIP-68 (Private/Public Event Metadata)**: Referenced in `src/components/media/MediaGrid.tsx` for extracting media metadata from `imeta` tags.
*   **UI Rendering**: Components like `NoteCard`, `ListingCard`, `OrderCard`, and `ContentRenderer` are responsible for parsing and rendering the raw Nostr event data into a user-friendly interface.

**In summary**, the project utilizes a modern React frontend architecture, tightly coupled with NDK for all Nostr-related interactions. It emphasizes modularity, reactive data flows through hooks, client-side caching for performance, and user-configurable settings, while delegating low-level Nostr protocol and cryptographic complexities to the NDK library.

---
### Most Relevant Files:

*   `src/main.tsx`
*   `src/App.tsx`
*   `src/features/auth/LoginModal.tsx`
*   `src/features/auth/useAutoLogin.ts`
*   `src/hooks/wallet/useWallet.ts`
*   `src/pages/NoteDetailPage.tsx`
*   `src/features/feed/NoteCard.tsx`
*   `src/features/feed/ComposeNote.tsx`
*   `src/stores/settingsStore.ts`
*   `src/components/navigation/RelaySelector.tsx`
*   `local-research/nip60-61-summary.md`
*   `src/features/trades/TakeOrderModal.tsx`
*   `src/components/content/ContentRenderer.tsx`
</file>

<file path="local-research/nip17-implementation-plan.md">
Executing plan command with query: Add support for NIP-17 Direct Messages with NIP-44 encryption and gift wraps using @nostr-dev-kit/ndk ^2.14.35. Include creating utilities for encryption/decryption, sending and receiving encrypted DMs, a UI component for viewing DM threads, and a compose UI for new DMsUsing file provider: gemini
Using file model: gemini-2.5-flash
Using thinking provider: gemini
Using thinking model: gemini-2.5-pro
Finding relevant files...
Running repomix to get file listing...
</file>

<file path="local-research/nip17-spec-details.md">
Querying perplexity using sonar for: Explain NIP-17 Direct Messages specification including NIP-44 encryption and gift wraps implementation details with maxTokens: 21000
NIP-17 is a Nostr Implementation Possibility (NIP) that defines a **private, encrypted direct messaging scheme** using the advanced encryption methods specified in NIP-44 and NIP-59. It establishes a protocol for sending encrypted direct messages (kind 14 events) between users on Nostr, ensuring the confidentiality and privacy of messages.

### Key aspects of NIP-17

- **Direct Message Kind**: Messages are of type `kind=14`, which designates them as chat messages. The messages contain `p` tags that identify one or more recipient public keys, enabling multi-party direct messaging.

- **Message content**: The message `.content` field remains *plain text for the receiver's client*, but this plaintext is after decryption using NIP-44 encryption. Messages **must never be signed** because signing could cause messages to leak as publicly visible events.

- **Tags**:
  - `p` tags specify receiver(s) (their public keys and relay URLs).
  - Optional `e` tags indicate parent message IDs for threading or replies.
  - Optional `subject` tags can define conversation titles.

- **Encryption**: NIP-17 relies on **NIP-44** for encryption, which specifies a *versioned, keypair-based encryption format* designed for upgrading and robust security. NIP-44 uses:
  - secp256k1 ECDH (Elliptic Curve Diffie-Hellman) for shared secret derivation
  - HKDF (key derivation)
  - ChaCha20-Poly1305 for authenticated encryption
  - HMAC-SHA256 for authentication of ciphertext
  - Base64 for encoding ciphertext

- **Gift Wraps and Seals**: NIP-17 leverages **NIP-59**, which defines a **gift wrap protocol** for encapsulating events, thus further obscuring message metadata and providing collaborative signing capabilities. This involves:
  1. **Rumor**: The core event payload (the actual message).
  2. **Seal**: Encrypted rumor with additional metadata, ensuring confidentiality.
  3. **Gift Wrap**: The public event that wraps the sealed rumor, allowing it to be distributed without leaking sensitive information.

This layered approach in NIP-59 enhances privacy by making it difficult for relays or third parties to discern message contents or metadata beyond what is necessary.

### Implementation details summary

| Aspect              | Description                                                                                   |
|---------------------|-----------------------------------------------------------------------------------------------|
| Message Kind        | 14 (chat messages, encrypted direct messages)                                                 |
| Recipient Tags       | `p` tags list intended recipients by public key and relay                                       |
| Encryption scheme    | NIP-44: secp256k1 ECDH, HKDF, ChaCha20-Poly1305, HMAC-SHA256, base64 encoding                  |
| Metadata obfuscation | NIP-59 gift wraps & seals encapsulate and encrypt entire events for privacy & collaborative signing |
| Signatures          | Direct messages **must not be signed** to prevent public leakage                                |
| Content format       | Post-decryption plaintext stored in `.content`                                                |

### Summary

NIP-17 establishes a **secure private messaging protocol on Nostr** by combining:

- **NIP-44's modern, versioned encryption** for encrypting message content,
- **NIP-59's gift wrap protocol** to wrap and encrypt full messages or events to obscure metadata,
- a designated event kind (`14`) and tagging scheme for sender/receiver identification,

thus enabling **private, metadata-protected, encrypted direct messages** in the decentralized Nostr ecosystem[1][2][3][4].
</file>

<file path="local-research/nip60-61-summary.md">
Querying perplexity using sonar for: Summarize NIP-60 and NIP-61 Nostr specifications focusing on wallet events, token management, and nutzaps with maxTokens: 21000
**NIP-60** and **NIP-61** are Nostr protocol extensions designed to enable interoperable Cashu wallets and a token-based micropayment system called Nutzaps, focusing on wallet events, token management, and payment verification.

### NIP-60: Wallet Events and Token Management
- **Wallet Events:** NIP-60 defines a standardized wallet event format for Cashu wallets using the event kind `17375` to represent a user's wallet stored in Nostr relays. This allows the wallet to be accessible and portable across different nostr applications, enabling interoperability[1][2][6].
- The wallet event includes the private key for tokens (distinct from the user's Nostr key), lists the mints the wallet interacts with, and can also be backed up via another event kind `375` to safely store wallet data[2].
- Token management is handled by storing token-related information within these wallet events, allowing for minting, tracking, and swapping of Cashu tokens across trusted mints[1][2].

### NIP-61: Nutzaps (Token Payments and Receipts)
- **Nutzaps** are a specific type of Cashu token payment encapsulated as a token locked with the recipient‚Äôs public key (P2PK), where the payment itself serves as a receipt. Nutzaps are represented by events of kind `9321`[1][3].
- The process flow:
  1. Alice wants to send 1 sat (Satoshi) to Bob as a Nutzap because she liked a particular nostr event (e.g., `event-id-1`).
  2. Alice fetches Bob's `kind:10019` event to learn which mints Bob trusts and the public key (P2PK) to lock tokens to[1][3].
  3. Alice mints or swaps tokens at Bob‚Äôs trusted mint(s), locking them cryptographically to Bob‚Äôs pubkey.
  4. Alice publishes a Nutzap event (`kind:9321`) on the relays Bob specified.
  5. Bob receives the event, fetches Nutzap events tagging him, and swaps the tokens into his wallet[3].
- The `kind:10019` event is a NIP-61 informational event that advertises how to send Nutzaps to a user, including mints, relays, and the public key to use[1][2].
- Nutzaps enhance the verification and trust model of zaps (micropayments) in Nostr by cryptographically binding payments to recipients and events[4].

### Summary Table

| Aspect                  | NIP-60 (Cashu Wallets)                            | NIP-61 (Nutzaps)                                              |
|-------------------------|--------------------------------------------------|---------------------------------------------------------------|
| **Event kinds used**    | Wallet: `17375`; Backup: `375`                    | Nutzap info: `10019`; Nutzap payment: `9321`                  |
| **Wallet portability**  | Wallet stored on relays, accessible across apps  | Nutzap public key corresponds to wallet private key in NIP-60 |
| **Token management**    | Track mints, store keys, mint/swap tokens        | Nutzaps are P2PK Cashu tokens acting as payments + receipts   |
| **Payment flow**        | Mint/track tokens                                 | Send/use Nutzap event referencing an event and token locked to recipient‚Äôs key |
| **Verification**        | Wallet backup events allow recovery               | Payment event itself is proof of transfer, improving zap verification |

NIP-60 enables interoperable, persistent Cashu wallets for managing ecash tokens, while NIP-61 builds on it to provide a secure, verifiable micropayment system (Nutzaps) within Nostr, closely integrated with event liking and trust relationships.

This compound design improves the Nostr ecosystem‚Äôs ability to handle cash transfers and user wallet interoperability securely and flexibly[1][2][3][4].
</file>

<file path="scripts/test-wallet.ts">
#!/usr/bin/env tsx
/**
 * Test script for NIP-60 wallet and NIP-61 nutzaps
 * Refactored to use smaller, single-purpose helper functions
 */
import {
  initializeNDKConnection,
  generateWalletKeypair,
  createCashuWallet,
  createWalletDeposit,
  setupNutzapMonitoring,
  sendNutzapToRecipient,
  cleanupWalletResources,
  type WalletSetupResult,
} from './wallet-helpers';
const TESTNUT_MINT_URL = "https://nofees.testnut.cashu.space";
const DEFAULT_RELAY_URLS = [
  "wss://relay.damus.io",
  "wss://nos.lol",
  "wss://relay.nostr.band",
];
const TEST_DEPOSIT_AMOUNT = 100;
const MONITORING_DURATION_MS = 30000;
async function performWalletSetup(): Promise<WalletSetupResult> {
  console.log("üîß Setting up NDK connection...");
  const ndk = await initializeNDKConnection({
    explicitRelayUrls: DEFAULT_RELAY_URLS,
  });
  console.log("‚úÖ Connected to relays");
  console.log("\nüë§ Generating keypair...");
  const { signer, user } = await generateWalletKeypair();
  console.log("üë§ User pubkey:", user.pubkey);
  console.log("üîê Private key:", signer.privateKey);
  console.log("\nüí∞ Creating NIP-60 wallet...");
  const wallet = await createCashuWallet(ndk, signer, [TESTNUT_MINT_URL]);
  console.log("‚úÖ Wallet created and started");
  console.log("üíµ Initial balance:", wallet.balance?.amount || 0, "sats");
  console.log("\nüëÄ Setting up nutzap monitor...");
  const monitor = await setupNutzapMonitoring(ndk, wallet, user);
  console.log("‚úÖ Nutzap monitor started");
  return { ndk, signer, user, wallet, monitor };
}
async function handleDepositCreation(walletSetup: WalletSetupResult): Promise<void> {
  console.log(`\nüì• Creating deposit for ${TEST_DEPOSIT_AMOUNT} sats...`);
  try {
    const depositResult = await createWalletDeposit(
      walletSetup.wallet,
      TEST_DEPOSIT_AMOUNT,
      TESTNUT_MINT_URL
    );
    console.log("‚úÖ Deposit successful!");
    console.log("üé´ Token received");
    console.log("\nüíµ Balance after deposit:", walletSetup.wallet.balance?.amount || 0, "sats");
  } catch (error) {
    console.error("‚ùå Deposit failed:", error);
    throw error;
  }
}
async function handleNutzapSending(
  walletSetup: WalletSetupResult,
  recipientPubkey: string,
  amountSats: number
): Promise<void> {
  console.log(`\n‚ö° Sending ${amountSats} sat nutzap...`);
  const sendResult = await sendNutzapToRecipient(
    walletSetup.ndk,
    walletSetup.wallet,
    recipientPubkey,
    amountSats
  );
  if (sendResult.success) {
    console.log(`‚úÖ Nutzap sent successfully! ID: ${sendResult.nutzapId?.substring(0, 8)}`);
  } else {
    console.error(`‚ùå Failed to send nutzap:`, sendResult.error?.message);
  }
}
async function monitorForIncomingNutzaps(durationMs: number): Promise<void> {
  console.log(`\n‚è≥ Monitoring for incoming nutzaps for ${durationMs / 1000} seconds...`);
  await new Promise((resolve) => setTimeout(resolve, durationMs));
}
function displayWalletSummary(walletSetup: WalletSetupResult): void {
  console.log("\n‚úÖ Wallet setup complete!");
  console.log("\nWallet Info:");
  console.log("- Pubkey:", walletSetup.user.pubkey);
  console.log("- P2PK:", walletSetup.wallet.p2pk);
  console.log("- Mint:", TESTNUT_MINT_URL);
  console.log("- Balance:", walletSetup.wallet.balance?.amount || 0, "sats");
  console.log("\nüí° To send a nutzap, run:");
  console.log("   tsx scripts/test-wallet.ts send <recipient-pubkey> <amount>");
}
async function main() {
  console.log("üöÄ NIP-60/61 Wallet Test Script\n");
  console.log("This script will:");
  console.log("1. Generate a new keypair");
  console.log("2. Create a NIP-60 wallet");
  console.log("3. Configure the testnut mint");
  console.log("4. Create a test deposit");
  console.log("5. Setup nutzap monitoring");
  console.log("6. Optionally send a test nutzap\n");
  let walletSetup: WalletSetupResult | null = null;
  try {
    walletSetup = await performWalletSetup();
    await handleDepositCreation(walletSetup);
    displayWalletSummary(walletSetup);
    const commandArgs = process.argv.slice(2);
    if (commandArgs[0] === "send" && commandArgs[1] && commandArgs[2]) {
      const recipientPubkey = commandArgs[1];
      const amountSats = parseInt(commandArgs[2]);
      if (isNaN(amountSats) || amountSats <= 0) {
        throw new Error("Invalid amount specified");
      }
      await handleNutzapSending(walletSetup, recipientPubkey, amountSats);
    }
    await monitorForIncomingNutzaps(MONITORING_DURATION_MS);
    console.log("\n‚úÖ Test complete!");
    process.exit(0);
  } catch (error) {
    console.error("\n‚ùå Error:", error instanceof Error ? error.message : String(error));
    process.exit(1);
  } finally {
    if (walletSetup) {
      cleanupWalletResources(walletSetup.wallet, walletSetup.monitor);
    }
  }
}
main();
</file>

<file path="scripts/wallet-helpers.ts">
/**
 * Helper functions for wallet operations
 * Broken down into single-purpose, testable utilities
 */
import NDK, { NDKPrivateKeySigner, NDKEvent, NDKUser, NDKNutzap, NDKZapper } from "@nostr-dev-kit/ndk";
import { NDKCashuWallet, NDKNutzapMonitor } from "@nostr-dev-kit/ndk-wallet";
export interface WalletConnectionConfig {
  explicitRelayUrls: string[];
}
export interface WalletSetupResult {
  ndk: NDK;
  signer: NDKPrivateKeySigner;
  user: NDKUser;
  wallet: NDKCashuWallet;
  monitor: NDKNutzapMonitor;
}
export interface DepositResult {
  token: string;
  amount: number;
  mint: string;
}
export interface NutzapSendResult {
  success: boolean;
  nutzapId?: string;
  error?: Error;
}
/**
 * Initialize NDK connection with specified relays
 */
export async function initializeNDKConnection(config: WalletConnectionConfig): Promise<NDK> {
  const ndk = new NDK(config);
  await ndk.connect();
  return ndk;
}
/**
 * Generate a new keypair and return the signer and user
 */
export async function generateWalletKeypair(): Promise<{
  signer: NDKPrivateKeySigner;
  user: NDKUser;
}> {
  const signer = NDKPrivateKeySigner.generate();
  const user = await signer.user();
  return { signer, user };
}
/**
 * Create and initialize a Cashu wallet with the specified mints
 */
export async function createCashuWallet(
  ndk: NDK,
  signer: NDKPrivateKeySigner,
  mintUrls: string[]
): Promise<NDKCashuWallet> {
  ndk.signer = signer;
  const cashuWallet = new NDKCashuWallet(ndk);
  cashuWallet.mints = [...mintUrls];
  const walletP2PK = await cashuWallet.getP2pk();
  console.log('üîë Wallet P2PK:', walletP2PK);
  await cashuWallet.start();
  return cashuWallet;
}
/**
 * Create a deposit and wait for it to complete
 */
export async function createWalletDeposit(
  wallet: NDKCashuWallet,
  amountSats: number,
  mintUrl: string
): Promise<DepositResult> {
  return new Promise((resolve, reject) => {
    const depositInstance = wallet.deposit(amountSats, mintUrl);
    const timeoutId = setTimeout(() => {
      reject(new Error('Deposit timeout after 60 seconds'));
    }, 60000);
    depositInstance.on('success', (token) => {
      clearTimeout(timeoutId);
      resolve({
        token,
        amount: amountSats,
        mint: mintUrl,
      });
    });
    depositInstance.on('error', (error) => {
      clearTimeout(timeoutId);
      reject(error);
    });
    depositInstance.start();
    console.log('üí° Invoice:', depositInstance.quote);
  });
}
/**
 * Setup nutzap monitoring with event handlers
 */
export async function setupNutzapMonitoring(
  ndk: NDK,
  wallet: NDKCashuWallet,
  user: NDKUser
): Promise<NDKNutzapMonitor> {
  const monitor = new NDKNutzapMonitor(ndk, user, {});
  monitor.wallet = wallet;
  monitor.on('seen', (nutzap: NDKNutzap) => {
    console.log('üëÅÔ∏è  Seen nutzap:', nutzap.id.substring(0, 8));
  });
  monitor.on('redeemed', (nutzaps: NDKNutzap[], totalAmount: number) => {
    console.log(`‚úÖ Redeemed ${nutzaps.length} nutzap(s) for ${totalAmount} sats`);
  });
  monitor.on('failed', (nutzap: NDKNutzap, errorMessage: string) => {
    console.error('‚ùå Failed to redeem nutzap:', nutzap.id.substring(0, 8), errorMessage);
  });
  monitor.on('state_changed', (nutzapId: string, newState: any) => {
    console.log(`üîÑ Nutzap ${nutzapId.substring(0, 8)} state changed to:`, newState);
  });
  await monitor.start({});
  return monitor;
}
/**
 * Send a nutzap to a recipient
 */
export async function sendNutzapToRecipient(
  ndk: NDK,
  wallet: NDKCashuWallet,
  recipientPubkey: string,
  amountSats: number,
  targetEvent?: NDKEvent,
  comment?: string
): Promise<NutzapSendResult> {
  try {
    const recipient = ndk.getUser({ pubkey: recipientPubkey });
    const zapTarget = targetEvent || recipient;
    ndk.walletConfig = {
      cashuPay: async (payment) => {
        const result = await wallet.cashuPay(payment);
        return result;
      },
    };
    const zapper = new NDKZapper(zapTarget, amountSats, "sat", {
      ndk,
      comment: comment || "Nutzap from CLI script",
    });
    const zapResults = await zapper.zap(["nip61"]);
    for (const [zapSplit, zapResult] of zapResults) {
      if (zapResult instanceof Error) {
        return {
          success: false,
          error: zapResult,
        };
      } else if (zapResult instanceof NDKNutzap) {
        return {
          success: true,
          nutzapId: zapResult.id,
        };
      }
    }
    return {
      success: false,
      error: new Error('No valid zap result returned'),
    };
  } catch (error) {
    return {
      success: false,
      error: error instanceof Error ? error : new Error(String(error)),
    };
  }
}
/**
 * Cleanup wallet and monitor resources
 */
export function cleanupWalletResources(
  wallet: NDKCashuWallet,
  monitor: NDKNutzapMonitor
): void {
  wallet.stop();
  monitor.stop();
}
</file>

<file path="src/components/wallet/DepositModal.tsx">
import { useState } from 'react';
import { motion } from 'framer-motion';
import { X, Copy, Check, Loader2, AlertCircle } from 'lucide-react';
import { Dialog } from '../ui/dialog';
interface DepositModalProps {
  isOpen: boolean;
  onClose: () => void;
  onDeposit: (amount: number, mint?: string) => Promise<void>;
  mints: string[];
}
export function DepositModal({ isOpen, onClose, onDeposit, mints }: DepositModalProps) {
  const [amount, setAmount] = useState('100');
  const [selectedMint, setSelectedMint] = useState(mints[0]);
  const [invoice, setInvoice] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [copied, setCopied] = useState(false);
  const handleDeposit = async () => {
    const amountNum = parseInt(amount);
    if (isNaN(amountNum) || amountNum <= 0) {
      setError('Please enter a valid amount');
      return;
    }
    setIsLoading(true);
    setError(null);
    try {
      await onDeposit(amountNum, selectedMint);
      // Reset and close
      setTimeout(() => {
        onClose();
        setAmount('100');
        setInvoice(null);
      }, 1000);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to create deposit');
    } finally {
      setIsLoading(false);
    }
  };
  const handleCopy = async () => {
    if (invoice) {
      await navigator.clipboard.writeText(invoice);
      setCopied(true);
      setTimeout(() => setCopied(false), 2000);
    }
  };
  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      {isOpen && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
        <motion.div
          initial={{ opacity: 0, scale: 0.9 }}
          animate={{ opacity: 1, scale: 1 }}
          exit={{ opacity: 0, scale: 0.9 }}
          className="bg-white dark:bg-neutral-900 rounded-2xl max-w-md w-full p-6 shadow-xl"
        >
          <div className="flex items-center justify-between mb-6">
            <h2 className="text-xl font-semibold text-neutral-900 dark:text-neutral-100">
              Deposit Funds
            </h2>
            <button
              onClick={onClose}
              className="p-2 hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-lg transition-colors"
            >
              <X className="w-5 h-5 text-neutral-500" />
            </button>
          </div>
          {error && (
            <div className="mb-4 p-3 bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-900 rounded-lg flex items-center gap-2">
              <AlertCircle className="w-4 h-4 text-red-600 dark:text-red-400" />
              <p className="text-sm text-red-600 dark:text-red-400">{error}</p>
            </div>
          )}
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2">
                Amount (sats)
              </label>
              <input
                type="number"
                value={amount}
                onChange={(e) => setAmount(e.target.value)}
                className="w-full px-4 py-3 bg-neutral-50 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none"
                placeholder="100"
                min="1"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2">
                Mint
              </label>
              <select
                value={selectedMint}
                onChange={(e) => setSelectedMint(e.target.value)}
                className="w-full px-4 py-3 bg-neutral-50 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none"
              >
                {mints.map((mint) => (
                  <option key={mint} value={mint}>
                    {mint}
                  </option>
                ))}
              </select>
            </div>
            {invoice && (
              <div className="mt-4 p-4 bg-neutral-50 dark:bg-neutral-800 rounded-xl">
                <p className="text-xs text-neutral-500 mb-2">Lightning Invoice</p>
                <div className="flex items-center gap-2">
                  <code className="flex-1 text-xs font-mono break-all text-neutral-700 dark:text-neutral-300">
                    {invoice.substring(0, 40)}...
                  </code>
                  <button
                    onClick={handleCopy}
                    className="p-2 hover:bg-neutral-200 dark:hover:bg-neutral-700 rounded-lg transition-colors"
                  >
                    {copied ? (
                      <Check className="w-4 h-4 text-emerald-500" />
                    ) : (
                      <Copy className="w-4 h-4 text-neutral-500" />
                    )}
                  </button>
                </div>
              </div>
            )}
            <motion.button
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
              onClick={handleDeposit}
              disabled={isLoading}
              className="w-full py-3.5 bg-purple-600 hover:bg-purple-700 disabled:bg-neutral-400 text-white rounded-xl font-medium transition-all flex items-center justify-center gap-2"
            >
              {isLoading ? (
                <>
                  <Loader2 className="w-4 h-4 animate-spin" />
                  <span>Creating Deposit...</span>
                </>
              ) : (
                <span>Create Deposit</span>
              )}
            </motion.button>
          </div>
          <p className="text-xs text-neutral-500 mt-4 text-center">
            Using testnut mint - deposits auto-confirm
          </p>
        </motion.div>
      </div>
      )}
    </Dialog>
  );
}
</file>

<file path="src/hooks/wallet/eventHandlers.ts">
/**
 * Wallet event handlers
 * Manages balance updates and nutzap monitoring events
 */
import type { NDKCashuWallet, NDKNutzapMonitor } from '@nostr-dev-kit/ndk-wallet';
import type { NDKNutzap } from '@nostr-dev-kit/ndk';
import { walletLogger } from '../../utils/walletLogger';
export type BalanceUpdateCallback = (newBalance: number) => void;
/**
 * Setup balance update event listeners
 */
export function setupBalanceListeners(
  wallet: NDKCashuWallet,
  onBalanceUpdate: BalanceUpdateCallback
): () => void {
  const handleBalanceUpdate = () => {
    const updatedBalance = wallet.balance?.amount || 0;
    walletLogger.info(`Balance updated: ${updatedBalance} sats`, 'setupBalanceListeners');
    onBalanceUpdate(updatedBalance);
  };
  const handleWalletReady = () => {
    walletLogger.info('Wallet ready event received', 'setupBalanceListeners');
    const currentBalance = wallet.balance?.amount || 0;
    onBalanceUpdate(currentBalance);
  };
  wallet.on('balance_updated', handleBalanceUpdate);
  wallet.on('ready', handleWalletReady);
  return () => {
    wallet.off('balance_updated', handleBalanceUpdate);
    wallet.off('ready', handleWalletReady);
  };
}
/**
 * Setup nutzap monitoring event listeners
 */
export function setupNutzapMonitorListeners(monitor: NDKNutzapMonitor): () => void {
  const handleNutzapSeen = (nutzap: NDKNutzap) => {
    walletLogger.info(`Nutzap seen: ${nutzap.id.substring(0, 8)}`, 'setupNutzapMonitorListeners');
  };
  const handleNutzapRedeemed = (nutzaps: NDKNutzap[], totalAmount: number) => {
    walletLogger.info(
      `Redeemed ${nutzaps.length} nutzap(s) for ${totalAmount} sats`,
      'setupNutzapMonitorListeners'
    );
  };
  const handleNutzapFailed = (nutzap: NDKNutzap, errorMessage: string) => {
    walletLogger.error(
      `Failed to redeem nutzap: ${nutzap.id.substring(0, 8)}`,
      'setupNutzapMonitorListeners',
      errorMessage
    );
  };
  const handleNutzapStateChanged = (nutzapId: string, newState: any) => {
    walletLogger.debug(
      `Nutzap ${nutzapId.substring(0, 8)} state changed`,
      'setupNutzapMonitorListeners',
      newState
    );
  };
  monitor.on('seen', handleNutzapSeen);
  monitor.on('redeemed', handleNutzapRedeemed);
  monitor.on('failed', handleNutzapFailed);
  monitor.on('state_changed', handleNutzapStateChanged);
  return () => {
    monitor.off('seen', handleNutzapSeen);
    monitor.off('redeemed', handleNutzapRedeemed);
    monitor.off('failed', handleNutzapFailed);
    monitor.off('state_changed', handleNutzapStateChanged);
  };
}
</file>

<file path="src/hooks/wallet/initialization.ts">
/**
 * Wallet initialization logic
 * Handles setting up NDKCashuWallet and NDKNutzapMonitor
 */
import type NDK from '@nostr-dev-kit/ndk';
import type { NDKUser } from '@nostr-dev-kit/ndk';
import { NDKCashuWallet, NDKNutzapMonitor } from '@nostr-dev-kit/ndk-wallet';
import { walletLogger } from '../../utils/walletLogger';
import { toWalletError, retryWithBackoff } from '../../utils/walletErrors';
import { createNutzapMonitorStore } from '../../stores/walletStore';
export interface WalletInitializationConfig {
  ndk: NDK;
  currentUser: NDKUser;
  mintUrls: string[];
}
export interface WalletInitializationResult {
  wallet: NDKCashuWallet;
  monitor: NDKNutzapMonitor;
  initialBalance: number;
}
/**
 * Initialize the Cashu wallet with retry logic
 */
async function initializeCashuWallet(
  ndk: NDK,
  mintUrls: string[]
): Promise<NDKCashuWallet> {
  return retryWithBackoff(async () => {
    walletLogger.info('Initializing Cashu wallet', 'initializeCashuWallet');
    const cashuWallet = new NDKCashuWallet(ndk as any);
    cashuWallet.mints = [...mintUrls];
    const walletP2PK = await cashuWallet.getP2pk();
    walletLogger.info(`Wallet P2PK generated: ${walletP2PK}`, 'initializeCashuWallet');
    await cashuWallet.start();
    walletLogger.info('Cashu wallet started successfully', 'initializeCashuWallet');
    return cashuWallet;
  }, {
    maxAttempts: 3,
    delayMs: 1000,
  });
}
/**
 * Initialize the nutzap monitor with retry logic
 */
async function initializeNutzapMonitor(
  ndk: NDK,
  currentUser: NDKUser,
  wallet: NDKCashuWallet
): Promise<NDKNutzapMonitor> {
  return retryWithBackoff(async () => {
    walletLogger.info('Initializing nutzap monitor', 'initializeNutzapMonitor');
    const nutzapMonitor = new NDKNutzapMonitor(ndk as any, currentUser as any, {
      store: createNutzapMonitorStore(),
    });
    nutzapMonitor.wallet = wallet;
    await nutzapMonitor.start({});
    walletLogger.info('Nutzap monitor started successfully', 'initializeNutzapMonitor');
    return nutzapMonitor;
  }, {
    maxAttempts: 3,
    delayMs: 1000,
  });
}
/**
 * Configure NDK wallet integration
 */
function configureNDKWalletIntegration(ndk: NDK, wallet: NDKCashuWallet): void {
  (ndk as any).walletConfig = {
    cashuPay: async (payment: any) => {
      walletLogger.info('Processing Cashu payment', 'configureNDKWalletIntegration', {
        amount: payment.amount,
        unit: payment.unit,
      });
      const result = await wallet.cashuPay(payment);
      return result;
    },
    lnPay: async (payment: any) => {
      walletLogger.info('Processing Lightning payment', 'configureNDKWalletIntegration', {
        amount: payment.amount,
        unit: payment.unit,
      });
      const result = await wallet.lnPay(payment);
      return result;
    },
  };
}
/**
 * Main wallet initialization function
 */
export async function initializeWallet(
  config: WalletInitializationConfig
): Promise<WalletInitializationResult> {
  const { ndk, currentUser, mintUrls } = config;
  try {
    walletLogger.info('Starting wallet initialization', 'initializeWallet', { mintUrls });
    const wallet = await initializeCashuWallet(ndk, mintUrls);
    configureNDKWalletIntegration(ndk, wallet);
    const monitor = await initializeNutzapMonitor(ndk, currentUser, wallet);
    const initialBalance = wallet.balance?.amount || 0;
    walletLogger.info('Wallet initialization complete', 'initializeWallet', {
      balance: initialBalance,
      p2pk: wallet.p2pk,
    });
    return {
      wallet,
      monitor,
      initialBalance,
    };
  } catch (error) {
    walletLogger.error('Wallet initialization failed', 'initializeWallet', error);
    throw toWalletError(error, 'Wallet initialization failed');
  }
}
/**
 * Cleanup wallet resources
 */
export function cleanupWallet(wallet: NDKCashuWallet, monitor: NDKNutzapMonitor): void {
  try {
    walletLogger.info('Cleaning up wallet resources', 'cleanupWallet');
    wallet.stop();
    monitor.stop();
    walletLogger.info('Wallet cleanup complete', 'cleanupWallet');
  } catch (error) {
    walletLogger.error('Error during wallet cleanup', 'cleanupWallet', error);
  }
}
</file>

<file path="src/hooks/wallet/operations.ts">
/**
 * Wallet operations
 * Handles deposits, token receiving, and balance queries
 */
import type { NDKCashuWallet } from '@nostr-dev-kit/ndk-wallet';
import { walletLogger } from '../../utils/walletLogger';
import { toWalletError, retryWithBackoff } from '../../utils/walletErrors';
const DEPOSIT_TIMEOUT_MS = 120000; // 2 minutes
export interface DepositOptions {
  amountSats: number;
  mintUrl: string;
  timeoutMs?: number;
}
/**
 * Create a deposit with timeout and error handling
 */
export async function createDeposit(
  wallet: NDKCashuWallet,
  options: DepositOptions
): Promise<string> {
  const { amountSats, mintUrl, timeoutMs = DEPOSIT_TIMEOUT_MS } = options;
  return retryWithBackoff(async () => {
    walletLogger.info(
      `Creating deposit for ${amountSats} sats`,
      'createDeposit',
      { mintUrl }
    );
    return new Promise<string>((resolve, reject) => {
      const depositInstance = wallet.deposit(amountSats, mintUrl);
      const timeoutId = setTimeout(() => {
        reject(
          toWalletError(
            new Error(`Deposit timeout after ${timeoutMs}ms`),
            'Deposit operation timed out'
          )
        );
      }, timeoutMs);
      depositInstance.on('success', (token: any) => {
        clearTimeout(timeoutId);
        const tokenStr = typeof token === 'string' ? token : JSON.stringify(token);
        walletLogger.info('Deposit successful', 'createDeposit', { token: tokenStr.substring(0, 20) });
        resolve(tokenStr);
      });
      depositInstance.on('error', (error: any) => {
        clearTimeout(timeoutId);
        const errorObj = typeof error === 'string' ? new Error(error) : error;
        walletLogger.error('Deposit failed', 'createDeposit', errorObj);
        reject(toWalletError(errorObj, 'Deposit operation failed'));
      });
      depositInstance.start();
      if (depositInstance.quoteId) {
        walletLogger.debug('Deposit invoice generated', 'createDeposit', {
          quoteId: depositInstance.quoteId,
        });
      }
    });
  }, {
    maxAttempts: 2,
    delayMs: 2000,
  });
}
/**
 * Receive a Cashu token with error handling
 */
export async function receiveToken(
  wallet: NDKCashuWallet,
  token: string,
  description?: string
): Promise<void> {
  try {
    walletLogger.info(
      'Receiving Cashu token',
      'receiveToken',
      { description, tokenPrefix: token.substring(0, 20) }
    );
    const tokenEvent = await wallet.receiveToken(token, description);
    if (tokenEvent) {
      walletLogger.info(
        'Token received successfully',
        'receiveToken',
        { eventId: tokenEvent.id }
      );
    }
  } catch (error) {
    walletLogger.error('Failed to receive token', 'receiveToken', error);
    throw toWalletError(error, 'Failed to receive token');
  }
}
/**
 * Get current wallet balance with retry
 */
export async function queryBalance(wallet: NDKCashuWallet): Promise<number> {
  try {
    const currentBalance = wallet.balance?.amount || 0;
    walletLogger.debug('Balance queried', 'queryBalance', { balance: currentBalance });
    return currentBalance;
  } catch (error) {
    walletLogger.warn('Failed to query balance', 'queryBalance', error);
    return wallet.balance?.amount || 0;
  }
}
</file>

<file path="src/hooks/wallet/types.ts">
/**
 * TypeScript types for wallet hooks
 */
import type { NDKCashuWallet, NDKNutzapMonitor } from '@nostr-dev-kit/ndk-wallet';
export interface WalletState {
  wallet: NDKCashuWallet | null;
  monitor: NDKNutzapMonitor | null;
  balance: number;
  isReady: boolean;
  isInitializing: boolean;
  error: string | null;
  p2pk: string | undefined;
}
export interface WalletActions {
  deposit: (amountSats: number, mintUrl?: string) => Promise<string>;
  receiveToken: (token: string, description?: string) => Promise<void>;
  refreshBalance: () => Promise<void>;
}
export type WalletHookReturn = WalletState & WalletActions;
</file>

<file path="src/hooks/wallet/useWallet.ts">
/**
 * Main wallet hook
 * Integrates initialization, event handling, and operations
 */
import { useEffect, useState, useCallback, useRef } from 'react';
import { useNDK, useNDKCurrentUser } from '@nostr-dev-kit/ndk-hooks';
import { useWalletStore } from '../../stores/walletStore';
import { walletLogger } from '../../utils/walletLogger';
import { getUserFriendlyErrorMessage, WalletError } from '../../utils/walletErrors';
import {
  initializeWallet,
  cleanupWallet,
  type WalletInitializationResult,
} from './initialization';
import {
  setupBalanceListeners,
  setupNutzapMonitorListeners,
} from './eventHandlers';
import {
  createDeposit as createDepositOperation,
  receiveToken as receiveTokenOperation,
  queryBalance,
} from './operations';
import type { WalletHookReturn } from './types';
const BALANCE_POLLING_INTERVAL_MS = 30000; // Poll every 30 seconds as fallback
export function useWallet(): WalletHookReturn {
  const { ndk } = useNDK();
  const currentUser = useNDKCurrentUser();
  const mintUrls = useWalletStore((state) => state.mints);
  const [wallet, setWallet] = useState<WalletInitializationResult['wallet'] | null>(null);
  const [monitor, setMonitor] = useState<WalletInitializationResult['monitor'] | null>(null);
  const [balance, setBalance] = useState(0);
  const [isReady, setIsReady] = useState(false);
  const [isInitializing, setIsInitializing] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const balancePollingRef = useRef<NodeJS.Timeout | null>(null);
  // Initialize wallet when NDK and user are available
  useEffect(() => {
    if (!ndk || !currentUser || mintUrls.length === 0) {
      setWallet(null);
      setMonitor(null);
      setIsReady(false);
      setIsInitializing(false);
      return;
    }
    let isMounted = true;
    let cleanupBalanceListeners: (() => void) | null = null;
    let cleanupMonitorListeners: (() => void) | null = null;
    async function performWalletInitialization() {
      setIsInitializing(true);
      setError(null);
      try {
        walletLogger.info('Starting wallet initialization', 'useWallet');
        const initResult = await initializeWallet({
          ndk,
          currentUser,
          mintUrls,
        });
        if (!isMounted) return;
        const { wallet: initializedWallet, monitor: initializedMonitor, initialBalance } = initResult;
        // Setup event listeners
        cleanupBalanceListeners = setupBalanceListeners(
          initializedWallet,
          (newBalance) => {
            if (isMounted) {
              setBalance(newBalance);
            }
          }
        );
        cleanupMonitorListeners = setupNutzapMonitorListeners(initializedMonitor);
        setWallet(initializedWallet);
        setMonitor(initializedMonitor);
        setBalance(initialBalance);
        setIsReady(true);
        setIsInitializing(false);
        walletLogger.info('Wallet initialization complete', 'useWallet');
      } catch (err) {
        if (!isMounted) return;
        const walletError = err instanceof WalletError ? err : new WalletError(
          err instanceof Error ? err.message : 'Unknown error',
          err instanceof Error ? (err as any).code : 'UNKNOWN_ERROR'
        );
        const friendlyMessage = getUserFriendlyErrorMessage(walletError);
        setError(friendlyMessage);
        setIsInitializing(false);
        walletLogger.error('Wallet initialization failed', 'useWallet', err);
      }
    }
    performWalletInitialization();
    return () => {
      isMounted = false;
      if (cleanupBalanceListeners) cleanupBalanceListeners();
      if (cleanupMonitorListeners) cleanupMonitorListeners();
      if (wallet && monitor) {
        cleanupWallet(wallet, monitor);
      }
    };
  }, [ndk, currentUser, mintUrls]);
  // Fallback balance polling mechanism
  useEffect(() => {
    if (!wallet || !isReady) {
      if (balancePollingRef.current) {
        clearInterval(balancePollingRef.current);
        balancePollingRef.current = null;
      }
      return;
    }
    balancePollingRef.current = setInterval(async () => {
      try {
        const updatedBalance = await queryBalance(wallet);
        setBalance(updatedBalance);
      } catch (err) {
        walletLogger.warn('Balance polling failed', 'useWallet', err);
      }
    }, BALANCE_POLLING_INTERVAL_MS);
    return () => {
      if (balancePollingRef.current) {
        clearInterval(balancePollingRef.current);
        balancePollingRef.current = null;
      }
    };
  }, [wallet, isReady]);
  // Deposit action
  const deposit = useCallback(
    async (amountSats: number, mintUrl?: string): Promise<string> => {
      if (!wallet) {
        throw new Error('Wallet not initialized');
      }
      const targetMint = mintUrl || mintUrls[0];
      if (!targetMint) {
        throw new Error('No mint configured');
      }
      walletLogger.info(`Initiating deposit: ${amountSats} sats`, 'useWallet.deposit');
      const token = await createDepositOperation(wallet, {
        amountSats,
        mintUrl: targetMint,
      });
      walletLogger.info('Deposit completed', 'useWallet.deposit');
      return token;
    },
    [wallet, mintUrls]
  );
  // Receive token action
  const receiveToken = useCallback(
    async (token: string, description?: string): Promise<void> => {
      if (!wallet) {
        throw new Error('Wallet not initialized');
      }
      walletLogger.info('Receiving token', 'useWallet.receiveToken', { description });
      await receiveTokenOperation(wallet, token, description);
      walletLogger.info('Token received', 'useWallet.receiveToken');
    },
    [wallet]
  );
  // Refresh balance action
  const refreshBalance = useCallback(async (): Promise<void> => {
    if (!wallet) {
      throw new Error('Wallet not initialized');
    }
    walletLogger.info('Manually refreshing balance', 'useWallet.refreshBalance');
    const updatedBalance = await queryBalance(wallet);
    setBalance(updatedBalance);
  }, [wallet]);
  return {
    wallet,
    monitor,
    balance,
    isReady,
    isInitializing,
    error,
    p2pk: wallet?.p2pk,
    deposit,
    receiveToken,
    refreshBalance,
  };
}
</file>

<file path="src/hooks/useWallet.ts">
/**
 * Re-export the modular wallet hook
 * Maintains backwards compatibility while using refactored modules
 */
export { useWallet } from './wallet/useWallet';
export type { WalletHookReturn, WalletState, WalletActions } from './wallet/types';
</file>

<file path="src/hooks/useZap.ts">
import { useState, useCallback } from 'react';
import { NDKEvent, NDKZapper } from '@nostr-dev-kit/ndk-hooks';
import { useNDK } from '@nostr-dev-kit/ndk-hooks';
import { useWallet } from './useWallet';
import { walletLogger } from '@/utils/walletLogger';
import { toWalletError } from '@/utils/walletErrors';
interface UseZapOptions {
  onSuccess?: (amount: number, eventId: string) => void;
  onError?: (error: Error) => void;
}
export function useZap(options: UseZapOptions = {}) {
  const { ndk } = useNDK();
  const { wallet, isReady: isWalletReady } = useWallet();
  const [isZapping, setIsZapping] = useState(false);
  const sendZap = useCallback(async (
    event: NDKEvent,
    amountSats: number,
    comment?: string
  ): Promise<boolean> => {
    if (!ndk) {
      const error = new Error('NDK not initialized');
      walletLogger.error('Zap failed: NDK not initialized', 'useZap');
      options.onError?.(error);
      return false;
    }
    if (!isWalletReady || !wallet) {
      const error = new Error('Wallet not ready');
      walletLogger.error('Zap failed: Wallet not ready', 'useZap');
      options.onError?.(error);
      return false;
    }
    setIsZapping(true);
    try {
      walletLogger.info(
        `Initiating nutzap: ${amountSats} sats to event ${event.id}`,
        'useZap',
        { amountSats, eventId: event.id, authorPubkey: event.pubkey }
      );
      const zapper = new NDKZapper(event, amountSats, 'sat', {
        ndk,
        comment: comment || `Zapped ${amountSats} sats`,
        cashuPay: wallet,
      });
      const zapResults = await zapper.zap(['nip61']);
      if (!zapResults || zapResults.length === 0) {
        throw new Error('Zap failed: No results returned');
      }
      const successfulZaps = zapResults.filter((result) => result !== null);
      if (successfulZaps.length === 0) {
        throw new Error('Zap failed: All zap attempts failed');
      }
      walletLogger.info(
        `Nutzap successful: ${amountSats} sats`,
        'useZap',
        { eventId: event.id, results: zapResults.length }
      );
      options.onSuccess?.(amountSats, event.id);
      return true;
    } catch (error) {
      const walletError = toWalletError(error, 'Failed to send zap');
      walletLogger.error('Zap failed', 'useZap', walletError);
      options.onError?.(walletError);
      return false;
    } finally {
      setIsZapping(false);
    }
  }, [ndk, wallet, isWalletReady, options]);
  return {
    sendZap,
    isZapping,
    canZap: isWalletReady && !!wallet,
  };
}
</file>

<file path="src/pages/WalletSettingsPage.tsx">
import { useState } from 'react';
import { motion } from 'framer-motion';
import { ArrowLeft, ChevronRight, Zap, MessageCircle, Radio, Share2, Users } from 'lucide-react';
import { useNavigate } from 'react-router-dom';
export function WalletSettingsPage() {
  const navigate = useNavigate();
  const [defaultZapper, setDefaultZapper] = useState<string>('');
  const [defaultReaction, setDefaultReaction] = useState<string>('üëç');
  const settingsSections = [
    {
      title: 'Zapping',
      items: [
        {
          icon: Zap,
          iconColor: 'text-yellow-400',
          iconBg: 'bg-yellow-400/10',
          label: 'Default Zapper',
          description: 'Set your preferred wallet for sending zaps',
          onClick: () => {
            // Navigate to default zapper configuration
          },
        },
        {
          icon: MessageCircle,
          iconColor: 'text-blue-400',
          iconBg: 'bg-blue-400/10',
          label: 'Default Non-zapping Reaction',
          description: 'Choose your default reaction emoji',
          onClick: () => {
            // Navigate to reaction picker
          },
        },
        {
          icon: Users,
          iconColor: 'text-purple-400',
          iconBg: 'bg-purple-400/10',
          label: 'Zap Splits',
          description: 'Configure how zaps are split between recipients',
          onClick: () => {
            // Navigate to zap splits configuration
          },
        },
      ],
    },
    {
      title: 'Network',
      items: [
        {
          icon: Radio,
          iconColor: 'text-green-400',
          iconBg: 'bg-green-400/10',
          label: 'Relays for Receiving Zaps',
          description: 'Manage relays where you receive zaps',
          onClick: () => {
            // Navigate to relay management
          },
        },
        {
          icon: Share2,
          iconColor: 'text-orange-400',
          iconBg: 'bg-orange-400/10',
          label: 'Broadcasting Zaps',
          description: 'Configure how zaps are broadcast to the network',
          onClick: () => {
            // Navigate to broadcast settings
          },
        },
      ],
    },
  ];
  return (
    <div className="w-full min-h-screen bg-gradient-to-b from-neutral-50 to-white dark:from-neutral-950 dark:to-black">
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        className="max-w-lg mx-auto"
      >
        {/* Header */}
        <div className="px-6 pt-6 pb-4 border-b border-neutral-200 dark:border-neutral-800">
          <div className="flex items-center gap-3">
            <motion.button
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.95 }}
              onClick={() => navigate('/wallet')}
              className="p-2 hover:bg-neutral-200/50 dark:hover:bg-neutral-800/30 rounded-lg transition-all"
            >
              <ArrowLeft className="w-5 h-5 text-neutral-700 dark:text-neutral-300" />
            </motion.button>
            <h1 className="text-xl font-semibold text-neutral-900 dark:text-neutral-100">
              Wallet Settings
            </h1>
          </div>
        </div>
        {/* Settings Sections */}
        <div className="px-6 py-6 space-y-8">
          {settingsSections.map((section, sectionIdx) => (
            <div key={sectionIdx}>
              <h2 className="text-xs uppercase tracking-wider text-neutral-500 mb-3 font-medium">
                {section.title}
              </h2>
              <div className="space-y-2">
                {section.items.map((item, itemIdx) => {
                  const Icon = item.icon;
                  return (
                    <motion.button
                      key={itemIdx}
                      whileHover={{ scale: 1.01 }}
                      whileTap={{ scale: 0.99 }}
                      onClick={item.onClick}
                      className="w-full bg-neutral-100 dark:bg-neutral-900 hover:bg-neutral-200 dark:hover:bg-neutral-800 border border-neutral-200 dark:border-neutral-800 rounded-xl p-4 flex items-center justify-between transition-all"
                    >
                      <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 ${item.iconBg} rounded-lg flex items-center justify-center`}>
                          <Icon className={`w-5 h-5 ${item.iconColor}`} />
                        </div>
                        <div className="text-left">
                          <div className="text-sm font-medium text-neutral-900 dark:text-neutral-100">
                            {item.label}
                          </div>
                          <div className="text-xs text-neutral-500 dark:text-neutral-600">
                            {item.description}
                          </div>
                        </div>
                      </div>
                      <ChevronRight className="w-4 h-4 text-neutral-400" />
                    </motion.button>
                  );
                })}
              </div>
            </div>
          ))}
        </div>
      </motion.div>
    </div>
  );
}
</file>

<file path="src/stores/walletStore.ts">
import { create } from 'zustand';
import { persist } from 'zustand/middleware';
import type { NDKNutzapState, NDKEventId } from '@nostr-dev-kit/ndk';
import { NdkNutzapStatus } from '@nostr-dev-kit/ndk';
import type { NDKNutzapMonitorStore } from '@nostr-dev-kit/ndk-wallet';
interface WalletState {
  // Nutzap state tracking
  nutzaps: Map<NDKEventId, NDKNutzapState>;
  // Wallet configuration
  mints: string[];
  selectedMint: string | null;
  // Actions
  setNutzapState: (id: NDKEventId, state: Partial<NDKNutzapState>) => Promise<void>;
  getAllNutzaps: () => Promise<Map<NDKEventId, NDKNutzapState>>;
  addMint: (mint: string) => void;
  removeMint: (mint: string) => void;
  setSelectedMint: (mint: string | null) => void;
}
export const useWalletStore = create<WalletState>()(
  persist(
    (set, get) => ({
      nutzaps: new Map(),
      mints: ['https://nofees.testnut.cashu.space'],
      selectedMint: null,
      setNutzapState: async (id: NDKEventId, stateChange: Partial<NDKNutzapState>) => {
        set((state) => {
          const nutzaps = new Map(state.nutzaps);
          const current = nutzaps.get(id) || { status: NdkNutzapStatus.INITIAL };
          nutzaps.set(id, { ...current, ...stateChange });
          return { nutzaps };
        });
      },
      getAllNutzaps: async () => {
        return get().nutzaps;
      },
      addMint: (mint: string) => {
        set((state) => {
          if (state.mints.includes(mint)) return state;
          return { mints: [...state.mints, mint] };
        });
      },
      removeMint: (mint: string) => {
        set((state) => ({
          mints: state.mints.filter((m) => m !== mint),
          selectedMint: state.selectedMint === mint ? null : state.selectedMint,
        }));
      },
      setSelectedMint: (mint: string | null) => {
        set({ selectedMint: mint });
      },
    }),
    {
      name: 'voces-wallet-storage',
      partialize: (state) => ({
        mints: state.mints,
        selectedMint: state.selectedMint,
        // Note: nutzaps Map needs special handling for persistence
        nutzaps: Array.from(state.nutzaps.entries()),
      }),
      merge: (persistedState: any, currentState) => {
        // Convert persisted nutzaps array back to Map
        const nutzapsArray = persistedState?.nutzaps || [];
        const nutzapsMap = new Map(nutzapsArray);
        return {
          ...currentState,
          ...persistedState,
          nutzaps: nutzapsMap,
        };
      },
    }
  )
);
// Create a store adapter for NDKNutzapMonitor
export function createNutzapMonitorStore(): NDKNutzapMonitorStore {
  return {
    getAllNutzaps: () => useWalletStore.getState().getAllNutzaps(),
    setNutzapState: (id, state) => useWalletStore.getState().setNutzapState(id, state),
  };
}
</file>

<file path="src/utils/followUtils.ts">
import { NDK, NDKEvent, NDKKind, NDKUser } from '@nostr-dev-kit/ndk';
export async function followMultipleUsers(
  ndk: NDK,
  currentUser: NDKUser,
  pubkeysToFollow: string[]
): Promise<void> {
  if (!currentUser.pubkey) {
    throw new Error('Current user has no pubkey');
  }
  const existingFollowList = await ndk.fetchEvent({
    kinds: [NDKKind.Contacts],
    authors: [currentUser.pubkey],
  });
  const currentFollows = new Set<string>();
  if (existingFollowList) {
    existingFollowList.tags
      .filter(tag => tag[0] === 'p')
      .forEach(tag => currentFollows.add(tag[1]));
  }
  pubkeysToFollow.forEach(pubkey => currentFollows.add(pubkey));
  const newFollowList = new NDKEvent(ndk);
  newFollowList.kind = NDKKind.Contacts;
  newFollowList.tags = Array.from(currentFollows).map(pubkey => ['p', pubkey]);
  newFollowList.content = existingFollowList?.content || '';
  await newFollowList.publishReplaceable();
}
export async function followUser(
  ndk: NDK,
  currentUser: NDKUser,
  pubkeyToFollow: string
): Promise<void> {
  return followMultipleUsers(ndk, currentUser, [pubkeyToFollow]);
}
export async function unfollowUser(
  ndk: NDK,
  currentUser: NDKUser,
  pubkeyToUnfollow: string
): Promise<void> {
  if (!currentUser.pubkey) {
    throw new Error('Current user has no pubkey');
  }
  const existingFollowList = await ndk.fetchEvent({
    kinds: [NDKKind.Contacts],
    authors: [currentUser.pubkey],
  });
  if (!existingFollowList) {
    return;
  }
  const currentFollows = new Set<string>();
  existingFollowList.tags
    .filter(tag => tag[0] === 'p')
    .forEach(tag => currentFollows.add(tag[1]));
  currentFollows.delete(pubkeyToUnfollow);
  const newFollowList = new NDKEvent(ndk);
  newFollowList.kind = NDKKind.Contacts;
  newFollowList.tags = Array.from(currentFollows).map(pubkey => ['p', pubkey]);
  newFollowList.content = existingFollowList.content || '';
  await newFollowList.publishReplaceable();
}
</file>

<file path="src/utils/walletErrors.ts">
/**
 * Wallet error handling utilities
 * Provides user-friendly error messages and retry logic
 */
export class WalletError extends Error {
  constructor(
    message: string,
    public readonly code: WalletErrorCode,
    public readonly recoverable: boolean = true,
    public readonly originalError?: Error
  ) {
    super(message);
    this.name = 'WalletError';
  }
}
export enum WalletErrorCode {
  INITIALIZATION_FAILED = 'INITIALIZATION_FAILED',
  CONNECTION_FAILED = 'CONNECTION_FAILED',
  MINT_UNAVAILABLE = 'MINT_UNAVAILABLE',
  INSUFFICIENT_BALANCE = 'INSUFFICIENT_BALANCE',
  DEPOSIT_FAILED = 'DEPOSIT_FAILED',
  WITHDRAWAL_FAILED = 'WITHDRAWAL_FAILED',
  NUTZAP_FAILED = 'NUTZAP_FAILED',
  INVALID_TOKEN = 'INVALID_TOKEN',
  NETWORK_ERROR = 'NETWORK_ERROR',
  UNKNOWN_ERROR = 'UNKNOWN_ERROR',
}
export interface RetryConfig {
  maxAttempts: number;
  delayMs: number;
  backoffMultiplier: number;
}
const DEFAULT_RETRY_CONFIG: RetryConfig = {
  maxAttempts: 3,
  delayMs: 1000,
  backoffMultiplier: 2,
};
/**
 * Retry an async operation with exponential backoff
 */
export async function retryWithBackoff<T>(
  operation: () => Promise<T>,
  config: Partial<RetryConfig> = {}
): Promise<T> {
  const { maxAttempts, delayMs, backoffMultiplier } = {
    ...DEFAULT_RETRY_CONFIG,
    ...config,
  };
  let lastError: Error | undefined;
  let currentDelay = delayMs;
  for (let attempt = 1; attempt <= maxAttempts; attempt++) {
    try {
      return await operation();
    } catch (error) {
      lastError = error instanceof Error ? error : new Error(String(error));
      if (attempt === maxAttempts) {
        throw lastError;
      }
      await new Promise((resolve) => setTimeout(resolve, currentDelay));
      currentDelay *= backoffMultiplier;
    }
  }
  throw lastError || new Error('Operation failed after retries');
}
/**
 * Convert raw errors to user-friendly WalletError instances
 */
export function toWalletError(error: unknown, context?: string): WalletError {
  if (error instanceof WalletError) {
    return error;
  }
  const originalError = error instanceof Error ? error : new Error(String(error));
  const message = originalError.message.toLowerCase();
  // Network errors
  if (message.includes('network') || message.includes('connection') || message.includes('timeout')) {
    return new WalletError(
      'Network connection failed. Please check your internet connection.',
      WalletErrorCode.NETWORK_ERROR,
      true,
      originalError
    );
  }
  // Mint errors
  if (message.includes('mint') || message.includes('unavailable')) {
    return new WalletError(
      'Mint service is temporarily unavailable. Please try again later.',
      WalletErrorCode.MINT_UNAVAILABLE,
      true,
      originalError
    );
  }
  // Balance errors
  if (message.includes('insufficient') || message.includes('balance')) {
    return new WalletError(
      'Insufficient balance for this transaction.',
      WalletErrorCode.INSUFFICIENT_BALANCE,
      false,
      originalError
    );
  }
  // Token errors
  if (message.includes('token') || message.includes('invalid')) {
    return new WalletError(
      'Invalid or corrupted token. Please try a different payment method.',
      WalletErrorCode.INVALID_TOKEN,
      false,
      originalError
    );
  }
  // Generic error
  return new WalletError(
    context
      ? `${context}: ${originalError.message}`
      : originalError.message,
    WalletErrorCode.UNKNOWN_ERROR,
    true,
    originalError
  );
}
/**
 * Get user-friendly error message
 */
export function getUserFriendlyErrorMessage(error: WalletError): string {
  const baseMessage = error.message;
  if (error.recoverable) {
    return `${baseMessage} Please try again.`;
  }
  return baseMessage;
}
</file>

<file path="src/utils/walletLogger.ts">
/**
 * Shared logging utility for wallet operations
 * Provides consistent logging across wallet-related code
 */
export enum WalletLogLevel {
  DEBUG = 'DEBUG',
  INFO = 'INFO',
  WARN = 'WARN',
  ERROR = 'ERROR',
}
interface WalletLogEntry {
  level: WalletLogLevel;
  message: string;
  context?: string;
  data?: unknown;
  timestamp: Date;
}
class WalletLogger {
  private logs: WalletLogEntry[] = [];
  private maxLogs = 1000;
  private log(level: WalletLogLevel, message: string, context?: string, data?: unknown) {
    const entry: WalletLogEntry = {
      level,
      message,
      context,
      data,
      timestamp: new Date(),
    };
    this.logs.push(entry);
    if (this.logs.length > this.maxLogs) {
      this.logs.shift();
    }
    const prefix = context ? `[${context}]` : '';
    const emoji = this.getEmoji(level);
    switch (level) {
      case WalletLogLevel.DEBUG:
        console.debug(`${emoji} ${prefix}`, message, data || '');
        break;
      case WalletLogLevel.INFO:
        console.log(`${emoji} ${prefix}`, message, data || '');
        break;
      case WalletLogLevel.WARN:
        console.warn(`${emoji} ${prefix}`, message, data || '');
        break;
      case WalletLogLevel.ERROR:
        console.error(`${emoji} ${prefix}`, message, data || '');
        break;
    }
  }
  private getEmoji(level: WalletLogLevel): string {
    switch (level) {
      case WalletLogLevel.DEBUG:
        return 'üîç';
      case WalletLogLevel.INFO:
        return '‚úÖ';
      case WalletLogLevel.WARN:
        return '‚ö†Ô∏è';
      case WalletLogLevel.ERROR:
        return '‚ùå';
    }
  }
  debug(message: string, context?: string, data?: unknown) {
    this.log(WalletLogLevel.DEBUG, message, context, data);
  }
  info(message: string, context?: string, data?: unknown) {
    this.log(WalletLogLevel.INFO, message, context, data);
  }
  warn(message: string, context?: string, data?: unknown) {
    this.log(WalletLogLevel.WARN, message, context, data);
  }
  error(message: string, context?: string, data?: unknown) {
    this.log(WalletLogLevel.ERROR, message, context, data);
  }
  getLogs(): WalletLogEntry[] {
    return [...this.logs];
  }
  clearLogs() {
    this.logs = [];
  }
}
export const walletLogger = new WalletLogger();
</file>

<file path="context/PROJECT.md">
# Voces - NDK Nostr App

A modern React-based Nostr client built with NDK (Nostr Development Kit), Vite, shadcn/ui, and TypeScript.

## Project Overview

Voces is a Nostr client application that allows users to authenticate with Nostr extensions or private keys, publish notes to the Nostr network, and view a real-time feed of notes from followed users. The application follows modern React best practices with a clean, modular architecture and a minimalistic, responsive UI.

## Technology Stack

- **Framework**: React 19 with TypeScript
- **Build Tool**: Vite
- **Nostr SDK**: @nostr-dev-kit/ndk with React hooks
- **UI Components**: shadcn/ui with Radix UI primitives
- **Styling**: Tailwind CSS
- **State Management**: React Context API for NDK state, Zustand (included for future use)
- **Data Fetching**: TanStack Query (React Query) for server state
- **Database**: Dexie (IndexedDB wrapper) for caching
- **Routing**: React Router DOM

## Project Structure

```
src/
‚îú‚îÄ‚îÄ components/       # Reusable UI components
‚îÇ   ‚îú‚îÄ‚îÄ ui/          # shadcn/ui components (Button, Card, etc.)
‚îÇ   ‚îú‚îÄ‚îÄ navigation/  # Navigation components (Sidebar, BottomNav)
‚îÇ   ‚îú‚îÄ‚îÄ layout/      # Layout components
‚îÇ   ‚îî‚îÄ‚îÄ nostr/      # Nostr-specific components
‚îú‚îÄ‚îÄ features/        # Feature-based modules
‚îÇ   ‚îú‚îÄ‚îÄ auth/        # Authentication features (LoginButton)
‚îÇ   ‚îú‚îÄ‚îÄ feed/        # Feed and notes features (NoteFeed, ComposeNote)
‚îÇ   ‚îî‚îÄ‚îÄ profile/     # User profile features
‚îú‚îÄ‚îÄ hooks/           # Custom React hooks
‚îú‚îÄ‚îÄ lib/             # Utility functions
‚îú‚îÄ‚îÄ contexts/        # React contexts (NDK provider, etc.)
‚îú‚îÄ‚îÄ types/           # TypeScript type definitions
‚îú‚îÄ‚îÄ utils/           # Helper functions
‚îú‚îÄ‚îÄ config/          # Configuration files (NDK setup, etc.)
‚îú‚îÄ‚îÄ pages/           # Page components for routing
‚îî‚îÄ‚îÄ index.css        # Global styles and theme configuration
```

## NDK Integration

### NDK Context
The application uses a React Context (`NDKContext`) to provide a single source of truth for the NDK instance, relays, and the signed-in user. This allows any component to access NDK functionality through the `useNDK()` hook.

### Key Components
1. **LoginButton** - Handles authentication via NIP-07 browser extensions or private key
2. **NoteFeed** - Displays a real-time feed of Nostr notes using NDK subscription hooks
3. **ComposeNote** - Allows users to publish new notes to the Nostr network
4. **NoteCard** - Displays individual notes with engagement features (like, repost, reply)

### Configuration
The NDK instance is configured with:
- Multiple default relays (Damus, Nostr.band, nos.lol, Snort, Primal)
- Dexie cache adapter for performance
- Auto-connection to user relays
- Outbox model support
- Auto-fetching of user mutelist

## Key Features

- **Nostr Authentication**: Login with NIP-07 browser extensions or private key
- **Real-time Feed**: View notes from followed users with live updates
- **Note Publishing**: Compose and publish text notes to the Nostr network
- **Modern UI**: Clean, responsive interface built with shadcn/ui components
- **Caching**: Dexie-based caching for improved performance
- **Type Safety**: Full TypeScript coverage throughout the application
- **Responsive Design**: Mobile-first approach with dedicated mobile navigation
- **Dark Mode**: Automatic dark/light mode based on system preferences

## UI/UX Improvements

### Navigation
- **Desktop**: Persistent sidebar navigation with user profile information
- **Mobile**: Bottom navigation bar for easy thumb access
- **Responsive**: Adapts seamlessly between mobile and desktop layouts
- **Intuitive**: Clear visual hierarchy and consistent navigation patterns

### Visual Design
- **Minimalist**: Clean interface with ample whitespace
- **Consistent**: Unified design language throughout the application
- **Accessible**: Proper contrast ratios and semantic HTML
- **Animated**: Subtle transitions and loading states for enhanced user experience

### User Experience
- **Real-time Updates**: Live feed updates without page refresh
- **Character Counter**: Visual feedback for note composition with color-coded limits
- **Profile Integration**: User avatars and names throughout the interface
- **Contextual Actions**: Relevant actions available for each note

## Development

The application is ready for development with:
- Hot module replacement via Vite
- Tailwind CSS for styling
- Path aliases for clean imports
- ESLint and TypeScript for code quality
- Pre-configured shadcn/ui components

## Future Improvements

1. Enhanced error handling and user feedback
2. Testing framework implementation
3. Environment-specific configuration
4. Additional state management for complex features
5. Accessibility improvements
6. Advanced profile customization
7. Notification system implementation
8. Media attachment support
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="src/components/content/ContentRendererDemo.tsx">
import { ContentRenderer } from './ContentRenderer';
export function ContentRendererDemo() {
  const sampleContent = `
Check out this image: https://nostr.build/i/example.jpg
Here's a YouTube video: https://www.youtube.com/watch?v=dQw4w9WgXcQ
Mentioned user: nostr:npub1l2vyh47mk2p0qlsku7hg0vn29faehy9hy34ygaclpn66ukqp3afqutajft
A quoted note: nostr:note1qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
Regular link: https://github.com/nostr-protocol/nips
Some audio: https://example.com/podcast.mp3
And a video: https://example.com/video.mp4
`;
  return (
    <div className="max-w-2xl mx-auto p-8">
      <h2 className="text-2xl font-bold mb-4">Content Renderer Demo</h2>
      <div className="border border-neutral-200 dark:border-neutral-800 rounded-lg p-4">
        <ContentRenderer content={sampleContent} />
      </div>
    </div>
  );
}
</file>

<file path="src/components/content/EmbeddedArticle.tsx">
import { useProfile } from '@nostr-dev-kit/ndk-hooks';
import { NDKKind } from '@nostr-dev-kit/ndk';
import { FileText, Clock } from 'lucide-react';
import { Link } from 'react-router-dom';
import { nip19 } from 'nostr-tools';
interface EmbeddedArticleProps {
  naddr: any; // naddr decoded data
}
export function EmbeddedArticle({ naddr }: EmbeddedArticleProps) {
  // For kind:30023 (long-form content), we'll show a preview
  const profile = useProfile(naddr.pubkey);
  const displayName = profile?.name || profile?.displayName || 'Anonymous';
  // Parse tags if available
  const title = naddr.identifier || 'Untitled Article';
  return (
    <div className="my-3 border border-neutral-200 dark:border-neutral-800 rounded-xl bg-white dark:bg-neutral-900/50 hover:bg-neutral-50 dark:hover:bg-neutral-900/70 transition-colors overflow-hidden">
      <Link
        to={`/article/${nip19.naddrEncode(naddr)}`}
        className="block p-4"
        onClick={(e) => e.stopPropagation()}
      >
        <div className="flex items-start gap-3">
          <div className="flex-shrink-0 w-12 h-12 bg-accent-100 dark:bg-accent-900/20 rounded-lg flex items-center justify-center">
            <FileText className="w-6 h-6 text-accent-600 dark:text-accent-400" />
          </div>
          <div className="flex-1 min-w-0">
            <h3 className="font-semibold text-neutral-900 dark:text-neutral-100 line-clamp-2 mb-1">
              {title}
            </h3>
            {profile?.about && (
              <p className="text-sm text-neutral-600 dark:text-neutral-400 line-clamp-2 mb-2">
                {profile.about}
              </p>
            )}
            <div className="flex items-center gap-3 text-xs text-neutral-500 dark:text-neutral-500">
              <span className="font-medium">{displayName}</span>
              {naddr.kind === NDKKind.Article && (
                <>
                  <span className="text-neutral-300 dark:text-neutral-700">¬∑</span>
                  <span className="flex items-center gap-1">
                    <Clock className="w-3 h-3" />
                    Long-form article
                  </span>
                </>
              )}
            </div>
          </div>
        </div>
      </Link>
    </div>
  );
}
</file>

<file path="src/components/content/index.ts">
export { ContentRenderer } from './ContentRenderer';
export { EmbeddedNote } from './EmbeddedNote';
export { EmbeddedArticle } from './EmbeddedArticle';
export { MediaEmbed } from './MediaEmbed';
</file>

<file path="src/components/content/MediaEmbed.tsx">
import { useState, useMemo } from 'react';
import { Play, Volume2, VolumeX, Image as ImageIcon } from 'lucide-react';
interface MediaEmbedProps {
  url: string;
  className?: string;
}
export function MediaEmbed({ url, className = '' }: MediaEmbedProps) {
  const [showMedia, setShowMedia] = useState(false);
  const [muted, setMuted] = useState(true);
  const [imageError, setImageError] = useState(false);
  const mediaType = useMemo(() => {
    const lowerUrl = url.toLowerCase();
    // Image formats
    if (/\.(jpg|jpeg|png|gif|webp|svg)(\?|$)/i.test(lowerUrl)) {
      return 'image';
    }
    // Video formats
    if (/\.(mp4|webm|mov)(\?|$)/i.test(lowerUrl)) {
      return 'video';
    }
    // Audio formats
    if (/\.(mp3|wav|ogg|m4a)(\?|$)/i.test(lowerUrl)) {
      return 'audio';
    }
    // YouTube
    if (/youtube\.com\/watch\?v=([a-zA-Z0-9_-]+)|youtu\.be\/([a-zA-Z0-9_-]+)/i.test(lowerUrl)) {
      return 'youtube';
    }
    return 'unknown';
  }, [url]);
  const getYouTubeId = (url: string) => {
    const match = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]+)/);
    return match ? match[1] : null;
  };
  if (mediaType === 'image') {
    if (imageError) {
      return (
        <div className="my-2 p-4 bg-neutral-100 dark:bg-neutral-900 rounded-lg flex items-center gap-2 text-sm text-neutral-600 dark:text-neutral-400">
          <ImageIcon className="w-4 h-4" />
          <span>Image could not be loaded</span>
        </div>
      );
    }
    return (
      <div className={`my-2 ${className}`}>
        <img
          src={url}
          alt="Embedded content"
          className="max-w-full h-auto rounded-lg cursor-pointer hover:opacity-95 transition-opacity"
          loading="lazy"
          onError={() => setImageError(true)}
          onClick={(e) => {
            e.stopPropagation();
            window.open(url, '_blank');
          }}
        />
      </div>
    );
  }
  if (mediaType === 'video') {
    if (!showMedia) {
      return (
        <div className={`my-2 ${className}`}>
          <div
            className="relative bg-neutral-900 rounded-lg aspect-video flex items-center justify-center cursor-pointer group"
            onClick={(e) => {
              e.stopPropagation();
              setShowMedia(true);
            }}
          >
            <div className="absolute inset-0 bg-gradient-to-b from-transparent to-black/30 rounded-lg"></div>
            <button className="relative z-10 w-16 h-16 bg-white/90 rounded-full flex items-center justify-center group-hover:bg-white transition-colors">
              <Play className="w-8 h-8 text-neutral-900 ml-1" fill="currentColor" />
            </button>
            <div className="absolute bottom-4 left-4 text-white text-sm font-medium">
              Click to play video
            </div>
          </div>
        </div>
      );
    }
    return (
      <div className={`my-2 relative ${className}`}>
        <video
          src={url}
          controls
          autoPlay
          muted={muted}
          className="max-w-full h-auto rounded-lg"
          onClick={(e) => e.stopPropagation()}
        />
        <button
          className="absolute top-4 right-4 p-2 bg-black/50 rounded-lg text-white hover:bg-black/70 transition-colors"
          onClick={(e) => {
            e.stopPropagation();
            setMuted(!muted);
          }}
        >
          {muted ? <VolumeX className="w-5 h-5" /> : <Volume2 className="w-5 h-5" />}
        </button>
      </div>
    );
  }
  if (mediaType === 'audio') {
    return (
      <div className={`my-2 ${className}`}>
        <audio
          src={url}
          controls
          className="w-full max-w-md"
          onClick={(e) => e.stopPropagation()}
        />
      </div>
    );
  }
  if (mediaType === 'youtube') {
    const videoId = getYouTubeId(url);
    if (!videoId) return null;
    if (!showMedia) {
      return (
        <div className={`my-2 ${className}`}>
          <div
            className="relative bg-neutral-900 rounded-lg aspect-video flex items-center justify-center cursor-pointer group"
            style={{
              backgroundImage: `url(https://img.youtube.com/vi/${videoId}/maxresdefault.jpg)`,
              backgroundSize: 'cover',
              backgroundPosition: 'center',
            }}
            onClick={(e) => {
              e.stopPropagation();
              setShowMedia(true);
            }}
          >
            <div className="absolute inset-0 bg-black/40 rounded-lg"></div>
            <button className="relative z-10 w-16 h-16 bg-red-600 rounded-full flex items-center justify-center group-hover:bg-red-700 transition-colors">
              <Play className="w-8 h-8 text-white ml-1" fill="currentColor" />
            </button>
          </div>
        </div>
      );
    }
    return (
      <div className={`my-2 ${className}`}>
        <div className="relative aspect-video">
          <iframe
            src={`https://www.youtube.com/embed/${videoId}?autoplay=1`}
            title="YouTube video player"
            frameBorder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            allowFullScreen
            className="absolute inset-0 w-full h-full rounded-lg"
            onClick={(e) => e.stopPropagation()}
          />
        </div>
      </div>
    );
  }
  return null;
}
</file>

<file path="src/components/navigation/NavItems.tsx">
import { Home, Edit3, Bell, User, Wallet, TrendingUp, ShoppingBag, Package } from 'lucide-react';
import { Link, useLocation } from 'react-router-dom';
import { useTranslation } from 'react-i18next';
import { cn } from '@/lib/utils';
import { useWallet } from '@/hooks/useWallet';
const NAV_ITEMS_CONFIG = [
  { path: '/', icon: Home, labelKey: 'feed' },
  { path: '/compose', icon: Edit3, labelKey: 'compose' },
  { path: '/notifications', icon: Bell, labelKey: 'notifications' },
  { path: '/profile', icon: User, labelKey: 'profile' },
  { path: '/packs', icon: Package, labelKey: 'followPacks' },
  { path: '/marketplace', icon: ShoppingBag, labelKey: 'marketplace' },
  { path: '/wallet', icon: Wallet, labelKey: 'wallet' },
  { path: '/trades', icon: TrendingUp, labelKey: 'trades' },
] as const;
export function NavItems() {
  const { t } = useTranslation();
  const location = useLocation();
  const { balance } = useWallet();
  return (
    <nav className="flex-1 px-3 py-6">
      <div className="space-y-1">
        {NAV_ITEMS_CONFIG.map(({ path, icon: Icon, labelKey }) => {
          const isActive = location.pathname === path ||
                         (path === '/packs' && location.pathname.startsWith('/packs/'));
          const isWallet = path === '/wallet';
          return (
            <Link
              key={path}
              to={path}
              className={cn(
                'flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all font-medium text-sm',
                isActive
                  ? 'bg-neutral-900 text-white'
                  : 'text-neutral-400 hover:bg-neutral-900/50 hover:text-neutral-200'
              )}
            >
              <Icon className="w-5 h-5" strokeWidth={isActive ? 2 : 1.5} />
              <span>{t(`navigation.${labelKey}`)}</span>
              {isWallet && (
                <span className="ml-auto text-xs font-normal text-orange-500">
                  {balance.toLocaleString()} sats
                </span>
              )}
            </Link>
          );
        })}
      </div>
    </nav>
  );
}
</file>

<file path="src/components/navigation/UserMenu.tsx">
import { Settings, LogOut } from 'lucide-react';
import { Link } from 'react-router-dom';
import { useTranslation } from 'react-i18next';
import { useNDKCurrentUser, useNDKSessionLogout } from '@nostr-dev-kit/ndk-hooks';
import { useProfile } from '@nostr-dev-kit/ndk-hooks';
import { UserAvatar } from '@/components/ui/UserAvatar';
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu';
import { clearAuthStorage } from '@/features/auth/utils/logout';
export function UserMenu() {
  const { t } = useTranslation();
  const currentUser = useNDKCurrentUser();
  const profile = useProfile(currentUser?.pubkey);
  const logout = useNDKSessionLogout();
  const handleLogout = () => {
    logout();
    clearAuthStorage();
  };
  if (!currentUser) {
    return null;
  }
  return (
    <DropdownMenu>
      <DropdownMenuTrigger className="w-full">
        <div className="flex items-center gap-3 px-2 py-2 rounded-lg hover:bg-neutral-900/50 transition-colors cursor-pointer">
          <UserAvatar pubkey={currentUser.pubkey} size="md" />
          <div className="flex-1 min-w-0 text-left">
            <p className="font-medium text-sm truncate text-white">
              {profile?.name || 'Anonymous'}
            </p>
            <p className="text-xs text-neutral-500 truncate">
              {profile?.nip05 || currentUser.npub?.slice(0, 16) + '...'}
            </p>
          </div>
        </div>
      </DropdownMenuTrigger>
      {/* 
        Positioned above (side="top") to avoid dropdown being cut off at bottom of screen.
        Aligned to start (left edge) to match the trigger element's position.
      */}
      <DropdownMenuContent 
        className="w-56 mb-2 ml-4"
        align="start"
        side="top"
      >
        <DropdownMenuItem asChild>
          <Link
            to="/settings"
            className="flex items-center gap-3 cursor-pointer"
          >
            <Settings className="w-4 h-4" />
            <span>{t('navigation.settings')}</span>
          </Link>
        </DropdownMenuItem>
        <DropdownMenuSeparator />
        <DropdownMenuItem
          onClick={handleLogout}
          className="flex items-center gap-3 cursor-pointer text-red-500 focus:text-red-600 dark:text-red-400 dark:focus:text-red-300"
        >
          <LogOut className="w-4 h-4" />
          <span>{t('navigation.logout')}</span>
        </DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
  );
}
</file>

<file path="src/components/ui/alert.tsx">
import * as React from 'react';
import { cva, type VariantProps } from 'class-variance-authority';
import { cn } from '@/lib/utils';
const alertVariants = cva(
  'relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground',
  {
    variants: {
      variant: {
        default: 'bg-background text-foreground',
        destructive:
          'border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive',
      },
    },
    defaultVariants: {
      variant: 'default',
    },
  }
);
const Alert = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>
>(({ className, variant, ...props }, ref) => (
  <div
    ref={ref}
    role="alert"
    className={cn(alertVariants({ variant }), className)}
    {...props}
  />
));
Alert.displayName = 'Alert';
const AlertTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h5
    ref={ref}
    className={cn('mb-1 font-medium leading-none tracking-tight', className)}
    {...props}
  />
));
AlertTitle.displayName = 'AlertTitle';
const AlertDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn('text-sm [&_p]:leading-relaxed', className)}
    {...props}
  />
));
AlertDescription.displayName = 'AlertDescription';
export { Alert, AlertTitle, AlertDescription };
</file>

<file path="src/components/ui/Avatar.tsx">
import { cn } from '@/lib/utils';
import { useProfile } from '@nostr-dev-kit/ndk-hooks';
interface AvatarProps {
  pubkey?: string;
  size?: 'xs' | 'sm' | 'md' | 'lg' | 'xl';
  className?: string;
  fallback?: string;
}
const sizeClasses = {
  xs: 'w-8 h-8 text-xs',
  sm: 'w-10 h-10 text-sm',
  md: 'w-12 h-12 text-base',
  lg: 'w-16 h-16 text-lg',
  xl: 'w-20 h-20 text-xl',
};
export function Avatar({ pubkey, size = 'md', className, fallback }: AvatarProps) {
  const profile = useProfile(pubkey);
  const imageUrl = profile?.image || profile?.picture;
  const displayName = profile?.displayName || profile?.name || fallback || '?';
  const initials = displayName.slice(0, 2).toUpperCase();
  if (imageUrl) {
    return (
      <img
        src={imageUrl}
        alt={displayName}
        className={cn(
          'rounded-full object-cover bg-neutral-100 dark:bg-neutral-900',
          sizeClasses[size],
          className
        )}
        loading="lazy"
      />
    );
  }
  // Minimal, monochrome fallback
  return (
    <div
      className={cn(
        'rounded-full bg-neutral-200 dark:bg-neutral-800 flex items-center justify-center text-neutral-600 dark:text-neutral-400 font-medium',
        sizeClasses[size],
        className
      )}
    >
      {initials}
    </div>
  );
}
</file>

<file path="src/components/ui/button.tsx">
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils"
const buttonVariants = cva(
  "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline:
          "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)
export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}
const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"
export { Button, buttonVariants }
</file>

<file path="src/components/ui/card.tsx">
import * as React from "react"
import { cn } from "@/lib/utils"
const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-lg border bg-card text-card-foreground shadow-sm",
      className
    )}
    {...props}
  />
))
Card.displayName = "Card"
const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
))
CardHeader.displayName = "CardHeader"
const CardTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h3
    ref={ref}
    className={cn(
      "text-2xl font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
CardTitle.displayName = "CardTitle"
const CardDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <p
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
CardDescription.displayName = "CardDescription"
const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"
const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
))
CardFooter.displayName = "CardFooter"
export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }
</file>

<file path="src/components/ui/dropdown-menu.tsx">
import * as React from "react"
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"
import { cn } from "@/lib/utils"
const DropdownMenu = DropdownMenuPrimitive.Root
const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger
const DropdownMenuGroup = DropdownMenuPrimitive.Group
const DropdownMenuPortal = DropdownMenuPrimitive.Portal
const DropdownMenuSub = DropdownMenuPrimitive.Sub
const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup
const DropdownMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <DropdownMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-neutral-100 data-[state=open]:bg-neutral-100 dark:focus:bg-neutral-800 dark:data-[state=open]:bg-neutral-800",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
  </DropdownMenuPrimitive.SubTrigger>
))
DropdownMenuSubTrigger.displayName =
  DropdownMenuPrimitive.SubTrigger.displayName
const DropdownMenuSubContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border border-neutral-200 bg-white p-1 text-neutral-950 shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-neutral-800 dark:bg-neutral-950 dark:text-neutral-50",
      className
    )}
    {...props}
  />
))
DropdownMenuSubContent.displayName =
  DropdownMenuPrimitive.SubContent.displayName
const DropdownMenuContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <DropdownMenuPrimitive.Portal>
    <DropdownMenuPrimitive.Content
      ref={ref}
      sideOffset={sideOffset}
      className={cn(
        "z-50 min-w-[8rem] overflow-hidden rounded-md border border-neutral-200 bg-white p-1 text-neutral-950 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-neutral-800 dark:bg-neutral-950 dark:text-neutral-50",
        className
      )}
      {...props}
    />
  </DropdownMenuPrimitive.Portal>
))
DropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName
const DropdownMenuItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-neutral-100 focus:text-neutral-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-neutral-800 dark:focus:text-neutral-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName
const DropdownMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <DropdownMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-neutral-100 focus:text-neutral-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-neutral-800 dark:focus:text-neutral-50",
      className
    )}
    checked={checked}
    {...props}
  >
    {children}
  </DropdownMenuPrimitive.CheckboxItem>
))
DropdownMenuCheckboxItem.displayName =
  DropdownMenuPrimitive.CheckboxItem.displayName
const DropdownMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <DropdownMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-neutral-100 focus:text-neutral-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-neutral-800 dark:focus:text-neutral-50",
      className
    )}
    {...props}
  >
    {children}
  </DropdownMenuPrimitive.RadioItem>
))
DropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName
const DropdownMenuLabel = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName
const DropdownMenuSeparator = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-neutral-100 dark:bg-neutral-800", className)}
    {...props}
  />
))
DropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName
const DropdownMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn("ml-auto text-xs tracking-widest opacity-60", className)}
      {...props}
    />
  )
}
DropdownMenuShortcut.displayName = "DropdownMenuShortcut"
export {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuGroup,
  DropdownMenuPortal,
  DropdownMenuSub,
  DropdownMenuSubContent,
  DropdownMenuSubTrigger,
  DropdownMenuRadioGroup,
}
</file>

<file path="src/components/ui/FAB.tsx">
import { motion } from 'framer-motion';
import { Plus, Edit3, TrendingUp, ShoppingBag } from 'lucide-react';
import { useLocation } from 'react-router-dom';
import { cn } from '@/lib/utils';
import { useState } from 'react';
import { CreateOrderModal } from '@/features/trades/CreateOrderModal';
import { useNavigate } from 'react-router-dom';
import { useNDKCurrentUser } from '@nostr-dev-kit/ndk-hooks';
interface FABProps {
  className?: string;
  icon?: 'plus' | 'edit';
}
export function FAB({ className }: FABProps) {
  const navigate = useNavigate();
  const location = useLocation();
  const currentUser = useNDKCurrentUser();
  const [showCreateOrderModal, setShowCreateOrderModal] = useState(false);
  // Determine FAB action and icon based on current route
  const getFABConfig = () => {
    const path = location.pathname;
    if (path.startsWith('/trades')) {
      return {
        icon: TrendingUp,
        label: 'Create Trade',
        action: () => setShowCreateOrderModal(true),
        requiresAuth: true
      };
    }
    if (path.startsWith('/marketplace')) {
      return {
        icon: ShoppingBag,
        label: 'List Item',
        action: () => navigate('/marketplace/create'),
        requiresAuth: true
      };
    }
    if (path.startsWith('/wallet')) {
      return {
        icon: Plus,
        label: 'Add Funds',
        action: () => {}, // TODO: Implement wallet action
        requiresAuth: false
      };
    }
    // Default to compose for feed/home
    return {
      icon: Edit3,
      label: 'Compose',
      action: () => navigate('/compose'),
      requiresAuth: true
    };
  };
  const config = getFABConfig();
  const Icon = config.icon;
  // Don't show FAB if auth is required but user not logged in
  if (config.requiresAuth && !currentUser) {
    return null;
  }
  const handleClick = () => {
    config.action();
  };
  return (
    <>
      <motion.button
        onClick={handleClick}
        whileHover={{ scale: 1.1 }}
        whileTap={{ scale: 0.95 }}
        initial={{ scale: 0 }}
        animate={{ scale: 1 }}
        transition={{ type: "spring", stiffness: 300, damping: 20 }}
        className={cn(
          "fixed bottom-20 right-4 z-40",
          "w-14 h-14 rounded-full",
          "bg-black dark:bg-white",
          "shadow-lg shadow-black/25 dark:shadow-white/10",
          "flex items-center justify-center",
          "md:hidden", // Only show on mobile
          className
        )}
        aria-label={config.label}
      >
        <Icon className="w-6 h-6 text-white" />
      </motion.button>
      {/* Modal for trades page */}
      {showCreateOrderModal && (
        <CreateOrderModal onClose={() => setShowCreateOrderModal(false)} />
      )}
    </>
  );
}
</file>

<file path="src/components/ui/FollowButton.tsx">
import { useState } from 'react';
import { useNDK, useFollows, useNDKCurrentUser } from '@nostr-dev-kit/ndk-hooks';
import { NDKUser } from '@nostr-dev-kit/ndk';
import { Button } from './button';
import { UserPlus, UserMinus, Loader2 } from 'lucide-react';
interface FollowButtonProps {
  pubkey: string;
  variant?: 'default' | 'outline' | 'ghost';
  size?: 'default' | 'sm' | 'lg' | 'icon';
  showIcon?: boolean;
  className?: string;
}
export function FollowButton({ 
  pubkey, 
  variant = 'default',
  size = 'default',
  showIcon = true,
  className 
}: FollowButtonProps) {
  const { ndk } = useNDK();
  const currentUser = useNDKCurrentUser();
  const follows = useFollows();
  const [isLoading, setIsLoading] = useState(false);
  const isFollowing = follows.has(pubkey);
  const isOwnProfile = currentUser?.pubkey === pubkey;
  // Don't show follow button on own profile
  if (isOwnProfile || !currentUser || !ndk) {
    return null;
  }
  const handleToggleFollow = async () => {
    if (!ndk || !currentUser) return;
    setIsLoading(true);
    try {
      const targetUser = ndk.getUser({ pubkey });
      if (isFollowing) {
        // Unfollow
        await currentUser.unfollow(targetUser);
      } else {
        // Follow
        await currentUser.follow(targetUser);
      }
    } catch (error) {
      console.error('Error toggling follow:', error);
    } finally {
      setIsLoading(false);
    }
  };
  return (
    <Button
      variant={isFollowing ? 'outline' : variant}
      size={size}
      onClick={handleToggleFollow}
      disabled={isLoading}
      className={className}
    >
      {isLoading ? (
        <>
          {showIcon && <Loader2 className="w-4 h-4 mr-2 animate-spin" />}
          {isFollowing ? 'Unfollowing...' : 'Following...'}
        </>
      ) : (
        <>
          {showIcon && (
            isFollowing ? (
              <UserMinus className="w-4 h-4 mr-2" />
            ) : (
              <UserPlus className="w-4 h-4 mr-2" />
            )
          )}
          {isFollowing ? 'Unfollow' : 'Follow'}
        </>
      )}
    </Button>
  );
}
</file>

<file path="src/components/ui/label.tsx">
import * as React from 'react';
import { cn } from '@/lib/utils';
export type LabelProps = React.LabelHTMLAttributes<HTMLLabelElement>
const Label = React.forwardRef<HTMLLabelElement, LabelProps>(
  ({ className, ...props }, ref) => {
    return (
      <label
        ref={ref}
        className={cn(
          'text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70',
          className
        )}
        {...props}
      />
    );
  }
);
Label.displayName = 'Label';
export { Label };
</file>

<file path="src/components/wallet/index.ts">
export { Wallet } from './Wallet';
export type { WalletVariant } from './Wallet';
export { WalletBalance } from './WalletBalance';
export { MintConfiguration } from './MintConfiguration';
export { TransactionButton } from './TransactionButton';
export { QRScanner } from './QRScanner';
export { TransactionModal } from './TransactionModal';
export { ProfessionalWallet } from './ProfessionalWallet';
</file>

<file path="src/components/wallet/MintConfiguration.tsx">
import { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Settings, Plus, Trash2, Info, Check, X } from 'lucide-react';
interface Mint {
  id: string;
  url: string;
  name: string;
  balance?: number;
  isActive: boolean;
}
interface MintConfigurationProps {
  variant?: 'minimal' | 'detailed' | 'card';
}
export function MintConfiguration({ variant = 'minimal' }: MintConfigurationProps) {
  const [mints, setMints] = useState<Mint[]>([
    { id: '1', url: 'https://mint.minibits.cash', name: 'Minibits', balance: 10000, isActive: true },
    { id: '2', url: 'https://stablenut.umint.cash', name: 'Stablenut', balance: 5000, isActive: false },
  ]);
  const [isExpanded, setIsExpanded] = useState(false);
  const [newMintUrl, setNewMintUrl] = useState('');
  const [showTooltip, setShowTooltip] = useState(false);
  const addMint = () => {
    if (newMintUrl) {
      const newMint: Mint = {
        id: Date.now().toString(),
        url: newMintUrl,
        name: new URL(newMintUrl).hostname,
        balance: 0,
        isActive: false
      };
      setMints([...mints, newMint]);
      setNewMintUrl('');
    }
  };
  const removeMint = (id: string) => {
    setMints(mints.filter(m => m.id !== id));
  };
  const toggleMint = (id: string) => {
    setMints(mints.map(m => 
      m.id === id ? { ...m, isActive: !m.isActive } : m
    ));
  };
  if (variant === 'card') {
    return (
      <motion.div
        className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6"
        whileHover={{ y: -2 }}
        transition={{ type: "spring", stiffness: 300 }}
      >
        <div className="flex items-center justify-between mb-4">
          <h3 className="text-lg font-medium text-gray-900">Cashu Mints</h3>
          <button
            onClick={() => setIsExpanded(!isExpanded)}
            className="p-2 hover:bg-gray-50 rounded-lg transition-colors"
          >
            <Settings className="w-5 h-5 text-gray-600" />
          </button>
        </div>
        <AnimatePresence>
          {isExpanded && (
            <motion.div
              initial={{ height: 0, opacity: 0 }}
              animate={{ height: "auto", opacity: 1 }}
              exit={{ height: 0, opacity: 0 }}
              className="space-y-3 overflow-hidden"
            >
              {mints.map((mint) => (
                <MintItem
                  key={mint.id}
                  mint={mint}
                  onToggle={() => toggleMint(mint.id)}
                  onRemove={() => removeMint(mint.id)}
                />
              ))}
              <AddMintInput
                value={newMintUrl}
                onChange={setNewMintUrl}
                onAdd={addMint}
              />
            </motion.div>
          )}
        </AnimatePresence>
        {!isExpanded && (
          <div className="text-sm text-gray-600">
            {mints.filter(m => m.isActive).length} active mints
          </div>
        )}
      </motion.div>
    );
  }
  if (variant === 'detailed') {
    return (
      <div className="space-y-4">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-2">
            <h3 className="text-sm font-medium text-gray-700">Mints</h3>
            <button
              onMouseEnter={() => setShowTooltip(true)}
              onMouseLeave={() => setShowTooltip(false)}
              className="relative"
            >
              <Info className="w-4 h-4 text-gray-400" />
              <AnimatePresence>
                {showTooltip && (
                  <motion.div
                    initial={{ opacity: 0, y: 5 }}
                    animate={{ opacity: 1, y: 0 }}
                    exit={{ opacity: 0, y: 5 }}
                    className="absolute left-6 top-0 bg-gray-800 text-white text-xs px-2 py-1 rounded-md whitespace-nowrap z-10"
                  >
                    Cashu mint (server)
                  </motion.div>
                )}
              </AnimatePresence>
            </button>
          </div>
          <button
            onClick={() => setIsExpanded(!isExpanded)}
            className="text-sm text-blue-600 hover:text-blue-700"
          >
            {isExpanded ? 'Close' : 'Configure'}
          </button>
        </div>
        <AnimatePresence>
          {isExpanded && (
            <motion.div
              initial={{ height: 0, opacity: 0 }}
              animate={{ height: "auto", opacity: 1 }}
              exit={{ height: 0, opacity: 0 }}
              className="space-y-2 overflow-hidden"
            >
              {mints.map((mint) => (
                <MintItem
                  key={mint.id}
                  mint={mint}
                  onToggle={() => toggleMint(mint.id)}
                  onRemove={() => removeMint(mint.id)}
                  variant="detailed"
                />
              ))}
              <AddMintInput
                value={newMintUrl}
                onChange={setNewMintUrl}
                onAdd={addMint}
                variant="inline"
              />
            </motion.div>
          )}
        </AnimatePresence>
        {!isExpanded && (
          <div className="flex gap-2 flex-wrap">
            {mints.filter(m => m.isActive).map((mint) => (
              <span
                key={mint.id}
                className="text-xs bg-green-50 text-green-700 px-2 py-1 rounded-full"
              >
                {mint.name}
              </span>
            ))}
          </div>
        )}
      </div>
    );
  }
  // Minimal variant (default)
  return (
    <button
      onClick={() => setIsExpanded(!isExpanded)}
      onMouseEnter={() => setShowTooltip(true)}
      onMouseLeave={() => setShowTooltip(false)}
      className="relative flex items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-lg transition-colors"
    >
      <Settings className="w-4 h-4" />
      <span>Mint</span>
      <AnimatePresence>
        {showTooltip && (
          <motion.div
            initial={{ opacity: 0, y: 5 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: 5 }}
            className="absolute left-0 top-10 bg-gray-800 text-white text-xs px-2 py-1 rounded-md whitespace-nowrap z-10"
          >
            Cashu mint (server)
          </motion.div>
        )}
      </AnimatePresence>
    </button>
  );
}
interface MintItemProps {
  mint: Mint;
  onToggle: () => void;
  onRemove: () => void;
  variant?: 'compact' | 'detailed';
}
function MintItem({ mint, onToggle, onRemove, variant = 'compact' }: MintItemProps) {
  if (variant === 'detailed') {
    return (
      <motion.div
        initial={{ x: -10, opacity: 0 }}
        animate={{ x: 0, opacity: 1 }}
        className="flex items-center justify-between p-3 bg-gray-50 rounded-lg"
      >
        <div className="flex items-center gap-3">
          <button
            onClick={onToggle}
            className={`w-5 h-5 rounded-full border-2 flex items-center justify-center transition-all ${
              mint.isActive
                ? 'bg-green-500 border-green-500'
                : 'bg-white border-gray-300'
            }`}
          >
            {mint.isActive && <Check className="w-3 h-3 text-white" />}
          </button>
          <div>
            <div className="text-sm font-medium text-gray-900">{mint.name}</div>
            <div className="text-xs text-gray-500">{mint.url}</div>
            {mint.balance && (
              <div className="text-xs text-gray-600 mt-1">
                Balance: {mint.balance.toLocaleString()} sats
              </div>
            )}
          </div>
        </div>
        <button
          onClick={onRemove}
          className="p-1 hover:bg-gray-200 rounded transition-colors"
        >
          <Trash2 className="w-4 h-4 text-gray-500" />
        </button>
      </motion.div>
    );
  }
  return (
    <motion.div
      initial={{ x: -10, opacity: 0 }}
      animate={{ x: 0, opacity: 1 }}
      className="flex items-center justify-between p-2 hover:bg-gray-50 rounded-lg"
    >
      <div className="flex items-center gap-2">
        <button
          onClick={onToggle}
          className={`w-4 h-4 rounded-full border-2 ${
            mint.isActive
              ? 'bg-green-500 border-green-500'
              : 'bg-white border-gray-300'
          }`}
        />
        <span className="text-sm text-gray-700">{mint.name}</span>
      </div>
      <button
        onClick={onRemove}
        className="p-1 hover:bg-gray-100 rounded"
      >
        <X className="w-3 h-3 text-gray-500" />
      </button>
    </motion.div>
  );
}
interface AddMintInputProps {
  value: string;
  onChange: (value: string) => void;
  onAdd: () => void;
  variant?: 'default' | 'inline';
}
function AddMintInput({ value, onChange, onAdd, variant = 'default' }: AddMintInputProps) {
  if (variant === 'inline') {
    return (
      <div className="flex gap-2">
        <input
          type="url"
          value={value}
          onChange={(e) => onChange(e.target.value)}
          placeholder="https://mint.example.com"
          className="flex-1 px-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:border-blue-500"
        />
        <button
          onClick={onAdd}
          disabled={!value}
          className="px-3 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Add
        </button>
      </div>
    );
  }
  return (
    <div className="flex items-center gap-2 p-2 border border-dashed border-gray-300 rounded-lg">
      <Plus className="w-4 h-4 text-gray-400" />
      <input
        type="url"
        value={value}
        onChange={(e) => onChange(e.target.value)}
        onKeyDown={(e) => e.key === 'Enter' && onAdd()}
        placeholder="Add mint URL"
        className="flex-1 text-sm bg-transparent focus:outline-none"
      />
    </div>
  );
}
</file>

<file path="src/components/wallet/ProfessionalWallet.tsx">
import { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import {
  ArrowUpRight,
  ArrowDownLeft,
  Shield,
  Eye,
  EyeOff,
  Loader2,
  Settings
} from 'lucide-react';
import { useWallet } from '../../hooks/useWallet';
import { useWalletStore } from '../../stores/walletStore';
import { DepositModal } from './DepositModal';
import { useNavigate } from 'react-router-dom';
export function ProfessionalWallet() {
  const { balance: walletBalance, isReady, error, deposit, p2pk } = useWallet();
  const mints = useWalletStore((state) => state.mints);
  const [balanceHidden, setBalanceHidden] = useState(false);
  const [showDepositModal, setShowDepositModal] = useState(false);
  const navigate = useNavigate();
  const balance = walletBalance || 0;
  const handleDeposit = async (amount: number, mint?: string) => {
    await deposit(amount, mint);
  };
  // Show loading state
  if (!isReady && !error) {
    return (
      <div className="w-full min-h-screen bg-gradient-to-b from-neutral-50 to-white dark:from-neutral-950 dark:to-black flex items-center justify-center">
        <div className="text-center">
          <Loader2 className="w-8 h-8 animate-spin text-neutral-400 mx-auto mb-3" />
          <p className="text-sm text-neutral-500">Initializing wallet...</p>
          {p2pk && (
            <p className="text-xs text-neutral-600 mt-2 font-mono">P2PK: {p2pk.substring(0, 16)}...</p>
          )}
        </div>
      </div>
    );
  }
  // Show error state
  if (error) {
    return (
      <div className="w-full min-h-screen bg-gradient-to-b from-neutral-50 to-white dark:from-neutral-950 dark:to-black flex items-center justify-center">
        <div className="text-center max-w-md mx-auto px-6">
          <div className="w-12 h-12 bg-red-400/10 rounded-full flex items-center justify-center mx-auto mb-3">
            <Shield className="w-6 h-6 text-red-400" />
          </div>
          <h3 className="text-lg font-medium text-neutral-900 dark:text-neutral-100 mb-2">
            Wallet Error
          </h3>
          <p className="text-sm text-neutral-500">{error}</p>
        </div>
      </div>
    );
  }
  return (
    <div className="w-full min-h-screen bg-gradient-to-b from-neutral-50 to-white dark:from-neutral-950 dark:to-black">
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        className="max-w-lg mx-auto"
      >
        {/* Wallet Status Indicator */}
        {isReady && (
          <div className="px-6 pt-4">
            <div className="flex items-center gap-2 text-xs text-emerald-400">
              <div className="w-1.5 h-1.5 bg-emerald-400 rounded-full animate-pulse" />
              <span>Wallet Active</span>
            </div>
          </div>
        )}
        {/* Balance Section */}
        <div className="px-5 pt-8 pb-6">
          <div className="text-center">
            <div className="text-2xs uppercase tracking-wider text-neutral-500 mb-3 flex items-center justify-center gap-2">
              <span>Total Balance</span>
              <button
                onClick={() => setBalanceHidden(!balanceHidden)}
                className="p-1 hover:bg-neutral-200/50 dark:hover:bg-neutral-800/30 rounded-md transition-all"
              >
                {balanceHidden ? (
                  <Eye className="w-3.5 h-3.5" />
                ) : (
                  <EyeOff className="w-3.5 h-3.5" />
                )}
              </button>
            </div>
            <motion.div
              key={balanceHidden ? 'hidden' : 'visible'}
              initial={{ opacity: 0, y: -10 }}
              animate={{ opacity: 1, y: 0 }}
              className="mb-3"
            >
              {balanceHidden ? (
                <div className="text-4xl font-light text-neutral-400 dark:text-neutral-600">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
              ) : (
                <>
                  <div className="text-5xl font-light text-neutral-900 dark:text-neutral-50 tracking-tight">
                    {balance.toLocaleString()}
                  </div>
                  <div className="text-sm text-neutral-500 mt-1">sats</div>
                </>
              )}
            </motion.div>
          </div>
          {/* Action Buttons */}
          <div className="flex gap-3 mt-8">
            <motion.button
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
              className="flex-1 bg-neutral-900 dark:bg-neutral-50 text-neutral-50 dark:text-neutral-900 py-3.5 rounded-xl font-medium transition-all flex items-center justify-center gap-2 min-h-[52px]"
            >
              <ArrowUpRight className="w-4 h-4" strokeWidth={2} />
              Send
            </motion.button>
            <motion.button
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
              onClick={() => setShowDepositModal(true)}
              className="flex-1 bg-neutral-100 dark:bg-neutral-900 text-neutral-900 dark:text-neutral-100 border border-neutral-200 dark:border-neutral-800 py-3.5 rounded-xl font-medium transition-all flex items-center justify-center gap-2 min-h-[52px]"
            >
              <ArrowDownLeft className="w-4 h-4" strokeWidth={2} />
              Receive
            </motion.button>
          </div>
        </div>
        {/* Wallet Settings Button */}
        <div className="px-6 pb-4">
          <motion.button
            whileHover={{ scale: 1.02 }}
            whileTap={{ scale: 0.98 }}
            onClick={() => navigate('/wallet/settings')}
            className="w-full bg-neutral-100 dark:bg-neutral-900 hover:bg-neutral-200 dark:hover:bg-neutral-800 border border-neutral-200 dark:border-neutral-800 rounded-xl p-4 flex items-center justify-center gap-2 transition-all"
          >
            <Settings className="w-5 h-5 text-neutral-700 dark:text-neutral-300" />
            <span className="text-sm font-medium text-neutral-700 dark:text-neutral-300">Wallet Settings</span>
          </motion.button>
        </div>
        {/* Recent Activity */}
        <div className="px-6 py-4">
          <h3 className="text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-3">Recent Activity</h3>
          <div className="text-center py-12">
            <div className="text-sm text-neutral-500 dark:text-neutral-600">
              No transactions yet
            </div>
            <div className="text-xs text-neutral-400 dark:text-neutral-700 mt-1">
              Transactions will appear here once you start using your wallet
            </div>
          </div>
        </div>
        {/* Footer */}
        <div className="px-6 pb-6">
          <motion.button
            whileHover={{ scale: 1.02 }}
            whileTap={{ scale: 0.98 }}
            className="w-full py-3 bg-gray-800/50 hover:bg-gray-800 border border-gray-700/50 rounded-xl text-sm text-gray-400 hover:text-gray-300 transition-all"
          >
            View All Transactions
          </motion.button>
        </div>
      </motion.div>
      <DepositModal
        isOpen={showDepositModal}
        onClose={() => setShowDepositModal(false)}
        onDeposit={handleDeposit}
        mints={mints}
      />
    </div>
  );
}
</file>

<file path="src/components/wallet/QRScanner.tsx">
import { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Camera, X, Clipboard, QrCode } from 'lucide-react';
interface QRScannerProps {
  onScan: (data: string) => void;
  variant?: 'minimal' | 'detailed' | 'modal';
}
export function QRScanner({ onScan, variant = 'minimal' }: QRScannerProps) {
  const [isOpen, setIsOpen] = useState(false);
  const [pasteValue, setPasteValue] = useState('');
  const [showPasteInput, setShowPasteInput] = useState(false);
  const handlePaste = () => {
    if (pasteValue) {
      onScan(pasteValue);
      setPasteValue('');
      setShowPasteInput(false);
      setIsOpen(false);
    }
  };
  const handleQuickPaste = async () => {
    try {
      const text = await navigator.clipboard.readText();
      if (text) {
        onScan(text);
        setIsOpen(false);
      }
    } catch (_err) {
      setShowPasteInput(true);
    }
  };
  if (variant === 'modal') {
    return (
      <>
        <motion.button
          onClick={() => setIsOpen(true)}
          whileHover={{ scale: 1.05 }}
          whileTap={{ scale: 0.95 }}
          className="p-3 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-colors"
        >
          <QrCode className="w-5 h-5" />
        </motion.button>
        <AnimatePresence>
          {isOpen && (
            <motion.div
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              exit={{ opacity: 0 }}
              className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
              onClick={() => setIsOpen(false)}
            >
              <motion.div
                initial={{ scale: 0.9, y: 20 }}
                animate={{ scale: 1, y: 0 }}
                exit={{ scale: 0.9, y: 20 }}
                className="bg-white rounded-3xl p-6 max-w-md w-full shadow-2xl"
                onClick={(e) => e.stopPropagation()}
              >
                <div className="flex justify-between items-center mb-6">
                  <h3 className="text-xl font-semibold text-gray-900">Scan or Paste</h3>
                  <button
                    onClick={() => setIsOpen(false)}
                    className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                  >
                    <X className="w-5 h-5 text-gray-500" />
                  </button>
                </div>
                <div className="space-y-4">
                  <div className="bg-gray-100 rounded-2xl p-8 flex flex-col items-center justify-center">
                    <Camera className="w-12 h-12 text-gray-400 mb-3" />
                    <p className="text-sm text-gray-600 text-center">
                      Camera access needed for QR scanning
                    </p>
                    <button className="mt-4 text-sm text-purple-600 hover:text-purple-700">
                      Enable Camera
                    </button>
                  </div>
                  <div className="relative">
                    <div className="absolute inset-0 flex items-center">
                      <div className="w-full border-t border-gray-200" />
                    </div>
                    <div className="relative flex justify-center text-sm">
                      <span className="bg-white px-3 text-gray-500">or</span>
                    </div>
                  </div>
                  <div className="space-y-3">
                    <button
                      onClick={handleQuickPaste}
                      className="w-full flex items-center justify-center gap-2 px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-xl transition-colors"
                    >
                      <Clipboard className="w-4 h-4 text-gray-600" />
                      <span className="text-gray-700">Paste from Clipboard</span>
                    </button>
                    <AnimatePresence>
                      {showPasteInput && (
                        <motion.div
                          initial={{ height: 0, opacity: 0 }}
                          animate={{ height: "auto", opacity: 1 }}
                          exit={{ height: 0, opacity: 0 }}
                          className="overflow-hidden"
                        >
                          <input
                            type="text"
                            value={pasteValue}
                            onChange={(e) => setPasteValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handlePaste()}
                            placeholder="Paste invoice here..."
                            className="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                            autoFocus
                          />
                          <button
                            onClick={handlePaste}
                            disabled={!pasteValue}
                            className="w-full mt-3 px-4 py-3 bg-purple-600 text-white rounded-xl hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                          >
                            Process Invoice
                          </button>
                        </motion.div>
                      )}
                    </AnimatePresence>
                  </div>
                </div>
              </motion.div>
            </motion.div>
          )}
        </AnimatePresence>
      </>
    );
  }
  if (variant === 'detailed') {
    return (
      <div className="space-y-3">
        <button
          onClick={() => setShowPasteInput(!showPasteInput)}
          className="w-full flex items-center justify-between p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl hover:from-purple-100 hover:to-pink-100 transition-all"
        >
          <div className="flex items-center gap-3">
            <QrCode className="w-5 h-5 text-purple-600" />
            <span className="text-gray-700 font-medium">Scan QR Code</span>
          </div>
          <span className="text-xs text-gray-500">Tap to paste</span>
        </button>
        <AnimatePresence>
          {showPasteInput && (
            <motion.div
              initial={{ height: 0, opacity: 0 }}
              animate={{ height: "auto", opacity: 1 }}
              exit={{ height: 0, opacity: 0 }}
              className="overflow-hidden"
            >
              <div className="flex gap-2">
                <input
                  type="text"
                  value={pasteValue}
                  onChange={(e) => setPasteValue(e.target.value)}
                  placeholder="Paste Lightning invoice..."
                  className="flex-1 px-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:border-purple-500"
                />
                <button
                  onClick={handlePaste}
                  disabled={!pasteValue}
                  className="px-4 py-2 bg-purple-600 text-white rounded-lg text-sm hover:bg-purple-700 disabled:opacity-50"
                >
                  Pay
                </button>
              </div>
            </motion.div>
          )}
        </AnimatePresence>
      </div>
    );
  }
  // Minimal variant (default)
  return (
    <div className="relative">
      <button
        onClick={() => setShowPasteInput(!showPasteInput)}
        className="flex items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-lg transition-colors"
      >
        <Camera className="w-4 h-4" />
        <span>Scan</span>
      </button>
      <AnimatePresence>
        {showPasteInput && (
          <motion.div
            initial={{ opacity: 0, y: -10 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: -10 }}
            className="absolute top-full left-0 mt-2 p-3 bg-white rounded-lg shadow-lg border border-gray-200 z-10"
          >
            <div className="flex gap-2">
              <input
                type="text"
                value={pasteValue}
                onChange={(e) => setPasteValue(e.target.value)}
                onKeyDown={(e) => e.key === 'Enter' && handlePaste()}
                placeholder="Paste invoice"
                className="px-2 py-1 text-sm border border-gray-200 rounded focus:outline-none focus:border-blue-500"
                autoFocus
              />
              <button
                onClick={handlePaste}
                disabled={!pasteValue}
                className="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 disabled:opacity-50"
              >
                Pay
              </button>
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
}
</file>

<file path="src/components/wallet/README.md">
# NIP-60 Lightning Wallet UI Components

A gorgeous, elegant, and minimalist wallet UI for NIP-60 Lightning transactions with Cashu mint support.

## Features

- **5 Design Variations**: Choose from minimal light, minimal dark, card elegant, gradient modern, or compact styles
- **Cashu Mint Configuration**: Add and manage multiple Cashu mints with tooltips
- **QR Code Scanner**: Scan Lightning invoices with paste fallback option
- **Send & Receive**: Intuitive transaction modals with mock functionality
- **Subtle Animations**: Smooth Framer Motion animations throughout
- **Responsive Design**: Works beautifully on desktop and mobile

## Components

### Main Components

- `Wallet` - Main wallet component with variant selection
- `WalletBalance` - Displays balance with optional animations
- `MintConfiguration` - Manage Cashu mints configuration
- `TransactionButton` - Send/Receive action buttons
- `QRScanner` - QR code scanning with paste fallback
- `TransactionModal` - Modal for send/receive transactions

### Usage

```tsx
import { Wallet } from '@/components/wallet';

// Basic usage with default minimal-light variant
<Wallet />

// With specific variant
<Wallet variant="gradient-modern" />

// Available variants:
// - 'minimal-light' (default)
// - 'minimal-dark'
// - 'card-elegant'
// - 'gradient-modern'
// - 'compact'
```

## Design Variations

### Minimal Light (Default)
Clean and minimal design with light theme. Features subtle borders and elegant typography.

### Minimal Dark
Sleek dark theme with yellow accents inspired by Lightning. Perfect for dark mode applications.

### Card Elegant
Sophisticated card design with gradient accents and detailed balance display including daily changes.

### Gradient Modern
Bold animated gradient background with glassmorphism effects. Eye-catching and modern.

### Compact
Space-efficient inline design perfect for embedding in sidebars or headers.

## Mock Functionality

All components include mock functionality ready for integration:

- Balance tracking with animated updates
- Mint configuration with add/remove/toggle
- Invoice generation and QR codes
- Clipboard integration for paste functionality
- Transaction processing animations

## Integration with NIP-60

The wallet is designed to integrate with NIP-60 protocol for Cashu ecash wallets:

1. **Mint Management**: Configure and connect to multiple Cashu mints
2. **Balance Aggregation**: Track total balance across all mints
3. **Lightning Integration**: Send/receive via Lightning Network
4. **Zap Support**: Ready for Nostr zap integration

## Customization

Components use Tailwind CSS and can be easily customized:

- Colors can be adjusted via Tailwind classes
- Animations powered by Framer Motion
- Icons from Lucide React
- Fully typed with TypeScript

## Example Integration

See `WalletIntegration.tsx` for a complete example of how to integrate the wallet with zapping functionality.

## Development

To view all wallet variations:
1. Navigate to `/wallet` in your browser
2. Click on different variant buttons to see each design
3. Interact with buttons to see animations and modals

The wallet page showcases all features and variations in an interactive demo.
</file>

<file path="src/components/wallet/TransactionButton.tsx">
import { motion } from 'framer-motion';
import { Send, Download, ArrowUpRight, ArrowDownLeft } from 'lucide-react';
interface TransactionButtonProps {
  type: 'send' | 'receive';
  onClick: () => void;
  variant?: 'minimal' | 'detailed' | 'icon';
  disabled?: boolean;
}
export function TransactionButton({ 
  type, 
  onClick, 
  variant = 'minimal',
  disabled = false 
}: TransactionButtonProps) {
  const isSend = type === 'send';
  const icons = {
    minimal: isSend ? <Send className="w-4 h-4" /> : <Download className="w-4 h-4" />,
    detailed: isSend ? <ArrowUpRight className="w-5 h-5" /> : <ArrowDownLeft className="w-5 h-5" />,
    icon: isSend ? <Send className="w-5 h-5" /> : <Download className="w-5 h-5" />
  };
  const labels = {
    send: 'Send',
    receive: 'Receive'
  };
  if (variant === 'icon') {
    return (
      <motion.button
        onClick={onClick}
        disabled={disabled}
        whileHover={{ scale: 1.05 }}
        whileTap={{ scale: 0.95 }}
        className={`
          p-3 rounded-full transition-all
          ${isSend 
            ? 'bg-blue-600 hover:bg-blue-700 text-white' 
            : 'bg-gray-100 hover:bg-gray-200 text-gray-700'
          }
          ${disabled ? 'opacity-50 cursor-not-allowed' : ''}
        `}
      >
        {icons[variant]}
      </motion.button>
    );
  }
  if (variant === 'detailed') {
    return (
      <motion.button
        onClick={onClick}
        disabled={disabled}
        whileHover={{ scale: 1.02, y: -2 }}
        whileTap={{ scale: 0.98 }}
        className={`
          flex flex-col items-center justify-center p-6 rounded-2xl transition-all w-full
          ${isSend 
            ? 'bg-gradient-to-br from-blue-500 to-blue-600 text-white shadow-lg shadow-blue-500/20' 
            : 'bg-white border-2 border-gray-200 text-gray-700 hover:border-gray-300'
          }
          ${disabled ? 'opacity-50 cursor-not-allowed' : ''}
        `}
      >
        <motion.div
          initial={{ rotate: 0 }}
          whileHover={{ rotate: isSend ? -45 : 45 }}
          transition={{ type: "spring", stiffness: 300 }}
        >
          {icons[variant]}
        </motion.div>
        <span className="mt-2 text-sm font-medium">{labels[type]}</span>
      </motion.button>
    );
  }
  // Minimal variant (default)
  return (
    <motion.button
      onClick={onClick}
      disabled={disabled}
      whileHover={{ scale: 1.05 }}
      whileTap={{ scale: 0.95 }}
      transition={{ type: "spring", stiffness: 400, damping: 17 }}
      className={`
        flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all
        ${isSend 
          ? 'bg-gray-900 hover:bg-gray-800 text-white' 
          : 'bg-white hover:bg-gray-50 text-gray-900 border border-gray-200'
        }
        ${disabled ? 'opacity-50 cursor-not-allowed' : ''}
      `}
    >
      {icons[variant]}
      <span>{labels[type]}</span>
    </motion.button>
  );
}
</file>

<file path="src/components/wallet/TransactionModal.tsx">
import { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { X, Copy, Check, Zap, QrCode, Loader2 } from 'lucide-react';
interface TransactionModalProps {
  type: 'send' | 'receive';
  isOpen: boolean;
  onClose: () => void;
  balance: number;
  variant?: 'light' | 'dark' | 'gradient';
}
export function TransactionModal({
  type,
  isOpen,
  onClose,
  balance,
  variant = 'light'
}: TransactionModalProps) {
  const [amount, setAmount] = useState('');
  const [description, setDescription] = useState('');
  const [invoice, setInvoice] = useState('');
  const [copied, setCopied] = useState(false);
  const [isProcessing, setIsProcessing] = useState(false);
  const isSend = type === 'send';
  const handleCopy = () => {
    // Mock invoice
    const mockInvoice = 'lnbc21000n1pj9xyz...mockInvoice';
    navigator.clipboard.writeText(mockInvoice);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };
  const handleSubmit = () => {
    setIsProcessing(true);
    // Mock transaction
    setTimeout(() => {
      setIsProcessing(false);
      onClose();
    }, 2000);
  };
  const getModalStyles = () => {
    switch (variant) {
      case 'dark':
        return 'bg-gray-900 text-white';
      case 'gradient':
        return 'bg-gradient-to-br from-purple-600 to-pink-600 text-white';
      default:
        return 'bg-white';
    }
  };
  const getInputStyles = () => {
    switch (variant) {
      case 'dark':
        return 'bg-gray-800 border-gray-700 text-white placeholder-gray-400';
      case 'gradient':
        return 'bg-white/20 border-white/30 text-white placeholder-white/70 backdrop-blur-sm';
      default:
        return 'bg-white border-gray-200 text-gray-900';
    }
  };
  return (
    <AnimatePresence>
      {isOpen && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={onClose}
        >
          <motion.div
            initial={{ scale: 0.9, y: 20 }}
            animate={{ scale: 1, y: 0 }}
            exit={{ scale: 0.9, y: 20 }}
            className={`rounded-3xl p-6 max-w-md w-full shadow-2xl ${getModalStyles()}`}
            onClick={(e) => e.stopPropagation()}
          >
            {/* Header */}
            <div className="flex justify-between items-center mb-6">
              <h3 className="text-xl font-semibold">
                {isSend ? 'Send Payment' : 'Receive Payment'}
              </h3>
              <button
                onClick={onClose}
                className={`p-2 rounded-lg transition-colors ${
                  variant === 'dark' ? 'hover:bg-gray-800' : 'hover:bg-gray-100'
                }`}
              >
                <X className="w-5 h-5" />
              </button>
            </div>
            {/* Content */}
            {isSend ? (
              <div className="space-y-4">
                <div>
                  <label className={`text-sm ${variant === 'dark' ? 'text-gray-400' : 'text-gray-600'} mb-1 block`}>
                    Invoice
                  </label>
                  <textarea
                    value={invoice}
                    onChange={(e) => setInvoice(e.target.value)}
                    placeholder="Paste Lightning invoice or LNURL..."
                    className={`w-full p-3 rounded-xl resize-none focus:outline-none focus:ring-2 focus:ring-purple-500 ${getInputStyles()}`}
                    rows={3}
                  />
                </div>
                <div className="text-center py-2">
                  <span className={`text-sm ${variant === 'dark' ? 'text-gray-500' : 'text-gray-400'}`}>or</span>
                </div>
                <div>
                  <label className={`text-sm ${variant === 'dark' ? 'text-gray-400' : 'text-gray-600'} mb-1 block`}>
                    Amount (sats)
                  </label>
                  <input
                    type="number"
                    value={amount}
                    onChange={(e) => setAmount(e.target.value)}
                    placeholder="0"
                    className={`w-full p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 ${getInputStyles()}`}
                  />
                  <div className={`text-xs mt-1 ${variant === 'dark' ? 'text-gray-500' : 'text-gray-500'}`}>
                    Available: {balance.toLocaleString()} sats
                  </div>
                </div>
                <div>
                  <label className={`text-sm ${variant === 'dark' ? 'text-gray-400' : 'text-gray-600'} mb-1 block`}>
                    Note (optional)
                  </label>
                  <input
                    type="text"
                    value={description}
                    onChange={(e) => setDescription(e.target.value)}
                    placeholder="Coffee tip"
                    className={`w-full p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 ${getInputStyles()}`}
                  />
                </div>
                <motion.button
                  whileHover={{ scale: 1.02 }}
                  whileTap={{ scale: 0.98 }}
                  onClick={handleSubmit}
                  disabled={!invoice && !amount}
                  className={`w-full py-3 rounded-xl font-medium transition-all flex items-center justify-center gap-2 ${
                    variant === 'gradient'
                      ? 'bg-white text-purple-600 hover:bg-white/90'
                      : variant === 'dark'
                      ? 'bg-yellow-500 text-gray-900 hover:bg-yellow-400'
                      : 'bg-gray-900 text-white hover:bg-gray-800'
                  } disabled:opacity-50 disabled:cursor-not-allowed`}
                >
                  {isProcessing ? (
                    <>
                      <Loader2 className="w-4 h-4 animate-spin" />
                      <span>Processing...</span>
                    </>
                  ) : (
                    <>
                      <Zap className="w-4 h-4" />
                      <span>Send Payment</span>
                    </>
                  )}
                </motion.button>
              </div>
            ) : (
              <div className="space-y-4">
                <div>
                  <label className={`text-sm ${variant === 'dark' ? 'text-gray-400' : 'text-gray-600'} mb-1 block`}>
                    Amount (sats)
                  </label>
                  <input
                    type="number"
                    value={amount}
                    onChange={(e) => setAmount(e.target.value)}
                    placeholder="0"
                    className={`w-full p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 ${getInputStyles()}`}
                  />
                </div>
                <div>
                  <label className={`text-sm ${variant === 'dark' ? 'text-gray-400' : 'text-gray-600'} mb-1 block`}>
                    Description
                  </label>
                  <input
                    type="text"
                    value={description}
                    onChange={(e) => setDescription(e.target.value)}
                    placeholder="What's this payment for?"
                    className={`w-full p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 ${getInputStyles()}`}
                  />
                </div>
                {amount && (
                  <motion.div
                    initial={{ opacity: 0, height: 0 }}
                    animate={{ opacity: 1, height: 'auto' }}
                    className="space-y-4"
                  >
                    <div className={`p-4 rounded-xl ${
                      variant === 'dark' ? 'bg-gray-800' : 'bg-gray-50'
                    }`}>
                      <div className="flex items-center justify-center mb-4">
                        <div className="p-8 bg-white rounded-2xl">
                          <QrCode className="w-32 h-32 text-gray-900" />
                        </div>
                      </div>
                      <div className={`text-xs ${
                        variant === 'dark' ? 'text-gray-400' : 'text-gray-500'
                      } text-center break-all`}>
                        lnbc{amount}n1pj9xyz...mockInvoice
                      </div>
                    </div>
                    <button
                      onClick={handleCopy}
                      className={`w-full py-3 rounded-xl font-medium transition-all flex items-center justify-center gap-2 ${
                        variant === 'gradient'
                          ? 'bg-white/20 text-white hover:bg-white/30'
                          : variant === 'dark'
                          ? 'bg-gray-800 text-white hover:bg-gray-700'
                          : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                      }`}
                    >
                      {copied ? (
                        <>
                          <Check className="w-4 h-4" />
                          <span>Copied!</span>
                        </>
                      ) : (
                        <>
                          <Copy className="w-4 h-4" />
                          <span>Copy Invoice</span>
                        </>
                      )}
                    </button>
                  </motion.div>
                )}
                {!amount && (
                  <motion.button
                    whileHover={{ scale: 1.02 }}
                    whileTap={{ scale: 0.98 }}
                    onClick={() => setAmount('1000')}
                    className={`w-full py-3 rounded-xl font-medium transition-all ${
                      variant === 'gradient'
                        ? 'bg-white text-purple-600 hover:bg-white/90'
                        : variant === 'dark'
                        ? 'bg-yellow-500 text-gray-900 hover:bg-yellow-400'
                        : 'bg-gray-900 text-white hover:bg-gray-800'
                    }`}
                  >
                    Generate Invoice
                  </motion.button>
                )}
              </div>
            )}
          </motion.div>
        </motion.div>
      )}
    </AnimatePresence>
  );
}
</file>

<file path="src/components/wallet/Wallet.tsx">
import { useState } from 'react';
import { motion } from 'framer-motion';
import { WalletBalance } from './WalletBalance';
import { MintConfiguration } from './MintConfiguration';
import { TransactionButton } from './TransactionButton';
import { QRScanner } from './QRScanner';
import { TransactionModal } from './TransactionModal';
import { Zap, History, MoreHorizontal } from 'lucide-react';
export type WalletVariant = 'minimal-light' | 'minimal-dark' | 'card-elegant' | 'gradient-modern' | 'compact';
interface WalletProps {
  variant?: WalletVariant;
}
export function Wallet({ variant = 'minimal-light' }: WalletProps) {
  const [balance] = useState(21000);
  const [showSendModal, setShowSendModal] = useState(false);
  const [showReceiveModal, setShowReceiveModal] = useState(false);
  const [showHistory, setShowHistory] = useState(false);
  const handleScan = (data: string) => {
    console.log('Scanned:', data);
    // Mock: Parse lightning invoice and open send modal
    setShowSendModal(true);
  };
  const handleSend = () => {
    setShowSendModal(true);
  };
  const handleReceive = () => {
    setShowReceiveModal(true);
  };
  // Minimal Light Variant (Default)
  if (variant === 'minimal-light') {
    return (
      <>
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          className="bg-white rounded-2xl p-6 shadow-sm border border-gray-100"
        >
          <div className="flex justify-between items-start mb-6">
            <h2 className="text-lg font-medium text-gray-900">Wallet</h2>
            <div className="flex items-center gap-2">
              <QRScanner onScan={handleScan} variant="minimal" />
              <MintConfiguration variant="minimal" />
            </div>
          </div>
          <WalletBalance amount={balance} variant="minimal" />
          <div className="flex gap-3 mt-6">
            <TransactionButton type="send" onClick={handleSend} variant="minimal" />
            <TransactionButton type="receive" onClick={handleReceive} variant="minimal" />
          </div>
          <button
            onClick={() => setShowHistory(!showHistory)}
            className="w-full mt-4 text-sm text-gray-500 hover:text-gray-700 transition-colors"
          >
            View History
          </button>
        </motion.div>
        <TransactionModal
          type="send"
          isOpen={showSendModal}
          onClose={() => setShowSendModal(false)}
          balance={balance}
        />
        <TransactionModal
          type="receive"
          isOpen={showReceiveModal}
          onClose={() => setShowReceiveModal(false)}
          balance={balance}
        />
      </>
    );
  }
  // Minimal Dark Variant
  if (variant === 'minimal-dark') {
    return (
      <>
        <motion.div
          initial={{ opacity: 0, scale: 0.95 }}
          animate={{ opacity: 1, scale: 1 }}
          className="bg-gray-900 rounded-3xl p-8 shadow-2xl"
        >
          <div className="flex justify-between items-center mb-8">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-yellow-500 rounded-full flex items-center justify-center">
                <Zap className="w-5 h-5 text-gray-900" />
              </div>
              <h2 className="text-white font-light text-xl">Lightning Wallet</h2>
            </div>
            <button className="p-2 hover:bg-gray-800 rounded-lg transition-colors">
              <MoreHorizontal className="w-5 h-5 text-gray-400" />
            </button>
          </div>
          <div className="text-center mb-8">
            <div className="text-5xl font-thin text-white mb-2">
              {balance.toLocaleString()}
            </div>
            <div className="text-gray-400 text-sm">satoshis</div>
          </div>
          <div className="grid grid-cols-2 gap-4 mb-6">
            <motion.button
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
              onClick={handleSend}
              className="py-4 bg-yellow-500 text-gray-900 rounded-xl font-medium hover:bg-yellow-400 transition-colors"
            >
              Send
            </motion.button>
            <motion.button
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
              onClick={handleReceive}
              className="py-4 bg-gray-800 text-white rounded-xl font-medium hover:bg-gray-700 transition-colors"
            >
              Receive
            </motion.button>
          </div>
          <div className="flex items-center justify-between pt-6 border-t border-gray-800">
            <button
              onClick={() => setShowHistory(!showHistory)}
              className="flex items-center gap-2 text-gray-400 hover:text-gray-300 text-sm"
            >
              <History className="w-4 h-4" />
              <span>History</span>
            </button>
            <button className="text-gray-400 hover:text-gray-300 text-sm">
              Settings
            </button>
          </div>
        </motion.div>
        <TransactionModal
          type="send"
          isOpen={showSendModal}
          onClose={() => setShowSendModal(false)}
          balance={balance}
          variant="dark"
        />
        <TransactionModal
          type="receive"
          isOpen={showReceiveModal}
          onClose={() => setShowReceiveModal(false)}
          balance={balance}
          variant="dark"
        />
      </>
    );
  }
  // Card Elegant Variant
  if (variant === 'card-elegant') {
    return (
      <>
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ type: "spring", stiffness: 200, damping: 20 }}
          className="max-w-md mx-auto"
        >
          <motion.div
            className="bg-gradient-to-br from-white to-gray-50 rounded-3xl p-8 shadow-xl border border-gray-100"
            whileHover={{ y: -5 }}
            transition={{ type: "spring", stiffness: 300 }}
          >
            <div className="flex items-center justify-between mb-8">
              <div className="flex items-center gap-3">
                <div className="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                  <Zap className="w-6 h-6 text-white" />
                </div>
                <div>
                  <h2 className="text-xl font-semibold text-gray-900">NIP-60 Wallet</h2>
                  <p className="text-xs text-gray-500">Lightning Network</p>
                </div>
              </div>
            </div>
            <WalletBalance amount={balance} variant="detailed" showChange changeAmount={2500} />
            <div className="mt-8 space-y-4">
              <MintConfiguration variant="detailed" />
              <QRScanner onScan={handleScan} variant="detailed" />
            </div>
            <div className="flex gap-4 mt-8">
              <TransactionButton type="send" onClick={handleSend} variant="detailed" />
              <TransactionButton type="receive" onClick={handleReceive} variant="detailed" />
            </div>
            <div className="mt-8 pt-6 border-t border-gray-200">
              <button
                onClick={() => setShowHistory(!showHistory)}
                className="w-full flex items-center justify-center gap-2 text-sm text-gray-600 hover:text-gray-900 transition-colors"
              >
                <History className="w-4 h-4" />
                <span>Transaction History</span>
              </button>
            </div>
          </motion.div>
        </motion.div>
        <TransactionModal
          type="send"
          isOpen={showSendModal}
          onClose={() => setShowSendModal(false)}
          balance={balance}
        />
        <TransactionModal
          type="receive"
          isOpen={showReceiveModal}
          onClose={() => setShowReceiveModal(false)}
          balance={balance}
        />
      </>
    );
  }
  // Gradient Modern Variant
  if (variant === 'gradient-modern') {
    return (
      <>
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          className="relative overflow-hidden rounded-3xl"
        >
          {/* Animated gradient background */}
          <div className="absolute inset-0 bg-gradient-to-br from-purple-600 via-pink-500 to-orange-500">
            <motion.div
              className="absolute inset-0 bg-gradient-to-tr from-blue-600/30 via-purple-600/30 to-pink-600/30"
              animate={{
                x: [0, 100, 0],
                y: [0, -100, 0],
              }}
              transition={{
                duration: 20,
                repeat: Infinity,
                ease: "linear"
              }}
            />
          </div>
          <div className="relative backdrop-blur-sm bg-white/10 p-8">
            <div className="text-center mb-8">
              <motion.div
                initial={{ scale: 0 }}
                animate={{ scale: 1 }}
                transition={{ type: "spring", stiffness: 200, delay: 0.2 }}
                className="inline-block"
              >
                <div className="text-6xl font-bold text-white mb-2">
                  {balance.toLocaleString()}
                </div>
                <div className="text-white/80 text-sm uppercase tracking-wide">Satoshis</div>
              </motion.div>
            </div>
            <div className="grid grid-cols-3 gap-3 mb-8">
              <motion.button
                whileHover={{ scale: 1.05 }}
                whileTap={{ scale: 0.95 }}
                onClick={handleSend}
                className="bg-white/20 backdrop-blur-md text-white p-4 rounded-2xl hover:bg-white/30 transition-all"
              >
                <Zap className="w-6 h-6 mx-auto mb-2" />
                <div className="text-xs">Zap</div>
              </motion.button>
              <motion.button
                whileHover={{ scale: 1.05 }}
                whileTap={{ scale: 0.95 }}
                onClick={handleSend}
                className="bg-white/20 backdrop-blur-md text-white p-4 rounded-2xl hover:bg-white/30 transition-all"
              >
                <History className="w-6 h-6 mx-auto mb-2" />
                <div className="text-xs">History</div>
              </motion.button>
              <motion.button
                whileHover={{ scale: 1.05 }}
                whileTap={{ scale: 0.95 }}
                onClick={() => {}}
                className="bg-white/20 backdrop-blur-md text-white p-4 rounded-2xl hover:bg-white/30 transition-all"
              >
                <MoreHorizontal className="w-6 h-6 mx-auto mb-2" />
                <div className="text-xs">More</div>
              </motion.button>
            </div>
            <div className="flex gap-3">
              <motion.button
                whileHover={{ scale: 1.02 }}
                whileTap={{ scale: 0.98 }}
                onClick={handleSend}
                className="flex-1 py-4 bg-white text-purple-600 rounded-2xl font-semibold hover:bg-white/90 transition-all"
              >
                Send
              </motion.button>
              <motion.button
                whileHover={{ scale: 1.02 }}
                whileTap={{ scale: 0.98 }}
                onClick={handleReceive}
                className="flex-1 py-4 bg-white/20 backdrop-blur-md text-white rounded-2xl font-semibold hover:bg-white/30 transition-all"
              >
                Receive
              </motion.button>
            </div>
          </div>
        </motion.div>
        <TransactionModal
          type="send"
          isOpen={showSendModal}
          onClose={() => setShowSendModal(false)}
          balance={balance}
          variant="gradient"
        />
        <TransactionModal
          type="receive"
          isOpen={showReceiveModal}
          onClose={() => setShowReceiveModal(false)}
          balance={balance}
          variant="gradient"
        />
      </>
    );
  }
  // Compact Variant
  if (variant === 'compact') {
    return (
      <>
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          className="bg-white rounded-xl p-4 shadow-sm border border-gray-100"
        >
          <div className="flex items-center justify-between">
            <WalletBalance amount={balance} variant="compact" />
            <div className="flex gap-2">
              <TransactionButton type="send" onClick={handleSend} variant="icon" />
              <TransactionButton type="receive" onClick={handleReceive} variant="icon" />
            </div>
          </div>
        </motion.div>
        <TransactionModal
          type="send"
          isOpen={showSendModal}
          onClose={() => setShowSendModal(false)}
          balance={balance}
        />
        <TransactionModal
          type="receive"
          isOpen={showReceiveModal}
          onClose={() => setShowReceiveModal(false)}
          balance={balance}
        />
      </>
    );
  }
  return null;
}
</file>

<file path="src/components/wallet/WalletBalance.tsx">
import { useState, useEffect } from 'react';
import { motion } from 'framer-motion';
interface WalletBalanceProps {
  amount: number;
  unit?: string;
  showChange?: boolean;
  changeAmount?: number;
  variant?: 'minimal' | 'detailed' | 'compact';
}
export function WalletBalance({
  amount,
  unit = 'sats',
  showChange = false,
  changeAmount = 0,
  variant = 'minimal'
}: WalletBalanceProps) {
  const [displayAmount, setDisplayAmount] = useState(0);
  useEffect(() => {
    // Animate balance changes
    const timer = setTimeout(() => {
      setDisplayAmount(amount);
    }, 100);
    return () => clearTimeout(timer);
  }, [amount]);
  const formatAmount = (value: number) => {
    return new Intl.NumberFormat('en-US').format(value);
  };
  const isPositiveChange = changeAmount > 0;
  if (variant === 'compact') {
    return (
      <div className="flex items-baseline gap-1">
        <span className="text-2xl font-light text-gray-900">{formatAmount(displayAmount)}</span>
        <span className="text-sm text-gray-500">{unit}</span>
      </div>
    );
  }
  if (variant === 'detailed') {
    return (
      <div className="space-y-2">
        <div className="flex items-end gap-2">
          <motion.span
            key={displayAmount}
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            className="text-5xl font-thin text-gray-900"
          >
            {formatAmount(displayAmount)}
          </motion.span>
          <span className="text-lg text-gray-600 mb-2">{unit}</span>
        </div>
        {showChange && changeAmount !== 0 && (
          <motion.div
            initial={{ opacity: 0, x: -10 }}
            animate={{ opacity: 1, x: 0 }}
            className={`text-sm ${isPositiveChange ? 'text-green-600' : 'text-red-600'}`}
          >
            <span>{isPositiveChange ? '+' : '-'}</span>
            <span>{formatAmount(Math.abs(changeAmount))}</span>
            <span className="text-xs ml-1">today</span>
          </motion.div>
        )}
      </div>
    );
  }
  // Minimal variant (default)
  return (
    <div className="text-center">
      <motion.div
        key={displayAmount}
        initial={{ scale: 0.95, opacity: 0 }}
        animate={{ scale: 1, opacity: 1 }}
        transition={{ type: "spring", stiffness: 300, damping: 25 }}
        className="text-4xl font-light text-gray-900"
      >
        {formatAmount(displayAmount)}
      </motion.div>
      <div className="text-sm text-gray-500 mt-1">{unit}</div>
    </div>
  );
}
</file>

<file path="src/components/wallet/WalletBalanceBadge.tsx">
import { useState } from 'react';
import { motion } from 'framer-motion';
import { Zap } from 'lucide-react';
import { useNavigate } from 'react-router-dom';
export function WalletBalanceBadge() {
  const [balance] = useState(21000);
  const navigate = useNavigate();
  const handleClick = () => {
    navigate('/wallet');
  };
  return (
    <motion.button
      onClick={handleClick}
      whileHover={{ scale: 1.05 }}
      whileTap={{ scale: 0.95 }}
      className="flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-950/30 dark:to-orange-950/30 rounded-full border border-yellow-200 dark:border-yellow-800/50 transition-all hover:shadow-md"
    >
      <div className="w-5 h-5 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center">
        <Zap className="w-3 h-3 text-white" />
      </div>
      <span className="text-sm font-medium text-gray-900 dark:text-gray-100">
        {balance.toLocaleString()}
      </span>
      <span className="text-xs text-gray-500 dark:text-gray-400">sats</span>
    </motion.button>
  );
}
</file>

<file path="src/components/wallet/WalletIntegration.tsx">
import { useState } from 'react';
import { motion } from 'framer-motion';
import { Zap, CheckCircle, XCircle } from 'lucide-react';
import { Wallet } from './Wallet';
/**
 * Example integration showing how to use the Wallet component
 * with mock NIP-60 functionality for zapping
 */
export function WalletIntegration() {
  const [zapHistory, setZapHistory] = useState<Array<{
    id: string;
    amount: number;
    recipient: string;
    timestamp: Date;
    status: 'success' | 'failed';
  }>>([]);
  // Mock function to handle zap sending
  const handleZap = (recipient: string, amount: number) => {
    const newZap = {
      id: Date.now().toString(),
      amount,
      recipient,
      timestamp: new Date(),
      status: 'success' as const
    };
    setZapHistory(prev => [newZap, ...prev]);
    // Here you would integrate with actual NIP-60 implementation
    console.log('Zap sent:', { recipient, amount });
  };
  return (
    <div className="space-y-6">
      {/* Main Wallet Component */}
      <Wallet variant="minimal-light" />
      {/* Example Zap Interface */}
      <div className="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
        <h3 className="text-lg font-medium text-gray-900 mb-4">Quick Zap</h3>
        <div className="space-y-4">
          {/* Quick Zap Buttons */}
          <div className="flex gap-2">
            {[100, 500, 1000, 5000].map(amount => (
              <motion.button
                key={amount}
                whileHover={{ scale: 1.05 }}
                whileTap={{ scale: 0.95 }}
                onClick={() => handleZap('npub1...example', amount)}
                className="flex-1 px-3 py-2 bg-gray-50 hover:bg-gray-100 rounded-lg text-sm font-medium text-gray-700 transition-colors"
              >
                <Zap className="w-4 h-4 inline mr-1" />
                {amount}
              </motion.button>
            ))}
          </div>
          {/* Recent Zaps */}
          {zapHistory.length > 0 && (
            <div className="space-y-2 mt-6">
              <h4 className="text-sm font-medium text-gray-600">Recent Zaps</h4>
              {zapHistory.slice(0, 3).map(zap => (
                <motion.div
                  key={zap.id}
                  initial={{ opacity: 0, x: -10 }}
                  animate={{ opacity: 1, x: 0 }}
                  className="flex items-center justify-between p-3 bg-gray-50 rounded-lg"
                >
                  <div className="flex items-center gap-3">
                    {zap.status === 'success' ? (
                      <CheckCircle className="w-4 h-4 text-green-500" />
                    ) : (
                      <XCircle className="w-4 h-4 text-red-500" />
                    )}
                    <div>
                      <div className="text-sm font-medium text-gray-700">
                        {zap.amount} sats
                      </div>
                      <div className="text-xs text-gray-500">
                        {zap.recipient.slice(0, 16)}...
                      </div>
                    </div>
                  </div>
                  <div className="text-xs text-gray-400">
                    {zap.timestamp.toLocaleTimeString()}
                  </div>
                </motion.div>
              ))}
            </div>
          )}
        </div>
      </div>
      {/* Integration Notes */}
      <div className="bg-blue-50 border border-blue-200 rounded-xl p-4">
        <h4 className="text-sm font-medium text-blue-900 mb-2">NIP-60 Integration</h4>
        <ul className="text-xs text-blue-700 space-y-1">
          <li>‚Ä¢ Connect to Cashu mints using NIP-60 protocol</li>
          <li>‚Ä¢ Generate Lightning invoices for receiving</li>
          <li>‚Ä¢ Scan QR codes or paste invoices for sending</li>
          <li>‚Ä¢ Track balance across multiple mints</li>
          <li>‚Ä¢ Mock functionality ready for real implementation</li>
        </ul>
      </div>
    </div>
  );
}
</file>

<file path="src/config/auth.ts">
export const AUTH_STORAGE_KEYS = {
  PRIVATE_KEY: 'nostr_private_key',
  BUNKER_URL: 'nostr_bunker_url',
  EXTENSION_AUTO_LOGIN: 'nostr_extension_auto_login',
} as const;
</file>

<file path="src/config/ndk.ts">
// This file is now deprecated as all NDK functionality is provided by ndk-hooks
// Keeping it only for reference if needed during migration
import { NDKNip07Signer, NDKPrivateKeySigner } from '@nostr-dev-kit/ndk-hooks';
// Default relay configuration (moved to NDKContext.tsx)
export const defaultRelays = [
  'wss://relay.damus.io',
  'wss://relay.nostr.band',
  'wss://nos.lol',
  'wss://relay.snort.social',
  'wss://relay.primal.net'
];
// Helper to get signer based on available auth method (deprecated - use session hooks instead)
export async function getSigner(): Promise<NDKPrivateKeySigner | NDKNip07Signer | null> {
  // Check for NIP-07 extension (like Alby, nos2x, etc.)
  if (window.nostr) {
    return new NDKNip07Signer();
  }
  // Check for stored private key (for demo purposes - in production use secure storage)
  const privateKey = localStorage.getItem('nostr_private_key');
  if (privateKey) {
    return new NDKPrivateKeySigner(privateKey);
  }
  return null;
}
</file>

<file path="src/features/auth/utils/logout.ts">
import { AUTH_STORAGE_KEYS } from '@/config/auth';
export function clearAuthStorage(): void {
  Object.values(AUTH_STORAGE_KEYS).forEach(key => {
    localStorage.removeItem(key);
  });
}
</file>

<file path="src/features/auth/useAutoLogin.ts">
import { useEffect, useState } from 'react';
import {
  useNDKCurrentUser,
  useNDKSessionLogin,
  NDKNip07Signer,
  NDKNip46Signer,
  NDKPrivateKeySigner
} from '@nostr-dev-kit/ndk-hooks';
export function useAutoLogin() {
  const currentUser = useNDKCurrentUser();
  const login = useNDKSessionLogin();
  const [isAttempting, setIsAttempting] = useState(false);
  const [attempted, setAttempted] = useState(false);
  useEffect(() => {
    if (currentUser || attempted || isAttempting) return;
    const attemptAutoLogin = async () => {
      setIsAttempting(true);
      try {
        // Check for saved bunker URL first (NIP-46)
        const bunkerUrl = localStorage.getItem('nostr_bunker_url');
        if (bunkerUrl) {
          try {
            const signer = new NDKNip46Signer(bunkerUrl);
            await signer.blockUntilReady();
            await login(signer, true);
            return;
          } catch (error) {
            console.error('Bunker auto-login failed:', error);
            localStorage.removeItem('nostr_bunker_url');
          }
        }
        // Check for saved private key
        const privateKey = localStorage.getItem('nostr_private_key');
        if (privateKey) {
          try {
            const signer = new NDKPrivateKeySigner(privateKey);
            await login(signer, true);
            return;
          } catch (error) {
            console.error('Private key auto-login failed:', error);
            localStorage.removeItem('nostr_private_key');
          }
        }
        // Check for browser extension (NIP-07)
        if (window.nostr) {
          try {
            const hasAutoLoginConsent = localStorage.getItem('nostr_extension_auto_login');
            if (hasAutoLoginConsent === 'true') {
              const signer = new NDKNip07Signer();
              await login(signer, false); // Don't persist for extension
              return;
            }
          } catch (error) {
            console.error('Extension auto-login failed:', error);
            localStorage.removeItem('nostr_extension_auto_login');
          }
        }
      } finally {
        setIsAttempting(false);
        setAttempted(true);
      }
    };
    attemptAutoLogin();
  }, [currentUser, login, attempted, isAttempting]);
  return { isAttempting };
}
</file>

<file path="src/features/classifieds/components/CategorySection.tsx">
import { ChevronRight } from 'lucide-react';
import { Link } from 'react-router-dom';
import type { ClassifiedListing } from '../types';
import { ListingCard } from './ListingCard';
interface CategorySectionProps {
  category: string;
  listings: ClassifiedListing[];
  showViewAll?: boolean;
}
export function CategorySection({ category, listings, showViewAll = true }: CategorySectionProps) {
  if (listings.length === 0) return null;
  const displayName = category.charAt(0).toUpperCase() + category.slice(1).replace('-', ' ');
  return (
    <section className="mb-8">
      <div className="flex items-center justify-between mb-4">
        <h2 className="text-xl font-semibold text-gray-900 dark:text-white">
          {displayName}
        </h2>
        {showViewAll && listings.length > 4 && (
          <Link
            to={`/marketplace?category=${category}`}
            className="flex items-center gap-1 text-sm text-purple-600 hover:text-purple-700 dark:text-purple-400 dark:hover:text-purple-300"
          >
            View All
            <ChevronRight className="w-4 h-4" />
          </Link>
        )}
      </div>
      <div className="relative">
        <div className="flex gap-4 overflow-x-auto scrollbar-hide pb-2">
          {listings.slice(0, 10).map((listing) => (
            <div
              key={listing.id}
              className="flex-none w-72 sm:w-80"
            >
              <ListingCard listing={listing} />
            </div>
          ))}
        </div>
      </div>
    </section>
  );
}
</file>

<file path="src/features/classifieds/components/ListingForm.tsx">
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Plus, X, ImagePlus } from 'lucide-react';
import type { ListingFormData, PriceFrequency } from '../types';
interface ListingFormProps {
  onSubmit: (data: ListingFormData) => Promise<void>;
  initialData?: Partial<ListingFormData>;
  isSubmitting?: boolean;
}
const COMMON_CATEGORIES = [
  'electronics',
  'furniture',
  'clothing',
  'books',
  'services',
  'vehicles',
  'real-estate',
  'jobs',
  'free',
  'wanted'
];
const CURRENCIES = ['USD', 'EUR', 'GBP', 'BTC', 'SATS'];
export function ListingForm({ onSubmit, initialData, isSubmitting }: ListingFormProps) {
  const navigate = useNavigate();
  const [formData, setFormData] = useState<ListingFormData>({
    title: initialData?.title || '',
    summary: initialData?.summary || '',
    content: initialData?.content || '',
    location: initialData?.location || '',
    price: initialData?.price || { amount: '', currency: 'USD' },
    categories: initialData?.categories || [],
    images: initialData?.images || []
  });
  const [newCategory, setNewCategory] = useState('');
  const [newImageUrl, setNewImageUrl] = useState('');
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    await onSubmit(formData);
  };
  const addCategory = () => {
    if (newCategory && !formData.categories.includes(newCategory)) {
      setFormData(prev => ({
        ...prev,
        categories: [...prev.categories, newCategory.toLowerCase()]
      }));
      setNewCategory('');
    }
  };
  const removeCategory = (category: string) => {
    setFormData(prev => ({
      ...prev,
      categories: prev.categories.filter(c => c !== category)
    }));
  };
  const addImage = () => {
    if (newImageUrl && !formData.images.includes(newImageUrl)) {
      setFormData(prev => ({
        ...prev,
        images: [...prev.images, newImageUrl]
      }));
      setNewImageUrl('');
    }
  };
  const removeImage = (image: string) => {
    setFormData(prev => ({
      ...prev,
      images: prev.images.filter(i => i !== image)
    }));
  };
  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      <Card>
        <CardHeader>
          <CardTitle>Listing Details</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div>
            <Label htmlFor="title">Title *</Label>
            <Input
              id="title"
              value={formData.title}
              onChange={(e) => setFormData(prev => ({ ...prev, title: e.target.value }))}
              placeholder="What are you listing?"
              required
              className="mt-1"
            />
          </div>
          <div>
            <Label htmlFor="summary">Summary</Label>
            <Input
              id="summary"
              value={formData.summary}
              onChange={(e) => setFormData(prev => ({ ...prev, summary: e.target.value }))}
              placeholder="Brief description"
              className="mt-1"
            />
          </div>
          <div>
            <Label htmlFor="content">Description *</Label>
            <Textarea
              id="content"
              value={formData.content}
              onChange={(e) => setFormData(prev => ({ ...prev, content: e.target.value }))}
              placeholder="Detailed description (Markdown supported)"
              rows={6}
              required
              className="mt-1"
            />
          </div>
          <div>
            <Label htmlFor="location">Location</Label>
            <Input
              id="location"
              value={formData.location}
              onChange={(e) => setFormData(prev => ({ ...prev, location: e.target.value }))}
              placeholder="City, State or Country"
              className="mt-1"
            />
          </div>
        </CardContent>
      </Card>
      <Card>
        <CardHeader>
          <CardTitle>Pricing</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <Label htmlFor="amount">Amount</Label>
              <Input
                id="amount"
                type="text"
                value={formData.price.amount}
                onChange={(e) => setFormData(prev => ({
                  ...prev,
                  price: { ...prev.price, amount: e.target.value }
                }))}
                placeholder="0.00"
                className="mt-1"
              />
            </div>
            <div>
              <Label htmlFor="currency">Currency</Label>
              <Select
                value={formData.price.currency}
                onValueChange={(value) => setFormData(prev => ({
                  ...prev,
                  price: { ...prev.price, currency: value }
                }))}
              >
                <SelectTrigger className="mt-1">
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  {CURRENCIES.map(currency => (
                    <SelectItem key={currency} value={currency}>
                      {currency}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>
            <div>
              <Label htmlFor="frequency">Frequency</Label>
              <Select
                value={formData.price.frequency || 'once'}
                onValueChange={(value) => setFormData(prev => ({
                  ...prev,
                  price: { ...prev.price, frequency: value as PriceFrequency }
                }))}
              >
                <SelectTrigger className="mt-1">
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="once">One time</SelectItem>
                  <SelectItem value="hour">Per hour</SelectItem>
                  <SelectItem value="day">Per day</SelectItem>
                  <SelectItem value="week">Per week</SelectItem>
                  <SelectItem value="month">Per month</SelectItem>
                  <SelectItem value="year">Per year</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </div>
        </CardContent>
      </Card>
      <Card>
        <CardHeader>
          <CardTitle>Categories</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="flex gap-2">
            <Select value={newCategory} onValueChange={setNewCategory}>
              <SelectTrigger className="flex-1">
                <SelectValue placeholder="Select a category" />
              </SelectTrigger>
              <SelectContent>
                {COMMON_CATEGORIES.map(cat => (
                  <SelectItem key={cat} value={cat}>
                    {cat.charAt(0).toUpperCase() + cat.slice(1)}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
            <Input
              value={newCategory}
              onChange={(e) => setNewCategory(e.target.value)}
              placeholder="Or type custom"
              className="flex-1"
            />
            <Button type="button" onClick={addCategory} size="icon">
              <Plus className="w-4 h-4" />
            </Button>
          </div>
          {formData.categories.length > 0 && (
            <div className="flex flex-wrap gap-2">
              {formData.categories.map(category => (
                <div
                  key={category}
                  className="inline-flex items-center gap-1 px-3 py-1 bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-400 rounded-full text-sm"
                >
                  <span>{category}</span>
                  <button
                    type="button"
                    onClick={() => removeCategory(category)}
                    className="hover:text-purple-600"
                  >
                    <X className="w-3 h-3" />
                  </button>
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>
      <Card>
        <CardHeader>
          <CardTitle>Images</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="flex gap-2">
            <Input
              value={newImageUrl}
              onChange={(e) => setNewImageUrl(e.target.value)}
              placeholder="Image URL"
              className="flex-1"
            />
            <Button type="button" onClick={addImage} size="icon">
              <ImagePlus className="w-4 h-4" />
            </Button>
          </div>
          {formData.images.length > 0 && (
            <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
              {formData.images.map((image, index) => (
                <div key={index} className="relative group">
                  <img
                    src={image}
                    alt={`Listing image ${index + 1}`}
                    className="w-full h-32 object-cover rounded-lg"
                  />
                  <button
                    type="button"
                    onClick={() => removeImage(image)}
                    className="absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity"
                  >
                    <X className="w-4 h-4" />
                  </button>
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>
      <div className="flex justify-end gap-4">
        <Button
          type="button"
          variant="outline"
          onClick={() => navigate('/marketplace')}
          disabled={isSubmitting}
        >
          Cancel
        </Button>
        <Button type="submit" disabled={isSubmitting}>
          {isSubmitting ? 'Publishing...' : 'Publish Listing'}
        </Button>
      </div>
    </form>
  );
}
</file>

<file path="src/features/classifieds/components/ListingGrid.tsx">
import type { ClassifiedListing } from '../types';
import { ListingCard } from './ListingCard';
interface ListingGridProps {
  listings: ClassifiedListing[];
}
export function ListingGrid({ listings }: ListingGridProps) {
  if (listings.length === 0) {
    return (
      <div className="text-center py-12 px-4">
        <p className="text-gray-500 dark:text-gray-400">
          No listings found. Be the first to post something!
        </p>
      </div>
    );
  }
  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
      {listings.map((listing) => (
        <ListingCard key={listing.id} listing={listing} />
      ))}
    </div>
  );
}
</file>

<file path="src/features/classifieds/components/PriceTag.tsx">
import type { ListingPrice } from '../types';
interface PriceTagProps {
  price: ListingPrice;
  className?: string;
}
export function PriceTag({ price, className = '' }: PriceTagProps) {
  const formatFrequency = (frequency?: string) => {
    if (!frequency || frequency === 'once') return '';
    return `/${frequency}`;
  };
  return (
    <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400 ${className}`}>
      {price.amount} {price.currency}{formatFrequency(price.frequency)}
    </span>
  );
}
</file>

<file path="src/features/classifieds/hooks/useCreateListing.ts">
import { useNDK, useNDKCurrentUser } from '@nostr-dev-kit/ndk-hooks';
import { NDKEvent } from '@nostr-dev-kit/ndk';
import { CLASSIFIED_LISTING_KIND, createListingTags } from '../types';
import type { ListingFormData } from '../types';
export function useCreateListing() {
  const { ndk } = useNDK();
  const currentUser = useNDKCurrentUser();
  const createListing = async (data: ListingFormData) => {
    if (!ndk || !currentUser) {
      throw new Error('You must be logged in to create a listing');
    }
    const event = new NDKEvent(ndk);
    event.kind = CLASSIFIED_LISTING_KIND;
    event.content = data.content;
    event.tags = createListingTags(data);
    await event.sign();
    await event.publish();
    return event;
  };
  const updateListing = async (eventId: string, data: ListingFormData) => {
    if (!ndk || !currentUser) {
      throw new Error('You must be logged in to update a listing');
    }
    // For replaceable events (30000-39999), we create a new event with the same 'd' tag
    const event = new NDKEvent(ndk);
    event.kind = CLASSIFIED_LISTING_KIND;
    event.content = data.content;
    event.tags = createListingTags(data);
    // Add the 'd' tag to identify this as a replacement
    event.tags.push(['d', eventId]);
    await event.sign();
    await event.publish();
    return event;
  };
  const deleteListing = async (eventId: string) => {
    if (!ndk || !currentUser) {
      throw new Error('You must be logged in to delete a listing');
    }
    // To delete, we update with a "sold" or "deleted" status
    const event = new NDKEvent(ndk);
    event.kind = CLASSIFIED_LISTING_KIND;
    event.content = '';
    event.tags = [
      ['d', eventId],
      ['status', 'deleted']
    ];
    await event.sign();
    await event.publish();
    return event;
  };
  return {
    createListing,
    updateListing,
    deleteListing,
    isAuthenticated: !!currentUser
  };
}
</file>

<file path="src/features/classifieds/types.ts">
import { NDKEvent } from '@nostr-dev-kit/ndk';
// NIP-99 Event Kinds
export const CLASSIFIED_LISTING_KIND = 30402;
export const CLASSIFIED_DRAFT_KIND = 30403;
export type ListingStatus = 'active' | 'sold' | 'expired' | 'draft';
export type PriceFrequency = 'once' | 'hour' | 'day' | 'week' | 'month' | 'year';
export interface ListingPrice {
  amount: string;
  currency: string;
  frequency?: PriceFrequency;
}
export interface ClassifiedListing {
  id: string;
  title: string;
  summary?: string;
  content: string; // Markdown content
  author: string; // pubkey
  publishedAt?: number;
  location?: string;
  price?: ListingPrice;
  status?: ListingStatus;
  categories?: string[];
  images?: string[];
  event?: NDKEvent;
}
export interface ListingFormData {
  title: string;
  summary: string;
  content: string;
  location: string;
  price: {
    amount: string;
    currency: string;
    frequency?: PriceFrequency;
  };
  categories: string[];
  images: string[];
}
export function parseListingFromEvent(event: NDKEvent): ClassifiedListing {
  const title = event.tagValue('title') || 'Untitled Listing';
  const summary = event.tagValue('summary');
  const location = event.tagValue('location');
  const status = event.tagValue('status') as ListingStatus || 'active';
  const publishedAt = event.tagValue('published_at');
  // Parse price tag [price, amount, currency, frequency?]
  const priceTag = event.tags.find(tag => tag[0] === 'price');
  let price: ListingPrice | undefined;
  if (priceTag && priceTag.length >= 3) {
    price = {
      amount: priceTag[1],
      currency: priceTag[2],
      frequency: priceTag[3] as PriceFrequency | undefined
    };
  }
  // Parse categories from 't' tags
  const categories = event.tags
    .filter(tag => tag[0] === 't')
    .map(tag => tag[1]);
  // Parse images - handle multiple tag formats used in the wild
  let images: string[] = [];
  // 1. Standard 'image' tags (most common)
  const imageTags = event.tags
    .filter(tag => tag[0] === 'image')
    .map(tag => tag[1]);
  if (imageTags.length > 0) {
    images = imageTags;
  } else {
    // 2. Check for 'r' tags (resource URLs) that look like images
    const rTags = event.tags
      .filter(tag => tag[0] === 'r' && tag[1] &&
        (tag[1].match(/\.(jpg|jpeg|png|gif|webp|svg)/i) ||
         tag[1].includes('image') ||
         tag[1].includes('img')))
      .map(tag => tag[1]);
    if (rTags.length > 0) {
      images = rTags;
    } else {
      // 3. Check for custom image tags (featuredImageUrl, screenshotsUrls, etc.)
      const featuredImage = event.tagValue('featuredImageUrl');
      if (featuredImage) {
        images.push(featuredImage);
      }
      const screenshotsTag = event.tags.find(tag => tag[0] === 'screenshotsUrls');
      if (screenshotsTag) {
        images.push(...screenshotsTag.slice(1));
      }
      // 4. Other fallbacks
      const imgUrl = event.tagValue('imgUrl');
      if (imgUrl) images.push(imgUrl);
    }
  }
  return {
    id: event.id,
    title,
    summary,
    content: event.content,
    author: event.pubkey,
    publishedAt: publishedAt ? parseInt(publishedAt) : event.created_at,
    location,
    price,
    status,
    categories,
    images,
    event
  };
}
export function createListingTags(data: ListingFormData): string[][] {
  const tags: string[][] = [];
  tags.push(['title', data.title]);
  if (data.summary) {
    tags.push(['summary', data.summary]);
  }
  if (data.location) {
    tags.push(['location', data.location]);
  }
  if (data.price && data.price.amount && data.price.currency) {
    const priceTag = ['price', data.price.amount, data.price.currency];
    if (data.price.frequency && data.price.frequency !== 'once') {
      priceTag.push(data.price.frequency);
    }
    tags.push(priceTag);
  }
  tags.push(['published_at', Math.floor(Date.now() / 1000).toString()]);
  tags.push(['status', 'active']);
  data.categories.forEach(category => {
    tags.push(['t', category.toLowerCase()]);
  });
  data.images.forEach(image => {
    tags.push(['image', image]);
  });
  return tags;
}
</file>

<file path="src/features/followPacks/components/ProfileAvatar.tsx">
import { useProfile } from '@nostr-dev-kit/ndk-hooks';
import { cn } from '@/lib/utils';
interface ProfileAvatarProps {
  pubkey: string;
  size?: 'sm' | 'md' | 'lg';
  showName?: boolean;
  className?: string;
  style?: React.CSSProperties;
}
export function ProfileAvatar({
  pubkey,
  size = 'sm',
  showName = false,
  className,
  style
}: ProfileAvatarProps) {
  const profile = useProfile(pubkey);
  const sizeClasses = {
    sm: 'w-8 h-8 text-xs',
    md: 'w-10 h-10 text-sm',
    lg: 'w-12 h-12 text-base'
  };
  return (
    <div className={cn("flex items-center gap-3", className)} style={style}>
      <div className={cn(
        "rounded-full border-2 border-white dark:border-gray-950 overflow-hidden",
        sizeClasses[size]
      )}>
        {profile?.picture ? (
          <img
            src={profile.picture}
            alt={profile?.name || 'User'}
            className="w-full h-full object-cover"
          />
        ) : (
          <div className={cn(
            "w-full h-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold",
            sizeClasses[size]
          )}>
            {(profile?.name || 'A')[0].toUpperCase()}
          </div>
        )}
      </div>
      {showName && (
        <div className="flex-1 min-w-0">
          <p className="font-medium text-gray-900 dark:text-gray-100 truncate">
            {profile?.name || 'Anonymous'}
          </p>
          {profile?.nip05 && (
            <p className="text-xs text-gray-500 dark:text-gray-400 truncate">
              @{profile.nip05}
            </p>
          )}
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/features/followPacks/mockData.ts">
// Mock follow pack data for testing
// Generate more packs for testing lazy loading
const generateExtraPacks = (start: number, count: number) => {
  return Array.from({ length: count }, (_, i) => ({
    id: `pack${start + i}`,
    title: `Community Pack ${start + i}`,
    description: `A curated list of interesting accounts in the ${['Tech', 'Art', 'Music', 'Sports', 'Gaming', 'Finance', 'Science', 'Food'][i % 8]} space`,
    image: i % 3 === 0 ? `https://picsum.photos/500/300?random=${start + i}` : undefined,
    pubkeys: Array.from({length: 5 + (i % 10)}, (_, j) => `npub${start + i}xxx${j+1}`),
    encode: () => `nevent1pack${start + i}`
  }));
};
export const mockFollowPacks = [
  {
    id: 'pack1',
    title: 'BBO',
    description: 'Gent de la comunitat de Barcelona Bitcoin Only que viu a prop de Barcelona, que participa a la...',
    image: 'https://images.unsplash.com/photo-1523821741446-edb2b68bb7a0?w=500&h=300&fit=crop',
    pubkeys: [
      'npub1xxx1', 'npub1xxx2', 'npub1xxx3', 'npub1xxx4', 'npub1xxx5',
      'npub1xxx6', 'npub1xxx7', 'npub1xxx8', 'npub1xxx9', 'npub1xxx10',
      'npub1xxx11', 'npub1xxx12', 'npub1xxx13', 'npub1xxx14', 'npub1xxx15',
      'npub1xxx16', 'npub1xxx17', 'npub1xxx18', 'npub1xxx19', 'npub1xxx20',
      'npub1xxx21', 'npub1xxx22', 'npub1xxx23', 'npub1xxx24', 'npub1xxx25',
      'npub1xxx26', 'npub1xxx27', 'npub1xxx28', 'npub1xxx29', 'npub1xxx30',
      'npub1xxx31', 'npub1xxx32', 'npub1xxx33', 'npub1xxx34', 'npub1xxx35',
      'npub1xxx36', 'npub1xxx37', 'npub1xxx38', 'npub1xxx39', 'npub1xxx40',
      'npub1xxx41', 'npub1xxx42', 'npub1xxx43', 'npub1xxx44', 'npub1xxx45',
      'npub1xxx46', 'npub1xxx47', 'npub1xxx48', 'npub1xxx49', 'npub1xxx50',
      'npub1xxx51', 'npub1xxx52', 'npub1xxx53', 'npub1xxx54', 'npub1xxx55',
      'npub1xxx56', 'npub1xxx57', 'npub1xxx58', 'npub1xxx59', 'npub1xxx60',
      'npub1xxx61'
    ],
    encode: () => 'nevent1pack1'
  },
  {
    id: 'pack2',
    title: 'Orange Pill Per√∫',
    description: 'Community of Bitcoin enthusiasts from Peru',
    image: 'https://images.unsplash.com/photo-1526304640581-d334cdbbf45e?w=500&h=300&fit=crop',
    pubkeys: ['npub2xxx1', 'npub2xxx2', 'npub2xxx3', 'npub2xxx4', 'npub2xxx5', 'npub2xxx6', 'npub2xxx7', 'npub2xxx8', 'npub2xxx9'],
    encode: () => 'nevent1pack2'
  },
  {
    id: 'pack3',
    title: 'Spicy Girls üî•',
    description: 'Spicy Girls üî• (not naked) ~ NSFW',
    image: 'https://images.unsplash.com/photo-1516450360452-9312f5e86fc7?w=500&h=300&fit=crop',
    pubkeys: ['npub3xxx1', 'npub3xxx2', 'npub3xxx3', 'npub3xxx4', 'npub3xxx5', 'npub3xxx6', 'npub3xxx7', 'npub3xxx8', 'npub3xxx9', 'npub3xxx10', 'npub3xxx11'],
    encode: () => 'nevent1pack3'
  },
  {
    id: 'pack4',
    title: 'Cloudbusting Chemtrail Psychopaths',
    description: 'Just look up.',
    pubkeys: Array.from({length: 21}, (_, i) => `npub4xxx${i+1}`),
    encode: () => 'nevent1pack4'
  },
  {
    id: 'pack5',
    title: 'High Council of Bitcoin Bens',
    description: 'The elite Bitcoin council',
    image: 'https://images.unsplash.com/photo-1518546305927-5a555bb7020d?w=500&h=300&fit=crop',
    pubkeys: Array.from({length: 18}, (_, i) => `npub5xxx${i+1}`),
    encode: () => 'nevent1pack5'
  },
  {
    id: 'pack6',
    title: 'Carnivores ü•©',
    description: 'Just eat meat.',
    image: 'https://images.unsplash.com/photo-1558030006-450675393462?w=500&h=300&fit=crop',
    pubkeys: Array.from({length: 15}, (_, i) => `npub6xxx${i+1}`),
    encode: () => 'nevent1pack6'
  },
  {
    id: 'pack7',
    title: 'Globe Disrespectors',
    description: "WHERE'S THE CURVE, LEBOWSKI?",
    pubkeys: Array.from({length: 9}, (_, i) => `npub7xxx${i+1}`),
    encode: () => 'nevent1pack7'
  },
  {
    id: 'pack8',
    title: 'jimmy Dale Flannagan',
    description: 'Personal follow list',
    image: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=500&h=300&fit=crop',
    pubkeys: ['npub8xxx1'],
    encode: () => 'nevent1pack8'
  },
  {
    id: 'pack9',
    title: 'Mexiko en NOSTR',
    description: 'Mexicanos usando NOSTR',
    image: 'https://images.unsplash.com/photo-1518105779142-d975f22f1b0a?w=500&h=300&fit=crop',
    pubkeys: Array.from({length: 6}, (_, i) => `npub9xxx${i+1}`),
    encode: () => 'nevent1pack9'
  },
  // Add more packs for testing lazy loading
  ...generateExtraPacks(10, 30)
];
</file>

<file path="src/features/settings/NotificationSettings.tsx">
export function NotificationSettings() {
  return (
    <div className="text-center py-12 text-gray-500">
      Notification settings coming soon...
    </div>
  );
}
</file>

<file path="src/features/settings/PrivacySettings.tsx">
export function PrivacySettings() {
  return (
    <div className="text-center py-12 text-gray-500">
      Privacy settings coming soon...
    </div>
  );
}
</file>

<file path="src/features/settings/ProfileSettings.tsx">
export function ProfileSettings() {
  return (
    <div className="text-center py-12 text-gray-500">
      Profile settings coming soon...
    </div>
  );
}
</file>

<file path="src/features/trades/hooks/useAvailableCurrencies.ts">
import { useEffect, useState } from 'react';
import { useNDK } from '@nostr-dev-kit/ndk-hooks';
import { NDKEvent, type NDKFilter } from '@nostr-dev-kit/ndk';
interface CurrencyInfo {
  code: string;
  name: string;
  flag: string;
}
const currencyMetadata: Record<string, { name: string; flag: string }> = {
  USD: { name: 'US Dollar', flag: 'üá∫üá∏' },
  EUR: { name: 'Euro', flag: 'üá™üá∫' },
  BRL: { name: 'Brazilian Real', flag: 'üáßüá∑' },
  ARS: { name: 'Argentine Peso', flag: 'üá¶üá∑' },
  GBP: { name: 'British Pound', flag: 'üá¨üáß' },
  PLN: { name: 'Polish Z≈Çoty', flag: 'üáµüá±' },
  JPY: { name: 'Japanese Yen', flag: 'üáØüáµ' },
  CAD: { name: 'Canadian Dollar', flag: 'üá®üá¶' },
  AUD: { name: 'Australian Dollar', flag: 'üá¶üá∫' },
  CHF: { name: 'Swiss Franc', flag: 'üá®üá≠' },
  CNY: { name: 'Chinese Yuan', flag: 'üá®üá≥' },
  INR: { name: 'Indian Rupee', flag: 'üáÆüá≥' },
  MXN: { name: 'Mexican Peso', flag: 'üá≤üáΩ' },
  ZAR: { name: 'South African Rand', flag: 'üáøüá¶' },
  SEK: { name: 'Swedish Krona', flag: 'üá∏üá™' },
  NOK: { name: 'Norwegian Krone', flag: 'üá≥üá¥' },
  DKK: { name: 'Danish Krone', flag: 'üá©üá∞' },
  NZD: { name: 'New Zealand Dollar', flag: 'üá≥üáø' },
  SGD: { name: 'Singapore Dollar', flag: 'üá∏üá¨' },
  HKD: { name: 'Hong Kong Dollar', flag: 'üá≠üá∞' },
  KRW: { name: 'South Korean Won', flag: 'üá∞üá∑' },
  TRY: { name: 'Turkish Lira', flag: 'üáπüá∑' },
  RUB: { name: 'Russian Ruble', flag: 'üá∑üá∫' },
  THB: { name: 'Thai Baht', flag: 'üáπüá≠' },
  MYR: { name: 'Malaysian Ringgit', flag: 'üá≤üáæ' },
  PHP: { name: 'Philippine Peso', flag: 'üáµüá≠' },
  IDR: { name: 'Indonesian Rupiah', flag: 'üáÆüá©' },
  VND: { name: 'Vietnamese Dong', flag: 'üáªüá≥' },
  COP: { name: 'Colombian Peso', flag: 'üá®üá¥' },
  CLP: { name: 'Chilean Peso', flag: 'üá®üá±' },
  PEN: { name: 'Peruvian Sol', flag: 'üáµüá™' },
  UAH: { name: 'Ukrainian Hryvnia', flag: 'üá∫üá¶' },
  AED: { name: 'UAE Dirham', flag: 'üá¶üá™' },
  SAR: { name: 'Saudi Riyal', flag: 'üá∏üá¶' },
  QAR: { name: 'Qatari Riyal', flag: 'üá∂üá¶' },
  KWD: { name: 'Kuwaiti Dinar', flag: 'üá∞üáº' },
  NGN: { name: 'Nigerian Naira', flag: 'üá≥üá¨' },
  KES: { name: 'Kenyan Shilling', flag: 'üá∞üá™' },
  GHS: { name: 'Ghanaian Cedi', flag: 'üá¨üá≠' },
  UGX: { name: 'Ugandan Shilling', flag: 'üá∫üá¨' },
  VES: { name: 'Venezuelan Bol√≠var', flag: 'üáªüá™' },
  UYU: { name: 'Uruguayan Peso', flag: 'üá∫üáæ' },
  BOB: { name: 'Bolivian Boliviano', flag: 'üáßüá¥' },
  CRC: { name: 'Costa Rican Col√≥n', flag: 'üá®üá∑' },
  GTQ: { name: 'Guatemalan Quetzal', flag: 'üá¨üáπ' },
  HNL: { name: 'Honduran Lempira', flag: 'üá≠üá≥' },
  NIO: { name: 'Nicaraguan C√≥rdoba', flag: 'üá≥üáÆ' },
  PAB: { name: 'Panamanian Balboa', flag: 'üáµüá¶' },
  PYG: { name: 'Paraguayan Guarani', flag: 'üáµüáæ' },
  DOP: { name: 'Dominican Peso', flag: 'üá©üá¥' },
  JMD: { name: 'Jamaican Dollar', flag: 'üáØüá≤' },
  TTD: { name: 'Trinidad Dollar', flag: 'üáπüáπ' },
  BSD: { name: 'Bahamian Dollar', flag: 'üáßüá∏' },
  BBD: { name: 'Barbadian Dollar', flag: 'üáßüáß' },
  BZD: { name: 'Belize Dollar', flag: 'üáßüáø' },
  XOF: { name: 'West African CFA', flag: 'üåç' },
  XAF: { name: 'Central African CFA', flag: 'üåç' },
  MAD: { name: 'Moroccan Dirham', flag: 'üá≤üá¶' },
  TND: { name: 'Tunisian Dinar', flag: 'üáπüá≥' },
  EGP: { name: 'Egyptian Pound', flag: 'üá™üá¨' },
  ILS: { name: 'Israeli Shekel', flag: 'üáÆüá±' },
  JOD: { name: 'Jordanian Dinar', flag: 'üáØüá¥' },
  LBP: { name: 'Lebanese Pound', flag: 'üá±üáß' },
  PKR: { name: 'Pakistani Rupee', flag: 'üáµüá∞' },
  BDT: { name: 'Bangladeshi Taka', flag: 'üáßüá©' },
  LKR: { name: 'Sri Lankan Rupee', flag: 'üá±üá∞' },
  NPR: { name: 'Nepalese Rupee', flag: 'üá≥üáµ' },
  MMK: { name: 'Myanmar Kyat', flag: 'üá≤üá≤' },
  KHR: { name: 'Cambodian Riel', flag: 'üá∞üá≠' },
  LAK: { name: 'Lao Kip', flag: 'üá±üá¶' },
  BND: { name: 'Brunei Dollar', flag: 'üáßüá≥' },
  TWD: { name: 'Taiwan Dollar', flag: 'üáπüáº' },
  HRK: { name: 'Croatian Kuna', flag: 'üá≠üá∑' },
  BGN: { name: 'Bulgarian Lev', flag: 'üáßüá¨' },
  RON: { name: 'Romanian Leu', flag: 'üá∑üá¥' },
  CZK: { name: 'Czech Koruna', flag: 'üá®üáø' },
  HUF: { name: 'Hungarian Forint', flag: 'üá≠üá∫' },
  ISK: { name: 'Icelandic Kr√≥na', flag: 'üáÆüá∏' },
  BAM: { name: 'Bosnian Mark', flag: 'üáßüá¶' },
  MKD: { name: 'Macedonian Denar', flag: 'üá≤üá∞' },
  ALL: { name: 'Albanian Lek', flag: 'üá¶üá±' },
  RSD: { name: 'Serbian Dinar', flag: 'üá∑üá∏' },
  GEL: { name: 'Georgian Lari', flag: 'üá¨üá™' },
  AZN: { name: 'Azerbaijani Manat', flag: 'üá¶üáø' },
  AMD: { name: 'Armenian Dram', flag: 'üá¶üá≤' },
  BYN: { name: 'Belarusian Ruble', flag: 'üáßüáæ' },
  MDL: { name: 'Moldovan Leu', flag: 'üá≤üá©' },
  KZT: { name: 'Kazakhstani Tenge', flag: 'üá∞üáø' },
  UZS: { name: 'Uzbekistani Som', flag: 'üá∫üáø' },
  TJS: { name: 'Tajikistani Somoni', flag: 'üáπüáØ' },
  KGS: { name: 'Kyrgyzstani Som', flag: 'üá∞üá¨' },
  TMT: { name: 'Turkmenistani Manat', flag: 'üáπüá≤' }
};
export function useAvailableCurrencies() {
  const { ndk } = useNDK();
  const [currencies, setCurrencies] = useState<CurrencyInfo[]>([
    { code: 'all', name: 'All', flag: 'üåç' }
  ]);
  const [loading, setLoading] = useState(true);
  useEffect(() => {
    if (!ndk) return;
    const fetchCurrencies = async () => {
      setLoading(true);
      const filter: NDKFilter = {
        kinds: [38383 as any],
        limit: 1000
      };
      const events = await ndk.fetchEvents(filter);
      const uniqueCurrencies = new Set<string>();
      events.forEach((event: NDKEvent) => {
        const tags = event.tags;
        const zTag = tags.find((t: string[]) => t[0] === 'z');
        if (zTag && zTag[1] === 'info') return;
        const currency = tags.find((t: string[]) => t[0] === 'f')?.[1];
        const status = tags.find((t: string[]) => t[0] === 's')?.[1];
        if (currency && status === 'pending') {
          uniqueCurrencies.add(currency.toUpperCase());
        }
      });
      const currencyList: CurrencyInfo[] = [
        { code: 'all', name: 'All', flag: 'üåç' }
      ];
      Array.from(uniqueCurrencies)
        .sort()
        .forEach(code => {
          const metadata = currencyMetadata[code];
          currencyList.push({
            code,
            name: metadata?.name || code,
            flag: metadata?.flag || 'üí±'
          });
        });
      setCurrencies(currencyList);
      setLoading(false);
    };
    fetchCurrencies();
    const sub = ndk.subscribe(
      { kinds: [38383 as any], since: Math.floor(Date.now() / 1000) },
      { closeOnEose: false }
    );
    sub.on('event', (event: NDKEvent) => {
      const tags = event.tags;
      const zTag = tags.find((t: string[]) => t[0] === 'z');
      if (zTag && zTag[1] === 'info') return;
      const currency = tags.find((t: string[]) => t[0] === 'f')?.[1];
      const status = tags.find((t: string[]) => t[0] === 's')?.[1];
      if (currency && status === 'pending') {
        const upperCurrency = currency.toUpperCase();
        setCurrencies(prev => {
          if (prev.some(c => c.code === upperCurrency)) return prev;
          const metadata = currencyMetadata[upperCurrency];
          const newCurrency: CurrencyInfo = {
            code: upperCurrency,
            name: metadata?.name || upperCurrency,
            flag: metadata?.flag || 'üí±'
          };
          const updated = [...prev.filter(c => c.code !== 'all'), newCurrency].sort((a, b) =>
            a.code.localeCompare(b.code)
          );
          return [{ code: 'all', name: 'All', flag: 'üåç' }, ...updated];
        });
      }
    });
    return () => {
      sub.stop();
    };
  }, [ndk]);
  return { currencies, loading };
}
</file>

<file path="src/features/trades/OrderBook.tsx">
import { useEffect, useState } from 'react';
import { useNDK } from '@nostr-dev-kit/ndk-hooks';
import { NDKEvent, type NDKFilter } from '@nostr-dev-kit/ndk';
import { OrderCard } from './OrderCard';
interface Order {
  id: string;
  pubkey: string;
  type: 'buy' | 'sell';
  currency: string;
  status: string;
  paymentMethod: string;
  satsAmount: number;
  fiatAmount: number;
  premium?: number;
  rating?: number;
  platform?: string;
  createdAt: number;
  event: NDKEvent;
}
interface OrderBookProps {
  filters: {
    currency: string;
    paymentMethod: string;
    orderType: 'all' | 'buy' | 'sell';
    minAmount: number;
    maxAmount: number;
  };
}
export function OrderBook({ filters }: OrderBookProps) {
  const { ndk } = useNDK();
  const [orders, setOrders] = useState<Order[]>([]);
  const [loading, setLoading] = useState(true);
  useEffect(() => {
    if (!ndk) return;
    const fetchOrders = async () => {
      setLoading(true);
      const filter: NDKFilter = {
        kinds: [38383 as any],
        limit: 100,
      };
      const events = await ndk.fetchEvents(filter);
      const parsedOrders: Order[] = [];
      events.forEach((event: NDKEvent) => {
        const tags = event.tags;
        // Skip info events
        const zTag = tags.find((t: string[]) => t[0] === 'z');
        if (zTag && zTag[1] === 'info') return;
        // Extract order data from tags
        const orderType = tags.find((t: string[]) => t[0] === 'k')?.[1] as 'buy' | 'sell';
        const currency = tags.find((t: string[]) => t[0] === 'f')?.[1];
        const status = tags.find((t: string[]) => t[0] === 's')?.[1];
        const paymentMethod = tags.find((t: string[]) => t[0] === 'pm')?.[1];
        const satsAmount = parseInt(tags.find((t: string[]) => t[0] === 'amt')?.[1] || '0');
        const fiatAmount = parseFloat(tags.find((t: string[]) => t[0] === 'fa')?.[1] || '0');
        const premium = parseFloat(tags.find((t: string[]) => t[0] === 'premium')?.[1] || '0');
        const rating = parseFloat(tags.find((t: string[]) => t[0] === 'rating')?.[1] || '0');
        const platform = tags.find((t: string[]) => t[0] === 'y')?.[1];
        const dTag = tags.find((t: string[]) => t[0] === 'd')?.[1];
        // Only include active orders
        if (status === 'pending' && orderType && currency && dTag) {
          parsedOrders.push({
            id: dTag,
            pubkey: event.pubkey,
            type: orderType,
            currency,
            status,
            paymentMethod: paymentMethod || 'Unknown',
            satsAmount,
            fiatAmount,
            premium,
            rating,
            platform,
            createdAt: event.created_at || Date.now() / 1000,
            event
          });
        }
      });
      // Sort by created date, newest first
      parsedOrders.sort((a, b) => b.createdAt - a.createdAt);
      setOrders(parsedOrders);
      setLoading(false);
    };
    fetchOrders();
    // Subscribe to new orders
    const sub = ndk.subscribe(
      { kinds: [38383 as any], since: Math.floor(Date.now() / 1000) },
      { closeOnEose: false }
    );
    sub.on('event', (event: NDKEvent) => {
      const tags = event.tags;
      const zTag = tags.find((t: string[]) => t[0] === 'z');
      if (zTag && zTag[1] === 'info') return;
      const orderType = tags.find((t: string[]) => t[0] === 'k')?.[1] as 'buy' | 'sell';
      const currency = tags.find((t: string[]) => t[0] === 'f')?.[1];
      const status = tags.find((t: string[]) => t[0] === 's')?.[1];
      const dTag = tags.find((t: string[]) => t[0] === 'd')?.[1];
      if (status === 'pending' && orderType && currency && dTag) {
        const newOrder: Order = {
          id: dTag,
          pubkey: event.pubkey,
          type: orderType,
          currency,
          status,
          paymentMethod: tags.find((t: string[]) => t[0] === 'pm')?.[1] || 'Unknown',
          satsAmount: parseInt(tags.find((t: string[]) => t[0] === 'amt')?.[1] || '0'),
          fiatAmount: parseFloat(tags.find((t: string[]) => t[0] === 'fa')?.[1] || '0'),
          premium: parseFloat(tags.find((t: string[]) => t[0] === 'premium')?.[1] || '0'),
          rating: parseFloat(tags.find((t: string[]) => t[0] === 'rating')?.[1] || '0'),
          platform: tags.find((t: string[]) => t[0] === 'y')?.[1],
          createdAt: event.created_at || Date.now() / 1000,
          event
        };
        setOrders(prev => [newOrder, ...prev.filter(o => o.id !== dTag)]);
      }
    });
    return () => {
      sub.stop();
    };
  }, [ndk]);
  // Filter orders based on user preferences
  const filteredOrders = orders.filter(order => {
    if (filters.currency !== 'all' && order.currency !== filters.currency) return false;
    if (filters.paymentMethod !== 'all' && order.paymentMethod !== filters.paymentMethod) return false;
    if (filters.orderType !== 'all' && order.type !== filters.orderType) return false;
    if (order.satsAmount < filters.minAmount || order.satsAmount > filters.maxAmount) return false;
    return true;
  });
  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-[400px]">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"></div>
      </div>
    );
  }
  return (
    <div className="w-full">
      <div className="grid gap-3 md:gap-4">
        {filteredOrders.length === 0 ? (
          <div className="text-center py-12 text-gray-500">
            No orders available matching your filters
          </div>
        ) : (
          filteredOrders.map(order => (
            <OrderCard key={order.id} order={order} />
          ))
        )}
      </div>
    </div>
  );
}
</file>

<file path="src/i18n/config.ts">
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import LanguageDetector from 'i18next-browser-languagedetector';
import en from './locales/en.json';
import es from './locales/es.json';
const resources = {
  en: {
    translation: en
  },
  es: {
    translation: es
  }
};
i18n
  .use(LanguageDetector)
  .use(initReactI18next)
  .init({
    resources,
    fallbackLng: 'en',
    debug: false,
    interpolation: {
      escapeValue: false
    },
    detection: {
      order: ['localStorage', 'navigator'],
      caches: ['localStorage'],
      lookupLocalStorage: 'voces-language'
    }
  });
export default i18n;
</file>

<file path="src/lib/utils.ts">
import { type ClassValue, clsx } from "clsx"
import { twMerge } from "tailwind-merge"
export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
</file>

<file path="src/pages/marketplace/CreateListingPage.tsx">
import { useNavigate } from 'react-router-dom';
import { ArrowLeft } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { ListingForm } from '@/features/classifieds/components/ListingForm';
import { useCreateListing } from '@/features/classifieds/hooks/useCreateListing';
import type { ListingFormData } from '@/features/classifieds/types';
import { useState } from 'react';
export function CreateListingPage() {
  const navigate = useNavigate();
  const { createListing, isAuthenticated } = useCreateListing();
  const [isSubmitting, setIsSubmitting] = useState(false);
  const handleSubmit = async (data: ListingFormData) => {
    if (!isAuthenticated) {
      alert('Please log in to create a listing');
      return;
    }
    try {
      setIsSubmitting(true);
      await createListing(data);
      navigate('/marketplace');
    } catch (error) {
      console.error('Failed to create listing:', error);
      alert('Failed to create listing. Please try again.');
    } finally {
      setIsSubmitting(false);
    }
  };
  if (!isAuthenticated) {
    return (
      <div className="container mx-auto px-4 py-12">
        <div className="max-w-2xl mx-auto text-center">
          <h2 className="text-2xl font-bold mb-4">Sign In Required</h2>
          <p className="text-gray-600 dark:text-gray-400 mb-6">
            You need to be logged in to create a listing.
          </p>
          <Button onClick={() => navigate('/')}>
            Go to Home
          </Button>
        </div>
      </div>
    );
  }
  return (
    <div className="container mx-auto px-4 py-6">
      <div className="max-w-4xl mx-auto">
        <div className="mb-6">
          <Button
            variant="ghost"
            onClick={() => navigate('/marketplace')}
            className="mb-4"
          >
            <ArrowLeft className="w-4 h-4 mr-2" />
            Back to Marketplace
          </Button>
          <h1 className="text-3xl font-bold text-gray-900 dark:text-white">
            Create New Listing
          </h1>
          <p className="text-gray-600 dark:text-gray-400 mt-2">
            Fill in the details below to create your classified listing
          </p>
        </div>
        <ListingForm onSubmit={handleSubmit} isSubmitting={isSubmitting} />
      </div>
    </div>
  );
}
</file>

<file path="src/pages/FollowPacksPageImproved.tsx">
import { useState, useEffect, useRef, useCallback } from 'react';
import { Package, Search } from 'lucide-react';
import { Input } from '@/components/ui/input';
import { useFollowPacks, useSubscribedFollowPacks } from '@/features/followPacks/hooks/useFollowPacks';
import { mockFollowPacks } from '@/features/followPacks/mockData';
import { PackCard } from '@/features/followPacks/components/PackCard';
const INITIAL_LOAD = 9; // 3x3 grid
const BATCH_SIZE = 6;  // 2 rows at a time
export function FollowPacksPage() {
  const [searchQuery, setSearchQuery] = useState('');
  const [visibleCount, setVisibleCount] = useState(INITIAL_LOAD);
  const [isLoadingMore, setIsLoadingMore] = useState(false);
  const observerRef = useRef<IntersectionObserver | null>(null);
  const loadMoreRef = useRef<HTMLDivElement | null>(null);
  const { packs } = useFollowPacks();
  const subscribedPacks = useSubscribedFollowPacks();
  // Use mock data if no packs from relays
  const displayPacks = packs.length > 0 ? packs : mockFollowPacks as any[];
  // Filter packs based on search
  const filteredPacks = displayPacks.filter(pack => {
    if (!searchQuery) return true;
    const search = searchQuery.toLowerCase();
    return pack.title.toLowerCase().includes(search) ||
           (pack.description && pack.description.toLowerCase().includes(search));
  });
  // Apply lazy loading to filtered packs
  const visiblePacks = filteredPacks.slice(0, visibleCount);
  const hasMore = visibleCount < filteredPacks.length;
  const loadMore = useCallback(() => {
    if (isLoadingMore || !hasMore) return;
    setIsLoadingMore(true);
    // Simulate async loading for smooth UX
    setTimeout(() => {
      setVisibleCount(prev => Math.min(prev + BATCH_SIZE, filteredPacks.length));
      setIsLoadingMore(false);
    }, 100);
  }, [isLoadingMore, hasMore, filteredPacks.length]);
  // Set up intersection observer
  useEffect(() => {
    if (observerRef.current) {
      observerRef.current.disconnect();
    }
    observerRef.current = new IntersectionObserver(
      (entries) => {
        const target = entries[0];
        if (target.isIntersecting && hasMore && !isLoadingMore) {
          loadMore();
        }
      },
      {
        root: null,
        rootMargin: '200px', // Start loading earlier for smoother experience
        threshold: 0.1
      }
    );
    if (loadMoreRef.current) {
      observerRef.current.observe(loadMoreRef.current);
    }
    return () => {
      if (observerRef.current) {
        observerRef.current.disconnect();
      }
    };
  }, [hasMore, isLoadingMore, loadMore]);
  // Reset visible count when search changes
  useEffect(() => {
    setVisibleCount(INITIAL_LOAD);
  }, [searchQuery]);
  // Reset visible count when packs change significantly
  useEffect(() => {
    if (filteredPacks.length < visibleCount) {
      setVisibleCount(Math.min(INITIAL_LOAD, filteredPacks.length));
    }
  }, [filteredPacks.length]);
  return (
    <div className="max-w-6xl mx-auto px-4 py-8">
      {/* Header */}
      <div className="mb-8">
        <h1 className="text-3xl font-bold text-white mb-2 flex items-center gap-3">
          <Package className="w-8 h-8 text-purple-500" />
          Follow Packs
        </h1>
        <p className="text-neutral-400">
          Discover curated lists of accounts to follow
        </p>
      </div>
      {/* Search */}
      <div className="mb-6">
        <div className="relative">
          <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-neutral-500" />
          <Input
            type="search"
            placeholder="Search follow packs..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            className="pl-10 bg-neutral-900 border-neutral-800 text-white placeholder:text-neutral-500"
          />
        </div>
      </div>
      {/* Your Subscribed Packs - no lazy loading for subscribed */}
      {subscribedPacks.length > 0 && (
        <div className="mb-8">
          <h2 className="text-xl font-semibold text-white mb-4">Your Packs</h2>
          <div className="grid gap-5 md:grid-cols-2 lg:grid-cols-3">
            {subscribedPacks.slice(0, 6).map(pack => (
              <PackCard key={pack.id} pack={pack} />
            ))}
          </div>
        </div>
      )}
      {/* All Packs Grid with lazy loading */}
      <div>
        <h2 className="text-xl font-semibold text-white mb-4">
          {subscribedPacks.length > 0 ? 'Discover More' : 'Popular Packs'}
        </h2>
        {filteredPacks.length > 0 ? (
          <>
            <div className="grid gap-5 md:grid-cols-2 lg:grid-cols-3">
              {visiblePacks.map(pack => (
                <PackCard key={pack.id} pack={pack} />
              ))}
            </div>
            {/* Load more trigger */}
            {hasMore && (
              <div
                ref={loadMoreRef}
                className="py-12 text-center"
              >
                {isLoadingMore ? (
                  <div className="flex items-center justify-center gap-3">
                    <div className="w-3 h-3 rounded-full bg-purple-500 animate-pulse" />
                    <div className="w-3 h-3 rounded-full bg-purple-500 animate-pulse" style={{ animationDelay: '0.2s' }} />
                    <div className="w-3 h-3 rounded-full bg-purple-500 animate-pulse" style={{ animationDelay: '0.4s' }} />
                  </div>
                ) : (
                  <button
                    onClick={loadMore}
                    className="text-sm text-neutral-400 hover:text-white transition-colors px-4 py-2 rounded-lg hover:bg-neutral-900"
                  >
                    Load more packs ({filteredPacks.length - visibleCount} remaining)
                  </button>
                )}
              </div>
            )}
          </>
        ) : (
          <div className="text-center py-12">
            <Package className="w-16 h-16 text-neutral-600 mx-auto mb-4" />
            <p className="text-neutral-400">
              No follow packs found
            </p>
          </div>
        )}
      </div>
    </div>
  );
}
</file>

<file path="src/pages/WalletPage.tsx">
import { ProfessionalWallet } from '../components/wallet/ProfessionalWallet';
export function WalletPage() {
  return <ProfessionalWallet />;
}
</file>

<file path="src/stores/followPacksStore.ts">
import { create } from 'zustand';
import { persist } from 'zustand/middleware';
interface FollowPacksStore {
  subscribedPacks: string[]; // Array of pack IDs
  favoritesPacks: string[]; // Array of favorite pack IDs
  userCreatedPacks: string[]; // Array of pack IDs created by the user
  subscribeToPack: (packId: string) => void;
  unsubscribeFromPack: (packId: string) => void;
  toggleFavorite: (packId: string) => void;
  addUserPack: (packId: string) => void;
  removeUserPack: (packId: string) => void;
  isSubscribed: (packId: string) => boolean;
  isFavorite: (packId: string) => boolean;
}
export const useFollowPacksStore = create<FollowPacksStore>()(
  persist(
    (set, get) => ({
      subscribedPacks: [],
      favoritesPacks: [],
      userCreatedPacks: [],
      subscribeToPack: (packId) =>
        set((state) => ({
          subscribedPacks: [...new Set([...state.subscribedPacks, packId])]
        })),
      unsubscribeFromPack: (packId) =>
        set((state) => ({
          subscribedPacks: state.subscribedPacks.filter(id => id !== packId)
        })),
      toggleFavorite: (packId) =>
        set((state) => ({
          favoritesPacks: state.favoritesPacks.includes(packId)
            ? state.favoritesPacks.filter(id => id !== packId)
            : [...state.favoritesPacks, packId]
        })),
      addUserPack: (packId) =>
        set((state) => ({
          userCreatedPacks: [...new Set([...state.userCreatedPacks, packId])]
        })),
      removeUserPack: (packId) =>
        set((state) => ({
          userCreatedPacks: state.userCreatedPacks.filter(id => id !== packId)
        })),
      isSubscribed: (packId) => get().subscribedPacks.includes(packId),
      isFavorite: (packId) => get().favoritesPacks.includes(packId),
    }),
    {
      name: 'follow-packs-storage',
    }
  )
);
</file>

<file path="src/stores/settingsStore.ts">
import { create } from 'zustand';
import { persist } from 'zustand/middleware';
export interface Relay {
  url: string;
  read: boolean;
  write: boolean;
  enabled: boolean;
}
interface AppSettings {
  // Relay settings
  relays: Relay[];
  selectedRelay: string | null; // null means use all enabled relays
  // Theme settings (for future)
  theme: 'light' | 'dark' | 'system';
  // Language settings
  language: 'en' | 'es';
  // Notification settings (for future)
  notifications: {
    enabled: boolean;
    mentions: boolean;
    replies: boolean;
    zaps: boolean;
  };
  // Privacy settings (for future)
  privacy: {
    hideReadReceipts: boolean;
    hideTypingIndicator: boolean;
  };
}
interface SettingsStore extends AppSettings {
  // Relay actions
  addRelay: (relay: Relay) => void;
  removeRelay: (url: string) => void;
  updateRelay: (url: string, updates: Partial<Relay>) => void;
  toggleRelay: (url: string) => void;
  setRelays: (relays: Relay[]) => void;
  setSelectedRelay: (url: string | null) => void;
  // Theme actions
  setTheme: (theme: 'light' | 'dark' | 'system') => void;
  // Language actions
  setLanguage: (language: 'en' | 'es') => void;
  // Notification actions
  updateNotifications: (settings: Partial<AppSettings['notifications']>) => void;
  // Privacy actions
  updatePrivacy: (settings: Partial<AppSettings['privacy']>) => void;
  // General actions
  resetToDefaults: () => void;
}
const defaultRelays: Relay[] = [
  { url: 'wss://relay.damus.io', read: true, write: true, enabled: true },
  { url: 'wss://relay.nostr.band', read: true, write: false, enabled: true },
  { url: 'wss://nos.lol', read: true, write: true, enabled: true },
  { url: 'wss://relay.snort.social', read: true, write: true, enabled: true },
  { url: 'wss://relay.primal.net', read: true, write: true, enabled: true },
];
const defaultSettings: AppSettings = {
  relays: defaultRelays,
  selectedRelay: null,
  theme: 'system',
  language: 'en',
  notifications: {
    enabled: true,
    mentions: true,
    replies: true,
    zaps: true,
  },
  privacy: {
    hideReadReceipts: false,
    hideTypingIndicator: false,
  },
};
export const useSettingsStore = create<SettingsStore>()(
  persist(
    (set) => ({
      ...defaultSettings,
      // Relay actions
      addRelay: (relay) =>
        set((state) => ({
          relays: [...state.relays, relay],
        })),
      removeRelay: (url) =>
        set((state) => ({
          relays: state.relays.filter((r) => r.url !== url),
        })),
      updateRelay: (url, updates) =>
        set((state) => ({
          relays: state.relays.map((r) =>
            r.url === url ? { ...r, ...updates } : r
          ),
        })),
      toggleRelay: (url) =>
        set((state) => ({
          relays: state.relays.map((r) =>
            r.url === url ? { ...r, enabled: !r.enabled } : r
          ),
        })),
      setRelays: (relays) => set({ relays }),
      setSelectedRelay: (url) => set({ selectedRelay: url }),
      // Theme actions
      setTheme: (theme) => set({ theme }),
      // Language actions
      setLanguage: (language) => set({ language }),
      // Notification actions
      updateNotifications: (settings) =>
        set((state) => ({
          notifications: { ...state.notifications, ...settings },
        })),
      // Privacy actions
      updatePrivacy: (settings) =>
        set((state) => ({
          privacy: { ...state.privacy, ...settings },
        })),
      // General actions
      resetToDefaults: () => set(defaultSettings),
    }),
    {
      name: 'voces-settings',
      version: 1,
    }
  )
);
</file>

<file path="src/.repomix-output.txt">
This file is a merged representation of a subset of the codebase, containing specifically included files and files not matching ignore patterns, combined into a single document by Repomix.
The content has been processed where empty lines have been removed.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of a subset of the repository's contents that is considered the most important context.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Only files matching these patterns are included: **/*, .cursorrules, .cursor/rules/*, .clinerules, CLAUDE.md
- Files matching these patterns are excluded: .*.*, **/*.pbxproj, **/node_modules/**, **/dist/**, **/build/**, **/compile/**, **/*.spec.*, **/*.pyc, **/.env, **/.env.*, **/*.env, **/*.env.*, **/*.lock, **/*.lockb, **/package-lock.*, **/pnpm-lock.*, **/*.tsbuildinfo, **/certdata.txt
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Empty lines have been removed from all files
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
components/
  layout/
    Layout.tsx
  navigation/
    BottomNav.tsx
    RelaySelector.tsx
    Sidebar.tsx
  nostr/
  ui/
    Avatar.tsx
    button.tsx
    card.tsx
    FAB.tsx
    input.tsx
    label.tsx
    select.tsx
    tabs.tsx
    textarea.tsx
    UserAvatar.tsx
  wallet/
    index.ts
    MintConfiguration.tsx
    ProfessionalWallet.tsx
    QRScanner.tsx
    README.md
    TransactionButton.tsx
    TransactionModal.tsx
    Wallet.tsx
    WalletBalance.tsx
    WalletBalanceBadge.tsx
    WalletIntegration.tsx
    WalletWidget.tsx
    ZapButton.tsx
config/
  ndk.ts
contexts/
features/
  auth/
    LoginButton.tsx
  classifieds/
    components/
      CategorySection.tsx
      FilterButton.tsx
      ListingCard.tsx
      ListingForm.tsx
      ListingGrid.tsx
      PriceTag.tsx
    hooks/
      useCreateListing.ts
      useListings.ts
    types.ts
  feed/
    ComposeNote.tsx
    NoteCard.tsx
    NoteFeed.tsx
  profile/
  settings/
    NotificationSettings.tsx
    PrivacySettings.tsx
    ProfileSettings.tsx
    RelaySettings.tsx
    ThemeSettings.tsx
  trades/
    CompactFilters.tsx
    CreateOrderModal.tsx
    MobileFilters.tsx
    OrderBook.tsx
    OrderCard.tsx
    QuickFilters.tsx
    TakeOrderModal.tsx
    TradeFilters.tsx
hooks/
lib/
  utils.ts
pages/
  marketplace/
    CreateListingPage.tsx
    ListingDetailPage.tsx
    MarketplacePage.tsx
  ComposePage.tsx
  HomePage.tsx
  NotificationsPage.tsx
  ProfilePage.tsx
  SettingsPage.tsx
  TradePage.tsx
  WalletPage.tsx
stores/
  settingsStore.ts
tools/
  dynamic/
types/
utils/
app.css
App.tsx
index.css
main.tsx
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="components/layout/Layout.tsx">
import { Outlet, useNavigate } from 'react-router-dom';
import { Sidebar } from '@/components/navigation/Sidebar';
import { BottomNav } from '@/components/navigation/BottomNav';
import { LoginButton } from '@/features/auth/LoginButton';
import { useNDKCurrentUser } from '@nostr-dev-kit/ndk-hooks';
import { FAB } from '@/components/ui/FAB';
import { UserAvatar } from '@/components/ui/UserAvatar';
import { Bell } from 'lucide-react';
import { RelaySelector } from '@/components/navigation/RelaySelector';
export function Layout() {
  const currentUser = useNDKCurrentUser();
  const navigate = useNavigate();
  return (
    <div className="min-h-screen bg-gray-50 dark:bg-gray-900">
      {/* Sidebar for desktop */}
      <Sidebar />
      {/* Main content area */}
      <div className="md:ml-64 lg:ml-72 flex flex-col min-h-screen">
        {/* Mobile header */}
        <header className="md:hidden sticky top-0 z-40 bg-white/95 backdrop-blur-lg dark:bg-gray-950/95 border-b border-gray-100 dark:border-gray-800 shadow-soft">
          <div className="flex items-center justify-between px-4 py-4">
            <h1 className="text-2xl font-bold bg-gradient-to-r from-primary-600 to-primary-400 bg-clip-text text-transparent">
              Voces
            </h1>
            <div className="flex items-center gap-3">
              <RelaySelector />
              {currentUser && (
                <button
                  onClick={() => navigate('/notifications')}
                  className="relative p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-xl transition-all duration-200 hover:scale-105"
                >
                  <Bell className="w-5 h-5 text-gray-600 dark:text-gray-400" />
                  <span className="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full animate-pulse" />
                </button>
              )}
              {!currentUser && <LoginButton />}
            </div>
          </div>
        </header>
        {/* Desktop header */}
        <header className="hidden md:block sticky top-0 z-40 bg-white/80 dark:bg-gray-950/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-800">
          <div className="flex items-center justify-between px-6 py-4">
            <RelaySelector />
            <div className="flex-1" />
            <LoginButton />
          </div>
        </header>
        {/* Page content */}
        <main className="flex-1 pb-20 md:pb-0">
          <Outlet />
        </main>
      </div>
      {/* Bottom navigation for mobile - always show */}
      <BottomNav />
      {/* FAB for compose */}
      {currentUser && <FAB />}
    </div>
  );
}
</file>

<file path="components/navigation/BottomNav.tsx">
import { Home, Wallet, TrendingUp, Store, User } from 'lucide-react';
import { Link, useLocation } from 'react-router-dom';
import { cn } from '@/lib/utils';
const navItems = [
  { path: '/', icon: Home, label: 'Home' },
  { path: '/marketplace', icon: Store, label: 'Market' },
  { path: '/wallet', icon: Wallet, label: 'Wallet' },
  { path: '/trades', icon: TrendingUp, label: 'Trades' },
  { path: '/profile', icon: User, label: 'Profile' },
];
export function BottomNav() {
  const location = useLocation();
  return (
    <nav className="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-lg border-t border-gray-100 dark:bg-gray-950/95 dark:border-gray-800 md:hidden z-40 shadow-lg">
      <div className="flex items-center justify-around h-16 px-2">
        {navItems.map(({ path, icon: Icon, label }) => {
          const isActive = location.pathname === path;
          return (
            <Link
              key={path}
              to={path}
              className={cn(
                'flex flex-col items-center justify-center gap-1 w-full h-full rounded-lg transition-all duration-200',
                isActive
                  ? 'text-primary-600 dark:text-primary-400'
                  : 'text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300'
              )}
            >
              <div className={cn(
                'relative transition-all duration-200',
                isActive && 'scale-110'
              )}>
                <Icon
                  className={cn(
                    'w-6 h-6 transition-all duration-200',
                    isActive && 'drop-shadow-lg'
                  )}
                  strokeWidth={isActive ? 2.5 : 1.75}
                  fill={isActive ? 'currentColor' : 'none'}
                  fillOpacity={isActive ? 0.15 : 0}
                />
                {isActive && (
                  <div className="absolute -bottom-3 left-1/2 transform -translate-x-1/2 w-1 h-1 bg-primary-600 dark:bg-primary-400 rounded-full animate-scale-in" />
                )}
              </div>
              <span className={cn(
                'text-[10px] font-medium transition-all duration-200',
                isActive ? 'opacity-100' : 'opacity-70'
              )}>
                {label}
              </span>
            </Link>
          );
        })}
      </div>
    </nav>
  );
}
</file>

<file path="components/navigation/RelaySelector.tsx">
import { ChevronDown, Globe, Circle, Check } from "lucide-react";
import { useState, useRef, useEffect } from "react";
import { useSettingsStore } from "@/stores/settingsStore";
import { useNavigate } from "react-router-dom";
export function RelaySelector() {
  const [isOpen, setIsOpen] = useState(false);
  const dropdownRef = useRef<HTMLDivElement>(null);
  const navigate = useNavigate();
  const { relays, selectedRelay, setSelectedRelay } = useSettingsStore();
  const enabledRelays = relays.filter(r => r.enabled);
  // Close dropdown when clicking outside
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {
        setIsOpen(false);
      }
    };
    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, []);
  const handleRelaySelect = (relayUrl: string | null) => {
    setSelectedRelay(relayUrl);
    setIsOpen(false);
  };
  const getRelayDisplayName = (url: string) => {
    try {
      const urlObj = new URL(url);
      return urlObj.hostname.replace("wss://", "").replace("ws://", "");
    } catch {
      return url.replace("wss://", "").replace("ws://", "");
    }
  };
  const currentRelayDisplay = selectedRelay
    ? getRelayDisplayName(selectedRelay)
    : `All Relays (${enabledRelays.length})`;
  return (
    <div className="relative" ref={dropdownRef}>
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="flex items-center gap-1.5 px-2 py-1 text-sm text-gray-600 dark:text-gray-400
                   hover:text-gray-900 dark:hover:text-gray-100 transition-colors"
      >
        <Globe className="h-4 w-4" />
        <span className="max-w-[140px] truncate font-normal">{currentRelayDisplay}</span>
        <ChevronDown className={`h-3 w-3 transition-transform ${isOpen ? 'rotate-180' : ''}`} />
      </button>
      {isOpen && (
        <div className="absolute top-full mt-2 right-0 w-64 bg-white dark:bg-gray-800 rounded-lg shadow-lg
                        border border-gray-200 dark:border-gray-700 overflow-hidden z-50">
          <div className="py-1">
            {/* All Relays option */}
            <button
              onClick={() => handleRelaySelect(null)}
              className="w-full flex items-center justify-between px-4 py-2 text-sm text-gray-700 dark:text-gray-200
                         hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
            >
              <div className="flex items-center gap-2">
                <Globe className="h-4 w-4 text-blue-500" />
                <span>All Relays ({enabledRelays.length})</span>
              </div>
              {!selectedRelay && <Check className="h-4 w-4 text-green-500" />}
            </button>
            {/* Divider */}
            <div className="h-px bg-gray-200 dark:bg-gray-700 my-1" />
            {/* Individual relays */}
            {enabledRelays.length > 0 ? (
              enabledRelays.map((relay) => (
                <button
                  key={relay.url}
                  onClick={() => handleRelaySelect(relay.url)}
                  className="w-full flex items-center justify-between px-4 py-2 text-sm text-gray-700 dark:text-gray-200
                             hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                >
                  <div className="flex items-center gap-2">
                    <Circle
                      className={`h-2 w-2 ${relay.write && relay.read ? 'fill-green-500 text-green-500' :
                                             relay.read ? 'fill-blue-500 text-blue-500' :
                                             'fill-orange-500 text-orange-500'}`}
                    />
                    <span className="truncate">{getRelayDisplayName(relay.url)}</span>
                  </div>
                  {selectedRelay === relay.url && <Check className="h-4 w-4 text-green-500" />}
                </button>
              ))
            ) : (
              <div className="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">
                No relays enabled
              </div>
            )}
            {/* Divider */}
            <div className="h-px bg-gray-200 dark:bg-gray-700 my-1" />
            {/* Settings link */}
            <button
              onClick={() => {
                setIsOpen(false);
                navigate('/settings');
              }}
              className="w-full flex items-center px-4 py-2 text-sm text-blue-600 dark:text-blue-400
                         hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
            >
              Manage Relays ‚Üí
            </button>
          </div>
        </div>
      )}
    </div>
  );
}
</file>

<file path="components/navigation/Sidebar.tsx">
import { Home, Edit3, Bell, User, Wallet, TrendingUp, Settings, ShoppingBag } from 'lucide-react';
import { Link, useLocation } from 'react-router-dom';
import { cn } from '@/lib/utils';
import { useNDKCurrentUser } from '@nostr-dev-kit/ndk-hooks';
import { useProfile } from '@nostr-dev-kit/ndk-hooks';
import { WalletWidget } from '../wallet/WalletWidget';
import { UserAvatar } from '../ui/UserAvatar';
const navItems = [
  { path: '/', icon: Home, label: 'Home' },
  { path: '/compose', icon: Edit3, label: 'Compose' },
  { path: '/notifications', icon: Bell, label: 'Notifications' },
  { path: '/profile', icon: User, label: 'Profile' },
  { path: '/marketplace', icon: ShoppingBag, label: 'Marketplace' },
  { path: '/wallet', icon: Wallet, label: 'Wallet' },
  { path: '/trades', icon: TrendingUp, label: 'P2P Trades' },
];
export function Sidebar() {
  const location = useLocation();
  const currentUser = useNDKCurrentUser();
  const profile = useProfile(currentUser?.pubkey);
  return (
    <aside className="hidden md:flex md:w-64 lg:w-72 flex-col h-screen fixed left-0 top-0 bg-white dark:bg-gray-950 border-r border-gray-200 dark:border-gray-800">
      <div className="flex items-center gap-3 px-6 py-6 border-b border-gray-200 dark:border-gray-800">
        <h1 className="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
          Voces
        </h1>
      </div>
      <nav className="flex-1 px-3 py-6">
        <div className="space-y-1">
          {navItems.map(({ path, icon: Icon, label }) => {
            const isActive = location.pathname === path;
            return (
              <Link
                key={path}
                to={path}
                className={cn(
                  'flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all font-medium',
                  isActive 
                    ? 'bg-purple-50 text-purple-700 dark:bg-purple-950/50 dark:text-purple-400' 
                    : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-900'
                )}
              >
                <Icon className="w-5 h-5" strokeWidth={isActive ? 2.5 : 2} />
                <span>{label}</span>
              </Link>
            );
          })}
        </div>
      </nav>
      {/* Wallet Widget */}
      <div className="px-3 mb-4">
        <WalletWidget />
      </div>
      {currentUser && (
        <div className="border-t border-gray-200 dark:border-gray-800 p-4">
          <div className="flex items-center gap-3 mb-4">
            <UserAvatar pubkey={currentUser.pubkey} size="md" />
            <div className="flex-1 min-w-0">
              <p className="font-medium text-sm truncate text-gray-900 dark:text-gray-100">
                {profile?.name || 'Anonymous'}
              </p>
              <p className="text-xs text-gray-500 dark:text-gray-400 truncate">
                {profile?.nip05 || currentUser.npub?.slice(0, 16) + '...'}
              </p>
            </div>
          </div>
          <div className="space-y-1">
            <Link
              to="/settings"
              className="flex items-center gap-3 px-3 py-2 rounded-lg text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-900 transition-colors"
            >
              <Settings className="w-4 h-4" />
              <span className="text-sm">Settings</span>
            </Link>
          </div>
        </div>
      )}
    </aside>
  );
}
</file>

<file path="components/ui/Avatar.tsx">
import { User } from 'lucide-react';
import { cn } from '@/lib/utils';
interface AvatarProps {
  src?: string | null;
  alt?: string;
  name?: string | null;
  size?: 'xs' | 'sm' | 'md' | 'lg' | 'xl';
  className?: string;
}
const sizeClasses = {
  xs: 'w-6 h-6 text-xs',
  sm: 'w-8 h-8 text-sm',
  md: 'w-10 h-10 text-base',
  lg: 'w-12 h-12 text-lg',
  xl: 'w-16 h-16 text-xl',
};
const iconSizes = {
  xs: 'w-3 h-3',
  sm: 'w-4 h-4',
  md: 'w-5 h-5',
  lg: 'w-6 h-6',
  xl: 'w-8 h-8',
};
export function Avatar({ src, alt, name, size = 'md', className }: AvatarProps) {
  const sizeClass = sizeClasses[size];
  const iconSize = iconSizes[size];
  if (src) {
    return (
      <img
        src={src}
        alt={alt || name || 'Avatar'}
        className={cn(
          'rounded-full object-cover',
          sizeClass,
          className
        )}
      />
    );
  }
  // If no image, show initial or user icon
  const initial = name?.charAt(0)?.toUpperCase();
  if (initial) {
    return (
      <div
        className={cn(
          'rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-semibold',
          sizeClass,
          className
        )}
      >
        {initial}
      </div>
    );
  }
  // Fallback to user icon
  return (
    <div
      className={cn(
        'rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center',
        sizeClass,
        className
      )}
    >
      <User className={cn('text-gray-500 dark:text-gray-400', iconSize)} />
    </div>
  );
}
</file>

<file path="components/ui/button.tsx">
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils"
const buttonVariants = cva(
  "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline:
          "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)
export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}
const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"
export { Button, buttonVariants }
</file>

<file path="components/ui/card.tsx">
import * as React from "react"
import { cn } from "@/lib/utils"
const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-lg border bg-card text-card-foreground shadow-sm",
      className
    )}
    {...props}
  />
))
Card.displayName = "Card"
const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
))
CardHeader.displayName = "CardHeader"
const CardTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h3
    ref={ref}
    className={cn(
      "text-2xl font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
CardTitle.displayName = "CardTitle"
const CardDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <p
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
CardDescription.displayName = "CardDescription"
const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"
const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
))
CardFooter.displayName = "CardFooter"
export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }
</file>

<file path="components/ui/FAB.tsx">
import { motion } from 'framer-motion';
import { Plus, Edit3, TrendingUp, ShoppingBag, Wallet } from 'lucide-react';
import { useLocation } from 'react-router-dom';
import { cn } from '@/lib/utils';
import { useState } from 'react';
import { CreateOrderModal } from '@/features/trades/CreateOrderModal';
import { useNavigate } from 'react-router-dom';
import { useNDKCurrentUser } from '@nostr-dev-kit/ndk-hooks';
interface FABProps {
  className?: string;
  icon?: 'plus' | 'edit';
}
export function FAB({ className }: FABProps) {
  const navigate = useNavigate();
  const location = useLocation();
  const currentUser = useNDKCurrentUser();
  const [showCreateOrderModal, setShowCreateOrderModal] = useState(false);
  // Determine FAB action and icon based on current route
  const getFABConfig = () => {
    const path = location.pathname;
    if (path.startsWith('/trades')) {
      return {
        icon: TrendingUp,
        label: 'Create Trade',
        action: () => setShowCreateOrderModal(true),
        requiresAuth: true
      };
    }
    if (path.startsWith('/marketplace')) {
      return {
        icon: ShoppingBag,
        label: 'List Item',
        action: () => navigate('/marketplace/create'),
        requiresAuth: true
      };
    }
    if (path.startsWith('/wallet')) {
      return {
        icon: Plus,
        label: 'Add Funds',
        action: () => {}, // TODO: Implement wallet action
        requiresAuth: false
      };
    }
    // Default to compose for feed/home
    return {
      icon: Edit3,
      label: 'Compose',
      action: () => navigate('/compose'),
      requiresAuth: true
    };
  };
  const config = getFABConfig();
  const Icon = config.icon;
  // Don't show FAB if auth is required but user not logged in
  if (config.requiresAuth && !currentUser) {
    return null;
  }
  const handleClick = () => {
    config.action();
  };
  return (
    <>
      <motion.button
        onClick={handleClick}
        whileHover={{ scale: 1.1 }}
        whileTap={{ scale: 0.95 }}
        initial={{ scale: 0 }}
        animate={{ scale: 1 }}
        transition={{ type: "spring", stiffness: 300, damping: 20 }}
        className={cn(
          "fixed bottom-20 right-4 z-40",
          "w-14 h-14 rounded-full",
          "bg-gradient-to-br from-purple-600 to-pink-600",
          "shadow-lg shadow-purple-500/25",
          "flex items-center justify-center",
          "md:hidden", // Only show on mobile
          className
        )}
        aria-label={config.label}
      >
        <Icon className="w-6 h-6 text-white" />
      </motion.button>
      {/* Modal for trades page */}
      {showCreateOrderModal && (
        <CreateOrderModal onClose={() => setShowCreateOrderModal(false)} />
      )}
    </>
  );
}
</file>

<file path="components/ui/input.tsx">
import * as React from 'react';
import { cn } from '@/lib/utils';
export interface InputProps
  extends React.InputHTMLAttributes<HTMLInputElement> {}
const Input = React.forwardRef<HTMLInputElement, InputProps>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          'flex h-10 w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-purple-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-800 dark:bg-gray-950 dark:ring-offset-gray-950 dark:placeholder:text-gray-400 dark:focus-visible:ring-purple-400',
          className
        )}
        ref={ref}
        {...props}
      />
    );
  }
);
Input.displayName = 'Input';
export { Input };
</file>

<file path="components/ui/label.tsx">
import * as React from 'react';
import { cn } from '@/lib/utils';
export interface LabelProps
  extends React.LabelHTMLAttributes<HTMLLabelElement> {}
const Label = React.forwardRef<HTMLLabelElement, LabelProps>(
  ({ className, ...props }, ref) => {
    return (
      <label
        ref={ref}
        className={cn(
          'text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70',
          className
        )}
        {...props}
      />
    );
  }
);
Label.displayName = 'Label';
export { Label };
</file>

<file path="components/ui/select.tsx">
import * as React from 'react';
import { ChevronDown } from 'lucide-react';
import { cn } from '@/lib/utils';
const SelectContext = React.createContext<{
  value: string;
  onValueChange: (value: string) => void;
  open: boolean;
  setOpen: (open: boolean) => void;
}>({
  value: '',
  onValueChange: () => {},
  open: false,
  setOpen: () => {},
});
interface SelectProps {
  value?: string;
  onValueChange?: (value: string) => void;
  children: React.ReactNode;
}
export function Select({ value = '', onValueChange = () => {}, children }: SelectProps) {
  const [open, setOpen] = React.useState(false);
  return (
    <SelectContext.Provider value={{ value, onValueChange, open, setOpen }}>
      <div className="relative">
        {children}
      </div>
    </SelectContext.Provider>
  );
}
interface SelectTriggerProps {
  className?: string;
  children: React.ReactNode;
}
export const SelectTrigger = React.forwardRef<HTMLButtonElement, SelectTriggerProps>(
  ({ className, children, ...props }, ref) => {
    const { open, setOpen } = React.useContext(SelectContext);
    return (
      <button
        ref={ref}
        type="button"
        onClick={() => setOpen(!open)}
        className={cn(
          'flex h-10 w-full items-center justify-between rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-800 dark:bg-gray-950 dark:ring-offset-gray-950 dark:placeholder:text-gray-400 dark:focus:ring-purple-400',
          className
        )}
        {...props}
      >
        {children}
        <ChevronDown className="h-4 w-4 opacity-50" />
      </button>
    );
  }
);
SelectTrigger.displayName = 'SelectTrigger';
export function SelectValue({ placeholder }: { placeholder?: string }) {
  const { value } = React.useContext(SelectContext);
  return <span>{value || placeholder || 'Select...'}</span>;
}
interface SelectContentProps {
  className?: string;
  children: React.ReactNode;
}
export function SelectContent({ className, children }: SelectContentProps) {
  const { open, setOpen } = React.useContext(SelectContext);
  const ref = React.useRef<HTMLDivElement>(null);
  React.useEffect(() => {
    function handleClickOutside(event: MouseEvent) {
      if (ref.current && !ref.current.contains(event.target as Node)) {
        setOpen(false);
      }
    }
    if (open) {
      document.addEventListener('mousedown', handleClickOutside);
    }
    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
    };
  }, [open, setOpen]);
  if (!open) return null;
  return (
    <div
      ref={ref}
      className={cn(
        'absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded-md border border-gray-200 bg-white py-1 text-sm shadow-lg dark:border-gray-800 dark:bg-gray-950',
        className
      )}
    >
      {children}
    </div>
  );
}
interface SelectItemProps {
  value: string;
  className?: string;
  children: React.ReactNode;
}
export function SelectItem({ value, className, children }: SelectItemProps) {
  const { value: selectedValue, onValueChange, setOpen } = React.useContext(SelectContext);
  const isSelected = selectedValue === value;
  return (
    <div
      onClick={() => {
        onValueChange(value);
        setOpen(false);
      }}
      className={cn(
        'relative cursor-pointer select-none px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-800',
        isSelected && 'bg-gray-100 dark:bg-gray-800',
        className
      )}
    >
      {children}
    </div>
  );
}
</file>

<file path="components/ui/tabs.tsx">
import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"
import { cn } from "@/lib/utils"
const Tabs = TabsPrimitive.Root
const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-10 items-center justify-center rounded-md bg-gray-100 p-1 text-gray-500 dark:bg-gray-800 dark:text-gray-400",
      className
    )}
    {...props}
  />
))
TabsList.displayName = TabsPrimitive.List.displayName
const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white data-[state=active]:text-gray-950 data-[state=active]:shadow-sm dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300 dark:data-[state=active]:bg-gray-950 dark:data-[state=active]:text-gray-50",
      className
    )}
    {...props}
  />
))
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName
const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300",
      className
    )}
    {...props}
  />
))
TabsContent.displayName = TabsPrimitive.Content.displayName
export { Tabs, TabsList, TabsTrigger, TabsContent }
</file>

<file path="components/ui/textarea.tsx">
import * as React from 'react';
import { cn } from '@/lib/utils';
export interface TextareaProps
  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}
const Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(
  ({ className, ...props }, ref) => {
    return (
      <textarea
        className={cn(
          'flex min-h-[80px] w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-purple-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-800 dark:bg-gray-950 dark:ring-offset-gray-950 dark:placeholder:text-gray-400 dark:focus-visible:ring-purple-400',
          className
        )}
        ref={ref}
        {...props}
      />
    );
  }
);
Textarea.displayName = 'Textarea';
export { Textarea };
</file>

<file path="components/ui/UserAvatar.tsx">
import { useProfile } from '@nostr-dev-kit/ndk-hooks';
import { Avatar } from './Avatar';
interface UserAvatarProps {
  pubkey?: string;
  size?: 'xs' | 'sm' | 'md' | 'lg' | 'xl';
  className?: string;
}
export function UserAvatar({ pubkey, size = 'md', className }: UserAvatarProps) {
  const profile = useProfile(pubkey);
  if (!pubkey) {
    return <Avatar size={size} className={className} />;
  }
  return (
    <Avatar
      src={profile?.picture}
      alt={profile?.name || 'User'}
      name={profile?.name}
      size={size}
      className={className}
    />
  );
}
</file>

<file path="components/wallet/index.ts">
export { Wallet } from './Wallet';
export type { WalletVariant } from './Wallet';
export { WalletBalance } from './WalletBalance';
export { MintConfiguration } from './MintConfiguration';
export { TransactionButton } from './TransactionButton';
export { QRScanner } from './QRScanner';
export { TransactionModal } from './TransactionModal';
export { ProfessionalWallet } from './ProfessionalWallet';
</file>

<file path="components/wallet/MintConfiguration.tsx">
import { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Settings, Plus, Trash2, Info, Check, X } from 'lucide-react';
interface Mint {
  id: string;
  url: string;
  name: string;
  balance?: number;
  isActive: boolean;
}
interface MintConfigurationProps {
  variant?: 'minimal' | 'detailed' | 'card';
}
export function MintConfiguration({ variant = 'minimal' }: MintConfigurationProps) {
  const [mints, setMints] = useState<Mint[]>([
    { id: '1', url: 'https://mint.minibits.cash', name: 'Minibits', balance: 10000, isActive: true },
    { id: '2', url: 'https://stablenut.umint.cash', name: 'Stablenut', balance: 5000, isActive: false },
  ]);
  const [isExpanded, setIsExpanded] = useState(false);
  const [newMintUrl, setNewMintUrl] = useState('');
  const [showTooltip, setShowTooltip] = useState(false);
  const addMint = () => {
    if (newMintUrl) {
      const newMint: Mint = {
        id: Date.now().toString(),
        url: newMintUrl,
        name: new URL(newMintUrl).hostname,
        balance: 0,
        isActive: false
      };
      setMints([...mints, newMint]);
      setNewMintUrl('');
    }
  };
  const removeMint = (id: string) => {
    setMints(mints.filter(m => m.id !== id));
  };
  const toggleMint = (id: string) => {
    setMints(mints.map(m => 
      m.id === id ? { ...m, isActive: !m.isActive } : m
    ));
  };
  if (variant === 'card') {
    return (
      <motion.div
        className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6"
        whileHover={{ y: -2 }}
        transition={{ type: "spring", stiffness: 300 }}
      >
        <div className="flex items-center justify-between mb-4">
          <h3 className="text-lg font-medium text-gray-900">Cashu Mints</h3>
          <button
            onClick={() => setIsExpanded(!isExpanded)}
            className="p-2 hover:bg-gray-50 rounded-lg transition-colors"
          >
            <Settings className="w-5 h-5 text-gray-600" />
          </button>
        </div>
        <AnimatePresence>
          {isExpanded && (
            <motion.div
              initial={{ height: 0, opacity: 0 }}
              animate={{ height: "auto", opacity: 1 }}
              exit={{ height: 0, opacity: 0 }}
              className="space-y-3 overflow-hidden"
            >
              {mints.map((mint) => (
                <MintItem
                  key={mint.id}
                  mint={mint}
                  onToggle={() => toggleMint(mint.id)}
                  onRemove={() => removeMint(mint.id)}
                />
              ))}
              <AddMintInput
                value={newMintUrl}
                onChange={setNewMintUrl}
                onAdd={addMint}
              />
            </motion.div>
          )}
        </AnimatePresence>
        {!isExpanded && (
          <div className="text-sm text-gray-600">
            {mints.filter(m => m.isActive).length} active mints
          </div>
        )}
      </motion.div>
    );
  }
  if (variant === 'detailed') {
    return (
      <div className="space-y-4">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-2">
            <h3 className="text-sm font-medium text-gray-700">Mints</h3>
            <button
              onMouseEnter={() => setShowTooltip(true)}
              onMouseLeave={() => setShowTooltip(false)}
              className="relative"
            >
              <Info className="w-4 h-4 text-gray-400" />
              <AnimatePresence>
                {showTooltip && (
                  <motion.div
                    initial={{ opacity: 0, y: 5 }}
                    animate={{ opacity: 1, y: 0 }}
                    exit={{ opacity: 0, y: 5 }}
                    className="absolute left-6 top-0 bg-gray-800 text-white text-xs px-2 py-1 rounded-md whitespace-nowrap z-10"
                  >
                    Cashu mint (server)
                  </motion.div>
                )}
              </AnimatePresence>
            </button>
          </div>
          <button
            onClick={() => setIsExpanded(!isExpanded)}
            className="text-sm text-blue-600 hover:text-blue-700"
          >
            {isExpanded ? 'Close' : 'Configure'}
          </button>
        </div>
        <AnimatePresence>
          {isExpanded && (
            <motion.div
              initial={{ height: 0, opacity: 0 }}
              animate={{ height: "auto", opacity: 1 }}
              exit={{ height: 0, opacity: 0 }}
              className="space-y-2 overflow-hidden"
            >
              {mints.map((mint) => (
                <MintItem
                  key={mint.id}
                  mint={mint}
                  onToggle={() => toggleMint(mint.id)}
                  onRemove={() => removeMint(mint.id)}
                  variant="detailed"
                />
              ))}
              <AddMintInput
                value={newMintUrl}
                onChange={setNewMintUrl}
                onAdd={addMint}
                variant="inline"
              />
            </motion.div>
          )}
        </AnimatePresence>
        {!isExpanded && (
          <div className="flex gap-2 flex-wrap">
            {mints.filter(m => m.isActive).map((mint) => (
              <span
                key={mint.id}
                className="text-xs bg-green-50 text-green-700 px-2 py-1 rounded-full"
              >
                {mint.name}
              </span>
            ))}
          </div>
        )}
      </div>
    );
  }
  // Minimal variant (default)
  return (
    <button
      onClick={() => setIsExpanded(!isExpanded)}
      onMouseEnter={() => setShowTooltip(true)}
      onMouseLeave={() => setShowTooltip(false)}
      className="relative flex items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-lg transition-colors"
    >
      <Settings className="w-4 h-4" />
      <span>Mint</span>
      <AnimatePresence>
        {showTooltip && (
          <motion.div
            initial={{ opacity: 0, y: 5 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: 5 }}
            className="absolute left-0 top-10 bg-gray-800 text-white text-xs px-2 py-1 rounded-md whitespace-nowrap z-10"
          >
            Cashu mint (server)
          </motion.div>
        )}
      </AnimatePresence>
    </button>
  );
}
interface MintItemProps {
  mint: Mint;
  onToggle: () => void;
  onRemove: () => void;
  variant?: 'compact' | 'detailed';
}
function MintItem({ mint, onToggle, onRemove, variant = 'compact' }: MintItemProps) {
  if (variant === 'detailed') {
    return (
      <motion.div
        initial={{ x: -10, opacity: 0 }}
        animate={{ x: 0, opacity: 1 }}
        className="flex items-center justify-between p-3 bg-gray-50 rounded-lg"
      >
        <div className="flex items-center gap-3">
          <button
            onClick={onToggle}
            className={`w-5 h-5 rounded-full border-2 flex items-center justify-center transition-all ${
              mint.isActive
                ? 'bg-green-500 border-green-500'
                : 'bg-white border-gray-300'
            }`}
          >
            {mint.isActive && <Check className="w-3 h-3 text-white" />}
          </button>
          <div>
            <div className="text-sm font-medium text-gray-900">{mint.name}</div>
            <div className="text-xs text-gray-500">{mint.url}</div>
            {mint.balance && (
              <div className="text-xs text-gray-600 mt-1">
                Balance: {mint.balance.toLocaleString()} sats
              </div>
            )}
          </div>
        </div>
        <button
          onClick={onRemove}
          className="p-1 hover:bg-gray-200 rounded transition-colors"
        >
          <Trash2 className="w-4 h-4 text-gray-500" />
        </button>
      </motion.div>
    );
  }
  return (
    <motion.div
      initial={{ x: -10, opacity: 0 }}
      animate={{ x: 0, opacity: 1 }}
      className="flex items-center justify-between p-2 hover:bg-gray-50 rounded-lg"
    >
      <div className="flex items-center gap-2">
        <button
          onClick={onToggle}
          className={`w-4 h-4 rounded-full border-2 ${
            mint.isActive
              ? 'bg-green-500 border-green-500'
              : 'bg-white border-gray-300'
          }`}
        />
        <span className="text-sm text-gray-700">{mint.name}</span>
      </div>
      <button
        onClick={onRemove}
        className="p-1 hover:bg-gray-100 rounded"
      >
        <X className="w-3 h-3 text-gray-500" />
      </button>
    </motion.div>
  );
}
interface AddMintInputProps {
  value: string;
  onChange: (value: string) => void;
  onAdd: () => void;
  variant?: 'default' | 'inline';
}
function AddMintInput({ value, onChange, onAdd, variant = 'default' }: AddMintInputProps) {
  if (variant === 'inline') {
    return (
      <div className="flex gap-2">
        <input
          type="url"
          value={value}
          onChange={(e) => onChange(e.target.value)}
          placeholder="https://mint.example.com"
          className="flex-1 px-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:border-blue-500"
        />
        <button
          onClick={onAdd}
          disabled={!value}
          className="px-3 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Add
        </button>
      </div>
    );
  }
  return (
    <div className="flex items-center gap-2 p-2 border border-dashed border-gray-300 rounded-lg">
      <Plus className="w-4 h-4 text-gray-400" />
      <input
        type="url"
        value={value}
        onChange={(e) => onChange(e.target.value)}
        onKeyDown={(e) => e.key === 'Enter' && onAdd()}
        placeholder="Add mint URL"
        className="flex-1 text-sm bg-transparent focus:outline-none"
      />
    </div>
  );
}
</file>

<file path="components/wallet/ProfessionalWallet.tsx">
import { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import {
  ArrowUpRight,
  ArrowDownLeft,
  Zap,
  Coffee,
  TrendingUp,
  TrendingDown,
  Clock,
  MoreVertical,
  ChevronRight,
  Activity,
  Shield,
  Eye,
  EyeOff
} from 'lucide-react';
interface Transaction {
  id: string;
  type: 'sent' | 'received' | 'zap';
  description: string;
  amount: number;
  timestamp: string;
  icon?: 'zap' | 'coffee' | 'default';
  to?: string;
  from?: string;
  status?: 'pending' | 'completed';
}
export function ProfessionalWallet() {
  const [balance] = useState(21000);
  const [balanceHidden, setBalanceHidden] = useState(false);
  const [dailyChange] = useState(2500);
  const [selectedTab, setSelectedTab] = useState<'activity' | 'stats'>('activity');
  const transactions: Transaction[] = [
    {
      id: '1',
      type: 'zap',
      description: 'Zapped @jack',
      amount: -100,
      timestamp: '1h ago',
      icon: 'zap',
      to: 'jack',
      status: 'completed'
    },
    {
      id: '2',
      type: 'received',
      description: 'Payment received',
      amount: 500,
      timestamp: '2h ago',
      from: 'anon',
      status: 'completed'
    },
    {
      id: '3',
      type: 'sent',
      description: 'Coffee payment',
      amount: -250,
      timestamp: '3h ago',
      icon: 'coffee',
      to: 'Blue Bottle Coffee',
      status: 'completed'
    },
    {
      id: '4',
      type: 'zap',
      description: 'Zapped @fiatjaf',
      amount: -1000,
      timestamp: '1d ago',
      icon: 'zap',
      to: 'fiatjaf',
      status: 'completed'
    }
  ];
  const getTransactionIcon = (transaction: Transaction) => {
    if (transaction.icon === 'zap') {
      return <Zap className="w-5 h-5" />;
    }
    if (transaction.icon === 'coffee') {
      return <Coffee className="w-5 h-5" />;
    }
    if (transaction.type === 'sent') {
      return <ArrowUpRight className="w-5 h-5" />;
    }
    return <ArrowDownLeft className="w-5 h-5" />;
  };
  const getTransactionColor = (transaction: Transaction) => {
    if (transaction.type === 'received') {
      return 'text-emerald-400';
    }
    if (transaction.type === 'zap') {
      return 'text-purple-400';
    }
    return 'text-orange-400';
  };
  const getIconBgColor = (transaction: Transaction) => {
    if (transaction.type === 'received') {
      return 'bg-emerald-400/10 border-emerald-400/20';
    }
    if (transaction.type === 'zap') {
      return 'bg-purple-400/10 border-purple-400/20';
    }
    return 'bg-orange-400/10 border-orange-400/20';
  };
  return (
    <div className="w-full">
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
      >
        {/* Balance Section */}
        <div className="px-6 py-8">
          <div className="text-center">
            <div className="text-xs uppercase tracking-wider text-gray-500 mb-2 flex items-center justify-center gap-2">
              <span>Total Balance</span>
              <button
                onClick={() => setBalanceHidden(!balanceHidden)}
                className="p-1 hover:bg-gray-800/50 rounded transition-all"
              >
                {balanceHidden ? (
                  <Eye className="w-3 h-3" />
                ) : (
                  <EyeOff className="w-3 h-3" />
                )}
              </button>
            </div>
            <motion.div
              key={balanceHidden ? 'hidden' : 'visible'}
              initial={{ opacity: 0, y: -10 }}
              animate={{ opacity: 1, y: 0 }}
              className="mb-3"
            >
              {balanceHidden ? (
                <div className="text-4xl font-light text-gray-600">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
              ) : (
                <>
                  <div className="text-5xl font-light text-white tracking-tight">
                    {balance.toLocaleString()}
                  </div>
                  <div className="text-sm text-gray-400 mt-1">sats</div>
                </>
              )}
            </motion.div>
            <div className={`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-medium ${
              dailyChange >= 0
                ? 'bg-emerald-400/10 text-emerald-400 border border-emerald-400/20'
                : 'bg-red-400/10 text-red-400 border border-red-400/20'
            }`}>
              {dailyChange >= 0 ? (
                <TrendingUp className="w-3 h-3" />
              ) : (
                <TrendingDown className="w-3 h-3" />
              )}
              <span>{dailyChange >= 0 ? '+' : ''}{dailyChange.toLocaleString()} today</span>
            </div>
          </div>
          {/* Action Buttons */}
          <div className="flex gap-3 mt-8">
            <motion.button
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
              className="flex-1 bg-gradient-to-r from-purple-500 to-purple-600 text-white py-3.5 px-6 rounded-2xl font-medium shadow-lg shadow-purple-500/20 hover:shadow-purple-500/30 transition-all flex items-center justify-center gap-2"
            >
              <ArrowUpRight className="w-4 h-4" />
              Send
            </motion.button>
            <motion.button
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
              className="flex-1 bg-gray-800 hover:bg-gray-700 text-white py-3.5 px-6 rounded-2xl font-medium transition-all flex items-center justify-center gap-2 border border-gray-700"
            >
              <ArrowDownLeft className="w-4 h-4" />
              Receive
            </motion.button>
          </div>
        </div>
        {/* Quick Actions */}
        <div className="px-6 pb-4">
          <div className="grid grid-cols-2 gap-3">
            <motion.button
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
              className="bg-gray-800/50 hover:bg-gray-800 border border-gray-700/50 rounded-xl p-3 flex items-center justify-between transition-all"
            >
              <div className="flex items-center gap-2">
                <div className="w-8 h-8 bg-yellow-400/10 rounded-lg flex items-center justify-center">
                  <Activity className="w-4 h-4 text-yellow-400" />
                </div>
                <span className="text-sm text-gray-300">Mint</span>
              </div>
              <ChevronRight className="w-4 h-4 text-gray-500" />
            </motion.button>
            <motion.button
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
              className="bg-gray-800/50 hover:bg-gray-800 border border-gray-700/50 rounded-xl p-3 flex items-center justify-between transition-all"
            >
              <div className="flex items-center gap-2">
                <div className="w-8 h-8 bg-blue-400/10 rounded-lg flex items-center justify-center">
                  <Shield className="w-4 h-4 text-blue-400" />
                </div>
                <span className="text-sm text-gray-300">Backup</span>
              </div>
              <ChevronRight className="w-4 h-4 text-gray-500" />
            </motion.button>
          </div>
        </div>
        {/* Tabs */}
        <div className="px-6">
          <div className="flex gap-1 p-1 bg-gray-800/30 rounded-xl">
            <button
              onClick={() => setSelectedTab('activity')}
              className={`flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all ${
                selectedTab === 'activity'
                  ? 'bg-gray-700 text-white'
                  : 'text-gray-400 hover:text-gray-300'
              }`}
            >
              Recent Activity
            </button>
            <button
              onClick={() => setSelectedTab('stats')}
              className={`flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all ${
                selectedTab === 'stats'
                  ? 'bg-gray-700 text-white'
                  : 'text-gray-400 hover:text-gray-300'
              }`}
            >
              Statistics
            </button>
          </div>
        </div>
        {/* Transactions List */}
        <div className="px-6 py-4">
          <AnimatePresence mode="wait">
            {selectedTab === 'activity' && (
              <motion.div
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                exit={{ opacity: 0, y: -10 }}
                className="space-y-3"
              >
                {transactions.map((transaction, index) => (
                  <motion.div
                    key={transaction.id}
                    initial={{ opacity: 0, x: -20 }}
                    animate={{ opacity: 1, x: 0 }}
                    transition={{ delay: index * 0.05 }}
                    whileHover={{ x: 4 }}
                    className="flex items-center justify-between p-3 rounded-xl hover:bg-gray-800/30 transition-all cursor-pointer group"
                  >
                    <div className="flex items-center gap-3">
                      <div className={`w-10 h-10 rounded-xl flex items-center justify-center border ${getIconBgColor(transaction)}`}>
                        <div className={getTransactionColor(transaction)}>
                          {getTransactionIcon(transaction)}
                        </div>
                      </div>
                      <div>
                        <div className="text-sm font-medium text-gray-200">
                          {transaction.description}
                        </div>
                        <div className="flex items-center gap-2 text-xs text-gray-500">
                          <Clock className="w-3 h-3" />
                          <span>{transaction.timestamp}</span>
                          {transaction.status === 'pending' && (
                            <span className="px-1.5 py-0.5 bg-yellow-400/10 text-yellow-400 rounded text-xs">
                              Pending
                            </span>
                          )}
                        </div>
                      </div>
                    </div>
                    <div className="text-right">
                      <div className={`text-sm font-semibold ${
                        transaction.amount > 0 ? 'text-emerald-400' : 'text-gray-300'
                      }`}>
                        {transaction.amount > 0 ? '+' : ''}{Math.abs(transaction.amount).toLocaleString()} sats
                      </div>
                      <div className="text-xs text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity">
                        View details
                      </div>
                    </div>
                  </motion.div>
                ))}
              </motion.div>
            )}
            {selectedTab === 'stats' && (
              <motion.div
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                exit={{ opacity: 0, y: -10 }}
                className="space-y-4"
              >
                <div className="grid grid-cols-2 gap-3">
                  <div className="bg-gray-800/30 rounded-xl p-4 border border-gray-700/50">
                    <div className="text-xs text-gray-500 mb-1">Total Sent</div>
                    <div className="text-lg font-semibold text-orange-400">1,350 sats</div>
                    <div className="text-xs text-gray-500 mt-1">4 transactions</div>
                  </div>
                  <div className="bg-gray-800/30 rounded-xl p-4 border border-gray-700/50">
                    <div className="text-xs text-gray-500 mb-1">Total Received</div>
                    <div className="text-lg font-semibold text-emerald-400">3,850 sats</div>
                    <div className="text-xs text-gray-500 mt-1">8 transactions</div>
                  </div>
                </div>
                <div className="bg-gray-800/30 rounded-xl p-4 border border-gray-700/50">
                  <div className="flex items-center justify-between mb-3">
                    <div className="text-xs text-gray-500">Weekly Activity</div>
                    <TrendingUp className="w-4 h-4 text-emerald-400" />
                  </div>
                  <div className="flex items-end gap-1 h-12">
                    {[40, 65, 30, 80, 45, 90, 70].map((height, i) => (
                      <div
                        key={i}
                        className="flex-1 bg-gradient-to-t from-purple-500 to-purple-400 rounded-t"
                        style={{ height: `${height}%` }}
                      />
                    ))}
                  </div>
                  <div className="flex justify-between mt-2 text-xs text-gray-500">
                    <span>Mon</span>
                    <span>Sun</span>
                  </div>
                </div>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
        {/* Footer */}
        <div className="px-6 pb-6">
          <motion.button
            whileHover={{ scale: 1.02 }}
            whileTap={{ scale: 0.98 }}
            className="w-full py-3 bg-gray-800/50 hover:bg-gray-800 border border-gray-700/50 rounded-xl text-sm text-gray-400 hover:text-gray-300 transition-all"
          >
            View All Transactions
          </motion.button>
        </div>
      </motion.div>
    </div>
  );
}
</file>

<file path="components/wallet/QRScanner.tsx">
import { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Camera, X, Clipboard, QrCode } from 'lucide-react';
interface QRScannerProps {
  onScan: (data: string) => void;
  variant?: 'minimal' | 'detailed' | 'modal';
}
export function QRScanner({ onScan, variant = 'minimal' }: QRScannerProps) {
  const [isOpen, setIsOpen] = useState(false);
  const [pasteValue, setPasteValue] = useState('');
  const [showPasteInput, setShowPasteInput] = useState(false);
  const handlePaste = () => {
    if (pasteValue) {
      onScan(pasteValue);
      setPasteValue('');
      setShowPasteInput(false);
      setIsOpen(false);
    }
  };
  const handleQuickPaste = async () => {
    try {
      const text = await navigator.clipboard.readText();
      if (text) {
        onScan(text);
        setIsOpen(false);
      }
    } catch (err) {
      setShowPasteInput(true);
    }
  };
  if (variant === 'modal') {
    return (
      <>
        <motion.button
          onClick={() => setIsOpen(true)}
          whileHover={{ scale: 1.05 }}
          whileTap={{ scale: 0.95 }}
          className="p-3 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-colors"
        >
          <QrCode className="w-5 h-5" />
        </motion.button>
        <AnimatePresence>
          {isOpen && (
            <motion.div
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              exit={{ opacity: 0 }}
              className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
              onClick={() => setIsOpen(false)}
            >
              <motion.div
                initial={{ scale: 0.9, y: 20 }}
                animate={{ scale: 1, y: 0 }}
                exit={{ scale: 0.9, y: 20 }}
                className="bg-white rounded-3xl p-6 max-w-md w-full shadow-2xl"
                onClick={(e) => e.stopPropagation()}
              >
                <div className="flex justify-between items-center mb-6">
                  <h3 className="text-xl font-semibold text-gray-900">Scan or Paste</h3>
                  <button
                    onClick={() => setIsOpen(false)}
                    className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                  >
                    <X className="w-5 h-5 text-gray-500" />
                  </button>
                </div>
                <div className="space-y-4">
                  <div className="bg-gray-100 rounded-2xl p-8 flex flex-col items-center justify-center">
                    <Camera className="w-12 h-12 text-gray-400 mb-3" />
                    <p className="text-sm text-gray-600 text-center">
                      Camera access needed for QR scanning
                    </p>
                    <button className="mt-4 text-sm text-purple-600 hover:text-purple-700">
                      Enable Camera
                    </button>
                  </div>
                  <div className="relative">
                    <div className="absolute inset-0 flex items-center">
                      <div className="w-full border-t border-gray-200" />
                    </div>
                    <div className="relative flex justify-center text-sm">
                      <span className="bg-white px-3 text-gray-500">or</span>
                    </div>
                  </div>
                  <div className="space-y-3">
                    <button
                      onClick={handleQuickPaste}
                      className="w-full flex items-center justify-center gap-2 px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-xl transition-colors"
                    >
                      <Clipboard className="w-4 h-4 text-gray-600" />
                      <span className="text-gray-700">Paste from Clipboard</span>
                    </button>
                    <AnimatePresence>
                      {showPasteInput && (
                        <motion.div
                          initial={{ height: 0, opacity: 0 }}
                          animate={{ height: "auto", opacity: 1 }}
                          exit={{ height: 0, opacity: 0 }}
                          className="overflow-hidden"
                        >
                          <input
                            type="text"
                            value={pasteValue}
                            onChange={(e) => setPasteValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handlePaste()}
                            placeholder="Paste invoice here..."
                            className="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                            autoFocus
                          />
                          <button
                            onClick={handlePaste}
                            disabled={!pasteValue}
                            className="w-full mt-3 px-4 py-3 bg-purple-600 text-white rounded-xl hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                          >
                            Process Invoice
                          </button>
                        </motion.div>
                      )}
                    </AnimatePresence>
                  </div>
                </div>
              </motion.div>
            </motion.div>
          )}
        </AnimatePresence>
      </>
    );
  }
  if (variant === 'detailed') {
    return (
      <div className="space-y-3">
        <button
          onClick={() => setShowPasteInput(!showPasteInput)}
          className="w-full flex items-center justify-between p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl hover:from-purple-100 hover:to-pink-100 transition-all"
        >
          <div className="flex items-center gap-3">
            <QrCode className="w-5 h-5 text-purple-600" />
            <span className="text-gray-700 font-medium">Scan QR Code</span>
          </div>
          <span className="text-xs text-gray-500">Tap to paste</span>
        </button>
        <AnimatePresence>
          {showPasteInput && (
            <motion.div
              initial={{ height: 0, opacity: 0 }}
              animate={{ height: "auto", opacity: 1 }}
              exit={{ height: 0, opacity: 0 }}
              className="overflow-hidden"
            >
              <div className="flex gap-2">
                <input
                  type="text"
                  value={pasteValue}
                  onChange={(e) => setPasteValue(e.target.value)}
                  placeholder="Paste Lightning invoice..."
                  className="flex-1 px-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:border-purple-500"
                />
                <button
                  onClick={handlePaste}
                  disabled={!pasteValue}
                  className="px-4 py-2 bg-purple-600 text-white rounded-lg text-sm hover:bg-purple-700 disabled:opacity-50"
                >
                  Pay
                </button>
              </div>
            </motion.div>
          )}
        </AnimatePresence>
      </div>
    );
  }
  // Minimal variant (default)
  return (
    <div className="relative">
      <button
        onClick={() => setShowPasteInput(!showPasteInput)}
        className="flex items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-lg transition-colors"
      >
        <Camera className="w-4 h-4" />
        <span>Scan</span>
      </button>
      <AnimatePresence>
        {showPasteInput && (
          <motion.div
            initial={{ opacity: 0, y: -10 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: -10 }}
            className="absolute top-full left-0 mt-2 p-3 bg-white rounded-lg shadow-lg border border-gray-200 z-10"
          >
            <div className="flex gap-2">
              <input
                type="text"
                value={pasteValue}
                onChange={(e) => setPasteValue(e.target.value)}
                onKeyDown={(e) => e.key === 'Enter' && handlePaste()}
                placeholder="Paste invoice"
                className="px-2 py-1 text-sm border border-gray-200 rounded focus:outline-none focus:border-blue-500"
                autoFocus
              />
              <button
                onClick={handlePaste}
                disabled={!pasteValue}
                className="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 disabled:opacity-50"
              >
                Pay
              </button>
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
}
</file>

<file path="components/wallet/README.md">
# NIP-60 Lightning Wallet UI Components

A gorgeous, elegant, and minimalist wallet UI for NIP-60 Lightning transactions with Cashu mint support.

## Features

- **5 Design Variations**: Choose from minimal light, minimal dark, card elegant, gradient modern, or compact styles
- **Cashu Mint Configuration**: Add and manage multiple Cashu mints with tooltips
- **QR Code Scanner**: Scan Lightning invoices with paste fallback option
- **Send & Receive**: Intuitive transaction modals with mock functionality
- **Subtle Animations**: Smooth Framer Motion animations throughout
- **Responsive Design**: Works beautifully on desktop and mobile

## Components

### Main Components

- `Wallet` - Main wallet component with variant selection
- `WalletBalance` - Displays balance with optional animations
- `MintConfiguration` - Manage Cashu mints configuration
- `TransactionButton` - Send/Receive action buttons
- `QRScanner` - QR code scanning with paste fallback
- `TransactionModal` - Modal for send/receive transactions

### Usage

```tsx
import { Wallet } from '@/components/wallet';

// Basic usage with default minimal-light variant
<Wallet />

// With specific variant
<Wallet variant="gradient-modern" />

// Available variants:
// - 'minimal-light' (default)
// - 'minimal-dark'
// - 'card-elegant'
// - 'gradient-modern'
// - 'compact'
```

## Design Variations

### Minimal Light (Default)
Clean and minimal design with light theme. Features subtle borders and elegant typography.

### Minimal Dark
Sleek dark theme with yellow accents inspired by Lightning. Perfect for dark mode applications.

### Card Elegant
Sophisticated card design with gradient accents and detailed balance display including daily changes.

### Gradient Modern
Bold animated gradient background with glassmorphism effects. Eye-catching and modern.

### Compact
Space-efficient inline design perfect for embedding in sidebars or headers.

## Mock Functionality

All components include mock functionality ready for integration:

- Balance tracking with animated updates
- Mint configuration with add/remove/toggle
- Invoice generation and QR codes
- Clipboard integration for paste functionality
- Transaction processing animations

## Integration with NIP-60

The wallet is designed to integrate with NIP-60 protocol for Cashu ecash wallets:

1. **Mint Management**: Configure and connect to multiple Cashu mints
2. **Balance Aggregation**: Track total balance across all mints
3. **Lightning Integration**: Send/receive via Lightning Network
4. **Zap Support**: Ready for Nostr zap integration

## Customization

Components use Tailwind CSS and can be easily customized:

- Colors can be adjusted via Tailwind classes
- Animations powered by Framer Motion
- Icons from Lucide React
- Fully typed with TypeScript

## Example Integration

See `WalletIntegration.tsx` for a complete example of how to integrate the wallet with zapping functionality.

## Development

To view all wallet variations:
1. Navigate to `/wallet` in your browser
2. Click on different variant buttons to see each design
3. Interact with buttons to see animations and modals

The wallet page showcases all features and variations in an interactive demo.
</file>

<file path="components/wallet/TransactionButton.tsx">
import { motion } from 'framer-motion';
import { Send, Download, ArrowUpRight, ArrowDownLeft } from 'lucide-react';
interface TransactionButtonProps {
  type: 'send' | 'receive';
  onClick: () => void;
  variant?: 'minimal' | 'detailed' | 'icon';
  disabled?: boolean;
}
export function TransactionButton({ 
  type, 
  onClick, 
  variant = 'minimal',
  disabled = false 
}: TransactionButtonProps) {
  const isSend = type === 'send';
  const icons = {
    minimal: isSend ? <Send className="w-4 h-4" /> : <Download className="w-4 h-4" />,
    detailed: isSend ? <ArrowUpRight className="w-5 h-5" /> : <ArrowDownLeft className="w-5 h-5" />,
    icon: isSend ? <Send className="w-5 h-5" /> : <Download className="w-5 h-5" />
  };
  const labels = {
    send: 'Send',
    receive: 'Receive'
  };
  if (variant === 'icon') {
    return (
      <motion.button
        onClick={onClick}
        disabled={disabled}
        whileHover={{ scale: 1.05 }}
        whileTap={{ scale: 0.95 }}
        className={`
          p-3 rounded-full transition-all
          ${isSend 
            ? 'bg-blue-600 hover:bg-blue-700 text-white' 
            : 'bg-gray-100 hover:bg-gray-200 text-gray-700'
          }
          ${disabled ? 'opacity-50 cursor-not-allowed' : ''}
        `}
      >
        {icons[variant]}
      </motion.button>
    );
  }
  if (variant === 'detailed') {
    return (
      <motion.button
        onClick={onClick}
        disabled={disabled}
        whileHover={{ scale: 1.02, y: -2 }}
        whileTap={{ scale: 0.98 }}
        className={`
          flex flex-col items-center justify-center p-6 rounded-2xl transition-all w-full
          ${isSend 
            ? 'bg-gradient-to-br from-blue-500 to-blue-600 text-white shadow-lg shadow-blue-500/20' 
            : 'bg-white border-2 border-gray-200 text-gray-700 hover:border-gray-300'
          }
          ${disabled ? 'opacity-50 cursor-not-allowed' : ''}
        `}
      >
        <motion.div
          initial={{ rotate: 0 }}
          whileHover={{ rotate: isSend ? -45 : 45 }}
          transition={{ type: "spring", stiffness: 300 }}
        >
          {icons[variant]}
        </motion.div>
        <span className="mt-2 text-sm font-medium">{labels[type]}</span>
      </motion.button>
    );
  }
  // Minimal variant (default)
  return (
    <motion.button
      onClick={onClick}
      disabled={disabled}
      whileHover={{ scale: 1.05 }}
      whileTap={{ scale: 0.95 }}
      transition={{ type: "spring", stiffness: 400, damping: 17 }}
      className={`
        flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all
        ${isSend 
          ? 'bg-gray-900 hover:bg-gray-800 text-white' 
          : 'bg-white hover:bg-gray-50 text-gray-900 border border-gray-200'
        }
        ${disabled ? 'opacity-50 cursor-not-allowed' : ''}
      `}
    >
      {icons[variant]}
      <span>{labels[type]}</span>
    </motion.button>
  );
}
</file>

<file path="components/wallet/TransactionModal.tsx">
import { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { X, Copy, Check, Zap, QrCode, Loader2 } from 'lucide-react';
interface TransactionModalProps {
  type: 'send' | 'receive';
  isOpen: boolean;
  onClose: () => void;
  balance: number;
  variant?: 'light' | 'dark' | 'gradient';
}
export function TransactionModal({
  type,
  isOpen,
  onClose,
  balance,
  variant = 'light'
}: TransactionModalProps) {
  const [amount, setAmount] = useState('');
  const [description, setDescription] = useState('');
  const [invoice, setInvoice] = useState('');
  const [copied, setCopied] = useState(false);
  const [isProcessing, setIsProcessing] = useState(false);
  const isSend = type === 'send';
  const handleCopy = () => {
    // Mock invoice
    const mockInvoice = 'lnbc21000n1pj9xyz...mockInvoice';
    navigator.clipboard.writeText(mockInvoice);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };
  const handleSubmit = () => {
    setIsProcessing(true);
    // Mock transaction
    setTimeout(() => {
      setIsProcessing(false);
      onClose();
    }, 2000);
  };
  const getModalStyles = () => {
    switch (variant) {
      case 'dark':
        return 'bg-gray-900 text-white';
      case 'gradient':
        return 'bg-gradient-to-br from-purple-600 to-pink-600 text-white';
      default:
        return 'bg-white';
    }
  };
  const getInputStyles = () => {
    switch (variant) {
      case 'dark':
        return 'bg-gray-800 border-gray-700 text-white placeholder-gray-400';
      case 'gradient':
        return 'bg-white/20 border-white/30 text-white placeholder-white/70 backdrop-blur-sm';
      default:
        return 'bg-white border-gray-200 text-gray-900';
    }
  };
  return (
    <AnimatePresence>
      {isOpen && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={onClose}
        >
          <motion.div
            initial={{ scale: 0.9, y: 20 }}
            animate={{ scale: 1, y: 0 }}
            exit={{ scale: 0.9, y: 20 }}
            className={`rounded-3xl p-6 max-w-md w-full shadow-2xl ${getModalStyles()}`}
            onClick={(e) => e.stopPropagation()}
          >
            {/* Header */}
            <div className="flex justify-between items-center mb-6">
              <h3 className="text-xl font-semibold">
                {isSend ? 'Send Payment' : 'Receive Payment'}
              </h3>
              <button
                onClick={onClose}
                className={`p-2 rounded-lg transition-colors ${
                  variant === 'dark' ? 'hover:bg-gray-800' : 'hover:bg-gray-100'
                }`}
              >
                <X className="w-5 h-5" />
              </button>
            </div>
            {/* Content */}
            {isSend ? (
              <div className="space-y-4">
                <div>
                  <label className={`text-sm ${variant === 'dark' ? 'text-gray-400' : 'text-gray-600'} mb-1 block`}>
                    Invoice
                  </label>
                  <textarea
                    value={invoice}
                    onChange={(e) => setInvoice(e.target.value)}
                    placeholder="Paste Lightning invoice or LNURL..."
                    className={`w-full p-3 rounded-xl resize-none focus:outline-none focus:ring-2 focus:ring-purple-500 ${getInputStyles()}`}
                    rows={3}
                  />
                </div>
                <div className="text-center py-2">
                  <span className={`text-sm ${variant === 'dark' ? 'text-gray-500' : 'text-gray-400'}`}>or</span>
                </div>
                <div>
                  <label className={`text-sm ${variant === 'dark' ? 'text-gray-400' : 'text-gray-600'} mb-1 block`}>
                    Amount (sats)
                  </label>
                  <input
                    type="number"
                    value={amount}
                    onChange={(e) => setAmount(e.target.value)}
                    placeholder="0"
                    className={`w-full p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 ${getInputStyles()}`}
                  />
                  <div className={`text-xs mt-1 ${variant === 'dark' ? 'text-gray-500' : 'text-gray-500'}`}>
                    Available: {balance.toLocaleString()} sats
                  </div>
                </div>
                <div>
                  <label className={`text-sm ${variant === 'dark' ? 'text-gray-400' : 'text-gray-600'} mb-1 block`}>
                    Note (optional)
                  </label>
                  <input
                    type="text"
                    value={description}
                    onChange={(e) => setDescription(e.target.value)}
                    placeholder="Coffee tip"
                    className={`w-full p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 ${getInputStyles()}`}
                  />
                </div>
                <motion.button
                  whileHover={{ scale: 1.02 }}
                  whileTap={{ scale: 0.98 }}
                  onClick={handleSubmit}
                  disabled={!invoice && !amount}
                  className={`w-full py-3 rounded-xl font-medium transition-all flex items-center justify-center gap-2 ${
                    variant === 'gradient'
                      ? 'bg-white text-purple-600 hover:bg-white/90'
                      : variant === 'dark'
                      ? 'bg-yellow-500 text-gray-900 hover:bg-yellow-400'
                      : 'bg-gray-900 text-white hover:bg-gray-800'
                  } disabled:opacity-50 disabled:cursor-not-allowed`}
                >
                  {isProcessing ? (
                    <>
                      <Loader2 className="w-4 h-4 animate-spin" />
                      <span>Processing...</span>
                    </>
                  ) : (
                    <>
                      <Zap className="w-4 h-4" />
                      <span>Send Payment</span>
                    </>
                  )}
                </motion.button>
              </div>
            ) : (
              <div className="space-y-4">
                <div>
                  <label className={`text-sm ${variant === 'dark' ? 'text-gray-400' : 'text-gray-600'} mb-1 block`}>
                    Amount (sats)
                  </label>
                  <input
                    type="number"
                    value={amount}
                    onChange={(e) => setAmount(e.target.value)}
                    placeholder="0"
                    className={`w-full p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 ${getInputStyles()}`}
                  />
                </div>
                <div>
                  <label className={`text-sm ${variant === 'dark' ? 'text-gray-400' : 'text-gray-600'} mb-1 block`}>
                    Description
                  </label>
                  <input
                    type="text"
                    value={description}
                    onChange={(e) => setDescription(e.target.value)}
                    placeholder="What's this payment for?"
                    className={`w-full p-3 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 ${getInputStyles()}`}
                  />
                </div>
                {amount && (
                  <motion.div
                    initial={{ opacity: 0, height: 0 }}
                    animate={{ opacity: 1, height: 'auto' }}
                    className="space-y-4"
                  >
                    <div className={`p-4 rounded-xl ${
                      variant === 'dark' ? 'bg-gray-800' : 'bg-gray-50'
                    }`}>
                      <div className="flex items-center justify-center mb-4">
                        <div className="p-8 bg-white rounded-2xl">
                          <QrCode className="w-32 h-32 text-gray-900" />
                        </div>
                      </div>
                      <div className={`text-xs ${
                        variant === 'dark' ? 'text-gray-400' : 'text-gray-500'
                      } text-center break-all`}>
                        lnbc{amount}n1pj9xyz...mockInvoice
                      </div>
                    </div>
                    <button
                      onClick={handleCopy}
                      className={`w-full py-3 rounded-xl font-medium transition-all flex items-center justify-center gap-2 ${
                        variant === 'gradient'
                          ? 'bg-white/20 text-white hover:bg-white/30'
                          : variant === 'dark'
                          ? 'bg-gray-800 text-white hover:bg-gray-700'
                          : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                      }`}
                    >
                      {copied ? (
                        <>
                          <Check className="w-4 h-4" />
                          <span>Copied!</span>
                        </>
                      ) : (
                        <>
                          <Copy className="w-4 h-4" />
                          <span>Copy Invoice</span>
                        </>
                      )}
                    </button>
                  </motion.div>
                )}
                {!amount && (
                  <motion.button
                    whileHover={{ scale: 1.02 }}
                    whileTap={{ scale: 0.98 }}
                    onClick={() => setAmount('1000')}
                    className={`w-full py-3 rounded-xl font-medium transition-all ${
                      variant === 'gradient'
                        ? 'bg-white text-purple-600 hover:bg-white/90'
                        : variant === 'dark'
                        ? 'bg-yellow-500 text-gray-900 hover:bg-yellow-400'
                        : 'bg-gray-900 text-white hover:bg-gray-800'
                    }`}
                  >
                    Generate Invoice
                  </motion.button>
                )}
              </div>
            )}
          </motion.div>
        </motion.div>
      )}
    </AnimatePresence>
  );
}
</file>

<file path="components/wallet/Wallet.tsx">
import { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { WalletBalance } from './WalletBalance';
import { MintConfiguration } from './MintConfiguration';
import { TransactionButton } from './TransactionButton';
import { QRScanner } from './QRScanner';
import { TransactionModal } from './TransactionModal';
import { Zap, History, MoreHorizontal } from 'lucide-react';
export type WalletVariant = 'minimal-light' | 'minimal-dark' | 'card-elegant' | 'gradient-modern' | 'compact';
interface WalletProps {
  variant?: WalletVariant;
}
export function Wallet({ variant = 'minimal-light' }: WalletProps) {
  const [balance] = useState(21000);
  const [showSendModal, setShowSendModal] = useState(false);
  const [showReceiveModal, setShowReceiveModal] = useState(false);
  const [showHistory, setShowHistory] = useState(false);
  const handleScan = (data: string) => {
    console.log('Scanned:', data);
    // Mock: Parse lightning invoice and open send modal
    setShowSendModal(true);
  };
  const handleSend = () => {
    setShowSendModal(true);
  };
  const handleReceive = () => {
    setShowReceiveModal(true);
  };
  // Minimal Light Variant (Default)
  if (variant === 'minimal-light') {
    return (
      <>
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          className="bg-white rounded-2xl p-6 shadow-sm border border-gray-100"
        >
          <div className="flex justify-between items-start mb-6">
            <h2 className="text-lg font-medium text-gray-900">Wallet</h2>
            <div className="flex items-center gap-2">
              <QRScanner onScan={handleScan} variant="minimal" />
              <MintConfiguration variant="minimal" />
            </div>
          </div>
          <WalletBalance amount={balance} variant="minimal" />
          <div className="flex gap-3 mt-6">
            <TransactionButton type="send" onClick={handleSend} variant="minimal" />
            <TransactionButton type="receive" onClick={handleReceive} variant="minimal" />
          </div>
          <button
            onClick={() => setShowHistory(!showHistory)}
            className="w-full mt-4 text-sm text-gray-500 hover:text-gray-700 transition-colors"
          >
            View History
          </button>
        </motion.div>
        <TransactionModal
          type="send"
          isOpen={showSendModal}
          onClose={() => setShowSendModal(false)}
          balance={balance}
        />
        <TransactionModal
          type="receive"
          isOpen={showReceiveModal}
          onClose={() => setShowReceiveModal(false)}
          balance={balance}
        />
      </>
    );
  }
  // Minimal Dark Variant
  if (variant === 'minimal-dark') {
    return (
      <>
        <motion.div
          initial={{ opacity: 0, scale: 0.95 }}
          animate={{ opacity: 1, scale: 1 }}
          className="bg-gray-900 rounded-3xl p-8 shadow-2xl"
        >
          <div className="flex justify-between items-center mb-8">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-yellow-500 rounded-full flex items-center justify-center">
                <Zap className="w-5 h-5 text-gray-900" />
              </div>
              <h2 className="text-white font-light text-xl">Lightning Wallet</h2>
            </div>
            <button className="p-2 hover:bg-gray-800 rounded-lg transition-colors">
              <MoreHorizontal className="w-5 h-5 text-gray-400" />
            </button>
          </div>
          <div className="text-center mb-8">
            <div className="text-5xl font-thin text-white mb-2">
              {balance.toLocaleString()}
            </div>
            <div className="text-gray-400 text-sm">satoshis</div>
          </div>
          <div className="grid grid-cols-2 gap-4 mb-6">
            <motion.button
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
              onClick={handleSend}
              className="py-4 bg-yellow-500 text-gray-900 rounded-xl font-medium hover:bg-yellow-400 transition-colors"
            >
              Send
            </motion.button>
            <motion.button
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
              onClick={handleReceive}
              className="py-4 bg-gray-800 text-white rounded-xl font-medium hover:bg-gray-700 transition-colors"
            >
              Receive
            </motion.button>
          </div>
          <div className="flex items-center justify-between pt-6 border-t border-gray-800">
            <button
              onClick={() => setShowHistory(!showHistory)}
              className="flex items-center gap-2 text-gray-400 hover:text-gray-300 text-sm"
            >
              <History className="w-4 h-4" />
              <span>History</span>
            </button>
            <button className="text-gray-400 hover:text-gray-300 text-sm">
              Settings
            </button>
          </div>
        </motion.div>
        <TransactionModal
          type="send"
          isOpen={showSendModal}
          onClose={() => setShowSendModal(false)}
          balance={balance}
          variant="dark"
        />
        <TransactionModal
          type="receive"
          isOpen={showReceiveModal}
          onClose={() => setShowReceiveModal(false)}
          balance={balance}
          variant="dark"
        />
      </>
    );
  }
  // Card Elegant Variant
  if (variant === 'card-elegant') {
    return (
      <>
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ type: "spring", stiffness: 200, damping: 20 }}
          className="max-w-md mx-auto"
        >
          <motion.div
            className="bg-gradient-to-br from-white to-gray-50 rounded-3xl p-8 shadow-xl border border-gray-100"
            whileHover={{ y: -5 }}
            transition={{ type: "spring", stiffness: 300 }}
          >
            <div className="flex items-center justify-between mb-8">
              <div className="flex items-center gap-3">
                <div className="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                  <Zap className="w-6 h-6 text-white" />
                </div>
                <div>
                  <h2 className="text-xl font-semibold text-gray-900">NIP-60 Wallet</h2>
                  <p className="text-xs text-gray-500">Lightning Network</p>
                </div>
              </div>
            </div>
            <WalletBalance amount={balance} variant="detailed" showChange changeAmount={2500} />
            <div className="mt-8 space-y-4">
              <MintConfiguration variant="detailed" />
              <QRScanner onScan={handleScan} variant="detailed" />
            </div>
            <div className="flex gap-4 mt-8">
              <TransactionButton type="send" onClick={handleSend} variant="detailed" />
              <TransactionButton type="receive" onClick={handleReceive} variant="detailed" />
            </div>
            <div className="mt-8 pt-6 border-t border-gray-200">
              <button
                onClick={() => setShowHistory(!showHistory)}
                className="w-full flex items-center justify-center gap-2 text-sm text-gray-600 hover:text-gray-900 transition-colors"
              >
                <History className="w-4 h-4" />
                <span>Transaction History</span>
              </button>
            </div>
          </motion.div>
        </motion.div>
        <TransactionModal
          type="send"
          isOpen={showSendModal}
          onClose={() => setShowSendModal(false)}
          balance={balance}
        />
        <TransactionModal
          type="receive"
          isOpen={showReceiveModal}
          onClose={() => setShowReceiveModal(false)}
          balance={balance}
        />
      </>
    );
  }
  // Gradient Modern Variant
  if (variant === 'gradient-modern') {
    return (
      <>
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          className="relative overflow-hidden rounded-3xl"
        >
          {/* Animated gradient background */}
          <div className="absolute inset-0 bg-gradient-to-br from-purple-600 via-pink-500 to-orange-500">
            <motion.div
              className="absolute inset-0 bg-gradient-to-tr from-blue-600/30 via-purple-600/30 to-pink-600/30"
              animate={{
                x: [0, 100, 0],
                y: [0, -100, 0],
              }}
              transition={{
                duration: 20,
                repeat: Infinity,
                ease: "linear"
              }}
            />
          </div>
          <div className="relative backdrop-blur-sm bg-white/10 p-8">
            <div className="text-center mb-8">
              <motion.div
                initial={{ scale: 0 }}
                animate={{ scale: 1 }}
                transition={{ type: "spring", stiffness: 200, delay: 0.2 }}
                className="inline-block"
              >
                <div className="text-6xl font-bold text-white mb-2">
                  {balance.toLocaleString()}
                </div>
                <div className="text-white/80 text-sm uppercase tracking-wide">Satoshis</div>
              </motion.div>
            </div>
            <div className="grid grid-cols-3 gap-3 mb-8">
              <motion.button
                whileHover={{ scale: 1.05 }}
                whileTap={{ scale: 0.95 }}
                onClick={handleSend}
                className="bg-white/20 backdrop-blur-md text-white p-4 rounded-2xl hover:bg-white/30 transition-all"
              >
                <Zap className="w-6 h-6 mx-auto mb-2" />
                <div className="text-xs">Zap</div>
              </motion.button>
              <motion.button
                whileHover={{ scale: 1.05 }}
                whileTap={{ scale: 0.95 }}
                onClick={handleSend}
                className="bg-white/20 backdrop-blur-md text-white p-4 rounded-2xl hover:bg-white/30 transition-all"
              >
                <History className="w-6 h-6 mx-auto mb-2" />
                <div className="text-xs">History</div>
              </motion.button>
              <motion.button
                whileHover={{ scale: 1.05 }}
                whileTap={{ scale: 0.95 }}
                onClick={() => {}}
                className="bg-white/20 backdrop-blur-md text-white p-4 rounded-2xl hover:bg-white/30 transition-all"
              >
                <MoreHorizontal className="w-6 h-6 mx-auto mb-2" />
                <div className="text-xs">More</div>
              </motion.button>
            </div>
            <div className="flex gap-3">
              <motion.button
                whileHover={{ scale: 1.02 }}
                whileTap={{ scale: 0.98 }}
                onClick={handleSend}
                className="flex-1 py-4 bg-white text-purple-600 rounded-2xl font-semibold hover:bg-white/90 transition-all"
              >
                Send
              </motion.button>
              <motion.button
                whileHover={{ scale: 1.02 }}
                whileTap={{ scale: 0.98 }}
                onClick={handleReceive}
                className="flex-1 py-4 bg-white/20 backdrop-blur-md text-white rounded-2xl font-semibold hover:bg-white/30 transition-all"
              >
                Receive
              </motion.button>
            </div>
          </div>
        </motion.div>
        <TransactionModal
          type="send"
          isOpen={showSendModal}
          onClose={() => setShowSendModal(false)}
          balance={balance}
          variant="gradient"
        />
        <TransactionModal
          type="receive"
          isOpen={showReceiveModal}
          onClose={() => setShowReceiveModal(false)}
          balance={balance}
          variant="gradient"
        />
      </>
    );
  }
  // Compact Variant
  if (variant === 'compact') {
    return (
      <>
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          className="bg-white rounded-xl p-4 shadow-sm border border-gray-100"
        >
          <div className="flex items-center justify-between">
            <WalletBalance amount={balance} variant="compact" />
            <div className="flex gap-2">
              <TransactionButton type="send" onClick={handleSend} variant="icon" />
              <TransactionButton type="receive" onClick={handleReceive} variant="icon" />
            </div>
          </div>
        </motion.div>
        <TransactionModal
          type="send"
          isOpen={showSendModal}
          onClose={() => setShowSendModal(false)}
          balance={balance}
        />
        <TransactionModal
          type="receive"
          isOpen={showReceiveModal}
          onClose={() => setShowReceiveModal(false)}
          balance={balance}
        />
      </>
    );
  }
  return null;
}
</file>

<file path="components/wallet/WalletBalance.tsx">
import { useState, useEffect } from 'react';
import { motion } from 'framer-motion';
interface WalletBalanceProps {
  amount: number;
  unit?: string;
  showChange?: boolean;
  changeAmount?: number;
  variant?: 'minimal' | 'detailed' | 'compact';
}
export function WalletBalance({
  amount,
  unit = 'sats',
  showChange = false,
  changeAmount = 0,
  variant = 'minimal'
}: WalletBalanceProps) {
  const [displayAmount, setDisplayAmount] = useState(0);
  useEffect(() => {
    // Animate balance changes
    const timer = setTimeout(() => {
      setDisplayAmount(amount);
    }, 100);
    return () => clearTimeout(timer);
  }, [amount]);
  const formatAmount = (value: number) => {
    return new Intl.NumberFormat('en-US').format(value);
  };
  const isPositiveChange = changeAmount > 0;
  if (variant === 'compact') {
    return (
      <div className="flex items-baseline gap-1">
        <span className="text-2xl font-light text-gray-900">{formatAmount(displayAmount)}</span>
        <span className="text-sm text-gray-500">{unit}</span>
      </div>
    );
  }
  if (variant === 'detailed') {
    return (
      <div className="space-y-2">
        <div className="flex items-end gap-2">
          <motion.span
            key={displayAmount}
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            className="text-5xl font-thin text-gray-900"
          >
            {formatAmount(displayAmount)}
          </motion.span>
          <span className="text-lg text-gray-600 mb-2">{unit}</span>
        </div>
        {showChange && changeAmount !== 0 && (
          <motion.div
            initial={{ opacity: 0, x: -10 }}
            animate={{ opacity: 1, x: 0 }}
            className={`text-sm ${isPositiveChange ? 'text-green-600' : 'text-red-600'}`}
          >
            <span>{isPositiveChange ? '+' : '-'}</span>
            <span>{formatAmount(Math.abs(changeAmount))}</span>
            <span className="text-xs ml-1">today</span>
          </motion.div>
        )}
      </div>
    );
  }
  // Minimal variant (default)
  return (
    <div className="text-center">
      <motion.div
        key={displayAmount}
        initial={{ scale: 0.95, opacity: 0 }}
        animate={{ scale: 1, opacity: 1 }}
        transition={{ type: "spring", stiffness: 300, damping: 25 }}
        className="text-4xl font-light text-gray-900"
      >
        {formatAmount(displayAmount)}
      </motion.div>
      <div className="text-sm text-gray-500 mt-1">{unit}</div>
    </div>
  );
}
</file>

<file path="components/wallet/WalletBalanceBadge.tsx">
import { useState } from 'react';
import { motion } from 'framer-motion';
import { Zap } from 'lucide-react';
import { useNavigate } from 'react-router-dom';
export function WalletBalanceBadge() {
  const [balance] = useState(21000);
  const navigate = useNavigate();
  const handleClick = () => {
    navigate('/wallet');
  };
  return (
    <motion.button
      onClick={handleClick}
      whileHover={{ scale: 1.05 }}
      whileTap={{ scale: 0.95 }}
      className="flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-950/30 dark:to-orange-950/30 rounded-full border border-yellow-200 dark:border-yellow-800/50 transition-all hover:shadow-md"
    >
      <div className="w-5 h-5 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center">
        <Zap className="w-3 h-3 text-white" />
      </div>
      <span className="text-sm font-medium text-gray-900 dark:text-gray-100">
        {balance.toLocaleString()}
      </span>
      <span className="text-xs text-gray-500 dark:text-gray-400">sats</span>
    </motion.button>
  );
}
</file>

<file path="components/wallet/WalletIntegration.tsx">
import { useState } from 'react';
import { motion } from 'framer-motion';
import { Zap, CheckCircle, XCircle } from 'lucide-react';
import { Wallet } from './Wallet';
/**
 * Example integration showing how to use the Wallet component
 * with mock NIP-60 functionality for zapping
 */
export function WalletIntegration() {
  const [zapHistory, setZapHistory] = useState<Array<{
    id: string;
    amount: number;
    recipient: string;
    timestamp: Date;
    status: 'success' | 'failed';
  }>>([]);
  // Mock function to handle zap sending
  const handleZap = (recipient: string, amount: number) => {
    const newZap = {
      id: Date.now().toString(),
      amount,
      recipient,
      timestamp: new Date(),
      status: 'success' as const
    };
    setZapHistory(prev => [newZap, ...prev]);
    // Here you would integrate with actual NIP-60 implementation
    console.log('Zap sent:', { recipient, amount });
  };
  return (
    <div className="space-y-6">
      {/* Main Wallet Component */}
      <Wallet variant="minimal-light" />
      {/* Example Zap Interface */}
      <div className="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
        <h3 className="text-lg font-medium text-gray-900 mb-4">Quick Zap</h3>
        <div className="space-y-4">
          {/* Quick Zap Buttons */}
          <div className="flex gap-2">
            {[100, 500, 1000, 5000].map(amount => (
              <motion.button
                key={amount}
                whileHover={{ scale: 1.05 }}
                whileTap={{ scale: 0.95 }}
                onClick={() => handleZap('npub1...example', amount)}
                className="flex-1 px-3 py-2 bg-gray-50 hover:bg-gray-100 rounded-lg text-sm font-medium text-gray-700 transition-colors"
              >
                <Zap className="w-4 h-4 inline mr-1" />
                {amount}
              </motion.button>
            ))}
          </div>
          {/* Recent Zaps */}
          {zapHistory.length > 0 && (
            <div className="space-y-2 mt-6">
              <h4 className="text-sm font-medium text-gray-600">Recent Zaps</h4>
              {zapHistory.slice(0, 3).map(zap => (
                <motion.div
                  key={zap.id}
                  initial={{ opacity: 0, x: -10 }}
                  animate={{ opacity: 1, x: 0 }}
                  className="flex items-center justify-between p-3 bg-gray-50 rounded-lg"
                >
                  <div className="flex items-center gap-3">
                    {zap.status === 'success' ? (
                      <CheckCircle className="w-4 h-4 text-green-500" />
                    ) : (
                      <XCircle className="w-4 h-4 text-red-500" />
                    )}
                    <div>
                      <div className="text-sm font-medium text-gray-700">
                        {zap.amount} sats
                      </div>
                      <div className="text-xs text-gray-500">
                        {zap.recipient.slice(0, 16)}...
                      </div>
                    </div>
                  </div>
                  <div className="text-xs text-gray-400">
                    {zap.timestamp.toLocaleTimeString()}
                  </div>
                </motion.div>
              ))}
            </div>
          )}
        </div>
      </div>
      {/* Integration Notes */}
      <div className="bg-blue-50 border border-blue-200 rounded-xl p-4">
        <h4 className="text-sm font-medium text-blue-900 mb-2">NIP-60 Integration</h4>
        <ul className="text-xs text-blue-700 space-y-1">
          <li>‚Ä¢ Connect to Cashu mints using NIP-60 protocol</li>
          <li>‚Ä¢ Generate Lightning invoices for receiving</li>
          <li>‚Ä¢ Scan QR codes or paste invoices for sending</li>
          <li>‚Ä¢ Track balance across multiple mints</li>
          <li>‚Ä¢ Mock functionality ready for real implementation</li>
        </ul>
      </div>
    </div>
  );
}
</file>

<file path="components/wallet/WalletWidget.tsx">
import { useState } from 'react';
import { motion } from 'framer-motion';
import { Zap, Send, Download } from 'lucide-react';
import { Link } from 'react-router-dom';
export function WalletWidget() {
  const [balance] = useState(21000);
  return (
    <Link to="/wallet">
      <motion.div
        whileHover={{ scale: 1.02 }}
        className="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-950/30 dark:to-pink-950/30 p-4 rounded-xl cursor-pointer transition-all hover:shadow-md"
      >
        <div className="flex items-center justify-between mb-3">
          <div className="flex items-center gap-2">
            <div className="w-8 h-8 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg flex items-center justify-center">
              <Zap className="w-4 h-4 text-white" />
            </div>
            <span className="text-sm font-medium text-gray-700 dark:text-gray-300">Wallet</span>
          </div>
        </div>
        <div className="mb-3">
          <div className="text-2xl font-light text-gray-900 dark:text-gray-100">
            {balance.toLocaleString()}
          </div>
          <div className="text-xs text-gray-500 dark:text-gray-400">sats available</div>
        </div>
        <div className="flex gap-2">
          <button
            onClick={(e) => {
              e.preventDefault();
              e.stopPropagation();
              // Quick send action
            }}
            className="flex-1 flex items-center justify-center gap-1 py-1.5 bg-white dark:bg-gray-800 rounded-lg text-xs font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
          >
            <Send className="w-3 h-3" />
            Send
          </button>
          <button
            onClick={(e) => {
              e.preventDefault();
              e.stopPropagation();
              // Quick receive action
            }}
            className="flex-1 flex items-center justify-center gap-1 py-1.5 bg-white dark:bg-gray-800 rounded-lg text-xs font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
          >
            <Download className="w-3 h-3" />
            Receive
          </button>
        </div>
      </motion.div>
    </Link>
  );
}
</file>

<file path="components/wallet/ZapButton.tsx">
import { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Zap } from 'lucide-react';
import { cn } from '@/lib/utils';
interface ZapButtonProps {
  eventId: string;
  authorPubkey: string;
  initialZapCount?: number;
  size?: 'sm' | 'md';
  onZap?: (amount: number) => void;
}
export function ZapButton({
  eventId,
  authorPubkey,
  initialZapCount = 0,
  size = 'sm',
  onZap
}: ZapButtonProps) {
  const [showAmounts, setShowAmounts] = useState(false);
  const [zapCount, setZapCount] = useState(initialZapCount);
  const [isZapping, setIsZapping] = useState(false);
  const [lastZapAmount, setLastZapAmount] = useState<number | null>(null);
  const quickZapAmounts = [21, 100, 500, 1000];
  const handleZap = async (amount: number) => {
    setIsZapping(true);
    setLastZapAmount(amount);
    // Mock zap action
    setTimeout(() => {
      setZapCount(prev => prev + 1);
      setIsZapping(false);
      setShowAmounts(false);
      onZap?.(amount);
      // Clear the animation after a moment
      setTimeout(() => setLastZapAmount(null), 2000);
    }, 500);
  };
  return (
    <div className="relative">
      <button
        onClick={() => setShowAmounts(!showAmounts)}
        className={cn(
          "group flex items-center gap-2 p-2 rounded-full transition-all",
          zapCount > 0
            ? "text-yellow-600 dark:text-yellow-500"
            : "hover:bg-yellow-50 dark:hover:bg-yellow-950/30",
          size === 'md' && "p-3"
        )}
      >
        <motion.div
          animate={isZapping ? { rotate: 360 } : {}}
          transition={{ duration: 0.5 }}
        >
          <Zap
            className={cn(
              "transition-all",
              size === 'md' ? "w-5 h-5" : "w-4 h-4",
              zapCount > 0
                ? "fill-current text-yellow-600 dark:text-yellow-500"
                : "text-gray-500 group-hover:text-yellow-600 dark:text-gray-400 dark:group-hover:text-yellow-500"
            )}
          />
        </motion.div>
        {zapCount > 0 && (
          <span className={cn(
            "font-medium",
            size === 'md' ? "text-base" : "text-sm",
            "text-yellow-600 dark:text-yellow-500"
          )}>
            {zapCount}
          </span>
        )}
      </button>
      {/* Floating zap amount indicator */}
      <AnimatePresence>
        {lastZapAmount && (
          <motion.div
            initial={{ opacity: 0, y: 0, scale: 0.8 }}
            animate={{ opacity: 1, y: -30, scale: 1 }}
            exit={{ opacity: 0, y: -50, scale: 0.8 }}
            className="absolute left-1/2 -translate-x-1/2 pointer-events-none"
          >
            <div className="bg-yellow-500 text-white text-xs px-2 py-1 rounded-full font-bold whitespace-nowrap">
              +{lastZapAmount} ‚ö°
            </div>
          </motion.div>
        )}
      </AnimatePresence>
      {/* Quick zap amounts */}
      <AnimatePresence>
        {showAmounts && (
          <>
            {/* Backdrop to close on click outside */}
            <div
              className="fixed inset-0 z-10"
              onClick={() => setShowAmounts(false)}
            />
            <motion.div
              initial={{ opacity: 0, scale: 0.9, y: 5 }}
              animate={{ opacity: 1, scale: 1, y: 0 }}
              exit={{ opacity: 0, scale: 0.9, y: 5 }}
              className="absolute bottom-full left-0 mb-2 z-20"
            >
              <div className="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-2 flex gap-1">
                {quickZapAmounts.map((amount) => (
                  <motion.button
                    key={amount}
                    whileHover={{ scale: 1.1 }}
                    whileTap={{ scale: 0.95 }}
                    onClick={(e) => {
                      e.stopPropagation();
                      handleZap(amount);
                    }}
                    disabled={isZapping}
                    className="px-3 py-2 bg-gray-50 dark:bg-gray-700 hover:bg-yellow-50 dark:hover:bg-yellow-900/30 rounded-lg transition-colors disabled:opacity-50"
                  >
                    <div className="flex items-center gap-1">
                      <Zap className="w-3 h-3 text-yellow-600 dark:text-yellow-500" />
                      <span className="text-sm font-medium text-gray-700 dark:text-gray-300">
                        {amount}
                      </span>
                    </div>
                  </motion.button>
                ))}
              </div>
            </motion.div>
          </>
        )}
      </AnimatePresence>
    </div>
  );
}
</file>

<file path="config/ndk.ts">
// This file is now deprecated as all NDK functionality is provided by ndk-hooks
// Keeping it only for reference if needed during migration
import { NDKNip07Signer, NDKPrivateKeySigner } from '@nostr-dev-kit/ndk-hooks';
// Default relay configuration (moved to NDKContext.tsx)
export const defaultRelays = [
  'wss://relay.damus.io',
  'wss://relay.nostr.band',
  'wss://nos.lol',
  'wss://relay.snort.social',
  'wss://relay.primal.net'
];
// Helper to get signer based on available auth method (deprecated - use session hooks instead)
export async function getSigner(): Promise<NDKPrivateKeySigner | NDKNip07Signer | null> {
  // Check for NIP-07 extension (like Alby, nos2x, etc.)
  if (window.nostr) {
    return new NDKNip07Signer();
  }
  // Check for stored private key (for demo purposes - in production use secure storage)
  const privateKey = localStorage.getItem('nostr_private_key');
  if (privateKey) {
    return new NDKPrivateKeySigner(privateKey);
  }
  return null;
}
</file>

<file path="features/auth/LoginButton.tsx">
import { useState } from 'react';
import { 
  useNDKCurrentUser,
  useNDKSessionLogin,
  useNDKSessionLogout,
  NDKNip07Signer,
  NDKPrivateKeySigner
} from '@nostr-dev-kit/ndk-hooks';
import { Button } from '@/components/ui/button';
import { User, LogOut, Key, Sparkles } from 'lucide-react';
export function LoginButton() {
  const currentUser = useNDKCurrentUser();
  const login = useNDKSessionLogin();
  const logout = useNDKSessionLogout();
  const [showOptions, setShowOptions] = useState(false);
  const [nsec, setNsec] = useState('');
  const [showNsecInput, setShowNsecInput] = useState(false);
  const [isConnecting, setIsConnecting] = useState(false);
  const handleExtensionLogin = async () => {
    setIsConnecting(true);
    try {
      if (!window.nostr) {
        throw new Error('No Nostr extension found. Please install Alby or nos2x.');
      }
      const signer = new NDKNip07Signer();
      await login(signer, true);
      setShowOptions(false);
    } catch (error) {
      console.error('Extension login failed:', error);
      alert(error instanceof Error ? error.message : 'Extension login failed');
    } finally {
      setIsConnecting(false);
    }
  };
  const handlePrivateKeyLogin = async () => {
    if (!nsec) return;
    setIsConnecting(true);
    try {
      const signer = new NDKPrivateKeySigner(nsec);
      await login(signer, true);
      localStorage.setItem('nostr_private_key', nsec);
      setNsec('');
      setShowNsecInput(false);
      setShowOptions(false);
    } catch (error) {
      console.error('Private key login failed:', error);
      alert('Invalid private key');
    } finally {
      setIsConnecting(false);
    }
  };
  const handleGenerateIdentity = async () => {
    setIsConnecting(true);
    try {
      const signer = NDKPrivateKeySigner.generate();
      await login(signer, true);
      const privateKey = signer.privateKey!;
      localStorage.setItem('nostr_private_key', privateKey);
      const user = await signer.user();
      alert(`New identity created!\nnpub: ${user.npub}\nnsec: ${privateKey}\n\nIMPORTANT: Save your nsec somewhere safe!`);
      setShowOptions(false);
    } catch (error) {
      console.error('Failed to generate identity:', error);
      alert('Failed to generate new identity');
    } finally {
      setIsConnecting(false);
    }
  };
  const handleLogout = () => {
    logout();
    localStorage.removeItem('nostr_private_key');
  };
  if (currentUser) {
    return (
      <div className="flex items-center gap-4">
        <button
          onClick={handleLogout}
          className="px-4 py-2 rounded-full bg-gray-100 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 transition-colors text-sm font-medium flex items-center gap-2"
        >
          <LogOut className="w-4 h-4" />
          <span className="hidden sm:inline">Logout</span>
        </button>
      </div>
    );
  }
  if (showOptions) {
    return (
      <div className="flex flex-col gap-2">
        <Button
          onClick={handleExtensionLogin}
          disabled={isConnecting}
          variant="default"
          size="sm"
        >
          <User className="w-4 h-4 mr-2" />
          Login with Extension
        </Button>
        {showNsecInput ? (
          <div className="flex gap-2">
            <input
              type="password"
              placeholder="Enter nsec or hex key"
              value={nsec}
              onChange={(e) => setNsec(e.target.value)}
              className="px-3 py-1 border rounded text-sm"
              disabled={isConnecting}
            />
            <Button
              onClick={handlePrivateKeyLogin}
              disabled={!nsec || isConnecting}
              size="sm"
              variant="outline"
            >
              Login
            </Button>
          </div>
        ) : (
          <Button
            onClick={() => setShowNsecInput(true)}
            disabled={isConnecting}
            variant="outline"
            size="sm"
          >
            <Key className="w-4 h-4 mr-2" />
            Login with Private Key
          </Button>
        )}
        <Button
          onClick={handleGenerateIdentity}
          disabled={isConnecting}
          variant="outline"
          size="sm"
        >
          <Sparkles className="w-4 h-4 mr-2" />
          Generate New Identity
        </Button>
        <Button
          onClick={() => {
            setShowOptions(false);
            setShowNsecInput(false);
            setNsec('');
          }}
          variant="ghost"
          size="sm"
          disabled={isConnecting}
        >
          Cancel
        </Button>
      </div>
    );
  }
  return (
    <button
      onClick={() => setShowOptions(true)}
      disabled={isConnecting}
      className="px-4 py-2 rounded-full bg-purple-600 hover:bg-purple-700 dark:bg-purple-500 dark:hover:bg-purple-600 text-white transition-colors text-sm font-medium flex items-center gap-2"
    >
      <User className="w-4 h-4" />
      <span className="hidden sm:inline">{isConnecting ? 'Connecting...' : 'Login with Nostr'}</span>
      <span className="sm:hidden">{isConnecting ? '...' : 'Login'}</span>
    </button>
  );
}
</file>

<file path="features/classifieds/components/CategorySection.tsx">
import { ChevronRight } from 'lucide-react';
import { Link } from 'react-router-dom';
import type { ClassifiedListing } from '../types';
import { ListingCard } from './ListingCard';
interface CategorySectionProps {
  category: string;
  listings: ClassifiedListing[];
  showViewAll?: boolean;
}
export function CategorySection({ category, listings, showViewAll = true }: CategorySectionProps) {
  if (listings.length === 0) return null;
  const displayName = category.charAt(0).toUpperCase() + category.slice(1).replace('-', ' ');
  return (
    <section className="mb-8">
      <div className="flex items-center justify-between mb-4">
        <h2 className="text-xl font-semibold text-gray-900 dark:text-white">
          {displayName}
        </h2>
        {showViewAll && listings.length > 4 && (
          <Link
            to={`/marketplace?category=${category}`}
            className="flex items-center gap-1 text-sm text-purple-600 hover:text-purple-700 dark:text-purple-400 dark:hover:text-purple-300"
          >
            View All
            <ChevronRight className="w-4 h-4" />
          </Link>
        )}
      </div>
      <div className="relative">
        <div className="flex gap-4 overflow-x-auto scrollbar-hide pb-2">
          {listings.slice(0, 10).map((listing) => (
            <div
              key={listing.id}
              className="flex-none w-72 sm:w-80"
            >
              <ListingCard listing={listing} />
            </div>
          ))}
        </div>
      </div>
    </section>
  );
}
</file>

<file path="features/classifieds/components/FilterButton.tsx">
import { useState } from 'react';
import { Filter, X } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { motion, AnimatePresence } from 'framer-motion';
interface FilterButtonProps {
  categories: { value: string; label: string }[];
  selectedCategory: string;
  onCategoryChange: (category: string) => void;
}
export function FilterButton({ categories, selectedCategory, onCategoryChange }: FilterButtonProps) {
  const [isOpen, setIsOpen] = useState(false);
  const handleCategorySelect = (value: string) => {
    onCategoryChange(value);
    setIsOpen(false);
  };
  return (
    <div className="relative">
      <Button
        variant="outline"
        size="sm"
        onClick={() => setIsOpen(!isOpen)}
        className="flex items-center gap-2"
      >
        <Filter className="w-4 h-4" />
        {selectedCategory ? categories.find(c => c.value === selectedCategory)?.label : 'Filter'}
      </Button>
      <AnimatePresence>
        {isOpen && (
          <>
            {/* Backdrop */}
            <motion.div
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              exit={{ opacity: 0 }}
              className="fixed inset-0 z-40"
              onClick={() => setIsOpen(false)}
            />
            {/* Dropdown */}
            <motion.div
              initial={{ opacity: 0, y: -10 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: -10 }}
              className="absolute right-0 mt-2 w-56 bg-white dark:bg-gray-950 rounded-lg shadow-lg border border-gray-200 dark:border-gray-800 z-50"
            >
              <div className="p-2">
                {selectedCategory && (
                  <button
                    onClick={() => handleCategorySelect('')}
                    className="w-full flex items-center justify-between px-3 py-2 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-900 mb-1"
                  >
                    <span>Clear Filter</span>
                    <X className="w-4 h-4" />
                  </button>
                )}
                {categories.map(category => (
                  <button
                    key={category.value}
                    onClick={() => handleCategorySelect(category.value)}
                    className={`w-full text-left px-3 py-2 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-gray-900 ${
                      selectedCategory === category.value
                        ? 'bg-purple-50 text-purple-700 dark:bg-purple-950/50 dark:text-purple-400'
                        : ''
                    }`}
                  >
                    {category.label}
                  </button>
                ))}
              </div>
            </motion.div>
          </>
        )}
      </AnimatePresence>
    </div>
  );
}
</file>

<file path="features/classifieds/components/ListingCard.tsx">
import { Link } from 'react-router-dom';
import { MapPin, Clock } from 'lucide-react';
import { Card } from '@/components/ui/card';
import { UserAvatar } from '@/components/ui/UserAvatar';
import type { ClassifiedListing } from '../types';
import { PriceTag } from './PriceTag';
import { formatDistanceToNow } from 'date-fns';
interface ListingCardProps {
  listing: ClassifiedListing;
}
export function ListingCard({ listing }: ListingCardProps) {
  const mainImage = listing.images?.[0];
  const timeAgo = listing.publishedAt
    ? formatDistanceToNow(new Date(listing.publishedAt * 1000), { addSuffix: true })
    : 'recently';
  return (
    <Link to={`/marketplace/${listing.id}`}>
      <Card className="hover:shadow-xl transition-all duration-200 cursor-pointer h-full overflow-hidden group">
        {/* Image Section */}
        <div className="aspect-[4/3] relative overflow-hidden bg-gray-100 dark:bg-gray-900">
          {mainImage ? (
            <>
              <img
                src={mainImage}
                alt={listing.title}
                className="object-cover w-full h-full group-hover:scale-105 transition-transform duration-300"
                loading="lazy"
              />
              {listing.status === 'sold' && (
                <div className="absolute inset-0 bg-black/60 flex items-center justify-center backdrop-blur-sm">
                  <span className="text-white font-bold text-xl rotate-12 border-4 border-white px-3 py-1 rounded">
                    SOLD
                  </span>
                </div>
              )}
            </>
          ) : (
            <div className="w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-600">
              <svg className="w-16 h-16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
            </div>
          )}
        </div>
        {/* Content Section */}
        <div className="p-4 space-y-3">
          {/* Price - Most prominent */}
          {listing.price && (
            <div className="flex justify-between items-start">
              <span className="text-2xl font-bold text-gray-900 dark:text-white">
                {listing.price.currency === 'SATS' ? (
                  <span className="text-orange-500">{listing.price.amount} SATS</span>
                ) : (
                  <span>
                    {listing.price.currency === 'USD' && '$'}
                    {listing.price.currency === 'EUR' && '‚Ç¨'}
                    {listing.price.currency === 'GBP' && '¬£'}
                    {listing.price.amount}
                    {!['USD', 'EUR', 'GBP'].includes(listing.price.currency) && ` ${listing.price.currency}`}
                  </span>
                )}
                {listing.price.frequency && listing.price.frequency !== 'once' && (
                  <span className="text-sm font-normal text-gray-500 dark:text-gray-400">
                    /{listing.price.frequency}
                  </span>
                )}
              </span>
            </div>
          )}
          {/* Title */}
          <h3 className="font-semibold text-base text-gray-900 dark:text-white line-clamp-2 leading-tight">
            {listing.title}
          </h3>
          {/* Summary - if exists */}
          {listing.summary && (
            <p className="text-sm text-gray-600 dark:text-gray-400 line-clamp-2">
              {listing.summary}
            </p>
          )}
          {/* Metadata */}
          <div className="flex items-center gap-3 text-xs text-gray-500 dark:text-gray-500">
            {listing.location && (
              <div className="flex items-center gap-1">
                <MapPin className="w-3 h-3" />
                <span className="truncate">{listing.location}</span>
              </div>
            )}
            <div className="flex items-center gap-1">
              <Clock className="w-3 h-3" />
              <span>{timeAgo}</span>
            </div>
          </div>
          {/* Seller Info */}
          <div className="pt-3 border-t border-gray-100 dark:border-gray-800 flex items-center gap-2">
            <UserAvatar pubkey={listing.author} size="xs" />
            <span className="text-xs text-gray-500 dark:text-gray-400">
              Posted by
            </span>
          </div>
        </div>
      </Card>
    </Link>
  );
}
</file>

<file path="features/classifieds/components/ListingForm.tsx">
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Plus, X, ImagePlus } from 'lucide-react';
import type { ListingFormData, PriceFrequency } from '../types';
interface ListingFormProps {
  onSubmit: (data: ListingFormData) => Promise<void>;
  initialData?: Partial<ListingFormData>;
  isSubmitting?: boolean;
}
const COMMON_CATEGORIES = [
  'electronics',
  'furniture',
  'clothing',
  'books',
  'services',
  'vehicles',
  'real-estate',
  'jobs',
  'free',
  'wanted'
];
const CURRENCIES = ['USD', 'EUR', 'GBP', 'BTC', 'SATS'];
export function ListingForm({ onSubmit, initialData, isSubmitting }: ListingFormProps) {
  const navigate = useNavigate();
  const [formData, setFormData] = useState<ListingFormData>({
    title: initialData?.title || '',
    summary: initialData?.summary || '',
    content: initialData?.content || '',
    location: initialData?.location || '',
    price: initialData?.price || { amount: '', currency: 'USD' },
    categories: initialData?.categories || [],
    images: initialData?.images || []
  });
  const [newCategory, setNewCategory] = useState('');
  const [newImageUrl, setNewImageUrl] = useState('');
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    await onSubmit(formData);
  };
  const addCategory = () => {
    if (newCategory && !formData.categories.includes(newCategory)) {
      setFormData(prev => ({
        ...prev,
        categories: [...prev.categories, newCategory.toLowerCase()]
      }));
      setNewCategory('');
    }
  };
  const removeCategory = (category: string) => {
    setFormData(prev => ({
      ...prev,
      categories: prev.categories.filter(c => c !== category)
    }));
  };
  const addImage = () => {
    if (newImageUrl && !formData.images.includes(newImageUrl)) {
      setFormData(prev => ({
        ...prev,
        images: [...prev.images, newImageUrl]
      }));
      setNewImageUrl('');
    }
  };
  const removeImage = (image: string) => {
    setFormData(prev => ({
      ...prev,
      images: prev.images.filter(i => i !== image)
    }));
  };
  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      <Card>
        <CardHeader>
          <CardTitle>Listing Details</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div>
            <Label htmlFor="title">Title *</Label>
            <Input
              id="title"
              value={formData.title}
              onChange={(e) => setFormData(prev => ({ ...prev, title: e.target.value }))}
              placeholder="What are you listing?"
              required
              className="mt-1"
            />
          </div>
          <div>
            <Label htmlFor="summary">Summary</Label>
            <Input
              id="summary"
              value={formData.summary}
              onChange={(e) => setFormData(prev => ({ ...prev, summary: e.target.value }))}
              placeholder="Brief description"
              className="mt-1"
            />
          </div>
          <div>
            <Label htmlFor="content">Description *</Label>
            <Textarea
              id="content"
              value={formData.content}
              onChange={(e) => setFormData(prev => ({ ...prev, content: e.target.value }))}
              placeholder="Detailed description (Markdown supported)"
              rows={6}
              required
              className="mt-1"
            />
          </div>
          <div>
            <Label htmlFor="location">Location</Label>
            <Input
              id="location"
              value={formData.location}
              onChange={(e) => setFormData(prev => ({ ...prev, location: e.target.value }))}
              placeholder="City, State or Country"
              className="mt-1"
            />
          </div>
        </CardContent>
      </Card>
      <Card>
        <CardHeader>
          <CardTitle>Pricing</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <Label htmlFor="amount">Amount</Label>
              <Input
                id="amount"
                type="text"
                value={formData.price.amount}
                onChange={(e) => setFormData(prev => ({
                  ...prev,
                  price: { ...prev.price, amount: e.target.value }
                }))}
                placeholder="0.00"
                className="mt-1"
              />
            </div>
            <div>
              <Label htmlFor="currency">Currency</Label>
              <Select
                value={formData.price.currency}
                onValueChange={(value) => setFormData(prev => ({
                  ...prev,
                  price: { ...prev.price, currency: value }
                }))}
              >
                <SelectTrigger className="mt-1">
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  {CURRENCIES.map(currency => (
                    <SelectItem key={currency} value={currency}>
                      {currency}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>
            <div>
              <Label htmlFor="frequency">Frequency</Label>
              <Select
                value={formData.price.frequency || 'once'}
                onValueChange={(value) => setFormData(prev => ({
                  ...prev,
                  price: { ...prev.price, frequency: value as PriceFrequency }
                }))}
              >
                <SelectTrigger className="mt-1">
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="once">One time</SelectItem>
                  <SelectItem value="hour">Per hour</SelectItem>
                  <SelectItem value="day">Per day</SelectItem>
                  <SelectItem value="week">Per week</SelectItem>
                  <SelectItem value="month">Per month</SelectItem>
                  <SelectItem value="year">Per year</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </div>
        </CardContent>
      </Card>
      <Card>
        <CardHeader>
          <CardTitle>Categories</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="flex gap-2">
            <Select value={newCategory} onValueChange={setNewCategory}>
              <SelectTrigger className="flex-1">
                <SelectValue placeholder="Select a category" />
              </SelectTrigger>
              <SelectContent>
                {COMMON_CATEGORIES.map(cat => (
                  <SelectItem key={cat} value={cat}>
                    {cat.charAt(0).toUpperCase() + cat.slice(1)}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
            <Input
              value={newCategory}
              onChange={(e) => setNewCategory(e.target.value)}
              placeholder="Or type custom"
              className="flex-1"
            />
            <Button type="button" onClick={addCategory} size="icon">
              <Plus className="w-4 h-4" />
            </Button>
          </div>
          {formData.categories.length > 0 && (
            <div className="flex flex-wrap gap-2">
              {formData.categories.map(category => (
                <div
                  key={category}
                  className="inline-flex items-center gap-1 px-3 py-1 bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-400 rounded-full text-sm"
                >
                  <span>{category}</span>
                  <button
                    type="button"
                    onClick={() => removeCategory(category)}
                    className="hover:text-purple-600"
                  >
                    <X className="w-3 h-3" />
                  </button>
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>
      <Card>
        <CardHeader>
          <CardTitle>Images</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="flex gap-2">
            <Input
              value={newImageUrl}
              onChange={(e) => setNewImageUrl(e.target.value)}
              placeholder="Image URL"
              className="flex-1"
            />
            <Button type="button" onClick={addImage} size="icon">
              <ImagePlus className="w-4 h-4" />
            </Button>
          </div>
          {formData.images.length > 0 && (
            <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
              {formData.images.map((image, index) => (
                <div key={index} className="relative group">
                  <img
                    src={image}
                    alt={`Listing image ${index + 1}`}
                    className="w-full h-32 object-cover rounded-lg"
                  />
                  <button
                    type="button"
                    onClick={() => removeImage(image)}
                    className="absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity"
                  >
                    <X className="w-4 h-4" />
                  </button>
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>
      <div className="flex justify-end gap-4">
        <Button
          type="button"
          variant="outline"
          onClick={() => navigate('/marketplace')}
          disabled={isSubmitting}
        >
          Cancel
        </Button>
        <Button type="submit" disabled={isSubmitting}>
          {isSubmitting ? 'Publishing...' : 'Publish Listing'}
        </Button>
      </div>
    </form>
  );
}
</file>

<file path="features/classifieds/components/ListingGrid.tsx">
import type { ClassifiedListing } from '../types';
import { ListingCard } from './ListingCard';
import { Loader2 } from 'lucide-react';
interface ListingGridProps {
  listings: ClassifiedListing[];
  isLoading?: boolean;
}
export function ListingGrid({ listings, isLoading }: ListingGridProps) {
  if (isLoading && listings.length === 0) {
    return (
      <div className="flex items-center justify-center py-12">
        <Loader2 className="w-8 h-8 animate-spin text-purple-600 dark:text-purple-400" />
      </div>
    );
  }
  if (listings.length === 0) {
    return (
      <div className="text-center py-12 px-4">
        <p className="text-gray-500 dark:text-gray-400">
          No listings found. Be the first to post something!
        </p>
      </div>
    );
  }
  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
      {listings.map((listing) => (
        <ListingCard key={listing.id} listing={listing} />
      ))}
    </div>
  );
}
</file>

<file path="features/classifieds/components/PriceTag.tsx">
import type { ListingPrice } from '../types';
interface PriceTagProps {
  price: ListingPrice;
  className?: string;
}
export function PriceTag({ price, className = '' }: PriceTagProps) {
  const formatFrequency = (frequency?: string) => {
    if (!frequency || frequency === 'once') return '';
    return `/${frequency}`;
  };
  return (
    <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400 ${className}`}>
      {price.amount} {price.currency}{formatFrequency(price.frequency)}
    </span>
  );
}
</file>

<file path="features/classifieds/hooks/useCreateListing.ts">
import { useNDK, useNDKCurrentUser } from '@nostr-dev-kit/ndk-hooks';
import { NDKEvent } from '@nostr-dev-kit/ndk';
import { CLASSIFIED_LISTING_KIND, createListingTags } from '../types';
import type { ListingFormData } from '../types';
export function useCreateListing() {
  const { ndk } = useNDK();
  const currentUser = useNDKCurrentUser();
  const createListing = async (data: ListingFormData) => {
    if (!ndk || !currentUser) {
      throw new Error('You must be logged in to create a listing');
    }
    const event = new NDKEvent(ndk);
    event.kind = CLASSIFIED_LISTING_KIND;
    event.content = data.content;
    event.tags = createListingTags(data);
    await event.sign();
    await event.publish();
    return event;
  };
  const updateListing = async (eventId: string, data: ListingFormData) => {
    if (!ndk || !currentUser) {
      throw new Error('You must be logged in to update a listing');
    }
    // For replaceable events (30000-39999), we create a new event with the same 'd' tag
    const event = new NDKEvent(ndk);
    event.kind = CLASSIFIED_LISTING_KIND;
    event.content = data.content;
    event.tags = createListingTags(data);
    // Add the 'd' tag to identify this as a replacement
    event.tags.push(['d', eventId]);
    await event.sign();
    await event.publish();
    return event;
  };
  const deleteListing = async (eventId: string) => {
    if (!ndk || !currentUser) {
      throw new Error('You must be logged in to delete a listing');
    }
    // To delete, we update with a "sold" or "deleted" status
    const event = new NDKEvent(ndk);
    event.kind = CLASSIFIED_LISTING_KIND;
    event.content = '';
    event.tags = [
      ['d', eventId],
      ['status', 'deleted']
    ];
    await event.sign();
    await event.publish();
    return event;
  };
  return {
    createListing,
    updateListing,
    deleteListing,
    isAuthenticated: !!currentUser
  };
}
</file>

<file path="features/classifieds/hooks/useListings.ts">
import { useSubscribe } from '@nostr-dev-kit/ndk-hooks';
import { CLASSIFIED_LISTING_KIND, parseListingFromEvent } from '../types';
import { useMemo } from 'react';
interface UseListingsOptions {
  category?: string;
  author?: string;
  limit?: number;
}
export function useListings(options: UseListingsOptions = {}) {
  const { category, author, limit = 50 } = options;
  // Build filter based on options
  const filters = useMemo(() => {
    const filter: any = {
      kinds: [CLASSIFIED_LISTING_KIND],
      limit
    };
    if (author) {
      filter.authors = [author];
    }
    if (category) {
      filter['#t'] = [category.toLowerCase()];
    }
    return [filter];
  }, [category, author, limit]);
  const { events, eose } = useSubscribe(filters);
  const isLoading = !eose && events.length === 0;
  const listings = useMemo(() => {
    return events
      .map(parseListingFromEvent)
      .filter(listing => listing.status === 'active')
      .sort((a, b) => {
        const timeA = a.publishedAt || 0;
        const timeB = b.publishedAt || 0;
        return timeB - timeA; // Most recent first
      });
  }, [events]);
  return {
    listings,
    isLoading,
    events
  };
}
</file>

<file path="features/classifieds/types.ts">
import { NDKEvent } from '@nostr-dev-kit/ndk';
// NIP-99 Event Kinds
export const CLASSIFIED_LISTING_KIND = 30402;
export const CLASSIFIED_DRAFT_KIND = 30403;
export type ListingStatus = 'active' | 'sold' | 'expired' | 'draft';
export type PriceFrequency = 'once' | 'hour' | 'day' | 'week' | 'month' | 'year';
export interface ListingPrice {
  amount: string;
  currency: string;
  frequency?: PriceFrequency;
}
export interface ClassifiedListing {
  id: string;
  title: string;
  summary?: string;
  content: string; // Markdown content
  author: string; // pubkey
  publishedAt?: number;
  location?: string;
  price?: ListingPrice;
  status?: ListingStatus;
  categories?: string[];
  images?: string[];
  event?: NDKEvent;
}
export interface ListingFormData {
  title: string;
  summary: string;
  content: string;
  location: string;
  price: {
    amount: string;
    currency: string;
    frequency?: PriceFrequency;
  };
  categories: string[];
  images: string[];
}
export function parseListingFromEvent(event: NDKEvent): ClassifiedListing {
  const title = event.tagValue('title') || 'Untitled Listing';
  const summary = event.tagValue('summary');
  const location = event.tagValue('location');
  const status = event.tagValue('status') as ListingStatus || 'active';
  const publishedAt = event.tagValue('published_at');
  // Parse price tag [price, amount, currency, frequency?]
  const priceTag = event.tags.find(tag => tag[0] === 'price');
  let price: ListingPrice | undefined;
  if (priceTag && priceTag.length >= 3) {
    price = {
      amount: priceTag[1],
      currency: priceTag[2],
      frequency: priceTag[3] as PriceFrequency | undefined
    };
  }
  // Parse categories from 't' tags
  const categories = event.tags
    .filter(tag => tag[0] === 't')
    .map(tag => tag[1]);
  // Parse images - handle multiple tag formats used in the wild
  let images: string[] = [];
  // 1. Standard 'image' tags (most common)
  const imageTags = event.tags
    .filter(tag => tag[0] === 'image')
    .map(tag => tag[1]);
  if (imageTags.length > 0) {
    images = imageTags;
  } else {
    // 2. Check for 'r' tags (resource URLs) that look like images
    const rTags = event.tags
      .filter(tag => tag[0] === 'r' && tag[1] &&
        (tag[1].match(/\.(jpg|jpeg|png|gif|webp|svg)/i) ||
         tag[1].includes('image') ||
         tag[1].includes('img')))
      .map(tag => tag[1]);
    if (rTags.length > 0) {
      images = rTags;
    } else {
      // 3. Check for custom image tags (featuredImageUrl, screenshotsUrls, etc.)
      const featuredImage = event.tagValue('featuredImageUrl');
      if (featuredImage) {
        images.push(featuredImage);
      }
      const screenshotsTag = event.tags.find(tag => tag[0] === 'screenshotsUrls');
      if (screenshotsTag) {
        images.push(...screenshotsTag.slice(1));
      }
      // 4. Other fallbacks
      const imgUrl = event.tagValue('imgUrl');
      if (imgUrl) images.push(imgUrl);
    }
  }
  return {
    id: event.id,
    title,
    summary,
    content: event.content,
    author: event.pubkey,
    publishedAt: publishedAt ? parseInt(publishedAt) : event.created_at,
    location,
    price,
    status,
    categories,
    images,
    event
  };
}
export function createListingTags(data: ListingFormData): string[][] {
  const tags: string[][] = [];
  tags.push(['title', data.title]);
  if (data.summary) {
    tags.push(['summary', data.summary]);
  }
  if (data.location) {
    tags.push(['location', data.location]);
  }
  if (data.price && data.price.amount && data.price.currency) {
    const priceTag = ['price', data.price.amount, data.price.currency];
    if (data.price.frequency && data.price.frequency !== 'once') {
      priceTag.push(data.price.frequency);
    }
    tags.push(priceTag);
  }
  tags.push(['published_at', Math.floor(Date.now() / 1000).toString()]);
  tags.push(['status', 'active']);
  data.categories.forEach(category => {
    tags.push(['t', category.toLowerCase()]);
  });
  data.images.forEach(image => {
    tags.push(['image', image]);
  });
  return tags;
}
</file>

<file path="features/feed/ComposeNote.tsx">
import { useState, type FormEvent, useRef, useEffect } from 'react';
import { useNDK, NDKEvent, useNDKCurrentUser, NDKKind, useProfile } from '@nostr-dev-kit/ndk-hooks';
import { Send, Image, Smile, MapPin } from 'lucide-react';
import { cn } from '@/lib/utils';
export function ComposeNote() {
  const { ndk } = useNDK();
  const currentUser = useNDKCurrentUser();
  const profile = useProfile(currentUser?.pubkey);
  const [content, setContent] = useState('');
  const [isPublishing, setIsPublishing] = useState(false);
  const textareaRef = useRef<HTMLTextAreaElement>(null);
  // Auto-resize textarea
  useEffect(() => {
    const textarea = textareaRef.current;
    if (textarea) {
      textarea.style.height = 'auto';
      textarea.style.height = `${Math.min(textarea.scrollHeight, 300)}px`;
    }
  }, [content]);
  const handleSubmit = async (e: FormEvent) => {
    e.preventDefault();
    if (!content.trim() || !currentUser || !ndk) return;
    setIsPublishing(true);
    try {
      const event = new NDKEvent(ndk);
      event.kind = NDKKind.Text;
      event.content = content;
      await event.publish();
      setContent('');
    } catch (error) {
      console.error('Failed to publish note:', error);
    } finally {
      setIsPublishing(false);
    }
  };
  if (!currentUser) {
    return null;
  }
  const displayName = profile?.name || 'Anonymous';
  const remainingChars = 280 - content.length;
  const isOverLimit = remainingChars < 0;
  return (
    <div className="bg-white dark:bg-gray-950 rounded-lg">
      <form onSubmit={handleSubmit}>
        <div className="flex gap-3">
          {/* Avatar */}
          <div className="flex-shrink-0">
            {profile?.picture ? (
              <img
                src={profile.picture}
                alt={displayName}
                className="w-10 h-10 sm:w-12 sm:h-12 rounded-full object-cover"
              />
            ) : (
              <div className="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-semibold">
                {displayName[0]?.toUpperCase()}
              </div>
            )}
          </div>
          {/* Input area */}
          <div className="flex-1">
            <textarea
              ref={textareaRef}
              value={content}
              onChange={(e) => setContent(e.target.value)}
              placeholder="What's happening?"
              className="w-full p-0 text-lg placeholder:text-gray-500 dark:placeholder:text-gray-400 bg-transparent resize-none focus:outline-none text-gray-900 dark:text-gray-100 min-h-[60px]"
              disabled={isPublishing}
            />
            {/* Actions bar */}
            <div className="flex items-center justify-between mt-3 pt-3 border-t border-gray-200 dark:border-gray-800">
              <div className="flex items-center gap-1">
                <button
                  type="button"
                  className="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-500 dark:text-gray-400"
                  title="Add image (coming soon)"
                >
                  <Image className="w-5 h-5" />
                </button>
                <button
                  type="button"
                  className="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-500 dark:text-gray-400"
                  title="Add emoji (coming soon)"
                >
                  <Smile className="w-5 h-5" />
                </button>
                <button
                  type="button"
                  className="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-500 dark:text-gray-400"
                  title="Add location (coming soon)"
                >
                  <MapPin className="w-5 h-5" />
                </button>
              </div>
              <div className="flex items-center gap-3">
                {/* Character counter */}
                {content.length > 0 && (
                  <div className="relative">
                    <svg className="w-8 h-8 -rotate-90">
                      <circle
                        cx="16"
                        cy="16"
                        r="14"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="2"
                        className="text-gray-200 dark:text-gray-700"
                      />
                      <circle
                        cx="16"
                        cy="16"
                        r="14"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="2"
                        strokeDasharray={`${Math.max(0, (Math.min(280, content.length) / 280) * 88)} 88`}
                        strokeLinecap="round"
                        className={cn(
                          "transition-all duration-150",
                          isOverLimit ? "text-red-500" : 
                          remainingChars < 20 ? "text-yellow-500" : 
                          "text-purple-500"
                        )}
                      />
                    </svg>
                    {remainingChars < 20 && (
                      <span className={cn(
                        "absolute inset-0 flex items-center justify-center text-xs font-medium",
                        isOverLimit ? "text-red-500" : "text-gray-500 dark:text-gray-400"
                      )}>
                        {remainingChars}
                      </span>
                    )}
                  </div>
                )}
                {/* Publish button */}
                <button
                  type="submit"
                  disabled={!content.trim() || isPublishing || isOverLimit}
                  className={cn(
                    "px-4 py-1.5 rounded-full font-medium transition-all",
                    (!content.trim() || isOverLimit)
                      ? "bg-gray-200 text-gray-400 dark:bg-gray-800 dark:text-gray-600 cursor-not-allowed"
                      : "bg-purple-600 text-white hover:bg-purple-700 dark:bg-purple-500 dark:hover:bg-purple-600"
                  )}
                >
                  {isPublishing ? (
                    <span className="flex items-center gap-2">
                      <span className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin" />
                      Publishing
                    </span>
                  ) : (
                    'Publish'
                  )}
                </button>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  );
}
</file>

<file path="features/feed/NoteCard.tsx">
import { type NDKEvent, useProfile, useNDK, NDKKind, useNDKCurrentUser } from '@nostr-dev-kit/ndk-hooks';
import { formatDistanceToNow } from 'date-fns';
import { Heart, MessageCircle, Repeat2, Share, MoreHorizontal } from 'lucide-react';
import { useState } from 'react';
import { cn } from '@/lib/utils';
import { ZapButton } from '@/components/wallet/ZapButton';
import { UserAvatar } from '@/components/ui/UserAvatar';
import { Link } from 'react-router-dom';
interface NoteCardProps {
  event: NDKEvent;
}
export function NoteCard({ event }: NoteCardProps) {
  const profile = useProfile(event.author.pubkey);
  const { ndk } = useNDK();
  const currentUser = useNDKCurrentUser();
  const [isLiked, setIsLiked] = useState(false);
  const [likeCount, setLikeCount] = useState(0);
  const handleLike = async () => {
    if (!currentUser || !ndk) return;
    try {
      const reaction = new NDKEvent(ndk);
      reaction.kind = NDKKind.Reaction;
      reaction.content = isLiked ? '-' : '+';
      reaction.tags = [
        ['e', event.id],
        ['p', event.pubkey]
      ];
      await reaction.publish();
      setIsLiked(!isLiked);
      setLikeCount(prev => isLiked ? prev - 1 : prev + 1);
    } catch (error) {
      console.error('Failed to publish reaction:', error);
    }
  };
  const handleRepost = async () => {
    if (!currentUser || !ndk) return;
    try {
      const repost = new NDKEvent(ndk);
      repost.kind = NDKKind.Repost;
      repost.content = '';
      repost.tags = [
        ['e', event.id],
        ['p', event.pubkey]
      ];
      await repost.publish();
    } catch (error) {
      console.error('Failed to repost:', error);
    }
  };
  const displayName = profile?.name || 'Anonymous';
  const handle = profile?.nip05 ? `@${profile.nip05.split('@')[0]}` : `@${event.author?.npub?.slice(5, 12)}`;
  return (
    <article className="bg-white dark:bg-gray-900/50 border-b border-gray-100 dark:border-gray-800/50 hover:bg-gray-50 dark:hover:bg-gray-900/80 transition-all duration-200 animate-fade-in">
      <div className="px-4 py-4 sm:px-6">
        {/* Header */}
        <div className="flex items-start gap-3">
          {/* Avatar */}
          <Link to={`/profile/${event.author.pubkey}`} className="flex-shrink-0">
            <UserAvatar
              pubkey={event.author.pubkey}
              size="md"
              className="w-12 h-12 sm:w-14 sm:h-14 ring-2 ring-white dark:ring-gray-800 shadow-soft hover:shadow-soft-lg hover:scale-105 transition-all duration-200"
            />
          </Link>
          {/* Content */}
          <div className="flex-1 min-w-0">
            {/* Author info */}
            <div className="flex items-center gap-2 flex-wrap">
              <Link
                to={`/profile/${event.author.pubkey}`}
                className="flex items-center gap-1.5 hover:opacity-80 transition-opacity"
              >
                <span className="font-bold text-base text-gray-900 dark:text-gray-100">
                  {displayName}
                </span>
                <span className="text-gray-500 dark:text-gray-400 text-sm font-normal">
                  {handle}
                </span>
              </Link>
              <span className="text-gray-300 dark:text-gray-600 text-xs">¬∑</span>
              <time className="text-gray-500 dark:text-gray-400 text-sm hover:underline cursor-help">
                {formatDistanceToNow(new Date(event.created_at! * 1000), { addSuffix: true })}
              </time>
            </div>
            {/* Note content */}
            <div className="mt-2.5">
              <p className="text-gray-900 dark:text-gray-100 text-base leading-relaxed whitespace-pre-wrap break-words">
                {event.content}
              </p>
            </div>
            {/* Action buttons */}
            <div className="flex items-center justify-between mt-4 -ml-2">
              <div className="flex items-center gap-2">
                <button
                  onClick={() => {/* TODO: Implement reply */}}
                  className="group flex items-center gap-2 p-3 rounded-xl hover:bg-blue-50 dark:hover:bg-blue-950/20 transition-all duration-200 active:scale-95"
                  disabled={!currentUser}
                >
                  <MessageCircle className="w-5 h-5 text-gray-500 group-hover:text-blue-500 dark:text-gray-400 dark:group-hover:text-blue-400" />
                  {0 > 0 && (
                    <span className="text-sm text-gray-500 group-hover:text-blue-500 dark:text-gray-400 dark:group-hover:text-blue-400 font-medium">
                      0
                    </span>
                  )}
                </button>
                <button
                  onClick={handleRepost}
                  className="group flex items-center gap-2 p-3 rounded-xl hover:bg-green-50 dark:hover:bg-green-950/20 transition-all duration-200 active:scale-95"
                  disabled={!currentUser}
                >
                  <Repeat2 className="w-5 h-5 text-gray-500 group-hover:text-green-500 dark:text-gray-400 dark:group-hover:text-green-400" />
                  {0 > 0 && (
                    <span className="text-sm text-gray-500 group-hover:text-green-500 dark:text-gray-400 dark:group-hover:text-green-400 font-medium">
                      0
                    </span>
                  )}
                </button>
                <button
                  onClick={handleLike}
                  className={cn(
                    "group flex items-center gap-2 p-3 rounded-xl transition-all duration-200 active:scale-95",
                    isLiked
                      ? "bg-pink-50 dark:bg-pink-950/20"
                      : "hover:bg-pink-50 dark:hover:bg-pink-950/20"
                  )}
                  disabled={!currentUser}
                >
                  <Heart
                    className={cn(
                      "w-5 h-5 transition-all duration-200",
                      isLiked
                        ? "fill-current text-pink-500 dark:text-pink-400 scale-110"
                        : "text-gray-500 group-hover:text-pink-500 dark:text-gray-400 dark:group-hover:text-pink-400"
                    )}
                  />
                  {likeCount > 0 && (
                    <span className={cn(
                      "text-sm font-medium",
                      isLiked
                        ? "text-pink-500 dark:text-pink-400"
                        : "text-gray-500 group-hover:text-pink-500 dark:text-gray-400 dark:group-hover:text-pink-400"
                    )}>
                      {likeCount}
                    </span>
                  )}
                </button>
                {/* Zap Button */}
                <ZapButton
                  eventId={event.id}
                  authorPubkey={event.pubkey}
                  onZap={(amount) => console.log(`Zapped ${amount} sats to`, event.pubkey)}
                />
                <button
                  onClick={() => {/* TODO: Implement share */}}
                  className="group p-3 rounded-xl hover:bg-blue-50 dark:hover:bg-blue-950/20 transition-all duration-200 active:scale-95"
                >
                  <Share className="w-5 h-5 text-gray-500 group-hover:text-blue-500 dark:text-gray-400 dark:group-hover:text-blue-400" />
                </button>
              </div>
              <button className="p-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-800 transition-all duration-200">
                <MoreHorizontal className="w-5 h-5 text-gray-500 dark:text-gray-400" />
              </button>
            </div>
          </div>
        </div>
      </div>
    </article>
  );
}
</file>

<file path="features/feed/NoteFeed.tsx">
import { useSubscribe, NDKKind } from '@nostr-dev-kit/ndk-hooks';
import { NoteCard } from './NoteCard';
import { Loader2 } from 'lucide-react';
export function NoteFeed() {
  const { events, isLoading } = useSubscribe([{
    kinds: [NDKKind.Text],
    limit: 20,
  }]);
  if (isLoading && events.length === 0) {
    return (
      <div className="flex items-center justify-center py-12">
        <Loader2 className="w-8 h-8 animate-spin text-purple-600 dark:text-purple-400" />
      </div>
    );
  }
  if (events.length === 0) {
    return (
      <div className="text-center py-12 px-4">
        <p className="text-gray-500 dark:text-gray-400">
          No notes yet. Be the first to share something!
        </p>
      </div>
    );
  }
  return (
    <div className="divide-y divide-gray-200 dark:divide-gray-800">
      {events.map((event) => (
        <NoteCard key={event.id} event={event} />
      ))}
    </div>
  );
}
</file>

<file path="features/settings/NotificationSettings.tsx">
export function NotificationSettings() {
  return (
    <div className="text-center py-12 text-gray-500">
      Notification settings coming soon...
    </div>
  );
}
</file>

<file path="features/settings/PrivacySettings.tsx">
export function PrivacySettings() {
  return (
    <div className="text-center py-12 text-gray-500">
      Privacy settings coming soon...
    </div>
  );
}
</file>

<file path="features/settings/ProfileSettings.tsx">
export function ProfileSettings() {
  return (
    <div className="text-center py-12 text-gray-500">
      Profile settings coming soon...
    </div>
  );
}
</file>

<file path="features/settings/RelaySettings.tsx">
import { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import {
  Plus,
  Trash2,
  Check,
  X,
  Zap,
  BookOpen,
  Edit2,
  Globe,
  AlertCircle,
  WifiOff,
  Wifi
} from 'lucide-react';
import { useSettingsStore, type Relay } from '@/stores/settingsStore';
import { cn } from '@/lib/utils';
export function RelaySettings() {
  const { relays, addRelay, removeRelay, updateRelay, toggleRelay } = useSettingsStore();
  const [isAdding, setIsAdding] = useState(false);
  const [newRelay, setNewRelay] = useState({ url: '', read: true, write: true });
  const [testingRelay, setTestingRelay] = useState<string | null>(null);
  const [connectionStatus, setConnectionStatus] = useState<Record<string, 'connected' | 'disconnected' | 'testing'>>({});
  const handleAddRelay = () => {
    if (newRelay.url && !relays.some(r => r.url === newRelay.url)) {
      addRelay({
        ...newRelay,
        enabled: true,
        url: newRelay.url.startsWith('wss://') ? newRelay.url : `wss://${newRelay.url}`,
      });
      setNewRelay({ url: '', read: true, write: true });
      setIsAdding(false);
    }
  };
  const testRelayConnection = async (url: string) => {
    setTestingRelay(url);
    setConnectionStatus(prev => ({ ...prev, [url]: 'testing' }));
    // Mock connection test
    setTimeout(() => {
      const isConnected = Math.random() > 0.3; // 70% success rate for demo
      setConnectionStatus(prev => ({
        ...prev,
        [url]: isConnected ? 'connected' : 'disconnected'
      }));
      setTestingRelay(null);
    }, 1500);
  };
  const getRelayStatus = (url: string) => {
    if (testingRelay === url) return 'testing';
    return connectionStatus[url] || 'disconnected';
  };
  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2">
          Relay Configuration
        </h2>
        <p className="text-sm text-gray-600 dark:text-gray-400">
          Configure which Nostr relays your app connects to for reading and publishing events.
        </p>
      </div>
      {/* Stats */}
      <div className="grid grid-cols-3 gap-2 md:gap-4">
        <div className="bg-gray-50 dark:bg-gray-900 rounded-lg p-3 md:p-4">
          <div className="flex items-center gap-1 md:gap-2 text-green-600 dark:text-green-400 mb-1">
            <Wifi className="w-3 h-3 md:w-4 md:h-4" />
            <span className="text-xs md:text-sm font-medium">Active</span>
          </div>
          <div className="text-xl md:text-2xl font-bold text-gray-900 dark:text-gray-100">
            {relays.filter(r => r.enabled).length}
          </div>
        </div>
        <div className="bg-gray-50 dark:bg-gray-900 rounded-lg p-3 md:p-4">
          <div className="flex items-center gap-1 md:gap-2 text-blue-600 dark:text-blue-400 mb-1">
            <BookOpen className="w-3 h-3 md:w-4 md:h-4" />
            <span className="text-xs md:text-sm font-medium">Read</span>
          </div>
          <div className="text-xl md:text-2xl font-bold text-gray-900 dark:text-gray-100">
            {relays.filter(r => r.enabled && r.read).length}
          </div>
        </div>
        <div className="bg-gray-50 dark:bg-gray-900 rounded-lg p-3 md:p-4">
          <div className="flex items-center gap-1 md:gap-2 text-purple-600 dark:text-purple-400 mb-1">
            <Edit2 className="w-3 h-3 md:w-4 md:h-4" />
            <span className="text-xs md:text-sm font-medium">Write</span>
          </div>
          <div className="text-xl md:text-2xl font-bold text-gray-900 dark:text-gray-100">
            {relays.filter(r => r.enabled && r.write).length}
          </div>
        </div>
      </div>
      {/* Relay List */}
      <div className="space-y-2">
        <AnimatePresence>
          {relays.map((relay) => {
            const status = getRelayStatus(relay.url);
            return (
              <motion.div
                key={relay.url}
                initial={{ opacity: 0, x: -20 }}
                animate={{ opacity: 1, x: 0 }}
                exit={{ opacity: 0, x: 20 }}
                className={cn(
                  'border rounded-lg p-4 transition-all',
                  relay.enabled
                    ? 'bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700'
                    : 'bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-800 opacity-60'
                )}
              >
                <div className="flex flex-col md:flex-row md:items-start md:justify-between gap-3">
                  <div className="flex-1">
                    <div className="flex items-start md:items-center gap-3">
                      <button
                        onClick={() => toggleRelay(relay.url)}
                        className={cn(
                          'w-5 h-5 rounded-full border-2 flex items-center justify-center transition-all flex-shrink-0 mt-0.5 md:mt-0',
                          relay.enabled
                            ? 'bg-purple-600 border-purple-600'
                            : 'bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600'
                        )}
                      >
                        {relay.enabled && <Check className="w-3 h-3 text-white" />}
                      </button>
                      <div className="flex-1 min-w-0">
                        <div className="flex flex-wrap items-center gap-2">
                          <Globe className="w-4 h-4 text-gray-400 flex-shrink-0" />
                          <span className="font-mono text-xs md:text-sm text-gray-900 dark:text-gray-100 break-all">
                            {relay.url}
                          </span>
                          {status === 'connected' && (
                            <span className="text-xs bg-green-100 dark:bg-green-950 text-green-700 dark:text-green-400 px-2 py-0.5 rounded-full">
                              Connected
                            </span>
                          )}
                          {status === 'disconnected' && connectionStatus[relay.url] !== undefined && (
                            <span className="text-xs bg-red-100 dark:bg-red-950 text-red-700 dark:text-red-400 px-2 py-0.5 rounded-full">
                              Offline
                            </span>
                          )}
                          {status === 'testing' && (
                            <span className="text-xs bg-yellow-100 dark:bg-yellow-950 text-yellow-700 dark:text-yellow-400 px-2 py-0.5 rounded-full">
                              Testing...
                            </span>
                          )}
                        </div>
                        <div className="flex items-center gap-4 mt-2">
                          <label className="flex items-center gap-2 cursor-pointer">
                            <input
                              type="checkbox"
                              checked={relay.read}
                              onChange={(e) => updateRelay(relay.url, { read: e.target.checked })}
                              className="w-4 h-4 text-purple-600 rounded focus:ring-purple-500"
                            />
                            <span className="text-sm text-gray-600 dark:text-gray-400">
                              Read
                            </span>
                          </label>
                          <label className="flex items-center gap-2 cursor-pointer">
                            <input
                              type="checkbox"
                              checked={relay.write}
                              onChange={(e) => updateRelay(relay.url, { write: e.target.checked })}
                              className="w-4 h-4 text-purple-600 rounded focus:ring-purple-500"
                            />
                            <span className="text-sm text-gray-600 dark:text-gray-400">
                              Write
                            </span>
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div className="flex items-center gap-2 ml-8 md:ml-0">
                    <button
                      onClick={() => testRelayConnection(relay.url)}
                      disabled={testingRelay === relay.url}
                      className="p-1.5 md:p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50"
                      title="Test connection"
                    >
                      <Zap className="w-4 h-4 text-gray-500" />
                    </button>
                    <button
                      onClick={() => removeRelay(relay.url)}
                      className="p-1.5 md:p-2 hover:bg-red-50 dark:hover:bg-red-950/30 rounded-lg transition-colors group"
                      title="Remove relay"
                    >
                      <Trash2 className="w-4 h-4 text-gray-500 group-hover:text-red-600" />
                    </button>
                  </div>
                </div>
              </motion.div>
            );
          })}
        </AnimatePresence>
        {/* Add New Relay */}
        <AnimatePresence>
          {isAdding ? (
            <motion.div
              initial={{ opacity: 0, height: 0 }}
              animate={{ opacity: 1, height: 'auto' }}
              exit={{ opacity: 0, height: 0 }}
              className="border-2 border-dashed border-purple-300 dark:border-purple-700 rounded-lg p-4"
            >
              <div className="space-y-3">
                <input
                  type="text"
                  value={newRelay.url}
                  onChange={(e) => setNewRelay({ ...newRelay, url: e.target.value })}
                  placeholder="wss://relay.example.com"
                  className="w-full px-3 py-2 bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                  autoFocus
                />
                <div className="flex items-center gap-4">
                  <label className="flex items-center gap-2 cursor-pointer">
                    <input
                      type="checkbox"
                      checked={newRelay.read}
                      onChange={(e) => setNewRelay({ ...newRelay, read: e.target.checked })}
                      className="w-4 h-4 text-purple-600 rounded focus:ring-purple-500"
                    />
                    <span className="text-sm text-gray-600 dark:text-gray-400">Read</span>
                  </label>
                  <label className="flex items-center gap-2 cursor-pointer">
                    <input
                      type="checkbox"
                      checked={newRelay.write}
                      onChange={(e) => setNewRelay({ ...newRelay, write: e.target.checked })}
                      className="w-4 h-4 text-purple-600 rounded focus:ring-purple-500"
                    />
                    <span className="text-sm text-gray-600 dark:text-gray-400">Write</span>
                  </label>
                </div>
                <div className="flex gap-2">
                  <button
                    onClick={handleAddRelay}
                    disabled={!newRelay.url}
                    className="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                  >
                    Add Relay
                  </button>
                  <button
                    onClick={() => {
                      setIsAdding(false);
                      setNewRelay({ url: '', read: true, write: true });
                    }}
                    className="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
                  >
                    Cancel
                  </button>
                </div>
              </div>
            </motion.div>
          ) : (
            <motion.button
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              onClick={() => setIsAdding(true)}
              className="w-full border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-lg p-4 hover:border-purple-400 dark:hover:border-purple-600 transition-colors group"
            >
              <div className="flex items-center justify-center gap-2 text-gray-500 group-hover:text-purple-600 dark:group-hover:text-purple-400">
                <Plus className="w-5 h-5" />
                <span className="font-medium">Add Relay</span>
              </div>
            </motion.button>
          )}
        </AnimatePresence>
      </div>
      {/* Warning */}
      <div className="bg-yellow-50 dark:bg-yellow-950/30 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4">
        <div className="flex gap-3">
          <AlertCircle className="w-5 h-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5" />
          <div className="text-sm text-yellow-800 dark:text-yellow-300">
            <p className="font-medium mb-1">Important</p>
            <p>Changes to relay configuration will take effect after refreshing the app.</p>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="features/settings/ThemeSettings.tsx">
export function ThemeSettings() {
  return (
    <div className="text-center py-12 text-gray-500">
      Theme settings coming soon...
    </div>
  );
}
</file>

<file path="features/trades/CompactFilters.tsx">
import { ChevronDown } from 'lucide-react';
import { useState, useRef, useEffect } from 'react';
interface CompactFiltersProps {
  filters: {
    currency: string;
    paymentMethod: string;
    orderType: 'all' | 'buy' | 'sell';
  };
  onFiltersChange: (filters: any) => void;
}
const orderTypes = [
  { value: 'all', label: 'All', color: 'text-gray-700' },
  { value: 'buy', label: 'Buy', color: 'text-green-600' },
  { value: 'sell', label: 'Sell', color: 'text-red-600' },
];
const currencies = [
  { code: 'all', name: 'All', flag: 'üåç' },
  { code: 'USD', name: 'USD', flag: 'üá∫üá∏' },
  { code: 'EUR', name: 'EUR', flag: 'üá™üá∫' },
  { code: 'BRL', name: 'BRL', flag: 'üáßüá∑' },
  { code: 'ARS', name: 'ARS', flag: 'üá¶üá∑' },
  { code: 'GBP', name: 'GBP', flag: 'üá¨üáß' },
  { code: 'PLN', name: 'PLN', flag: 'üáµüá±' },
  { code: 'JPY', name: 'JPY', flag: 'üáØüáµ' },
];
const paymentMethods = [
  { id: 'all', name: 'All', icon: 'üí∞' },
  { id: 'Cash', name: 'Cash', icon: 'üíµ' },
  { id: 'PIX', name: 'PIX', icon: 'üîÑ' },
  { id: 'BLIK', name: 'BLIK', icon: 'üì±' },
  { id: 'Revolut', name: 'Revolut', icon: 'üí≥' },
  { id: 'Zelle', name: 'Zelle', icon: 'üè¶' },
  { id: 'CashApp', name: 'CashApp', icon: 'üì≤' },
];
function Dropdown({
  value,
  options,
  onChange,
  renderOption,
  renderValue,
  className = ''
}: any) {
  const [isOpen, setIsOpen] = useState(false);
  const dropdownRef = useRef<HTMLDivElement>(null);
  useEffect(() => {
    function handleClickOutside(event: MouseEvent) {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {
        setIsOpen(false);
      }
    }
    document.addEventListener('mousedown', handleClickOutside);
    return () => document.removeEventListener('mousedown', handleClickOutside);
  }, []);
  return (
    <div ref={dropdownRef} className={`relative ${className}`}>
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="flex items-center gap-1 px-3 py-1.5 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg text-sm font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
      >
        {renderValue(value)}
        <ChevronDown className={`w-3 h-3 transition-transform ${isOpen ? 'rotate-180' : ''}`} />
      </button>
      {isOpen && (
        <div className="absolute top-full mt-1 left-0 w-max min-w-[120px] bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-[100] max-h-64 overflow-y-auto">
          {options.map((option: any) => (
            <button
              key={option.value || option.code || option.id}
              onClick={() => {
                onChange(option);
                setIsOpen(false);
              }}
              className="w-full flex items-center gap-2 px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-left"
            >
              {renderOption(option)}
            </button>
          ))}
        </div>
      )}
    </div>
  );
}
export function CompactFilters({ filters, onFiltersChange }: CompactFiltersProps) {
  const selectedOrderType = orderTypes.find(t => t.value === filters.orderType);
  const selectedCurrency = currencies.find(c => c.code === filters.currency);
  const selectedPayment = paymentMethods.find(p => p.id === filters.paymentMethod);
  return (
    <div className="relative flex items-center gap-2 p-3 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 overflow-visible">
      {/* Order Type Dropdown */}
      <Dropdown
        value={filters.orderType}
        options={orderTypes}
        onChange={(option: any) => onFiltersChange({ ...filters, orderType: option.value })}
        renderValue={() => (
          <span className={selectedOrderType?.color}>
            {selectedOrderType?.label}
          </span>
        )}
        renderOption={(option: any) => (
          <span className={`text-sm font-medium ${option.color}`}>
            {option.label}
          </span>
        )}
      />
      {/* Currency Dropdown */}
      <Dropdown
        value={filters.currency}
        options={currencies}
        onChange={(option: any) => onFiltersChange({ ...filters, currency: option.code })}
        renderValue={() => (
          <>
            <span>{selectedCurrency?.flag}</span>
            <span>{selectedCurrency?.code === 'all' ? 'Currency' : selectedCurrency?.name}</span>
          </>
        )}
        renderOption={(option: any) => (
          <>
            <span className="text-lg">{option.flag}</span>
            <span className="text-sm">{option.code === 'all' ? 'All Currencies' : option.name}</span>
          </>
        )}
      />
      {/* Payment Method Dropdown */}
      <Dropdown
        value={filters.paymentMethod}
        options={paymentMethods}
        onChange={(option: any) => onFiltersChange({ ...filters, paymentMethod: option.id })}
        renderValue={() => (
          <>
            <span>{selectedPayment?.icon}</span>
            <span>{selectedPayment?.id === 'all' ? 'Payment' : selectedPayment?.name}</span>
          </>
        )}
        renderOption={(option: any) => (
          <>
            <span className="text-lg">{option.icon}</span>
            <span className="text-sm">{option.id === 'all' ? 'All Methods' : option.name}</span>
          </>
        )}
      />
      {/* Clear filters button - only show if filters are active */}
      {(filters.currency !== 'all' || filters.paymentMethod !== 'all' || filters.orderType !== 'all') && (
        <button
          onClick={() => onFiltersChange({
            ...filters,
            currency: 'all',
            paymentMethod: 'all',
            orderType: 'all'
          })}
          className="ml-auto px-2 py-1 text-xs text-purple-600 dark:text-purple-400 hover:underline"
        >
          Clear
        </button>
      )}
    </div>
  );
}
</file>

<file path="features/trades/CreateOrderModal.tsx">
import { useState } from 'react';
import { X, Bitcoin } from 'lucide-react';
import { useNDK } from '@nostr-dev-kit/ndk-hooks';
import { NDKEvent } from '@nostr-dev-kit/ndk';
interface CreateOrderModalProps {
  onClose: () => void;
}
const currencies = [
  { code: 'USD', symbol: '$', name: 'US Dollar' },
  { code: 'EUR', symbol: '‚Ç¨', name: 'Euro' },
  { code: 'GBP', symbol: '¬£', name: 'British Pound' },
  { code: 'BRL', symbol: 'R$', name: 'Brazilian Real' },
  { code: 'ARS', symbol: '$', name: 'Argentine Peso' },
  { code: 'PLN', symbol: 'z≈Ç', name: 'Polish Z≈Çoty' },
];
const paymentMethods = [
  { id: 'Cash', name: 'Cash (F2F)', icon: 'üíµ' },
  { id: 'Revolut', name: 'Revolut', icon: 'üí≥' },
  { id: 'PIX', name: 'PIX (Brazil)', icon: 'üîÑ' },
  { id: 'BLIK', name: 'BLIK (Poland)', icon: 'üì±' },
  { id: 'Zelle', name: 'Zelle', icon: 'üè¶' },
  { id: 'CashApp', name: 'Cash App', icon: 'üì≤' },
];
export function CreateOrderModal({ onClose }: CreateOrderModalProps) {
  const { ndk } = useNDK();
  const [orderType, setOrderType] = useState<'buy' | 'sell'>('buy');
  const [currency, setCurrency] = useState('USD');
  const [satsAmount, setSatsAmount] = useState('100000');
  const [fiatAmount, setFiatAmount] = useState('50');
  const [paymentMethod, setPaymentMethod] = useState('Cash');
  const [premium, setPremium] = useState('0');
  const [expirationHours, setExpirationHours] = useState('24');
  const [creating, setCreating] = useState(false);
  const handleCreate = async () => {
    if (!ndk) return;
    setCreating(true);
    try {
      const event = new NDKEvent(ndk);
      event.kind = 38383;
      // Generate unique ID
      const orderId = `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
      event.tags = [
        ['d', orderId],
        ['k', orderType],
        ['f', currency],
        ['s', 'pending'],
        ['amt', satsAmount],
        ['fa', fiatAmount],
        ['pm', paymentMethod],
        ['premium', premium],
        ['y', 'Voces'],
        ['z', 'order'],
        ['network', 'mainnet'],
        ['layer', 'lightning'],
        ['expiration', (Math.floor(Date.now() / 1000) + parseInt(expirationHours) * 3600).toString()]
      ];
      event.content = '';
      await event.publish();
      onClose();
    } catch (error) {
      console.error('Failed to create order:', error);
    } finally {
      setCreating(false);
    }
  };
  const btcAmount = parseInt(satsAmount) / 100000000;
  const pricePerBtc = parseFloat(fiatAmount) / btcAmount;
  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4">
      <div className="bg-white dark:bg-gray-900 rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto">
        <div className="sticky top-0 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 p-6">
          <div className="flex items-center justify-between">
            <h2 className="text-2xl font-bold text-gray-900 dark:text-white">
              Create P2P Order
            </h2>
            <button
              onClick={onClose}
              className="p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors"
            >
              <X className="w-5 h-5" />
            </button>
          </div>
        </div>
        <div className="p-6 space-y-6">
          {/* Order Type */}
          <div>
            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
              Order Type
            </label>
            <div className="grid grid-cols-2 gap-3">
              <button
                onClick={() => setOrderType('buy')}
                className={`px-4 py-3 rounded-lg border-2 transition-colors ${
                  orderType === 'buy'
                    ? 'border-green-500 bg-green-50 text-green-700 dark:bg-green-900/30 dark:text-green-400'
                    : 'border-gray-300 dark:border-gray-700'
                }`}
              >
                I want to buy Bitcoin
              </button>
              <button
                onClick={() => setOrderType('sell')}
                className={`px-4 py-3 rounded-lg border-2 transition-colors ${
                  orderType === 'sell'
                    ? 'border-red-500 bg-red-50 text-red-700 dark:bg-red-900/30 dark:text-red-400'
                    : 'border-gray-300 dark:border-gray-700'
                }`}
              >
                I want to sell Bitcoin
              </button>
            </div>
          </div>
          {/* Bitcoin Amount */}
          <div>
            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
              Bitcoin Amount (sats)
            </label>
            <div className="relative">
              <Bitcoin className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-orange-500" />
              <input
                type="number"
                value={satsAmount}
                onChange={(e) => setSatsAmount(e.target.value)}
                className="w-full pl-10 pr-3 py-3 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                placeholder="100000"
              />
            </div>
            <p className="mt-1 text-xs text-gray-500 dark:text-gray-400">
              = {btcAmount.toFixed(8)} BTC
            </p>
          </div>
          {/* Fiat Amount & Currency */}
          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Fiat Amount
              </label>
              <input
                type="number"
                value={fiatAmount}
                onChange={(e) => setFiatAmount(e.target.value)}
                className="w-full px-3 py-3 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
                placeholder="50"
              />
              <p className="mt-1 text-xs text-gray-500 dark:text-gray-400">
                ‚âà ${pricePerBtc.toFixed(2)}/BTC
              </p>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Currency
              </label>
              <select
                value={currency}
                onChange={(e) => setCurrency(e.target.value)}
                className="w-full px-3 py-3 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
              >
                {currencies.map((curr) => (
                  <option key={curr.code} value={curr.code}>
                    {curr.symbol} {curr.code}
                  </option>
                ))}
              </select>
            </div>
          </div>
          {/* Payment Method */}
          <div>
            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
              Payment Method
            </label>
            <div className="grid grid-cols-2 gap-3">
              {paymentMethods.map((method) => (
                <button
                  key={method.id}
                  onClick={() => setPaymentMethod(method.id)}
                  className={`flex items-center gap-2 px-3 py-2 rounded-lg border-2 transition-colors ${
                    paymentMethod === method.id
                      ? 'border-purple-500 bg-purple-50 dark:bg-purple-900/30'
                      : 'border-gray-300 dark:border-gray-700'
                  }`}
                >
                  <span className="text-lg">{method.icon}</span>
                  <span className="text-sm">{method.name}</span>
                </button>
              ))}
            </div>
          </div>
          {/* Premium */}
          <div>
            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
              Premium (%)
            </label>
            <input
              type="number"
              value={premium}
              onChange={(e) => setPremium(e.target.value)}
              className="w-full px-3 py-3 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
              placeholder="0"
            />
            <p className="mt-1 text-xs text-gray-500 dark:text-gray-400">
              Positive for above market, negative for below
            </p>
          </div>
          {/* Expiration */}
          <div>
            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
              Expiration (hours)
            </label>
            <select
              value={expirationHours}
              onChange={(e) => setExpirationHours(e.target.value)}
              className="w-full px-3 py-3 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
            >
              <option value="1">1 hour</option>
              <option value="6">6 hours</option>
              <option value="12">12 hours</option>
              <option value="24">24 hours</option>
              <option value="48">48 hours</option>
              <option value="72">72 hours</option>
            </select>
          </div>
          {/* Action Buttons */}
          <div className="flex gap-3">
            <button
              onClick={onClose}
              className="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors"
            >
              Cancel
            </button>
            <button
              onClick={handleCreate}
              disabled={creating || !satsAmount || !fiatAmount}
              className="flex-1 px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            >
              {creating ? 'Creating...' : 'Create Order'}
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="features/trades/MobileFilters.tsx">
import { useState } from 'react';
import { Filter, X } from 'lucide-react';
interface MobileFiltersProps {
  selectedCurrency: string;
  selectedPaymentMethod: string;
  onCurrencyChange: (currency: string) => void;
  onPaymentMethodChange: (method: string) => void;
}
const currencies = [
  { code: 'all', flag: 'üåç' },
  { code: 'USD', flag: 'üá∫üá∏' },
  { code: 'EUR', flag: 'üá™üá∫' },
  { code: 'BRL', flag: 'üáßüá∑' },
  { code: 'ARS', flag: 'üá¶üá∑' },
  { code: 'GBP', flag: 'üá¨üáß' },
  { code: 'PLN', flag: 'üáµüá±' },
  { code: 'JPY', flag: 'üáØüáµ' },
];
const paymentMethods = [
  { id: 'all', name: 'All', icon: 'üí∞' },
  { id: 'Cash', name: 'Cash', icon: 'üíµ' },
  { id: 'PIX', name: 'PIX', icon: 'üîÑ' },
  { id: 'BLIK', name: 'BLIK', icon: 'üì±' },
  { id: 'Revolut', name: 'Revolut', icon: 'üí≥' },
  { id: 'Zelle', name: 'Zelle', icon: 'üè¶' },
];
export function MobileFilters({
  selectedCurrency,
  selectedPaymentMethod,
  onCurrencyChange,
  onPaymentMethodChange,
}: MobileFiltersProps) {
  const [showFilters, setShowFilters] = useState(false);
  const selectedCurrencyData = currencies.find(c => c.code === selectedCurrency);
  const selectedPaymentData = paymentMethods.find(p => p.id === selectedPaymentMethod);
  return (
    <>
      {/* Compact Filter Bar */}
      <div className="flex gap-2 p-3 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800">
        <button
          onClick={() => setShowFilters(true)}
          className="flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg text-sm"
        >
          <Filter className="w-4 h-4" />
          <span className="font-medium">Filters</span>
          {(selectedCurrency !== 'all' || selectedPaymentMethod !== 'all') && (
            <span className="px-2 py-0.5 bg-purple-600 text-white rounded-full text-xs">
              {[selectedCurrency !== 'all' && selectedCurrency, selectedPaymentMethod !== 'all' && selectedPaymentMethod].filter(Boolean).length}
            </span>
          )}
        </button>
        {selectedCurrency !== 'all' && (
          <button
            onClick={() => onCurrencyChange('all')}
            className="flex items-center gap-1 px-3 py-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg text-sm"
          >
            <span>{selectedCurrencyData?.flag}</span>
            <span className="font-medium">{selectedCurrency}</span>
            <X className="w-3 h-3" />
          </button>
        )}
        {selectedPaymentMethod !== 'all' && (
          <button
            onClick={() => onPaymentMethodChange('all')}
            className="flex items-center gap-1 px-3 py-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg text-sm"
          >
            <span>{selectedPaymentData?.icon}</span>
            <span className="font-medium">{selectedPaymentMethod}</span>
            <X className="w-3 h-3" />
          </button>
        )}
      </div>
      {/* Full Screen Filter Modal */}
      {showFilters && (
        <div className="fixed inset-0 z-50 bg-white dark:bg-gray-900">
          {/* Header */}
          <div className="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-800">
            <h2 className="text-lg font-semibold">Filters</h2>
            <button
              onClick={() => setShowFilters(false)}
              className="p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg"
            >
              <X className="w-5 h-5" />
            </button>
          </div>
          {/* Filter Content */}
          <div className="p-4 space-y-6 overflow-y-auto max-h-[calc(100vh-140px)]">
            {/* Currency */}
            <div>
              <h3 className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Currency</h3>
              <div className="grid grid-cols-4 gap-2">
                {currencies.map((currency) => (
                  <button
                    key={currency.code}
                    onClick={() => onCurrencyChange(currency.code)}
                    className={`
                      flex flex-col items-center gap-1 p-3 rounded-lg transition-all
                      ${selectedCurrency === currency.code
                        ? 'bg-purple-600 text-white'
                        : 'bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700'
                      }
                    `}
                  >
                    <span className="text-2xl">{currency.flag}</span>
                    <span className="text-xs font-medium">{currency.code === 'all' ? 'All' : currency.code}</span>
                  </button>
                ))}
              </div>
            </div>
            {/* Payment Method */}
            <div>
              <h3 className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Payment Method</h3>
              <div className="space-y-2">
                {paymentMethods.map((method) => (
                  <button
                    key={method.id}
                    onClick={() => onPaymentMethodChange(method.id)}
                    className={`
                      w-full flex items-center gap-3 p-3 rounded-lg transition-all
                      ${selectedPaymentMethod === method.id
                        ? 'bg-purple-600 text-white'
                        : 'bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700'
                      }
                    `}
                  >
                    <span className="text-xl">{method.icon}</span>
                    <span className="font-medium">{method.name}</span>
                  </button>
                ))}
              </div>
            </div>
          </div>
          {/* Footer */}
          <div className="absolute bottom-0 left-0 right-0 p-4 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800">
            <div className="flex gap-2">
              <button
                onClick={() => {
                  onCurrencyChange('all');
                  onPaymentMethodChange('all');
                }}
                className="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800"
              >
                Clear All
              </button>
              <button
                onClick={() => setShowFilters(false)}
                className="flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700"
              >
                Apply Filters
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  );
}
</file>

<file path="features/trades/OrderBook.tsx">
import { useEffect, useState } from 'react';
import { useNDK } from '@nostr-dev-kit/ndk-hooks';
import { NDKEvent, type NDKFilter } from '@nostr-dev-kit/ndk';
import { OrderCard } from './OrderCard';
interface Order {
  id: string;
  pubkey: string;
  type: 'buy' | 'sell';
  currency: string;
  status: string;
  paymentMethod: string;
  satsAmount: number;
  fiatAmount: number;
  premium?: number;
  rating?: number;
  platform?: string;
  createdAt: number;
  event: NDKEvent;
}
interface OrderBookProps {
  filters: {
    currency: string;
    paymentMethod: string;
    orderType: 'all' | 'buy' | 'sell';
    minAmount: number;
    maxAmount: number;
  };
}
export function OrderBook({ filters }: OrderBookProps) {
  const { ndk } = useNDK();
  const [orders, setOrders] = useState<Order[]>([]);
  const [loading, setLoading] = useState(true);
  useEffect(() => {
    if (!ndk) return;
    const fetchOrders = async () => {
      setLoading(true);
      const filter: NDKFilter = {
        kinds: [38383 as any],
        limit: 100,
      };
      const events = await ndk.fetchEvents(filter);
      const parsedOrders: Order[] = [];
      events.forEach((event: NDKEvent) => {
        const tags = event.tags;
        // Skip info events
        const zTag = tags.find((t: string[]) => t[0] === 'z');
        if (zTag && zTag[1] === 'info') return;
        // Extract order data from tags
        const orderType = tags.find((t: string[]) => t[0] === 'k')?.[1] as 'buy' | 'sell';
        const currency = tags.find((t: string[]) => t[0] === 'f')?.[1];
        const status = tags.find((t: string[]) => t[0] === 's')?.[1];
        const paymentMethod = tags.find((t: string[]) => t[0] === 'pm')?.[1];
        const satsAmount = parseInt(tags.find((t: string[]) => t[0] === 'amt')?.[1] || '0');
        const fiatAmount = parseFloat(tags.find((t: string[]) => t[0] === 'fa')?.[1] || '0');
        const premium = parseFloat(tags.find((t: string[]) => t[0] === 'premium')?.[1] || '0');
        const rating = parseFloat(tags.find((t: string[]) => t[0] === 'rating')?.[1] || '0');
        const platform = tags.find((t: string[]) => t[0] === 'y')?.[1];
        const dTag = tags.find((t: string[]) => t[0] === 'd')?.[1];
        // Only include active orders
        if (status === 'pending' && orderType && currency && dTag) {
          parsedOrders.push({
            id: dTag,
            pubkey: event.pubkey,
            type: orderType,
            currency,
            status,
            paymentMethod: paymentMethod || 'Unknown',
            satsAmount,
            fiatAmount,
            premium,
            rating,
            platform,
            createdAt: event.created_at || Date.now() / 1000,
            event
          });
        }
      });
      // Sort by created date, newest first
      parsedOrders.sort((a, b) => b.createdAt - a.createdAt);
      setOrders(parsedOrders);
      setLoading(false);
    };
    fetchOrders();
    // Subscribe to new orders
    const sub = ndk.subscribe(
      { kinds: [38383 as any], since: Math.floor(Date.now() / 1000) },
      { closeOnEose: false }
    );
    sub.on('event', (event: NDKEvent) => {
      const tags = event.tags;
      const zTag = tags.find((t: string[]) => t[0] === 'z');
      if (zTag && zTag[1] === 'info') return;
      const orderType = tags.find((t: string[]) => t[0] === 'k')?.[1] as 'buy' | 'sell';
      const currency = tags.find((t: string[]) => t[0] === 'f')?.[1];
      const status = tags.find((t: string[]) => t[0] === 's')?.[1];
      const dTag = tags.find((t: string[]) => t[0] === 'd')?.[1];
      if (status === 'pending' && orderType && currency && dTag) {
        const newOrder: Order = {
          id: dTag,
          pubkey: event.pubkey,
          type: orderType,
          currency,
          status,
          paymentMethod: tags.find((t: string[]) => t[0] === 'pm')?.[1] || 'Unknown',
          satsAmount: parseInt(tags.find((t: string[]) => t[0] === 'amt')?.[1] || '0'),
          fiatAmount: parseFloat(tags.find((t: string[]) => t[0] === 'fa')?.[1] || '0'),
          premium: parseFloat(tags.find((t: string[]) => t[0] === 'premium')?.[1] || '0'),
          rating: parseFloat(tags.find((t: string[]) => t[0] === 'rating')?.[1] || '0'),
          platform: tags.find((t: string[]) => t[0] === 'y')?.[1],
          createdAt: event.created_at || Date.now() / 1000,
          event
        };
        setOrders(prev => [newOrder, ...prev.filter(o => o.id !== dTag)]);
      }
    });
    return () => {
      sub.stop();
    };
  }, [ndk]);
  // Filter orders based on user preferences
  const filteredOrders = orders.filter(order => {
    if (filters.currency !== 'all' && order.currency !== filters.currency) return false;
    if (filters.paymentMethod !== 'all' && order.paymentMethod !== filters.paymentMethod) return false;
    if (filters.orderType !== 'all' && order.type !== filters.orderType) return false;
    if (order.satsAmount < filters.minAmount || order.satsAmount > filters.maxAmount) return false;
    return true;
  });
  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-[400px]">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"></div>
      </div>
    );
  }
  return (
    <div className="w-full">
      <div className="grid gap-3 md:gap-4">
        {filteredOrders.length === 0 ? (
          <div className="text-center py-12 text-gray-500">
            No orders available matching your filters
          </div>
        ) : (
          filteredOrders.map(order => (
            <OrderCard key={order.id} order={order} />
          ))
        )}
      </div>
    </div>
  );
}
</file>

<file path="features/trades/OrderCard.tsx">
import { useState } from 'react';
import { Bitcoin, Star, MessageSquare, ArrowRight, Shield } from 'lucide-react';
import { useProfile } from '@nostr-dev-kit/ndk-hooks';
import { formatDistanceToNow } from 'date-fns';
import { NDKEvent } from '@nostr-dev-kit/ndk';
import { TakeOrderModal } from './TakeOrderModal';
interface OrderCardProps {
  order: {
    id: string;
    pubkey: string;
    type: 'buy' | 'sell';
    currency: string;
    status: string;
    paymentMethod: string;
    satsAmount: number;
    fiatAmount: number;
    premium?: number;
    rating?: number;
    platform?: string;
    createdAt: number;
    event: NDKEvent;
  };
}
const currencyData: { [key: string]: { symbol: string; flag: string } } = {
  USD: { symbol: '$', flag: 'üá∫üá∏' },
  EUR: { symbol: '‚Ç¨', flag: 'üá™üá∫' },
  GBP: { symbol: '¬£', flag: 'üá¨üáß' },
  BRL: { symbol: 'R$', flag: 'üáßüá∑' },
  ARS: { symbol: '$', flag: 'üá¶üá∑' },
  PLN: { symbol: 'z≈Ç', flag: 'üáµüá±' },
  JPY: { symbol: '¬•', flag: 'üáØüáµ' },
  CHF: { symbol: 'Fr', flag: 'üá®üá≠' },
  PEN: { symbol: 'S/', flag: 'üáµüá™' },
  UYU: { symbol: '$', flag: 'üá∫üáæ' },
  VES: { symbol: 'Bs', flag: 'üáªüá™' },
  RUB: { symbol: '‚ÇΩ', flag: 'üá∑üá∫' },
  SEK: { symbol: 'kr', flag: 'üá∏üá™' },
  NOK: { symbol: 'kr', flag: 'üá≥üá¥' },
  AUD: { symbol: '$', flag: 'üá¶üá∫' },
  CUP: { symbol: '$', flag: 'üá®üá∫' },
};
const paymentMethodData: { [key: string]: { icon: string; region: string } } = {
  'Cash': { icon: 'üíµ', region: 'Universal' },
  'PIX': { icon: 'üîÑ', region: 'Brazil' },
  'BLIK': { icon: 'üì±', region: 'Poland' },
  'Revolut': { icon: 'üí≥', region: 'Europe' },
  'Zelle': { icon: 'üè¶', region: 'USA' },
  'CashApp': { icon: 'üì≤', region: 'USA' },
  'CVU': { icon: 'üèß', region: 'Argentina' },
  'MP': { icon: 'üì≤', region: 'Argentina' },
  'f2f': { icon: 'ü§ù', region: 'Local' },
  '–°–ë–ü': { icon: 'üè¶', region: 'Russia' },
};
export function OrderCard({ order }: OrderCardProps) {
  const profile = useProfile(order.pubkey);
  const [showTakeModal, setShowTakeModal] = useState(false);
  const currencyInfo = currencyData[order.currency] || { symbol: order.currency, flag: 'üåç' };
  const paymentInfo = paymentMethodData[order.paymentMethod] || { icon: 'üí∞', region: '' };
  // Calculate price per BTC
  const pricePerBtc = order.fiatAmount > 0 && order.satsAmount > 0
    ? (order.fiatAmount / order.satsAmount) * 100000000
    : 0;
  return (
    <>
      <div className="bg-white dark:bg-gray-900 rounded-lg md:rounded-xl border border-gray-200 dark:border-gray-800 p-3 md:p-4 hover:shadow-lg transition-shadow">
        <div className="flex items-start justify-between mb-2 md:mb-3">
          <div className="flex items-center gap-3">
            {profile?.picture ? (
              <img
                src={profile.picture}
                alt={profile.name || 'User'}
                className="w-10 h-10 md:w-12 md:h-12 rounded-full object-cover"
              />
            ) : (
              <div className="w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full" />
            )}
            <div>
              <div className="flex items-center gap-2">
                <h3 className="font-semibold text-sm md:text-base text-gray-900 dark:text-white">
                  {profile?.name || `@${order.pubkey.slice(0, 6)}...`}
                </h3>
                {order.rating && order.rating > 0 && (
                  <div className="flex items-center gap-1 text-yellow-500">
                    <Star className="w-4 h-4 fill-current" />
                    <span className="text-sm">{order.rating.toFixed(1)}</span>
                  </div>
                )}
              </div>
              <p className="text-xs text-gray-500 dark:text-gray-400">
                {formatDistanceToNow(order.createdAt * 1000, { addSuffix: true })}
                {order.platform && ` ‚Ä¢ ${order.platform}`}
              </p>
            </div>
          </div>
          <div className="flex items-center gap-1 md:gap-2">
            <span className="text-lg md:text-2xl">{currencyInfo.flag}</span>
            <div className={`px-2 md:px-3 py-0.5 md:py-1 rounded-full text-xs md:text-sm font-medium ${
              order.type === 'buy'
                ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400'
                : 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400'
            }`}>
              {order.type === 'buy' ? 'Buying' : 'Selling'}
            </div>
          </div>
        </div>
        <div className="grid grid-cols-3 gap-2 md:gap-4 mb-3 md:mb-4">
          <div>
            <p className="text-xs text-gray-500 dark:text-gray-400 mb-0.5 md:mb-1">Amount</p>
            <div className="flex items-center gap-1 md:gap-2">
              <Bitcoin className="w-3 h-3 md:w-4 md:h-4 text-orange-500" />
              <span className="font-mono font-semibold text-xs md:text-base text-gray-900 dark:text-white">
                {(order.satsAmount / 100000000).toFixed(4)}
              </span>
            </div>
            <p className="text-xs text-gray-500 dark:text-gray-400 mt-0.5 md:mt-1 hidden md:block">
              {order.satsAmount.toLocaleString()} sats
            </p>
          </div>
          <div>
            <p className="text-xs text-gray-500 dark:text-gray-400 mb-0.5 md:mb-1">Price</p>
            <div className="flex items-center gap-1">
              <span className="text-sm md:text-base hidden md:inline">{currencyInfo.flag}</span>
              <p className="text-sm md:text-lg font-semibold text-gray-900 dark:text-white">
                {currencyInfo.symbol}{order.fiatAmount.toFixed(0)}
              </p>
            </div>
            {pricePerBtc > 0 && (
              <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">
                {currencyInfo.symbol}{pricePerBtc.toFixed(2)}/BTC
                {order.premium && order.premium !== 0 && (
                  <span className={order.premium > 0 ? 'text-red-500' : 'text-green-500'}>
                    {' '}({order.premium > 0 ? '+' : ''}{order.premium}%)
                  </span>
                )}
              </p>
            )}
          </div>
          <div className="min-w-0">
            <p className="text-xs text-gray-500 dark:text-gray-400 mb-0.5 md:mb-1">Payment</p>
            <div className="flex items-center gap-1 md:gap-2">
              <span className="text-sm md:text-lg flex-shrink-0">{paymentInfo.icon}</span>
              <div className="flex flex-col min-w-0">
                <span className="font-medium text-xs md:text-base text-gray-900 dark:text-white truncate max-w-[80px] md:max-w-none">
                  {order.paymentMethod}
                </span>
                {paymentInfo.region && (
                  <span className="text-xs text-gray-500 dark:text-gray-400 hidden md:inline">
                    {paymentInfo.region}
                  </span>
                )}
              </div>
            </div>
          </div>
        </div>
        <div className="flex items-center gap-2">
          <button
            onClick={() => setShowTakeModal(true)}
            className="flex-1 flex items-center justify-center gap-1 md:gap-2 px-3 md:px-4 py-1.5 md:py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm md:text-base"
          >
            <ArrowRight className="w-3 h-3 md:w-4 md:h-4" />
            <span className="hidden md:inline">{order.type === 'buy' ? 'Sell to User' : 'Buy from User'}</span>
            <span className="md:hidden">{order.type === 'buy' ? 'Sell' : 'Buy'}</span>
          </button>
          <button className="p-1.5 md:p-2 border border-gray-300 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
            <MessageSquare className="w-3 h-3 md:w-4 md:h-4" />
          </button>
          <button className="p-1.5 md:p-2 border border-gray-300 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors hidden md:block">
            <Shield className="w-3 h-3 md:w-4 md:h-4" />
          </button>
        </div>
      </div>
      {showTakeModal && (
        <TakeOrderModal order={order} onClose={() => setShowTakeModal(false)} />
      )}
    </>
  );
}
</file>

<file path="features/trades/QuickFilters.tsx">
import { Globe, CreditCard } from 'lucide-react';
interface QuickFiltersProps {
  selectedCurrency: string;
  selectedPaymentMethod: string;
  onCurrencyChange: (currency: string) => void;
  onPaymentMethodChange: (method: string) => void;
}
const popularCurrencies = [
  { code: 'all', name: 'All', flag: 'üåç' },
  { code: 'USD', name: 'USD', flag: 'üá∫üá∏' },
  { code: 'EUR', name: 'EUR', flag: 'üá™üá∫' },
  { code: 'BRL', name: 'BRL', flag: 'üáßüá∑' },
  { code: 'ARS', name: 'ARS', flag: 'üá¶üá∑' },
  { code: 'GBP', name: 'GBP', flag: 'üá¨üáß' },
  { code: 'PLN', name: 'PLN', flag: 'üáµüá±' },
  { code: 'JPY', name: 'JPY', flag: 'üáØüáµ' },
];
const popularPaymentMethods = [
  { id: 'all', name: 'All Methods', icon: 'üí∞', countries: [] },
  { id: 'Cash', name: 'Cash', icon: 'üíµ', countries: ['Universal'] },
  { id: 'PIX', name: 'PIX', icon: 'üîÑ', countries: ['Brazil'] },
  { id: 'BLIK', name: 'BLIK', icon: 'üì±', countries: ['Poland'] },
  { id: 'Revolut', name: 'Revolut', icon: 'üí≥', countries: ['Europe'] },
  { id: 'Zelle', name: 'Zelle', icon: 'üè¶', countries: ['USA'] },
  { id: 'CashApp', name: 'CashApp', icon: 'üì≤', countries: ['USA'] },
  { id: 'CVU', name: 'CVU/MP', icon: 'üèß', countries: ['Argentina'] },
  { id: 'f2f', name: 'Face to Face', icon: 'ü§ù', countries: ['Local'] },
];
export function QuickFilters({
  selectedCurrency,
  selectedPaymentMethod,
  onCurrencyChange,
  onPaymentMethodChange,
}: QuickFiltersProps) {
  return (
    <div className="space-y-4">
      {/* Currency Filter */}
      <div>
        <div className="flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          <Globe className="w-4 h-4" />
          <span>Currency</span>
        </div>
        <div className="flex flex-wrap gap-2">
          {popularCurrencies.map((currency) => (
            <button
              key={currency.code}
              onClick={() => onCurrencyChange(currency.code)}
              className={`
                flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium transition-all
                ${selectedCurrency === currency.code
                  ? 'bg-purple-600 text-white shadow-md scale-105'
                  : 'bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:border-purple-400 dark:hover:border-purple-600 hover:shadow-sm'
                }
              `}
            >
              <span className="text-base">{currency.flag}</span>
              <span>{currency.name}</span>
            </button>
          ))}
        </div>
      </div>
      {/* Payment Method Filter */}
      <div>
        <div className="flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          <CreditCard className="w-4 h-4" />
          <span>Payment Method</span>
        </div>
        <div className="flex flex-wrap gap-2">
          {popularPaymentMethods.map((method) => (
            <button
              key={method.id}
              onClick={() => onPaymentMethodChange(method.id)}
              className={`
                group flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium transition-all
                ${selectedPaymentMethod === method.id
                  ? 'bg-purple-600 text-white shadow-md scale-105'
                  : 'bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:border-purple-400 dark:hover:border-purple-600 hover:shadow-sm'
                }
              `}
            >
              <span className="text-base">{method.icon}</span>
              <span>{method.name}</span>
              {method.countries.length > 0 && method.id !== 'all' && (
                <span className={`
                  text-xs px-1.5 py-0.5 rounded-full ml-1
                  ${selectedPaymentMethod === method.id
                    ? 'bg-purple-700/50'
                    : 'bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400'
                  }
                `}>
                  {method.countries[0]}
                </span>
              )}
            </button>
          ))}
        </div>
      </div>
      {/* Active Filters Summary */}
      {(selectedCurrency !== 'all' || selectedPaymentMethod !== 'all') && (
        <div className="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400">
          <span>Active filters:</span>
          {selectedCurrency !== 'all' && (
            <span className="px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 rounded-full text-xs font-medium">
              {popularCurrencies.find(c => c.code === selectedCurrency)?.flag} {selectedCurrency}
            </span>
          )}
          {selectedPaymentMethod !== 'all' && (
            <span className="px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 rounded-full text-xs font-medium">
              {popularPaymentMethods.find(m => m.id === selectedPaymentMethod)?.icon} {selectedPaymentMethod}
            </span>
          )}
          <button
            onClick={() => {
              onCurrencyChange('all');
              onPaymentMethodChange('all');
            }}
            className="text-purple-600 hover:text-purple-700 dark:text-purple-400 dark:hover:text-purple-300 underline text-xs"
          >
            Clear all
          </button>
        </div>
      )}
    </div>
  );
}
</file>

<file path="features/trades/TakeOrderModal.tsx">
import { useState } from 'react';
import { X, AlertTriangle, Bitcoin, Shield } from 'lucide-react';
import { useNDK } from '@nostr-dev-kit/ndk-hooks';
import { NDKEvent } from '@nostr-dev-kit/ndk';
import { useProfile } from '@nostr-dev-kit/ndk-hooks';
interface TakeOrderModalProps {
  order: {
    id: string;
    pubkey: string;
    type: 'buy' | 'sell';
    currency: string;
    status: string;
    paymentMethod: string;
    satsAmount: number;
    fiatAmount: number;
    premium?: number;
    rating?: number;
    platform?: string;
    createdAt: number;
    event: NDKEvent;
  };
  onClose: () => void;
}
export function TakeOrderModal({ order, onClose }: TakeOrderModalProps) {
  const { ndk } = useNDK();
  const profile = useProfile(order.pubkey);
  const [step, setStep] = useState<'confirm' | 'processing' | 'complete'>('confirm');
  const [accepted, setAccepted] = useState(false);
  const handleTakeOrder = async () => {
    if (!ndk) return;
    setStep('processing');
    try {
      // Create a take order event
      const event = new NDKEvent(ndk);
      event.kind = 38383;
      // Create response event with reference to original order
      event.tags = [
        ['d', `take-${order.id}-${Date.now()}`],
        ['e', order.event.id],
        ['p', order.pubkey],
        ['k', order.type === 'buy' ? 'sell' : 'buy'],
        ['f', order.currency],
        ['s', 'in-progress'],
        ['amt', order.satsAmount.toString()],
        ['fa', order.fiatAmount.toString()],
        ['pm', order.paymentMethod],
        ['y', 'Voces'],
        ['z', 'take-order']
      ];
      event.content = `Taking order ${order.id}`;
      await event.publish();
      // Update original order status (in real implementation, this would be handled by the maker)
      const statusUpdate = new NDKEvent(ndk);
      statusUpdate.kind = 38383;
      statusUpdate.tags = [
        ...order.event.tags.filter(t => t[0] !== 's'),
        ['s', 'in-progress']
      ];
      statusUpdate.content = '';
      await statusUpdate.publish();
      setStep('complete');
      // Close modal after a delay
      setTimeout(() => {
        onClose();
      }, 2000);
    } catch (error) {
      console.error('Failed to take order:', error);
      setStep('confirm');
    }
  };
  const currencySymbol = { USD: '$', EUR: '‚Ç¨', GBP: '¬£', BRL: 'R$' }[order.currency] || order.currency;
  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4">
      <div className="bg-white dark:bg-gray-900 rounded-2xl max-w-md w-full">
        {step === 'confirm' && (
          <>
            <div className="p-6 border-b border-gray-200 dark:border-gray-800">
              <div className="flex items-center justify-between">
                <h2 className="text-xl font-bold text-gray-900 dark:text-white">
                  Confirm Trade
                </h2>
                <button
                  onClick={onClose}
                  className="p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors"
                >
                  <X className="w-5 h-5" />
                </button>
              </div>
            </div>
            <div className="p-6 space-y-4">
              {/* Trade Summary */}
              <div className="bg-gray-50 dark:bg-gray-800 rounded-lg p-4 space-y-3">
                <div className="flex items-center justify-between">
                  <span className="text-sm text-gray-500 dark:text-gray-400">You will {order.type === 'buy' ? 'sell' : 'buy'}</span>
                  <div className="flex items-center gap-1">
                    <Bitcoin className="w-4 h-4 text-orange-500" />
                    <span className="font-mono font-semibold">{(order.satsAmount / 100000000).toFixed(8)} BTC</span>
                  </div>
                </div>
                <div className="flex items-center justify-between">
                  <span className="text-sm text-gray-500 dark:text-gray-400">For</span>
                  <span className="font-semibold">{currencySymbol}{order.fiatAmount.toFixed(2)}</span>
                </div>
                <div className="flex items-center justify-between">
                  <span className="text-sm text-gray-500 dark:text-gray-400">Via</span>
                  <span className="font-medium">{order.paymentMethod}</span>
                </div>
                <div className="flex items-center justify-between">
                  <span className="text-sm text-gray-500 dark:text-gray-400">Trading with</span>
                  <div className="flex items-center gap-2">
                    <span className="font-medium">{profile?.name || 'Anonymous'}</span>
                    {order.rating && (
                      <span className="text-yellow-500 text-sm">‚òÖ {order.rating.toFixed(1)}</span>
                    )}
                  </div>
                </div>
              </div>
              {/* Warning */}
              <div className="flex items-start gap-3 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">
                <AlertTriangle className="w-5 h-5 text-yellow-600 dark:text-yellow-500 flex-shrink-0 mt-0.5" />
                <div className="text-sm text-yellow-800 dark:text-yellow-300">
                  <p className="font-medium mb-1">Trade Safely</p>
                  <ul className="space-y-1 text-xs">
                    <li>‚Ä¢ Never release funds before confirming payment</li>
                    <li>‚Ä¢ Use escrow when available</li>
                    <li>‚Ä¢ Communicate only through secure channels</li>
                    <li>‚Ä¢ Report suspicious behavior immediately</li>
                  </ul>
                </div>
              </div>
              {/* Terms Acceptance */}
              <label className="flex items-start gap-3 cursor-pointer">
                <input
                  type="checkbox"
                  checked={accepted}
                  onChange={(e) => setAccepted(e.target.checked)}
                  className="mt-1 w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"
                />
                <span className="text-sm text-gray-700 dark:text-gray-300">
                  I understand the risks and agree to proceed with this P2P trade
                </span>
              </label>
              {/* Actions */}
              <div className="flex gap-3">
                <button
                  onClick={onClose}
                  className="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors"
                >
                  Cancel
                </button>
                <button
                  onClick={handleTakeOrder}
                  disabled={!accepted}
                  className="flex-1 px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                >
                  Take Order
                </button>
              </div>
            </div>
          </>
        )}
        {step === 'processing' && (
          <div className="p-12 text-center">
            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"></div>
            <p className="text-gray-900 dark:text-white font-medium">Processing Trade...</p>
            <p className="text-sm text-gray-500 dark:text-gray-400 mt-2">
              Connecting with trader
            </p>
          </div>
        )}
        {step === 'complete' && (
          <div className="p-12 text-center">
            <div className="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4">
              <Shield className="w-6 h-6 text-green-600 dark:text-green-400" />
            </div>
            <p className="text-gray-900 dark:text-white font-medium">Trade Initiated!</p>
            <p className="text-sm text-gray-500 dark:text-gray-400 mt-2">
              Check your messages for next steps
            </p>
          </div>
        )}
      </div>
    </div>
  );
}
</file>

<file path="features/trades/TradeFilters.tsx">
import { DollarSign, CreditCard, TrendingUp } from 'lucide-react';
interface TradeFiltersProps {
  filters: {
    currency: string;
    paymentMethod: string;
    orderType: 'all' | 'buy' | 'sell';
    minAmount: number;
    maxAmount: number;
  };
  onChange: (filters: any) => void;
}
const currencies = [
  { code: 'all', name: 'All Currencies' },
  { code: 'USD', name: 'US Dollar' },
  { code: 'EUR', name: 'Euro' },
  { code: 'GBP', name: 'British Pound' },
  { code: 'BRL', name: 'Brazilian Real' },
  { code: 'ARS', name: 'Argentine Peso' },
  { code: 'PLN', name: 'Polish Z≈Çoty' },
];
const paymentMethods = [
  { id: 'all', name: 'All Methods' },
  { id: 'Cash', name: 'Cash' },
  { id: 'Revolut', name: 'Revolut' },
  { id: 'PIX', name: 'PIX' },
  { id: 'BLIK', name: 'BLIK' },
  { id: 'Zelle', name: 'Zelle' },
  { id: 'CashApp', name: 'Cash App' },
];
export function TradeFilters({ filters, onChange }: TradeFiltersProps) {
  return (
    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
      {/* Currency Filter */}
      <div>
        <label className="flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          <DollarSign className="w-4 h-4" />
          Currency
        </label>
        <select
          value={filters.currency}
          onChange={(e) => onChange({ ...filters, currency: e.target.value })}
          className="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
        >
          {currencies.map((curr) => (
            <option key={curr.code} value={curr.code}>
              {curr.name}
            </option>
          ))}
        </select>
      </div>
      {/* Payment Method Filter */}
      <div>
        <label className="flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          <CreditCard className="w-4 h-4" />
          Payment Method
        </label>
        <select
          value={filters.paymentMethod}
          onChange={(e) => onChange({ ...filters, paymentMethod: e.target.value })}
          className="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
        >
          {paymentMethods.map((method) => (
            <option key={method.id} value={method.id}>
              {method.name}
            </option>
          ))}
        </select>
      </div>
      {/* Order Type Filter */}
      <div>
        <label className="flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          <TrendingUp className="w-4 h-4" />
          Order Type
        </label>
        <select
          value={filters.orderType}
          onChange={(e) => onChange({ ...filters, orderType: e.target.value as 'all' | 'buy' | 'sell' })}
          className="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
        >
          <option value="all">All Orders</option>
          <option value="buy">Buy Orders</option>
          <option value="sell">Sell Orders</option>
        </select>
      </div>
      {/* Amount Range */}
      <div>
        <label className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block">
          Amount Range (sats)
        </label>
        <div className="flex items-center gap-2">
          <input
            type="number"
            value={filters.minAmount}
            onChange={(e) => onChange({ ...filters, minAmount: parseInt(e.target.value) || 0 })}
            className="w-full px-2 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white text-sm"
            placeholder="Min"
          />
          <span className="text-gray-500">-</span>
          <input
            type="number"
            value={filters.maxAmount}
            onChange={(e) => onChange({ ...filters, maxAmount: parseInt(e.target.value) || 1000000 })}
            className="w-full px-2 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white text-sm"
            placeholder="Max"
          />
        </div>
      </div>
    </div>
  );
}
</file>

<file path="lib/utils.ts">
import { type ClassValue, clsx } from "clsx"
import { twMerge } from "tailwind-merge"
export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
</file>

<file path="pages/marketplace/CreateListingPage.tsx">
import { useNavigate } from 'react-router-dom';
import { ArrowLeft } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { ListingForm } from '@/features/classifieds/components/ListingForm';
import { useCreateListing } from '@/features/classifieds/hooks/useCreateListing';
import type { ListingFormData } from '@/features/classifieds/types';
import { useState } from 'react';
export function CreateListingPage() {
  const navigate = useNavigate();
  const { createListing, isAuthenticated } = useCreateListing();
  const [isSubmitting, setIsSubmitting] = useState(false);
  const handleSubmit = async (data: ListingFormData) => {
    if (!isAuthenticated) {
      alert('Please log in to create a listing');
      return;
    }
    try {
      setIsSubmitting(true);
      await createListing(data);
      navigate('/marketplace');
    } catch (error) {
      console.error('Failed to create listing:', error);
      alert('Failed to create listing. Please try again.');
    } finally {
      setIsSubmitting(false);
    }
  };
  if (!isAuthenticated) {
    return (
      <div className="container mx-auto px-4 py-12">
        <div className="max-w-2xl mx-auto text-center">
          <h2 className="text-2xl font-bold mb-4">Sign In Required</h2>
          <p className="text-gray-600 dark:text-gray-400 mb-6">
            You need to be logged in to create a listing.
          </p>
          <Button onClick={() => navigate('/')}>
            Go to Home
          </Button>
        </div>
      </div>
    );
  }
  return (
    <div className="container mx-auto px-4 py-6">
      <div className="max-w-4xl mx-auto">
        <div className="mb-6">
          <Button
            variant="ghost"
            onClick={() => navigate('/marketplace')}
            className="mb-4"
          >
            <ArrowLeft className="w-4 h-4 mr-2" />
            Back to Marketplace
          </Button>
          <h1 className="text-3xl font-bold text-gray-900 dark:text-white">
            Create New Listing
          </h1>
          <p className="text-gray-600 dark:text-gray-400 mt-2">
            Fill in the details below to create your classified listing
          </p>
        </div>
        <ListingForm onSubmit={handleSubmit} isSubmitting={isSubmitting} />
      </div>
    </div>
  );
}
</file>

<file path="pages/marketplace/ListingDetailPage.tsx">
import { useParams, useNavigate, Link } from 'react-router-dom';
import { ArrowLeft, MapPin, Clock, Tag, Share2, MessageCircle, Edit, Trash2 } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Card, CardContent } from '@/components/ui/card';
import { UserAvatar } from '@/components/ui/UserAvatar';
import { PriceTag } from '@/features/classifieds/components/PriceTag';
import { useSubscribe, useNDKCurrentUser } from '@nostr-dev-kit/ndk-hooks';
import { CLASSIFIED_LISTING_KIND, parseListingFromEvent } from '@/features/classifieds/types';
import { formatDistanceToNow } from 'date-fns';
import { Loader2 } from 'lucide-react';
import { useCreateListing } from '@/features/classifieds/hooks/useCreateListing';
import { useState } from 'react';
export function ListingDetailPage() {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();
  const currentUser = useNDKCurrentUser();
  const { deleteListing } = useCreateListing();
  const [isDeleting, setIsDeleting] = useState(false);
  const { events, eose } = useSubscribe([{
    ids: id ? [id] : [],
    kinds: [CLASSIFIED_LISTING_KIND]
  }]);
  if (!eose && events.length === 0) {
    return (
      <div className="container mx-auto px-4 py-12">
        <div className="flex items-center justify-center">
          <Loader2 className="w-8 h-8 animate-spin text-purple-600 dark:text-purple-400" />
        </div>
      </div>
    );
  }
  const event = events[0];
  if (!event) {
    return (
      <div className="container mx-auto px-4 py-12">
        <div className="max-w-2xl mx-auto text-center">
          <h2 className="text-2xl font-bold mb-4">Listing Not Found</h2>
          <p className="text-gray-600 dark:text-gray-400 mb-6">
            This listing may have been removed or doesn't exist.
          </p>
          <Button onClick={() => navigate('/marketplace')}>
            Back to Marketplace
          </Button>
        </div>
      </div>
    );
  }
  const listing = parseListingFromEvent(event);
  const isOwner = currentUser?.pubkey === listing.author;
  const timeAgo = listing.publishedAt
    ? formatDistanceToNow(new Date(listing.publishedAt * 1000), { addSuffix: true })
    : 'recently';
  const handleDelete = async () => {
    if (!confirm('Are you sure you want to delete this listing?')) return;
    try {
      setIsDeleting(true);
      await deleteListing(listing.id);
      navigate('/marketplace');
    } catch (error) {
      console.error('Failed to delete listing:', error);
      alert('Failed to delete listing. Please try again.');
    } finally {
      setIsDeleting(false);
    }
  };
  const handleShare = () => {
    const url = window.location.href;
    navigator.clipboard.writeText(url);
    alert('Link copied to clipboard!');
  };
  return (
    <div className="container mx-auto px-4 py-6">
      <div className="max-w-6xl mx-auto">
        <Button
          variant="ghost"
          onClick={() => navigate('/marketplace')}
          className="mb-6"
        >
          <ArrowLeft className="w-4 h-4 mr-2" />
          Back to Marketplace
        </Button>
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <div className="lg:col-span-2">
            {listing.images && listing.images.length > 0 && (
              <div className="mb-6">
                <div className="grid gap-4">
                  <img
                    src={listing.images[0]}
                    alt={listing.title}
                    className="w-full rounded-lg object-cover aspect-video"
                  />
                  {listing.images.length > 1 && (
                    <div className="grid grid-cols-4 gap-2">
                      {listing.images.slice(1).map((image, index) => (
                        <img
                          key={index}
                          src={image}
                          alt={`${listing.title} ${index + 2}`}
                          className="w-full h-24 rounded-lg object-cover cursor-pointer hover:opacity-75"
                        />
                      ))}
                    </div>
                  )}
                </div>
              </div>
            )}
            <Card>
              <CardContent className="p-6">
                <div className="mb-6">
                  <div className="flex items-start justify-between mb-4">
                    <h1 className="text-2xl font-bold text-gray-900 dark:text-white">
                      {listing.title}
                    </h1>
                    {listing.price && (
                      <PriceTag price={listing.price} className="text-lg px-4 py-2" />
                    )}
                  </div>
                  {listing.status === 'sold' && (
                    <div className="mb-4 p-4 bg-red-100 dark:bg-red-900/20 text-red-800 dark:text-red-400 rounded-lg text-center font-semibold">
                      This item has been sold
                    </div>
                  )}
                  <div className="flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400 mb-6">
                    {listing.location && (
                      <div className="flex items-center gap-1">
                        <MapPin className="w-4 h-4" />
                        <span>{listing.location}</span>
                      </div>
                    )}
                    <div className="flex items-center gap-1">
                      <Clock className="w-4 h-4" />
                      <span>Posted {timeAgo}</span>
                    </div>
                  </div>
                  {listing.categories && listing.categories.length > 0 && (
                    <div className="flex flex-wrap gap-2 mb-6">
                      {listing.categories.map(category => (
                        <span
                          key={category}
                          className="inline-flex items-center gap-1 px-3 py-1 bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-400 rounded-full text-sm"
                        >
                          <Tag className="w-3 h-3" />
                          {category}
                        </span>
                      ))}
                    </div>
                  )}
                  <div className="prose dark:prose-invert max-w-none">
                    <h3 className="text-lg font-semibold mb-2">Description</h3>
                    <div className="whitespace-pre-wrap">{listing.content}</div>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>
          <div className="lg:col-span-1">
            <Card className="sticky top-6">
              <CardContent className="p-6">
                <div className="flex items-center gap-3 mb-6">
                  <UserAvatar pubkey={listing.author} size="lg" />
                  <div>
                    <p className="text-sm text-gray-500 dark:text-gray-400">Listed by</p>
                    <p className="font-medium">User</p>
                  </div>
                </div>
                <div className="space-y-3">
                  {isOwner ? (
                    <>
                      <Link to={`/marketplace/edit/${listing.id}`} className="block">
                        <Button className="w-full" variant="outline">
                          <Edit className="w-4 h-4 mr-2" />
                          Edit Listing
                        </Button>
                      </Link>
                      <Button
                        className="w-full"
                        variant="destructive"
                        onClick={handleDelete}
                        disabled={isDeleting}
                      >
                        <Trash2 className="w-4 h-4 mr-2" />
                        {isDeleting ? 'Deleting...' : 'Delete Listing'}
                      </Button>
                    </>
                  ) : (
                    <Button className="w-full">
                      <MessageCircle className="w-4 h-4 mr-2" />
                      Contact Seller
                    </Button>
                  )}
                  <Button
                    className="w-full"
                    variant="outline"
                    onClick={handleShare}
                  >
                    <Share2 className="w-4 h-4 mr-2" />
                    Share Listing
                  </Button>
                </div>
              </CardContent>
            </Card>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="pages/marketplace/MarketplacePage.tsx">
import { useState, useMemo, useEffect } from 'react';
import { useSearchParams } from 'react-router-dom';
import { Search } from 'lucide-react';
import { Input } from '@/components/ui/input';
import { ListingGrid } from '@/features/classifieds/components/ListingGrid';
import { CategorySection } from '@/features/classifieds/components/CategorySection';
import { FilterButton } from '@/features/classifieds/components/FilterButton';
import { useListings } from '@/features/classifieds/hooks/useListings';
import type { ClassifiedListing } from '@/features/classifieds/types';
const CATEGORIES = [
  { value: '', label: 'All Categories' },
  { value: 'electronics', label: 'Electronics' },
  { value: 'furniture', label: 'Furniture' },
  { value: 'clothing', label: 'Clothing' },
  { value: 'books', label: 'Books' },
  { value: 'services', label: 'Services' },
  { value: 'vehicles', label: 'Vehicles' },
  { value: 'real-estate', label: 'Real Estate' },
  { value: 'jobs', label: 'Jobs' },
  { value: 'free', label: 'Free' },
  { value: 'wanted', label: 'Wanted' }
];
export function MarketplacePage() {
  const [searchParams, setSearchParams] = useSearchParams();
  const [selectedCategory, setSelectedCategory] = useState(searchParams.get('category') || '');
  const [searchQuery, setSearchQuery] = useState('');
  const { listings, isLoading } = useListings({
    category: selectedCategory || undefined
  });
  // Update URL when category changes
  useEffect(() => {
    if (selectedCategory) {
      setSearchParams({ category: selectedCategory });
    } else {
      setSearchParams({});
    }
  }, [selectedCategory, setSearchParams]);
  // Filter and group listings
  const { filteredListings, listingsByCategory } = useMemo(() => {
    // First filter by search query
    const filtered = listings.filter(listing => {
      if (!searchQuery) return true;
      const query = searchQuery.toLowerCase();
      return (
        listing.title.toLowerCase().includes(query) ||
        listing.summary?.toLowerCase().includes(query) ||
        listing.content.toLowerCase().includes(query) ||
        listing.location?.toLowerCase().includes(query)
      );
    });
    // Group by category for the category sections view
    const byCategory = filtered.reduce<Record<string, ClassifiedListing[]>>((acc, listing) => {
      if (listing.categories && listing.categories.length > 0) {
        listing.categories.forEach(category => {
          const key = category.toLowerCase();
          if (!acc[key]) acc[key] = [];
          acc[key].push(listing);
        });
      } else {
        if (!acc['uncategorized']) acc['uncategorized'] = [];
        acc['uncategorized'].push(listing);
      }
      return acc;
    }, {});
    return { filteredListings: filtered, listingsByCategory: byCategory };
  }, [listings, searchQuery]);
  // Determine view mode
  const isFilteredView = selectedCategory || searchQuery;
  return (
    <div className="container mx-auto px-4 py-6">
      {/* Header */}
      <div className="mb-8">
        <h1 className="text-3xl font-bold text-gray-900 dark:text-white mb-6">
          Marketplace
        </h1>
        {/* Search and Filter Bar */}
        <div className="flex gap-3">
          <div className="flex-1">
            <div className="relative">
              <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" />
              <Input
                placeholder="Search listings..."
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                className="pl-10"
              />
            </div>
          </div>
          <FilterButton
            categories={CATEGORIES}
            selectedCategory={selectedCategory}
            onCategoryChange={setSelectedCategory}
          />
        </div>
      </div>
      {/* Content */}
      {isFilteredView ? (
        // Filtered view - show grid
        <div>
          {selectedCategory && (
            <div className="mb-6">
              <h2 className="text-xl font-semibold text-gray-900 dark:text-white">
                {CATEGORIES.find(c => c.value === selectedCategory)?.label || selectedCategory}
              </h2>
              <p className="text-sm text-gray-500 dark:text-gray-400 mt-1">
                {filteredListings.length} listings found
              </p>
            </div>
          )}
          <ListingGrid listings={filteredListings} isLoading={isLoading} />
        </div>
      ) : (
        // Category sections view
        <div>
          {isLoading && Object.keys(listingsByCategory).length === 0 ? (
            <ListingGrid listings={[]} isLoading={true} />
          ) : (
            <>
              {/* Featured/Recent listings */}
              {listings.length > 0 && (
                <CategorySection
                  category="Recent Listings"
                  listings={listings.slice(0, 10)}
                  showViewAll={false}
                />
              )}
              {/* Category sections */}
              {CATEGORIES.filter(c => c.value && listingsByCategory[c.value]?.length > 0).map(category => (
                <CategorySection
                  key={category.value}
                  category={category.value}
                  listings={listingsByCategory[category.value]}
                />
              ))}
              {/* Uncategorized section */}
              {listingsByCategory['uncategorized']?.length > 0 && (
                <CategorySection
                  category="Other"
                  listings={listingsByCategory['uncategorized']}
                  showViewAll={false}
                />
              )}
            </>
          )}
        </div>
      )}
    </div>
  );
}
</file>

<file path="pages/ComposePage.tsx">
import { ComposeNote } from '@/features/feed/ComposeNote';
import { useNavigate } from 'react-router-dom';
import { ArrowLeft } from 'lucide-react';
export function ComposePage() {
  const navigate = useNavigate();
  return (
    <div className="max-w-2xl mx-auto">
      {/* Page header */}
      <div className="sticky top-0 z-30 bg-white/80 dark:bg-gray-950/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-800">
        <div className="flex items-center gap-4 px-4 py-3 sm:px-6">
          <button
            onClick={() => navigate(-1)}
            className="p-2 -ml-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
          >
            <ArrowLeft className="w-5 h-5" />
          </button>
          <h2 className="text-lg font-semibold text-gray-900 dark:text-gray-100">Compose</h2>
        </div>
      </div>
      {/* Compose section */}
      <div className="p-4 sm:p-6">
        <ComposeNote />
      </div>
    </div>
  );
}
</file>

<file path="pages/HomePage.tsx">
import { NoteFeed } from '@/features/feed/NoteFeed';
import { ComposeNote } from '@/features/feed/ComposeNote';
import { useNDKCurrentUser } from '@nostr-dev-kit/ndk-hooks';
export function HomePage() {
  const currentUser = useNDKCurrentUser();
  return (
    <div className="max-w-2xl mx-auto">
      {/* Feed header */}
      <div className="sticky top-0 z-30 bg-white/80 dark:bg-gray-950/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-800">
        <div className="px-4 py-3 sm:px-6">
          <h2 className="text-lg font-semibold text-gray-900 dark:text-gray-100">Home</h2>
        </div>
      </div>
      {/* Compose section for logged-in users - hidden on mobile */}
      {currentUser && (
        <div className="hidden md:block border-b border-gray-200 dark:border-gray-800">
          <div className="p-4 sm:p-6">
            <ComposeNote />
          </div>
        </div>
      )}
      {/* Notes feed */}
      <NoteFeed />
    </div>
  );
}
</file>

<file path="pages/NotificationsPage.tsx">
import { Bell } from 'lucide-react';
export function NotificationsPage() {
  return (
    <div className="max-w-2xl mx-auto">
      {/* Page header */}
      <div className="sticky top-0 z-30 bg-white/80 dark:bg-gray-950/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-800">
        <div className="px-4 py-3 sm:px-6">
          <h2 className="text-lg font-semibold text-gray-900 dark:text-gray-100">Notifications</h2>
        </div>
      </div>
      {/* Empty state */}
      <div className="flex flex-col items-center justify-center py-16 px-4">
        <div className="w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mb-4">
          <Bell className="w-8 h-8 text-gray-400 dark:text-gray-600" />
        </div>
        <h3 className="text-lg font-medium text-gray-900 dark:text-gray-100 mb-1">
          No notifications yet
        </h3>
        <p className="text-gray-500 dark:text-gray-400 text-center max-w-sm">
          When someone mentions you or interacts with your notes, you'll see it here.
        </p>
      </div>
    </div>
  );
}
</file>

<file path="pages/ProfilePage.tsx">
import { useNDKCurrentUser, useProfile, useSubscribe, NDKKind } from '@nostr-dev-kit/ndk-hooks';
import { Calendar, MapPin, Link as LinkIcon } from 'lucide-react';
import { NoteCard } from '@/features/feed/NoteCard';
import { useParams } from 'react-router-dom';
export function ProfilePage() {
  const { pubkey } = useParams<{ pubkey?: string }>();
  const currentUser = useNDKCurrentUser();
  const targetPubkey = pubkey || currentUser?.pubkey;
  const profile = useProfile(targetPubkey);
  const { events } = useSubscribe(targetPubkey ? [{
    kinds: [NDKKind.Text],
    authors: [targetPubkey],
    limit: 20,
  }] : []);
  if (!targetPubkey) return null;
  return (
    <div className="max-w-2xl mx-auto">
      {/* Profile header */}
      <div className="bg-white dark:bg-gray-950 border-b border-gray-200 dark:border-gray-800">
        {/* Cover image */}
        <div className="h-32 sm:h-48 bg-gradient-to-br from-purple-500 to-pink-500"></div>
        {/* Profile info */}
        <div className="px-4 sm:px-6 pb-4">
          {/* Avatar */}
          <div className="relative -mt-12 sm:-mt-16 mb-4">
            {profile?.picture ? (
              <img
                src={profile.picture}
                alt={profile?.name || 'Profile'}
                className="w-24 h-24 sm:w-32 sm:h-32 rounded-full border-4 border-white dark:border-gray-950 object-cover"
              />
            ) : (
              <div className="w-24 h-24 sm:w-32 sm:h-32 rounded-full border-4 border-white dark:border-gray-950 bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold text-3xl">
                {(profile?.name || 'A')[0].toUpperCase()}
              </div>
            )}
          </div>
          {/* Name and bio */}
          <div className="mb-4">
            <h1 className="text-xl sm:text-2xl font-bold text-gray-900 dark:text-gray-100">
              {profile?.name || 'Anonymous'}
            </h1>
            {profile?.nip05 && (
              <p className="text-gray-500 dark:text-gray-400">
                @{profile.nip05.split('@')[0]}
              </p>
            )}
            {profile?.about && (
              <p className="mt-3 text-gray-700 dark:text-gray-300">
                {profile.about}
              </p>
            )}
          </div>
          {/* Meta info */}
          <div className="flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400">
            {profile?.website && (
              <a 
                href={profile.website} 
                target="_blank" 
                rel="noopener noreferrer"
                className="flex items-center gap-1 hover:text-purple-600 dark:hover:text-purple-400"
              >
                <LinkIcon className="w-4 h-4" />
                <span>{profile.website.replace(/^https?:\/\//, '')}</span>
              </a>
            )}
            <div className="flex items-center gap-1">
              <Calendar className="w-4 h-4" />
              <span>Joined recently</span>
            </div>
          </div>
          {/* Stats */}
          <div className="flex gap-6 mt-4">
            <div>
              <span className="font-semibold text-gray-900 dark:text-gray-100">
                {events.length}
              </span>
              <span className="text-gray-500 dark:text-gray-400 ml-1">Notes</span>
            </div>
            <div>
              <span className="font-semibold text-gray-900 dark:text-gray-100">0</span>
              <span className="text-gray-500 dark:text-gray-400 ml-1">Following</span>
            </div>
            <div>
              <span className="font-semibold text-gray-900 dark:text-gray-100">0</span>
              <span className="text-gray-500 dark:text-gray-400 ml-1">Followers</span>
            </div>
          </div>
        </div>
      </div>
      {/* Tabs */}
      <div className="sticky top-0 z-30 bg-white/80 dark:bg-gray-950/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-800">
        <div className="flex px-4 sm:px-6">
          <button className="px-4 py-3 font-medium text-purple-600 dark:text-purple-400 border-b-2 border-purple-600 dark:border-purple-400">
            Notes
          </button>
          <button className="px-4 py-3 font-medium text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
            Replies
          </button>
          <button className="px-4 py-3 font-medium text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
            Media
          </button>
        </div>
      </div>
      {/* User's notes */}
      <div>
        {events.map((event) => (
          <NoteCard key={event.id} event={event} />
        ))}
        {events.length === 0 && (
          <div className="text-center py-8 text-gray-500 dark:text-gray-400">
            No notes yet
          </div>
        )}
      </div>
    </div>
  );
}
</file>

<file path="pages/SettingsPage.tsx">
import React, { useState } from 'react';
import { motion } from 'framer-motion';
import {
  Server,
  Bell,
  Shield,
  Palette,
  User,
  ChevronRight,
  Settings as SettingsIcon
} from 'lucide-react';
import { cn } from '@/lib/utils';
import { RelaySettings } from '@/features/settings/RelaySettings';
import { ThemeSettings } from '@/features/settings/ThemeSettings';
import { NotificationSettings } from '@/features/settings/NotificationSettings';
import { PrivacySettings } from '@/features/settings/PrivacySettings';
import { ProfileSettings } from '@/features/settings/ProfileSettings';
type SettingsSection = 'relays' | 'theme' | 'notifications' | 'privacy' | 'profile';
interface SectionConfig {
  id: SettingsSection;
  label: string;
  description: string;
  icon: React.ElementType;
  component: React.ComponentType;
  available: boolean;
}
const sections: SectionConfig[] = [
  {
    id: 'relays',
    label: 'Relays',
    description: 'Configure Nostr relay connections',
    icon: Server,
    component: RelaySettings,
    available: true,
  },
  {
    id: 'profile',
    label: 'Profile',
    description: 'Edit your profile information',
    icon: User,
    component: ProfileSettings,
    available: false,
  },
  {
    id: 'theme',
    label: 'Appearance',
    description: 'Customize app theme and display',
    icon: Palette,
    component: ThemeSettings,
    available: false,
  },
  {
    id: 'notifications',
    label: 'Notifications',
    description: 'Control notification preferences',
    icon: Bell,
    component: NotificationSettings,
    available: false,
  },
  {
    id: 'privacy',
    label: 'Privacy',
    description: 'Manage privacy and security settings',
    icon: Shield,
    component: PrivacySettings,
    available: false,
  },
];
export function SettingsPage() {
  const [activeSection, setActiveSection] = useState<SettingsSection>('relays');
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
  const currentSection = sections.find(s => s.id === activeSection);
  const SectionComponent = currentSection?.component;
  return (
    <div className="min-h-screen bg-gray-50 dark:bg-gray-900 pb-20 md:pb-0">
      <div className="max-w-7xl mx-auto px-4 py-4 md:py-8">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          className="mb-6"
        >
          <h1 className="text-2xl md:text-3xl font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2 md:gap-3">
            <SettingsIcon className="w-6 h-6 md:w-8 md:h-8 text-purple-600" />
            Settings
          </h1>
          <p className="mt-1 text-sm md:text-base text-gray-600 dark:text-gray-400">
            Manage your app preferences and configuration
          </p>
        </motion.div>
        {/* Mobile Section Selector */}
        <div className="lg:hidden mb-4">
          <button
            onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
            className="w-full bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 px-4 py-3 flex items-center justify-between"
          >
            <div className="flex items-center gap-3">
              {currentSection && (
                <>
                  {React.createElement(currentSection.icon, { className: "w-5 h-5 text-purple-600" })}
                  <span className="font-medium text-gray-900 dark:text-gray-100">
                    {currentSection.label}
                  </span>
                </>
              )}
            </div>
            <ChevronRight className={cn(
              "w-5 h-5 text-gray-400 transition-transform",
              mobileMenuOpen ? "rotate-90" : ""
            )} />
          </button>
          {mobileMenuOpen && (
            <motion.div
              initial={{ opacity: 0, y: -10 }}
              animate={{ opacity: 1, y: 0 }}
              className="absolute left-4 right-4 z-20 mt-2 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden"
            >
              {sections.map((section) => {
                const Icon = section.icon;
                return (
                  <button
                    key={section.id}
                    onClick={() => {
                      if (section.available) {
                        setActiveSection(section.id);
                        setMobileMenuOpen(false);
                      }
                    }}
                    disabled={!section.available}
                    className={cn(
                      'w-full px-4 py-3 flex items-center gap-3 transition-all border-b border-gray-100 dark:border-gray-700 last:border-0',
                      section.available
                        ? 'hover:bg-gray-50 dark:hover:bg-gray-750'
                        : 'opacity-50 cursor-not-allowed'
                    )}
                  >
                    <Icon className="w-5 h-5" />
                    <span className="text-sm font-medium">
                      {section.label}
                      {!section.available && (
                        <span className="ml-2 text-xs bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 rounded">
                          Soon
                        </span>
                      )}
                    </span>
                  </button>
                );
              })}
            </motion.div>
          )}
        </div>
        <div className="flex flex-col lg:flex-row gap-6 lg:gap-8">
          {/* Desktop Sidebar Navigation */}
          <motion.nav
            initial={{ opacity: 0, x: -20 }}
            animate={{ opacity: 1, x: 0 }}
            className="hidden lg:block lg:w-64"
          >
            <div className="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
              {sections.map((section) => {
                const Icon = section.icon;
                const isActive = section.id === activeSection;
                return (
                  <button
                    key={section.id}
                    onClick={() => section.available && setActiveSection(section.id)}
                    disabled={!section.available}
                    className={cn(
                      'w-full px-4 py-3 flex items-center gap-3 transition-all border-b border-gray-100 dark:border-gray-700 last:border-0',
                      isActive
                        ? 'bg-purple-50 dark:bg-purple-950/30 text-purple-700 dark:text-purple-400'
                        : section.available
                        ? 'hover:bg-gray-50 dark:hover:bg-gray-750 text-gray-700 dark:text-gray-300'
                        : 'opacity-50 cursor-not-allowed text-gray-400 dark:text-gray-500'
                    )}
                  >
                    <Icon className={cn(
                      'w-5 h-5',
                      isActive ? 'text-purple-600 dark:text-purple-400' : ''
                    )} />
                    <div className="flex-1 text-left">
                      <div className="font-medium text-sm flex items-center gap-2">
                        {section.label}
                        {!section.available && (
                          <span className="text-xs bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 rounded">
                            Soon
                          </span>
                        )}
                      </div>
                      <div className="text-xs text-gray-500 dark:text-gray-400 mt-0.5">
                        {section.description}
                      </div>
                    </div>
                    {section.available && (
                      <ChevronRight className={cn(
                        'w-4 h-4 transition-transform',
                        isActive ? 'translate-x-1' : ''
                      )} />
                    )}
                  </button>
                );
              })}
            </div>
          </motion.nav>
          {/* Main Content */}
          <motion.main
            key={activeSection}
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            className="flex-1"
          >
            <div className="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
              {SectionComponent && <SectionComponent />}
            </div>
          </motion.main>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="pages/TradePage.tsx">
import { useState, useEffect } from 'react';
import { Plus } from 'lucide-react';
import { OrderBook } from '@/features/trades/OrderBook';
import { CreateOrderModal } from '@/features/trades/CreateOrderModal';
import { QuickFilters } from '@/features/trades/QuickFilters';
import { CompactFilters } from '@/features/trades/CompactFilters';
import { useNDKCurrentUser } from '@nostr-dev-kit/ndk-hooks';
export function TradePage() {
  const currentUser = useNDKCurrentUser();
  const [showCreateModal, setShowCreateModal] = useState(false);
  const [isMobile, setIsMobile] = useState(false);
  const [filters, setFilters] = useState({
    currency: 'all',
    paymentMethod: 'all',
    orderType: 'all' as 'all' | 'buy' | 'sell',
    minAmount: 0,
    maxAmount: 1000000
  });
  useEffect(() => {
    const checkMobile = () => {
      setIsMobile(window.innerWidth < 768);
    };
    checkMobile();
    window.addEventListener('resize', checkMobile);
    return () => window.removeEventListener('resize', checkMobile);
  }, []);
  return (
    <div className="min-h-screen bg-gray-50 dark:bg-gray-950">
      {/* Header */}
      <div className="bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 sticky top-0 z-20">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 md:py-4">
          <div className="flex items-center justify-between">
            <div>
              <h1 className="text-lg md:text-2xl font-bold text-gray-900 dark:text-white">P2P Trading</h1>
              <p className="text-xs md:text-sm text-gray-500 dark:text-gray-400 mt-0.5 md:mt-1 hidden sm:block">
                Buy and sell Bitcoin directly
              </p>
            </div>
            {currentUser && (
              <button
                onClick={() => setShowCreateModal(true)}
                className="hidden md:flex items-center gap-2 px-3 md:px-4 py-1.5 md:py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm md:text-base"
              >
                <Plus className="w-4 h-4" />
                <span>Create Order</span>
              </button>
            )}
          </div>
        </div>
      </div>
      {/* Filters - Mobile vs Desktop */}
      {isMobile ? (
        <CompactFilters
          filters={filters}
          onFiltersChange={setFilters}
        />
      ) : (
        <div className="bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800">
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <QuickFilters
              selectedCurrency={filters.currency}
              selectedPaymentMethod={filters.paymentMethod}
              onCurrencyChange={(currency) => setFilters({ ...filters, currency })}
              onPaymentMethodChange={(method) => setFilters({ ...filters, paymentMethod: method })}
            />
          </div>
        </div>
      )}
      {/* Main Content */}
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <OrderBook filters={filters} />
      </div>
      {/* Create Order Modal */}
      {showCreateModal && (
        <CreateOrderModal onClose={() => setShowCreateModal(false)} />
      )}
    </div>
  );
}
</file>

<file path="pages/WalletPage.tsx">
import { ProfessionalWallet } from '../components/wallet/ProfessionalWallet';
export function WalletPage() {
  return <ProfessionalWallet />;
}
</file>

<file path="stores/settingsStore.ts">
import { create } from 'zustand';
import { persist } from 'zustand/middleware';
export interface Relay {
  url: string;
  read: boolean;
  write: boolean;
  enabled: boolean;
}
interface AppSettings {
  // Relay settings
  relays: Relay[];
  selectedRelay: string | null; // null means use all enabled relays
  // Theme settings (for future)
  theme: 'light' | 'dark' | 'system';
  // Notification settings (for future)
  notifications: {
    enabled: boolean;
    mentions: boolean;
    replies: boolean;
    zaps: boolean;
  };
  // Privacy settings (for future)
  privacy: {
    hideReadReceipts: boolean;
    hideTypingIndicator: boolean;
  };
}
interface SettingsStore extends AppSettings {
  // Relay actions
  addRelay: (relay: Relay) => void;
  removeRelay: (url: string) => void;
  updateRelay: (url: string, updates: Partial<Relay>) => void;
  toggleRelay: (url: string) => void;
  setRelays: (relays: Relay[]) => void;
  setSelectedRelay: (url: string | null) => void;
  // Theme actions
  setTheme: (theme: 'light' | 'dark' | 'system') => void;
  // Notification actions
  updateNotifications: (settings: Partial<AppSettings['notifications']>) => void;
  // Privacy actions
  updatePrivacy: (settings: Partial<AppSettings['privacy']>) => void;
  // General actions
  resetToDefaults: () => void;
}
const defaultRelays: Relay[] = [
  { url: 'wss://relay.damus.io', read: true, write: true, enabled: true },
  { url: 'wss://relay.nostr.band', read: true, write: false, enabled: true },
  { url: 'wss://nos.lol', read: true, write: true, enabled: true },
  { url: 'wss://relay.snort.social', read: true, write: true, enabled: true },
  { url: 'wss://relay.primal.net', read: true, write: true, enabled: true },
];
const defaultSettings: AppSettings = {
  relays: defaultRelays,
  selectedRelay: null,
  theme: 'system',
  notifications: {
    enabled: true,
    mentions: true,
    replies: true,
    zaps: true,
  },
  privacy: {
    hideReadReceipts: false,
    hideTypingIndicator: false,
  },
};
export const useSettingsStore = create<SettingsStore>()(
  persist(
    (set) => ({
      ...defaultSettings,
      // Relay actions
      addRelay: (relay) =>
        set((state) => ({
          relays: [...state.relays, relay],
        })),
      removeRelay: (url) =>
        set((state) => ({
          relays: state.relays.filter((r) => r.url !== url),
        })),
      updateRelay: (url, updates) =>
        set((state) => ({
          relays: state.relays.map((r) =>
            r.url === url ? { ...r, ...updates } : r
          ),
        })),
      toggleRelay: (url) =>
        set((state) => ({
          relays: state.relays.map((r) =>
            r.url === url ? { ...r, enabled: !r.enabled } : r
          ),
        })),
      setRelays: (relays) => set({ relays }),
      setSelectedRelay: (url) => set({ selectedRelay: url }),
      // Theme actions
      setTheme: (theme) => set({ theme }),
      // Notification actions
      updateNotifications: (settings) =>
        set((state) => ({
          notifications: { ...state.notifications, ...settings },
        })),
      // Privacy actions
      updatePrivacy: (settings) =>
        set((state) => ({
          privacy: { ...state.privacy, ...settings },
        })),
      // General actions
      resetToDefaults: () => set(defaultSettings),
    }),
    {
      name: 'voces-settings',
      version: 1,
    }
  )
);
</file>

<file path="app.css">
@import "tailwindcss";
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
@theme {
  --color-background: 0 0% 100%;
  --color-foreground: 222.2 84% 4.9%;
  --color-card: 0 0% 100%;
  --color-card-foreground: 222.2 84% 4.9%;
  --color-popover: 0 0% 100%;
  --color-popover-foreground: 222.2 84% 4.9%;
  --color-primary: 267 84% 60%;
  --color-primary-foreground: 0 0% 100%;
  --color-secondary: 210 40% 96.1%;
  --color-secondary-foreground: 222.2 47.4% 11.2%;
  --color-muted: 210 40% 96.1%;
  --color-muted-foreground: 215.4 16.3% 46.9%;
  --color-accent: 210 40% 96.1%;
  --color-accent-foreground: 222.2 47.4% 11.2%;
  --color-destructive: 0 84.2% 60.2%;
  --color-destructive-foreground: 210 40% 98%;
  --color-border: 214.3 31.8% 91.4%;
  --color-input: 214.3 31.8% 91.4%;
  --color-ring: 267 84% 60%;
  --radius-sm: 0.5rem;
  --radius-md: 0.75rem;
  --radius-lg: 1rem;
}
@layer base {
  * {
    border-color: hsl(var(--color-border));
  }
  html {
    scroll-behavior: smooth;
  }
  body {
    background-color: hsl(var(--color-background));
    color: hsl(var(--color-foreground));
    font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  /* Dark mode */
  @media (prefers-color-scheme: dark) {
    :root {
      --color-background: 224 71% 4%;
      --color-foreground: 213 31% 91%;
      --color-card: 224 71% 4%;
      --color-card-foreground: 213 31% 91%;
      --color-popover: 224 71% 4%;
      --color-popover-foreground: 213 31% 91%;
      --color-primary: 267 84% 60%;
      --color-primary-foreground: 0 0% 100%;
      --color-secondary: 222.2 47.4% 11.2%;
      --color-secondary-foreground: 210 40% 98%;
      --color-muted: 223 47% 11%;
      --color-muted-foreground: 215 20.2% 65.1%;
      --color-accent: 223 47% 11%;
      --color-accent-foreground: 210 40% 98%;
      --color-destructive: 0 62.8% 30.6%;
      --color-destructive-foreground: 210 40% 98%;
      --color-border: 223 47% 11%;
      --color-input: 223 47% 11%;
      --color-ring: 267 84% 60%;
    }
  }
  .dark {
    --color-background: 224 71% 4%;
    --color-foreground: 213 31% 91%;
    --color-card: 224 71% 4%;
    --color-card-foreground: 213 31% 91%;
    --color-popover: 224 71% 4%;
    --color-popover-foreground: 213 31% 91%;
    --color-primary: 267 84% 60%;
    --color-primary-foreground: 0 0% 100%;
    --color-secondary: 222.2 47.4% 11.2%;
    --color-secondary-foreground: 210 40% 98%;
    --color-muted: 223 47% 11%;
    --color-muted-foreground: 215 20.2% 65.1%;
    --color-accent: 223 47% 11%;
    --color-accent-foreground: 210 40% 98%;
    --color-destructive: 0 62.8% 30.6%;
    --color-destructive-foreground: 210 40% 98%;
    --color-border: 223 47% 11%;
    --color-input: 223 47% 11%;
    --color-ring: 267 84% 60%;
  }
  /* Custom scrollbar */
  ::-webkit-scrollbar {
    width: 0.5rem;
    height: 0.5rem;
  }
  ::-webkit-scrollbar-track {
    background: transparent;
  }
  ::-webkit-scrollbar-thumb {
    background-color: rgb(209 213 219);
    border-radius: 9999px;
  }
  .dark ::-webkit-scrollbar-thumb {
    background-color: rgb(55 65 81);
  }
  ::-webkit-scrollbar-thumb:hover {
    background-color: rgb(156 163 175);
  }
  .dark ::-webkit-scrollbar-thumb:hover {
    background-color: rgb(75 85 99);
  }
  /* Focus visible improvements */
  :focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px hsl(var(--color-ring));
  }
  button:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px hsl(var(--color-ring));
  }
}
@layer utilities {
  /* Text selection */
  ::selection {
    background-color: rgb(233 213 255);
    color: rgb(88 28 135);
  }
  .dark ::selection {
    background-color: rgb(88 28 135);
    color: rgb(233 213 255);
  }
  /* Animation utilities */
  @keyframes fade-in {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
  @keyframes slide-up {
    from {
      transform: translateY(10px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }
  .animate-fade-in {
    animation: fade-in 0.5s ease-in-out;
  }
  .animate-slide-up {
    animation: slide-up 0.3s ease-out;
  }
}
</file>

<file path="App.tsx">
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import { Layout } from './components/layout/Layout';
import { HomePage } from './pages/HomePage';
import { ComposePage } from './pages/ComposePage';
import { NotificationsPage } from './pages/NotificationsPage';
import { ProfilePage } from './pages/ProfilePage';
import { WalletPage } from './pages/WalletPage';
import { SettingsPage } from './pages/SettingsPage';
import { TradePage } from './pages/TradePage';
import { MarketplacePage } from './pages/marketplace/MarketplacePage';
import { CreateListingPage } from './pages/marketplace/CreateListingPage';
import { ListingDetailPage } from './pages/marketplace/ListingDetailPage';
import { useNDKCurrentUser } from '@nostr-dev-kit/ndk-hooks';
const queryClient = new QueryClient();
function AppRoutes() {
  const currentUser = useNDKCurrentUser();
  return (
    <Routes>
      <Route path="/" element={<Layout />}>
        <Route index element={<HomePage />} />
        <Route path="compose" element={currentUser ? <ComposePage /> : <Navigate to="/" />} />
        <Route path="notifications" element={currentUser ? <NotificationsPage /> : <Navigate to="/" />} />
        <Route path="profile" element={currentUser ? <ProfilePage /> : <Navigate to="/" />} />
        <Route path="profile/:pubkey" element={<ProfilePage />} />
        <Route path="wallet" element={<WalletPage />} />
        <Route path="trades" element={<TradePage />} />
        <Route path="marketplace" element={<MarketplacePage />} />
        <Route path="marketplace/create" element={<CreateListingPage />} />
        <Route path="marketplace/:id" element={<ListingDetailPage />} />
        <Route path="settings" element={<SettingsPage />} />
      </Route>
    </Routes>
  );
}
function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <BrowserRouter>
        <AppRoutes />
      </BrowserRouter>
    </QueryClientProvider>
  );
}
export default App;
</file>

<file path="index.css">
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
@tailwind base;
@tailwind components;
@tailwind utilities;
@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;
    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 222.2 84% 4.9%;
    --primary: 267 84% 60%;
    --primary-foreground: 0 0% 100%;
    --secondary: 210 40% 96.1%;
    --secondary-foreground: 222.2 47.4% 11.2%;
    --muted: 210 40% 96.1%;
    --muted-foreground: 215.4 16.3% 46.9%;
    --accent: 210 40% 96.1%;
    --accent-foreground: 222.2 47.4% 11.2%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;
    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 267 84% 60%;
    --radius: 0.75rem;
  }
  .dark {
    --background: 224 71% 4%;
    --foreground: 213 31% 91%;
    --card: 224 71% 4%;
    --card-foreground: 213 31% 91%;
    --popover: 224 71% 4%;
    --popover-foreground: 213 31% 91%;
    --primary: 267 84% 60%;
    --primary-foreground: 0 0% 100%;
    --secondary: 222.2 47.4% 11.2%;
    --secondary-foreground: 210 40% 98%;
    --muted: 223 47% 11%;
    --muted-foreground: 215 20.2% 65.1%;
    --accent: 223 47% 11%;
    --accent-foreground: 210 40% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;
    --border: 223 47% 11%;
    --input: 223 47% 11%;
    --ring: 267 84% 60%;
  }
}
@layer base {
  * {
    border-color: hsl(var(--border));
  }
  html {
    scroll-behavior: smooth;
  }
  body {
    background-color: rgb(249 250 251);
    color: rgb(17 24 39);
    font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  .dark body {
    background-color: rgb(17 24 39);
    color: rgb(243 244 246);
  }
  /* Custom scrollbar */
  ::-webkit-scrollbar {
    width: 0.5rem;
    height: 0.5rem;
  }
  ::-webkit-scrollbar-track {
    background: transparent;
  }
  ::-webkit-scrollbar-thumb {
    background-color: rgb(209 213 219);
    border-radius: 9999px;
  }
  .dark ::-webkit-scrollbar-thumb {
    background-color: rgb(55 65 81);
  }
  ::-webkit-scrollbar-thumb:hover {
    background-color: rgb(156 163 175);
  }
  .dark ::-webkit-scrollbar-thumb:hover {
    background-color: rgb(75 85 99);
  }
  /* Focus visible improvements */
  :focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px hsl(var(--ring));
  }
  button:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px hsl(var(--ring));
  }
}
@layer utilities {
  /* Text selection */
  ::selection {
    background-color: rgb(233 213 255);
    color: rgb(88 28 135);
  }
  .dark ::selection {
    background-color: rgb(88 28 135);
    color: rgb(233 213 255);
  }
  /* Animation utilities */
  @keyframes fade-in {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
  @keyframes slide-up {
    from {
      transform: translateY(10px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }
  .animate-fade-in {
    animation: fade-in 0.5s ease-in-out;
  }
  .animate-slide-up {
    animation: slide-up 0.3s ease-out;
  }
  /* Hide scrollbar for horizontal scrolling sections */
  .scrollbar-hide {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }
  .scrollbar-hide::-webkit-scrollbar {
    display: none;  /* Chrome, Safari and Opera */
  }
}
</file>

<file path="main.tsx">
import React from 'react';
import { createRoot } from 'react-dom/client';
import { NDKHeadless, NDKSessionLocalStorage } from '@nostr-dev-kit/ndk-hooks';
import NDKCacheAdapterDexie from '@nostr-dev-kit/ndk-cache-dexie';
import { useSettingsStore } from './stores/settingsStore';
import './app.css';
import App from './App.tsx';
const root = createRoot(document.getElementById('root')!);
function AppWithNDK() {
  // Get relay configuration from settings store
  const relays = useSettingsStore((state) => state.relays);
  const selectedRelay = useSettingsStore((state) => state.selectedRelay);
  // If a specific relay is selected, use only that one
  // Otherwise use all enabled relays
  let relayUrls: string[];
  if (selectedRelay) {
    // Single relay mode
    relayUrls = [selectedRelay];
  } else {
    // All enabled relays mode
    const enabledRelayUrls = relays
      .filter((relay) => relay.enabled)
      .map((relay) => relay.url);
    // Fallback to default relays if none are enabled
    relayUrls = enabledRelayUrls.length > 0
      ? enabledRelayUrls
      : ['wss://relay.damus.io', 'wss://nos.lol'];
  }
  return (
    <>
      <NDKHeadless
        ndk={{
          explicitRelayUrls: relayUrls,
          cacheAdapter: new NDKCacheAdapterDexie({ dbName: 'voces-ndk-cache' }),
        }}
        session={{
          storage: new NDKSessionLocalStorage(),
          opts: {
            follows: true,
            profile: true
          }
        }}
      />
      <App />
    </>
  );
}
root.render(
  <React.StrictMode>
    <AppWithNDK />
  </React.StrictMode>
);
</file>

</files>
</file>

<file path="src/app.css">
@import "tailwindcss";
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
@theme {
  --color-background: 0 0% 100%;
  --color-foreground: 222.2 84% 4.9%;
  --color-card: 0 0% 100%;
  --color-card-foreground: 222.2 84% 4.9%;
  --color-popover: 0 0% 100%;
  --color-popover-foreground: 222.2 84% 4.9%;
  --color-primary: 267 84% 60%;
  --color-primary-foreground: 0 0% 100%;
  --color-secondary: 210 40% 96.1%;
  --color-secondary-foreground: 222.2 47.4% 11.2%;
  --color-muted: 210 40% 96.1%;
  --color-muted-foreground: 215.4 16.3% 46.9%;
  --color-accent: 210 40% 96.1%;
  --color-accent-foreground: 222.2 47.4% 11.2%;
  --color-destructive: 0 84.2% 60.2%;
  --color-destructive-foreground: 210 40% 98%;
  --color-border: 214.3 31.8% 91.4%;
  --color-input: 214.3 31.8% 91.4%;
  --color-ring: 267 84% 60%;
  --radius-sm: 0.5rem;
  --radius-md: 0.75rem;
  --radius-lg: 1rem;
}
@layer base {
  * {
    border-color: hsl(var(--color-border));
  }
  html {
    scroll-behavior: smooth;
  }
  body {
    background-color: hsl(var(--color-background));
    color: hsl(var(--color-foreground));
    font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  /* Dark mode */
  @media (prefers-color-scheme: dark) {
    :root {
      --color-background: 224 71% 4%;
      --color-foreground: 213 31% 91%;
      --color-card: 224 71% 4%;
      --color-card-foreground: 213 31% 91%;
      --color-popover: 224 71% 4%;
      --color-popover-foreground: 213 31% 91%;
      --color-primary: 267 84% 60%;
      --color-primary-foreground: 0 0% 100%;
      --color-secondary: 222.2 47.4% 11.2%;
      --color-secondary-foreground: 210 40% 98%;
      --color-muted: 223 47% 11%;
      --color-muted-foreground: 215 20.2% 65.1%;
      --color-accent: 223 47% 11%;
      --color-accent-foreground: 210 40% 98%;
      --color-destructive: 0 62.8% 30.6%;
      --color-destructive-foreground: 210 40% 98%;
      --color-border: 223 47% 11%;
      --color-input: 223 47% 11%;
      --color-ring: 267 84% 60%;
    }
  }
  .dark {
    --color-background: 224 71% 4%;
    --color-foreground: 213 31% 91%;
    --color-card: 224 71% 4%;
    --color-card-foreground: 213 31% 91%;
    --color-popover: 224 71% 4%;
    --color-popover-foreground: 213 31% 91%;
    --color-primary: 267 84% 60%;
    --color-primary-foreground: 0 0% 100%;
    --color-secondary: 222.2 47.4% 11.2%;
    --color-secondary-foreground: 210 40% 98%;
    --color-muted: 223 47% 11%;
    --color-muted-foreground: 215 20.2% 65.1%;
    --color-accent: 223 47% 11%;
    --color-accent-foreground: 210 40% 98%;
    --color-destructive: 0 62.8% 30.6%;
    --color-destructive-foreground: 210 40% 98%;
    --color-border: 223 47% 11%;
    --color-input: 223 47% 11%;
    --color-ring: 267 84% 60%;
  }
  /* Custom scrollbar */
  ::-webkit-scrollbar {
    width: 0.5rem;
    height: 0.5rem;
  }
  ::-webkit-scrollbar-track {
    background: transparent;
  }
  ::-webkit-scrollbar-thumb {
    background-color: rgb(209 213 219);
    border-radius: 9999px;
  }
  .dark ::-webkit-scrollbar-thumb {
    background-color: rgb(55 65 81);
  }
  ::-webkit-scrollbar-thumb:hover {
    background-color: rgb(156 163 175);
  }
  .dark ::-webkit-scrollbar-thumb:hover {
    background-color: rgb(75 85 99);
  }
  /* Focus visible improvements */
  :focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px hsl(var(--color-ring));
  }
  button:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px hsl(var(--color-ring));
  }
}
@layer utilities {
  /* Text selection */
  ::selection {
    background-color: rgb(233 213 255);
    color: rgb(88 28 135);
  }
  .dark ::selection {
    background-color: rgb(88 28 135);
    color: rgb(233 213 255);
  }
  /* Animation utilities */
  @keyframes fade-in {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
  @keyframes slide-up {
    from {
      transform: translateY(10px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }
  .animate-fade-in {
    animation: fade-in 0.5s ease-in-out;
  }
  .animate-slide-up {
    animation: slide-up 0.3s ease-out;
  }
}
</file>

<file path=".gitignore">
# TENEX project files
.tenex/

# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?
</file>

<file path="index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Voces - NDK Nostr App</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
</file>

<file path="README.md">
# Voces - Modern NDK Nostr App

A modern React-based Nostr client built with NDK (Nostr Development Kit), Vite, shadcn/ui, and TypeScript.

## Features

- **Nostr Authentication**: Login with NIP-07 browser extensions (Alby, nos2x, etc.) or private key
- **Real-time Feed**: View and publish notes to the Nostr network
- **Modern UI**: Built with shadcn/ui and Tailwind CSS for a clean, responsive interface
- **State Management**: Zustand for global state, React Query for server state
- **Caching**: Dexie-based caching for improved performance
- **TypeScript**: Full type safety throughout the application

## Tech Stack

- **Framework**: React 19 with TypeScript
- **Build Tool**: Vite
- **Nostr SDK**: @nostr-dev-kit/ndk with React hooks
- **UI Components**: shadcn/ui with Radix UI primitives
- **Styling**: Tailwind CSS
- **State Management**: Zustand
- **Data Fetching**: TanStack Query (React Query)
- **Database**: Dexie (IndexedDB wrapper) for caching
- **Routing**: React Router DOM

## Project Structure

```
src/
‚îú‚îÄ‚îÄ components/       # Reusable UI components
‚îÇ   ‚îú‚îÄ‚îÄ ui/          # shadcn/ui components
‚îÇ   ‚îú‚îÄ‚îÄ nostr/       # Nostr-specific components
‚îÇ   ‚îî‚îÄ‚îÄ layout/      # Layout components
‚îú‚îÄ‚îÄ features/        # Feature-based modules
‚îÇ   ‚îú‚îÄ‚îÄ auth/        # Authentication features
‚îÇ   ‚îú‚îÄ‚îÄ feed/        # Feed and notes features
‚îÇ   ‚îî‚îÄ‚îÄ profile/     # User profile features
‚îú‚îÄ‚îÄ hooks/           # Custom React hooks
‚îú‚îÄ‚îÄ lib/             # Utility functions
‚îú‚îÄ‚îÄ contexts/        # React contexts (NDK provider, etc.)
‚îú‚îÄ‚îÄ types/           # TypeScript type definitions
‚îú‚îÄ‚îÄ utils/           # Helper functions
‚îî‚îÄ‚îÄ config/          # Configuration files (NDK setup, etc.)
```

## Getting Started

### Prerequisites

- Node.js 18+ and npm
- A Nostr browser extension (recommended: [Alby](https://getalby.com/))

### Installation

```bash
# Install dependencies
npm install

# Start development server
npm run dev

# Build for production
npm run build

# Preview production build
npm run preview
```

### Development

The app will run on `http://localhost:5173` by default.

### Configuration

The app connects to multiple public Nostr relays by default:
- wss://relay.damus.io
- wss://relay.nostr.band
- wss://nos.lol
- wss://relay.snort.social
- wss://relay.primal.net

You can modify the relay list in `src/config/ndk.ts`.

## Key Features Implementation

### NDK Integration

The app uses NDK with:
- Auto-connection to user relays
- Outbox model support
- Dexie cache adapter for performance
- NIP-07 signer support for browser extensions

### Component Architecture

- **Feature-based organization**: Each feature (auth, feed, profile) has its own folder
- **Shared UI components**: Common UI elements in `components/ui`
- **Type-safe**: Full TypeScript coverage with strict mode

### State Management

- **NDK Context**: Provides NDK instance and user state globally
- **Zustand**: For complex client state (included, ready for use)
- **React Query**: For server state and caching

## License

MIT
</file>

<file path="tsconfig.app.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "types": ["vite/client"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true,

    /* Path aliases */
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src"]
}
</file>

<file path="tsconfig.json">
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ]
}
</file>

<file path="tsconfig.node.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2023",
    "lib": ["ES2023"],
    "module": "ESNext",
    "types": [],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}
</file>

<file path="src/components/content/ContentRenderer.tsx">
import { useProfile } from '@nostr-dev-kit/ndk-hooks';
import { nip19 } from 'nostr-tools';
import { Fragment, useMemo } from 'react';
import { Link } from 'react-router-dom';
import { EmbeddedNote } from './EmbeddedNote';
import { EmbeddedArticle } from './EmbeddedArticle';
import { MediaEmbed } from './MediaEmbed';
interface ContentRendererProps {
  content: string;
  className?: string;
}
interface ParsedSegment {
  type: 'text' | 'npub' | 'nprofile' | 'note' | 'nevent' | 'naddr' | 'link' | 'media';
  content: string;
  data?: any;
}
export function ContentRenderer({ content, className = '' }: ContentRendererProps) {
  // Remove [Image #X] labels from content
  const cleanedContent = useMemo(() => {
    return content.replace(/\[Image #\d+\]/gi, '').trim();
  }, [content]);
  const segments = useMemo(() => {
    const parsed: ParsedSegment[] = [];
    // Combined regex for all patterns
    const patterns = [
      // Nostr URIs (nostr:npub, nostr:note, etc.)
      /nostr:(npub1[a-z0-9]{58}|nprofile1[a-z0-9]+|note1[a-z0-9]{58}|nevent1[a-z0-9]+|naddr1[a-z0-9]+)/gi,
      // Direct media files
      /https?:\/\/[^\s<>"]+\.(jpg|jpeg|png|gif|webp|svg|mp4|webm|mov|mp3|wav|ogg|m4a)(\?[^\s<>"]*)?/gi,
      // YouTube URLs
      /https?:\/\/(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})[^\s<>"]*/gi,
      // Regular links
      /https?:\/\/[^\s<>"]+/gi,
    ];
    let lastIndex = 0;
    const allMatches: Array<{ match: RegExpExecArray; pattern: RegExp }> = [];
    // Collect all matches
    for (const pattern of patterns) {
      pattern.lastIndex = 0; // Reset regex state
      let match;
      while ((match = pattern.exec(cleanedContent)) !== null) {
        allMatches.push({ match, pattern });
      }
    }
    // Sort matches by position
    allMatches.sort((a, b) => a.match.index - b.match.index);
    // Process matches without overlaps
    for (const { match } of allMatches) {
      const matchStart = match.index;
      const matchEnd = match.index + match[0].length;
      // Skip if this match overlaps with already processed content
      if (matchStart < lastIndex) continue;
      // Add text before the match
      if (matchStart > lastIndex) {
        parsed.push({
          type: 'text',
          content: cleanedContent.slice(lastIndex, matchStart),
        });
      }
      const matchedText = match[0];
      // Process the match
      if (matchedText.startsWith('nostr:')) {
        const uri = matchedText.slice(6); // Remove 'nostr:' prefix
        try {
          if (uri.startsWith('npub1')) {
            const decoded = nip19.decode(uri);
            parsed.push({
              type: 'npub',
              content: uri,
              data: decoded.data,
            });
          } else if (uri.startsWith('nprofile1')) {
            const decoded = nip19.decode(uri);
            parsed.push({
              type: 'nprofile',
              content: uri,
              data: decoded.data,
            });
          } else if (uri.startsWith('note1')) {
            const decoded = nip19.decode(uri);
            parsed.push({
              type: 'note',
              content: uri,
              data: decoded.data,
            });
          } else if (uri.startsWith('nevent1')) {
            const decoded = nip19.decode(uri);
            parsed.push({
              type: 'nevent',
              content: uri,
              data: decoded.data,
            });
          } else if (uri.startsWith('naddr1')) {
            const decoded = nip19.decode(uri);
            parsed.push({
              type: 'naddr',
              content: uri,
              data: decoded.data,
            });
          }
        } catch (_e) {
          // If decoding fails, treat as text
          parsed.push({
            type: 'text',
            content: matchedText,
          });
        }
      } else if (/\.(jpg|jpeg|png|gif|webp|svg|mp4|webm|mov|mp3|wav|ogg|m4a)(\?|$)/i.test(matchedText)) {
        parsed.push({
          type: 'media',
          content: matchedText,
        });
      } else if (/youtube\.com|youtu\.be/i.test(matchedText)) {
        parsed.push({
          type: 'media',
          content: matchedText,
        });
      } else if (matchedText.startsWith('http')) {
        parsed.push({
          type: 'link',
          content: matchedText,
        });
      }
      lastIndex = matchEnd;
    }
    // Add remaining text
    if (lastIndex < cleanedContent.length) {
      parsed.push({
        type: 'text',
        content: cleanedContent.slice(lastIndex),
      });
    }
    return parsed;
  }, [cleanedContent]);
  return (
    <div className={className}>
      {segments.map((segment, index) => (
        <Fragment key={index}>
          {segment.type === 'text' && (
            <span className="whitespace-pre-wrap break-words">{segment.content}</span>
          )}
          {segment.type === 'npub' && (
            <UserMention pubkey={segment.data as string} />
          )}
          {segment.type === 'nprofile' && (
            <UserMention pubkey={(segment.data as any).pubkey} />
          )}
          {segment.type === 'note' && (
            <EmbeddedNote eventId={segment.data as string} />
          )}
          {segment.type === 'nevent' && (
            <EmbeddedNote eventId={(segment.data as any).id} />
          )}
          {segment.type === 'naddr' && (
            <EmbeddedArticle naddr={segment.data} />
          )}
          {segment.type === 'link' && (
            <a
              href={segment.content}
              target="_blank"
              rel="noopener noreferrer"
              className="text-accent-600 dark:text-accent-400 hover:underline break-all"
              onClick={(e) => e.stopPropagation()}
            >
              {segment.content}
            </a>
          )}
          {segment.type === 'media' && (
            <MediaEmbed url={segment.content} />
          )}
        </Fragment>
      ))}
    </div>
  );
}
interface UserMentionProps {
  pubkey: string;
}
function UserMention({ pubkey }: UserMentionProps) {
  const profile = useProfile(pubkey);
  const npub = nip19.npubEncode(pubkey);
  const displayName = profile?.name || profile?.displayName || `@${npub.slice(0, 8)}...`;
  return (
    <Link
      to={`/p/${npub}`}
      className="inline-flex items-center gap-0.5 text-accent-600 dark:text-accent-400 hover:underline font-medium"
      onClick={(e) => e.stopPropagation()}
    >
      @{displayName}
    </Link>
  );
}
</file>

<file path="src/components/content/EmbeddedNote.tsx">
import { useEvent, useProfile } from '@nostr-dev-kit/ndk-hooks';
import { formatDistanceToNow } from 'date-fns';
import { UserAvatar } from '@/components/ui/UserAvatar';
import { Link, useNavigate } from 'react-router-dom';
import { nip19 } from 'nostr-tools';
interface EmbeddedNoteProps {
  eventId: string;
}
export function EmbeddedNote({ eventId }: EmbeddedNoteProps) {
  const event = useEvent(eventId);
  const loading = !event;
  const error = false;
  const profile = useProfile(event?.pubkey);
  const navigate = useNavigate();
  if (loading) {
    return (
      <div className="my-3 p-4 border border-neutral-200 dark:border-neutral-800 rounded-xl bg-neutral-50 dark:bg-neutral-900/50 animate-pulse">
        <div className="h-4 bg-neutral-200 dark:bg-neutral-800 rounded w-3/4 mb-2"></div>
        <div className="h-4 bg-neutral-200 dark:bg-neutral-800 rounded w-1/2"></div>
      </div>
    );
  }
  if (error || !event) {
    return null;
  }
  const npub = event.pubkey ? nip19.npubEncode(event.pubkey) : '';
  const displayName = profile?.name || profile?.displayName || 'Anonymous';
  const handle = profile?.nip05 ? `@${profile.nip05.split('@')[0]}` : `@${npub.slice(5, 12)}`;
  return (
    <div className="my-3 p-4 border border-neutral-200 dark:border-neutral-800 rounded-xl bg-neutral-50 dark:bg-neutral-900/50 hover:bg-neutral-100 dark:hover:bg-neutral-900/70 transition-colors cursor-pointer"
         onClick={(e) => {
           e.stopPropagation();
           const neventId = event.encode();
           navigate(`/e/${neventId}`);
         }}>
      <div className="flex items-start gap-3">
        <Link to={`/p/${npub}`} onClick={(e) => e.stopPropagation()}>
          <UserAvatar
            pubkey={event.pubkey}
            size="sm"
            className="w-9 h-9"
          />
        </Link>
        <div className="flex-1 min-w-0">
          <div className="flex items-center gap-2 text-sm">
            <Link
              to={`/p/${npub}`}
              className="font-semibold text-neutral-900 dark:text-neutral-100 hover:underline"
              onClick={(e) => e.stopPropagation()}
            >
              {displayName}
            </Link>
            <span className="text-neutral-500 dark:text-neutral-500">
              {handle}
            </span>
            <span className="text-neutral-300 dark:text-neutral-700">¬∑</span>
            <time className="text-neutral-500 dark:text-neutral-500 text-xs">
              {formatDistanceToNow(new Date(event.created_at! * 1000), { addSuffix: true })}
            </time>
          </div>
          <div className="mt-1">
            <p className="text-neutral-700 dark:text-neutral-300 text-sm leading-relaxed whitespace-pre-wrap break-words line-clamp-4">
              {event.content}
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/navigation/RelaySelector.tsx">
import { ChevronDown, Globe, Circle, Check } from "lucide-react";
import { useState, useRef, useEffect } from "react";
import { useSettingsStore } from "@/stores/settingsStore";
import { useNavigate } from "react-router-dom";
export function RelaySelector() {
  const [isOpen, setIsOpen] = useState(false);
  const dropdownRef = useRef<HTMLDivElement>(null);
  const navigate = useNavigate();
  const { relays, selectedRelay, setSelectedRelay } = useSettingsStore();
  const enabledRelays = relays.filter(r => r.enabled);
  // Close dropdown when clicking outside
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {
        setIsOpen(false);
      }
    };
    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, []);
  const handleRelaySelect = (relayUrl: string | null) => {
    setSelectedRelay(relayUrl);
    setIsOpen(false);
  };
  const getRelayDisplayName = (url: string) => {
    try {
      const urlObj = new URL(url);
      return urlObj.hostname.replace("wss://", "").replace("ws://", "");
    } catch {
      return url.replace("wss://", "").replace("ws://", "");
    }
  };
  const currentRelayDisplay = selectedRelay
    ? getRelayDisplayName(selectedRelay)
    : `All Relays (${enabledRelays.length})`;
  return (
    <div className="relative" ref={dropdownRef}>
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="flex items-center gap-1.5 px-2 py-1 text-sm text-gray-600 dark:text-gray-400
                   hover:text-gray-900 dark:hover:text-gray-100 transition-colors"
      >
        <Globe className="h-4 w-4" />
        <span className="max-w-[140px] truncate font-normal">{currentRelayDisplay}</span>
        <ChevronDown className={`h-3 w-3 transition-transform ${isOpen ? 'rotate-180' : ''}`} />
      </button>
      {isOpen && (
        <div className="absolute top-full mt-2 right-0 w-64 bg-white dark:bg-black rounded-lg shadow-lg
                        border border-gray-200 dark:border-gray-700 overflow-hidden z-50">
          <div className="py-1">
            {/* All Relays option */}
            <button
              onClick={() => handleRelaySelect(null)}
              className="w-full flex items-center justify-between px-4 py-2 text-sm text-gray-700 dark:text-gray-200
                         hover:bg-gray-100 dark:hover:bg-neutral-900 transition-colors"
            >
              <div className="flex items-center gap-2">
                <Globe className="h-4 w-4 text-blue-500" />
                <span>All Relays ({enabledRelays.length})</span>
              </div>
              {!selectedRelay && <Check className="h-4 w-4 text-green-500" />}
            </button>
            {/* Divider */}
            <div className="h-px bg-gray-200 dark:bg-black my-1" />
            {/* Individual relays */}
            {enabledRelays.length > 0 ? (
              enabledRelays.map((relay) => (
                <button
                  key={relay.url}
                  onClick={() => handleRelaySelect(relay.url)}
                  className="w-full flex items-center justify-between px-4 py-2 text-sm text-gray-700 dark:text-gray-200
                             hover:bg-gray-100 dark:hover:bg-neutral-900 transition-colors"
                >
                  <div className="flex items-center gap-2">
                    <Circle
                      className={`h-2 w-2 ${relay.write && relay.read ? 'fill-green-500 text-green-500' :
                                             relay.read ? 'fill-blue-500 text-blue-500' :
                                             'fill-orange-500 text-orange-500'}`}
                    />
                    <span className="truncate">{getRelayDisplayName(relay.url)}</span>
                  </div>
                  {selectedRelay === relay.url && <Check className="h-4 w-4 text-green-500" />}
                </button>
              ))
            ) : (
              <div className="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">
                No relays enabled
              </div>
            )}
            {/* Divider */}
            <div className="h-px bg-gray-200 dark:bg-black my-1" />
            {/* Settings link */}
            <button
              onClick={() => {
                setIsOpen(false);
                navigate('/settings');
              }}
              className="w-full flex items-center px-4 py-2 text-sm text-blue-600 dark:text-blue-400
                         hover:bg-gray-100 dark:hover:bg-neutral-900 transition-colors"
            >
              Manage Relays ‚Üí
            </button>
          </div>
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/components/ui/dialog.tsx">
import * as React from 'react';
import * as DialogPrimitive from '@radix-ui/react-dialog';
import { X } from 'lucide-react';
import { cn } from '@/lib/utils';
const Dialog = DialogPrimitive.Root;
const DialogTrigger = DialogPrimitive.Trigger;
const DialogPortal = DialogPrimitive.Portal;
const DialogClose = DialogPrimitive.Close;
const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    className={cn(
      'fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0',
      className
    )}
    {...props}
  />
));
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName;
const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DialogPortal>
    <DialogOverlay />
    <DialogPrimitive.Content
      ref={ref}
      className={cn(
        'fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-neutral-700 bg-neutral-900 p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg',
        className
      )}
      {...props}
    >
      {children}
      <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </DialogPrimitive.Close>
    </DialogPrimitive.Content>
  </DialogPortal>
));
DialogContent.displayName = DialogPrimitive.Content.displayName;
const DialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      'flex flex-col space-y-1.5 text-center sm:text-left',
      className
    )}
    {...props}
  />
);
DialogHeader.displayName = 'DialogHeader';
const DialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      'flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2',
      className
    )}
    {...props}
  />
);
DialogFooter.displayName = 'DialogFooter';
const DialogTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn(
      'text-lg font-semibold leading-none tracking-tight text-white',
      className
    )}
    {...props}
  />
));
DialogTitle.displayName = DialogPrimitive.Title.displayName;
const DialogDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description
    ref={ref}
    className={cn('text-sm text-neutral-400', className)}
    {...props}
  />
));
DialogDescription.displayName = DialogPrimitive.Description.displayName;
export {
  Dialog,
  DialogPortal,
  DialogOverlay,
  DialogClose,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTitle,
  DialogDescription,
};
</file>

<file path="src/components/ui/input.tsx">
import * as React from 'react';
import { cn } from '@/lib/utils';
export type InputProps = React.InputHTMLAttributes<HTMLInputElement>
const Input = React.forwardRef<HTMLInputElement, InputProps>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          'flex h-10 w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-purple-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-800 dark:bg-black dark:ring-offset-gray-950 dark:placeholder:text-gray-400 dark:focus-visible:ring-purple-400',
          className
        )}
        ref={ref}
        {...props}
      />
    );
  }
);
Input.displayName = 'Input';
export { Input };
</file>

<file path="src/components/ui/tabs.tsx">
import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"
import { cn } from "@/lib/utils"
const Tabs = TabsPrimitive.Root
const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-10 items-center justify-center rounded-md bg-gray-100 p-1 text-gray-500 dark:bg-black dark:text-gray-400",
      className
    )}
    {...props}
  />
))
TabsList.displayName = TabsPrimitive.List.displayName
const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white data-[state=active]:text-gray-950 data-[state=active]:shadow-sm dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300 dark:data-[state=active]:bg-gray-950 dark:data-[state=active]:text-gray-50",
      className
    )}
    {...props}
  />
))
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName
const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300",
      className
    )}
    {...props}
  />
))
TabsContent.displayName = TabsPrimitive.Content.displayName
export { Tabs, TabsList, TabsTrigger, TabsContent }
</file>

<file path="src/components/ui/textarea.tsx">
import * as React from 'react';
import { cn } from '@/lib/utils';
export type TextareaProps = React.TextareaHTMLAttributes<HTMLTextAreaElement>
const Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(
  ({ className, ...props }, ref) => {
    return (
      <textarea
        className={cn(
          'flex min-h-[80px] w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-purple-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-800 dark:bg-black dark:ring-offset-gray-950 dark:placeholder:text-gray-400 dark:focus-visible:ring-purple-400',
          className
        )}
        ref={ref}
        {...props}
      />
    );
  }
);
Textarea.displayName = 'Textarea';
export { Textarea };
</file>

<file path="src/components/ui/UserAvatar.tsx">
import { useProfile } from '@nostr-dev-kit/ndk-hooks';
import { cn } from '@/lib/utils';
interface UserAvatarProps {
  pubkey?: string;
  size?: 'xs' | 'sm' | 'md' | 'lg' | 'xl';
  className?: string;
}
const sizeClasses = {
  xs: 'w-8 h-8 text-xs',
  sm: 'w-10 h-10 text-sm',
  md: 'w-12 h-12 text-base',
  lg: 'w-16 h-16 text-lg',
  xl: 'w-20 h-20 text-xl',
};
export function UserAvatar({ pubkey, size = 'md', className }: UserAvatarProps) {
  const profile = useProfile(pubkey);
  // Try multiple image sources
  const imageUrl = profile?.picture || profile?.image || profile?.banner;
  const displayName = profile?.displayName || profile?.name || 'Anonymous';
  // Generate initials from name
  const initials = displayName
    .split(' ')
    .map(n => n[0])
    .slice(0, 2)
    .join('')
    .toUpperCase() || '?';
  if (imageUrl) {
    return (
      <img
        src={imageUrl}
        alt={displayName}
        className={cn(
          'rounded-full object-cover bg-neutral-100 dark:bg-neutral-900',
          sizeClasses[size],
          className
        )}
        loading="lazy"
        onError={(e) => {
          // Hide broken images
          (e.target as HTMLImageElement).style.display = 'none';
        }}
      />
    );
  }
  // Consistent color based on pubkey for fallback
  const colors = [
    'bg-blue-500',
    'bg-green-500',
    'bg-yellow-500',
    'bg-red-500',
    'bg-purple-500',
    'bg-indigo-500',
    'bg-pink-500',
    'bg-teal-500',
  ];
  const colorIndex = pubkey ?
    parseInt(pubkey.slice(0, 8), 16) % colors.length :
    0;
  const bgColor = colors[colorIndex];
  return (
    <div
      className={cn(
        'rounded-full flex items-center justify-center text-white font-semibold',
        bgColor,
        sizeClasses[size],
        className
      )}
    >
      {initials}
    </div>
  );
}
</file>

<file path="src/components/wallet/ZapButton.tsx">
import { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Zap } from 'lucide-react';
import { cn } from '@/lib/utils';
import type { NDKEvent } from '@nostr-dev-kit/ndk-hooks';
interface ZapButtonProps {
  event: NDKEvent;
  initialZapCount?: number;
  size?: 'sm' | 'md';
  onZap?: (amount: number, success: boolean) => void;
}
export function ZapButton({
  event,
  initialZapCount = 0,
  size = 'sm',
  onZap
}: ZapButtonProps) {
  const [showAmounts, setShowAmounts] = useState(false);
  const [zapCount, setZapCount] = useState(initialZapCount);
  const [isZapping, setIsZapping] = useState(false);
  const [lastZapAmount, setLastZapAmount] = useState<number | null>(null);
  const [errorMessage, setErrorMessage] = useState<string | null>(null);
  const quickZapAmounts = [21, 100, 500, 1000];
  const handleZap = async (amount: number) => {
    setIsZapping(true);
    setLastZapAmount(amount);
    setErrorMessage(null);
    try {
      const { useZap } = await import('@/hooks/useZap');
      const { sendZap } = useZap({
        onSuccess: () => {
          setZapCount(prev => prev + 1);
          setShowAmounts(false);
          onZap?.(amount, true);
          setTimeout(() => setLastZapAmount(null), 2000);
        },
        onError: (error) => {
          setErrorMessage(error.message);
          onZap?.(amount, false);
          setTimeout(() => {
            setErrorMessage(null);
            setLastZapAmount(null);
          }, 3000);
        }
      });
      await sendZap(event, amount);
    } catch (error) {
      const message = error instanceof Error ? error.message : 'Zap failed';
      setErrorMessage(message);
      onZap?.(amount, false);
      setTimeout(() => {
        setErrorMessage(null);
        setLastZapAmount(null);
      }, 3000);
    } finally {
      setIsZapping(false);
    }
  };
  return (
    <div className="relative">
      <button
        onClick={() => setShowAmounts(!showAmounts)}
        className={cn(
          "group flex items-center gap-2 p-2 rounded-full transition-all",
          zapCount > 0
            ? "text-yellow-600 dark:text-yellow-500"
            : "hover:bg-yellow-50 dark:hover:bg-yellow-950/30",
          size === 'md' && "p-3"
        )}
      >
        <motion.div
          animate={isZapping ? { rotate: 360 } : {}}
          transition={{ duration: 0.5 }}
        >
          <Zap
            className={cn(
              "transition-all",
              size === 'md' ? "w-5 h-5" : "w-4 h-4",
              zapCount > 0
                ? "fill-current text-yellow-600 dark:text-yellow-500"
                : "text-gray-500 group-hover:text-yellow-600 dark:text-gray-400 dark:group-hover:text-yellow-500"
            )}
          />
        </motion.div>
        {zapCount > 0 && (
          <span className={cn(
            "font-medium",
            size === 'md' ? "text-base" : "text-sm",
            "text-yellow-600 dark:text-yellow-500"
          )}>
            {zapCount}
          </span>
        )}
      </button>
      {/* Floating zap amount indicator */}
      <AnimatePresence>
        {lastZapAmount && !errorMessage && (
          <motion.div
            initial={{ opacity: 0, y: 0, scale: 0.8 }}
            animate={{ opacity: 1, y: -30, scale: 1 }}
            exit={{ opacity: 0, y: -50, scale: 0.8 }}
            className="absolute left-1/2 -translate-x-1/2 pointer-events-none"
          >
            <div className="bg-yellow-500 text-white text-xs px-2 py-1 rounded-full font-bold whitespace-nowrap">
              +{lastZapAmount} ‚ö°
            </div>
          </motion.div>
        )}
        {errorMessage && (
          <motion.div
            initial={{ opacity: 0, y: 0, scale: 0.8 }}
            animate={{ opacity: 1, y: -30, scale: 1 }}
            exit={{ opacity: 0, y: -50, scale: 0.8 }}
            className="absolute left-1/2 -translate-x-1/2 pointer-events-none whitespace-nowrap"
          >
            <div className="bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold">
              {errorMessage}
            </div>
          </motion.div>
        )}
      </AnimatePresence>
      {/* Quick zap amounts */}
      <AnimatePresence>
        {showAmounts && (
          <>
            {/* Backdrop to close on click outside */}
            <div
              className="fixed inset-0 z-10"
              onClick={() => setShowAmounts(false)}
            />
            <motion.div
              initial={{ opacity: 0, scale: 0.9, y: 5 }}
              animate={{ opacity: 1, scale: 1, y: 0 }}
              exit={{ opacity: 0, scale: 0.9, y: 5 }}
              className="absolute bottom-full left-0 mb-2 z-20"
            >
              <div className="bg-white dark:bg-black rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-2 flex gap-1">
                {quickZapAmounts.map((amount) => (
                  <motion.button
                    key={amount}
                    whileHover={{ scale: 1.1 }}
                    whileTap={{ scale: 0.95 }}
                    onClick={(e) => {
                      e.stopPropagation();
                      handleZap(amount);
                    }}
                    disabled={isZapping}
                    className="px-3 py-2 bg-gray-50 dark:bg-black hover:bg-yellow-50 dark:hover:bg-yellow-900/30 rounded-lg transition-colors disabled:opacity-50"
                  >
                    <div className="flex items-center gap-1">
                      <Zap className="w-3 h-3 text-yellow-600 dark:text-yellow-500" />
                      <span className="text-sm font-medium text-gray-700 dark:text-gray-300">
                        {amount}
                      </span>
                    </div>
                  </motion.button>
                ))}
              </div>
            </motion.div>
          </>
        )}
      </AnimatePresence>
    </div>
  );
}
</file>

<file path="src/features/auth/LoginModal.tsx">
import { useState } from 'react';
import {
  useNDKSessionLogin,
  NDKNip07Signer,
  NDKNip46Signer,
  NDKPrivateKeySigner
} from '@nostr-dev-kit/ndk-hooks';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Chrome, Shield, Key, Sparkles, Loader2, Info } from 'lucide-react';
import { Alert, AlertDescription } from '@/components/ui/alert';
interface LoginModalProps {
  isOpen: boolean;
  onClose: () => void;
}
export function LoginModal({ isOpen, onClose }: LoginModalProps) {
  const login = useNDKSessionLogin();
  const [activeMethod, setActiveMethod] = useState<string | null>(null);
  const [nsec, setNsec] = useState('');
  const [bunkerUrl, setBunkerUrl] = useState('');
  const [isConnecting, setIsConnecting] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const resetState = () => {
    setActiveMethod(null);
    setNsec('');
    setBunkerUrl('');
    setError(null);
  };
  const handleClose = () => {
    resetState();
    onClose();
  };
  const handleExtensionLogin = async () => {
    setIsConnecting(true);
    setError(null);
    try {
      if (!window.nostr) {
        throw new Error('No Nostr extension found. Please install Alby, nos2x, or another NIP-07 compatible extension.');
      }
      const signer = new NDKNip07Signer();
      await login(signer, true);
      localStorage.setItem('nostr_extension_auto_login', 'true');
      handleClose();
    } catch (error) {
      console.error('Extension login failed:', error);
      setError(error instanceof Error ? error.message : 'Extension login failed');
    } finally {
      setIsConnecting(false);
    }
  };
  const handleBunkerLogin = async () => {
    if (!bunkerUrl) return;
    setIsConnecting(true);
    setError(null);
    try {
      const signer = new NDKNip46Signer(bunkerUrl);
      await signer.blockUntilReady();
      await login(signer, true);
      localStorage.setItem('nostr_bunker_url', bunkerUrl);
      handleClose();
    } catch (error) {
      console.error('Bunker login failed:', error);
      setError(error instanceof Error ? error.message : 'Bunker connection failed. Please check your bunker URL.');
    } finally {
      setIsConnecting(false);
    }
  };
  const handlePrivateKeyLogin = async () => {
    if (!nsec) return;
    setIsConnecting(true);
    setError(null);
    try {
      const signer = new NDKPrivateKeySigner(nsec);
      await login(signer, true);
      localStorage.setItem('nostr_private_key', nsec);
      handleClose();
    } catch (error) {
      console.error('Private key login failed:', error);
      setError('Invalid private key. Please check your nsec or hex key.');
    } finally {
      setIsConnecting(false);
    }
  };
  const handleGenerateIdentity = async () => {
    setIsConnecting(true);
    setError(null);
    try {
      const signer = NDKPrivateKeySigner.generate();
      await login(signer, true);
      const privateKey = signer.privateKey!;
      localStorage.setItem('nostr_private_key', privateKey);
      const user = await signer.user();
      // Show the keys in a more user-friendly way
      const message = `Identity created successfully!\n\nPublic Key (npub):\n${user.npub}\n\nPrivate Key (nsec):\n${privateKey}\n\nIMPORTANT: Save your private key (nsec) in a secure location. You will need it to login again.`;
      alert(message);
      handleClose();
    } catch (error) {
      console.error('Failed to generate identity:', error);
      setError('Failed to generate new identity. Please try again.');
    } finally {
      setIsConnecting(false);
    }
  };
  return (
    <Dialog open={isOpen} onOpenChange={handleClose}>
      <DialogContent className="sm:max-w-md">
        <DialogHeader>
          <DialogTitle>Login to Nostr</DialogTitle>
          <DialogDescription>
            Choose how you'd like to connect to the Nostr network
          </DialogDescription>
        </DialogHeader>
        <div className="space-y-3 pt-4">
          {error && (
            <Alert variant="destructive">
              <AlertDescription>{error}</AlertDescription>
            </Alert>
          )}
          {!activeMethod && (
            <>
              <Button
                onClick={() => {
                  setActiveMethod('extension');
                  handleExtensionLogin();
                }}
                disabled={isConnecting}
                className="w-full justify-start bg-neutral-800 hover:bg-neutral-700 text-white border-neutral-600"
                variant="outline"
              >
                <Chrome className="w-4 h-4 mr-2" />
                Browser Extension (NIP-07)
                {isConnecting && activeMethod === 'extension' && (
                  <Loader2 className="w-4 h-4 ml-auto animate-spin" />
                )}
              </Button>
              <Button
                onClick={() => setActiveMethod('bunker')}
                disabled={isConnecting}
                className="w-full justify-start bg-neutral-800 hover:bg-neutral-700 text-white border-neutral-600"
                variant="outline"
              >
                <Shield className="w-4 h-4 mr-2" />
                Remote Signer / Bunker (NIP-46)
              </Button>
              <Button
                onClick={() => setActiveMethod('private-key')}
                disabled={isConnecting}
                className="w-full justify-start bg-neutral-800 hover:bg-neutral-700 text-white border-neutral-600"
                variant="outline"
              >
                <Key className="w-4 h-4 mr-2" />
                Private Key
              </Button>
              <div className="relative">
                <div className="absolute inset-0 flex items-center">
                  <span className="w-full border-t border-neutral-700" />
                </div>
                <div className="relative flex justify-center text-xs uppercase">
                  <span className="bg-neutral-900 px-2 text-neutral-400">Or</span>
                </div>
              </div>
              <Button
                onClick={() => {
                  setActiveMethod('generate');
                  handleGenerateIdentity();
                }}
                disabled={isConnecting}
                className="w-full justify-start bg-purple-900/50 hover:bg-purple-800/50 text-white border-purple-700/50"
                variant="secondary"
              >
                <Sparkles className="w-4 h-4 mr-2" />
                Generate New Identity
                {isConnecting && activeMethod === 'generate' && (
                  <Loader2 className="w-4 h-4 ml-auto animate-spin" />
                )}
              </Button>
            </>
          )}
          {activeMethod === 'bunker' && (
            <div className="space-y-3">
              <Alert>
                <Info className="w-4 h-4" />
                <AlertDescription>
                  Enter your bunker URL to connect using a remote signer.
                  Example: bunker://pubkey?relay=wss://relay.url
                </AlertDescription>
              </Alert>
              <Input
                type="text"
                placeholder="bunker://..."
                value={bunkerUrl}
                onChange={(e) => setBunkerUrl(e.target.value)}
                disabled={isConnecting}
                onKeyDown={(e) => {
                  if (e.key === 'Enter' && bunkerUrl) {
                    handleBunkerLogin();
                  }
                }}
              />
              <div className="flex gap-2">
                <Button
                  onClick={handleBunkerLogin}
                  disabled={!bunkerUrl || isConnecting}
                  className="flex-1"
                >
                  {isConnecting ? (
                    <Loader2 className="w-4 h-4 mr-2 animate-spin" />
                  ) : (
                    <Shield className="w-4 h-4 mr-2" />
                  )}
                  Connect
                </Button>
                <Button
                  onClick={() => setActiveMethod(null)}
                  variant="outline"
                  disabled={isConnecting}
                >
                  Back
                </Button>
              </div>
            </div>
          )}
          {activeMethod === 'private-key' && (
            <div className="space-y-3">
              <Alert>
                <Info className="w-4 h-4" />
                <AlertDescription>
                  Enter your private key (nsec or hex format). This will be stored locally in your browser.
                </AlertDescription>
              </Alert>
              <Input
                type="password"
                placeholder="nsec1... or hex key"
                value={nsec}
                onChange={(e) => setNsec(e.target.value)}
                disabled={isConnecting}
                onKeyDown={(e) => {
                  if (e.key === 'Enter' && nsec) {
                    handlePrivateKeyLogin();
                  }
                }}
              />
              <div className="flex gap-2">
                <Button
                  onClick={handlePrivateKeyLogin}
                  disabled={!nsec || isConnecting}
                  className="flex-1"
                >
                  {isConnecting ? (
                    <Loader2 className="w-4 h-4 mr-2 animate-spin" />
                  ) : (
                    <Key className="w-4 h-4 mr-2" />
                  )}
                  Login
                </Button>
                <Button
                  onClick={() => setActiveMethod(null)}
                  variant="outline"
                  disabled={isConnecting}
                >
                  Back
                </Button>
              </div>
            </div>
          )}
        </div>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="src/features/classifieds/components/ListingCard.tsx">
import { Link } from 'react-router-dom';
import { MapPin, Clock } from 'lucide-react';
import { Card } from '@/components/ui/card';
import { UserAvatar } from '@/components/ui/UserAvatar';
import type { ClassifiedListing } from '../types';
import { formatDistanceToNow } from 'date-fns';
interface ListingCardProps {
  listing: ClassifiedListing;
}
export function ListingCard({ listing }: ListingCardProps) {
  const mainImage = listing.images?.[0];
  const timeAgo = listing.publishedAt
    ? formatDistanceToNow(new Date(listing.publishedAt * 1000), { addSuffix: true })
    : 'recently';
  return (
    <Link to={`/marketplace/${listing.id}`}>
      <Card className="hover:shadow-soft-lg hover:scale-[1.02] transition-all duration-300 cursor-pointer h-full overflow-hidden group bg-white dark:bg-black/50 border-gray-100 dark:border-gray-800/50 animate-fade-in">
        {/* Image Section */}
        <div className="aspect-[4/3] relative overflow-hidden bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-900 dark:to-gray-800">
          {mainImage ? (
            <>
              <img
                src={mainImage}
                alt={listing.title}
                className="object-cover w-full h-full group-hover:scale-105 transition-transform duration-300"
                loading="lazy"
              />
              {listing.status === 'sold' && (
                <div className="absolute inset-0 bg-black/60 flex items-center justify-center backdrop-blur-sm">
                  <span className="text-white font-bold text-xl rotate-12 border-4 border-white px-3 py-1 rounded">
                    SOLD
                  </span>
                </div>
              )}
            </>
          ) : (
            <div className="w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-600">
              <svg className="w-16 h-16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
            </div>
          )}
        </div>
        {/* Content Section */}
        <div className="p-4 space-y-3">
          {/* Price - Most prominent */}
          {listing.price && (
            <div className="flex justify-between items-start">
              <span className="text-2xl font-bold text-gray-900 dark:text-white">
                {listing.price.currency === 'SATS' ? (
                  <span className="text-orange-500">{listing.price.amount} SATS</span>
                ) : (
                  <span>
                    {listing.price.currency === 'USD' && '$'}
                    {listing.price.currency === 'EUR' && '‚Ç¨'}
                    {listing.price.currency === 'GBP' && '¬£'}
                    {listing.price.amount}
                    {!['USD', 'EUR', 'GBP'].includes(listing.price.currency) && ` ${listing.price.currency}`}
                  </span>
                )}
                {listing.price.frequency && listing.price.frequency !== 'once' && (
                  <span className="text-sm font-normal text-gray-500 dark:text-gray-400">
                    /{listing.price.frequency}
                  </span>
                )}
              </span>
            </div>
          )}
          {/* Title */}
          <h3 className="font-semibold text-base text-gray-900 dark:text-white line-clamp-2 leading-tight">
            {listing.title}
          </h3>
          {/* Summary - if exists */}
          {listing.summary && (
            <p className="text-sm text-gray-600 dark:text-gray-400 line-clamp-2">
              {listing.summary}
            </p>
          )}
          {/* Metadata */}
          <div className="flex items-center gap-3 text-xs text-gray-500 dark:text-gray-500">
            {listing.location && (
              <div className="flex items-center gap-1">
                <MapPin className="w-3 h-3" />
                <span className="truncate">{listing.location}</span>
              </div>
            )}
            <div className="flex items-center gap-1">
              <Clock className="w-3 h-3" />
              <span>{timeAgo}</span>
            </div>
          </div>
          {/* Seller Info */}
          <div className="pt-3 border-t border-gray-100 dark:border-gray-800 flex items-center gap-2">
            <UserAvatar pubkey={listing.author} size="xs" />
            <span className="text-xs text-gray-500 dark:text-gray-400">
              Posted by
            </span>
          </div>
        </div>
      </Card>
    </Link>
  );
}
</file>

<file path="src/features/classifieds/hooks/useListings.ts">
import { useSubscribe } from '@nostr-dev-kit/ndk-hooks';
import { CLASSIFIED_LISTING_KIND, parseListingFromEvent } from '../types';
import { useMemo } from 'react';
interface UseListingsOptions {
  category?: string;
  author?: string;
  limit?: number;
}
export function useListings(options: UseListingsOptions = {}) {
  const { category, author, limit = 50 } = options;
  // Build filter based on options
  const filters = useMemo(() => {
    const filter: any = {
      kinds: [CLASSIFIED_LISTING_KIND],
      limit
    };
    if (author) {
      filter.authors = [author];
    }
    if (category) {
      filter['#t'] = [category.toLowerCase()];
    }
    return [filter];
  }, [category, author, limit]);
  const { events } = useSubscribe(filters, {
    subId: `listings${author ? `-by-${author.slice(0, 8)}` : ''}${category ? `-${category}` : ''}`
  });
  const listings = useMemo(() => {
    return events
      .map(parseListingFromEvent)
      .filter(listing => listing.status === 'active')
      .sort((a, b) => {
        const timeA = a.publishedAt || 0;
        const timeB = b.publishedAt || 0;
        return timeB - timeA; // Most recent first
      });
  }, [events]);
  return {
    listings,
    events
  };
}
</file>

<file path="src/features/followPacks/components/PackCard.tsx">
import { Link } from 'react-router-dom';
import { Package, Users, Heart } from 'lucide-react';
import { NDKFollowPack, useNDKCurrentUser, useProfileValue } from '@nostr-dev-kit/ndk-hooks';
import { Button } from '@/components/ui/button';
import { useFollowPacksStore } from '@/stores/followPacksStore';
import { ProfileAvatar } from './ProfileAvatar';
import { cn } from '@/lib/utils';
interface PackCardProps {
  pack: NDKFollowPack;
  variant?: 'default' | 'compact';
}
export function PackCard({ pack, variant = 'default' }: PackCardProps) {
  const { isSubscribed, subscribeToPack, unsubscribeFromPack, isFavorite, toggleFavorite } = useFollowPacksStore();
  const currentUser = useNDKCurrentUser();
  const creatorProfile = useProfileValue(pack.pubkey);
  const subscribed = isSubscribed(pack.id);
  const favorited = isFavorite(pack.id);
  const previewPubkeys = pack.pubkeys?.slice(0, 5) || [];
  // Check if current user is in the pack or is the creator
  const currentUserInPack = currentUser && pack.pubkeys?.includes(currentUser.pubkey);
  const isCreator = currentUser && pack.pubkey && pack.pubkey === currentUser.pubkey;
  const handleSubscribe = (e: React.MouseEvent) => {
    e.preventDefault();
    if (subscribed) {
      unsubscribeFromPack(pack.id);
    } else {
      subscribeToPack(pack.id);
    }
  };
  const handleFavorite = (e: React.MouseEvent) => {
    e.preventDefault();
    e.stopPropagation();
    toggleFavorite(pack.id);
  };
  if (variant === 'compact') {
    return (
      <Link
        to={`/packs/${pack.encode()}`}
        className="block bg-black/40 backdrop-blur-sm border border-neutral-800 rounded-xl overflow-hidden hover:border-purple-500/50 hover:bg-black/60 transition-all group"
      >
        <div className="relative">
          {/* Background image */}
          {pack.image && (
            <div className="absolute inset-0">
              <img
                src={pack.image}
                alt={pack.title}
                className="w-full h-full object-cover opacity-20 group-hover:opacity-30 transition-opacity"
              />
              <div className="absolute inset-0 bg-gradient-to-r from-black via-black/80 to-transparent" />
            </div>
          )}
          {/* Content */}
          <div className="relative p-4">
            <h4 className="font-semibold text-white group-hover:text-purple-400 transition-colors mb-2 text-lg">
              {pack.title}
            </h4>
            <p className="text-sm text-neutral-400 mb-2">
              {pack.pubkeys?.length || 0} members ‚Ä¢ {
                isCreator
                  ? 'by you'
                  : currentUserInPack
                    ? `with you and @${creatorProfile?.name || creatorProfile?.displayName || pack.pubkey?.slice(0, 8) || 'unknown'}`
                    : `by @${creatorProfile?.name || creatorProfile?.displayName || pack.pubkey?.slice(0, 8) || 'unknown'}`
              }
            </p>
            {pack.description && (
              <p className="text-sm text-neutral-500 mb-3 line-clamp-2">
                {pack.description}
              </p>
            )}
            <div className="flex items-center -space-x-2">
              {previewPubkeys.slice(0, 5).map((pubkey: string, index: number) => (
                <div
                  key={pubkey}
                  className="w-10 h-10 rounded-full overflow-hidden border-2 border-black/60 flex-shrink-0"
                  style={{ zIndex: 5 - index }}
                >
                  <ProfileAvatar
                    pubkey={pubkey}
                    size="sm"
                    className="w-full h-full"
                  />
                </div>
              ))}
              {(pack.pubkeys?.length || 0) > 5 && (
                <div className="w-10 h-10 rounded-full bg-gradient-to-br from-purple-600 to-purple-700 border-2 border-black/60 flex items-center justify-center flex-shrink-0">
                  <span className="text-xs text-white font-bold">
                    +{(pack.pubkeys?.length || 0) - 5}
                  </span>
                </div>
              )}
            </div>
          </div>
        </div>
      </Link>
    );
  }
  return (
    <Link
      to={`/packs/${pack.encode()}`}
      className="block bg-black/40 backdrop-blur-sm border border-neutral-800 rounded-2xl overflow-hidden hover:border-purple-500/50 hover:bg-black/60 transition-all duration-300 group relative"
    >
      {/* Favorite button */}
      <button
        onClick={handleFavorite}
        className={cn(
          "absolute top-3 right-3 z-20 p-2 rounded-full backdrop-blur-md transition-all",
          favorited
            ? "bg-red-500/20 text-red-500"
            : "bg-black/50 text-white/50 hover:text-red-500 hover:bg-red-500/20"
        )}
      >
        <Heart className={cn("w-4 h-4", favorited && "fill-current")} />
      </button>
      {/* Image with gradient overlay */}
      {pack.image ? (
        <div className="relative h-48 w-full overflow-hidden">
          <img
            src={pack.image}
            alt={pack.title}
            className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700 ease-out"
          />
          <div className="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent" />
          {/* Stats overlay */}
          <div className="absolute top-3 left-3 flex items-center gap-2 text-white/90 bg-black/30 backdrop-blur-sm px-3 py-1.5 rounded-full">
            <Users className="w-3.5 h-3.5" />
            <span className="text-sm font-medium">{pack.pubkeys?.length || 0}</span>
          </div>
          {/* Title overlay on image */}
          <div className="absolute bottom-0 left-0 right-0 p-5">
            <h3 className="font-bold text-2xl text-white mb-1 drop-shadow-lg">
              {pack.title}
            </h3>
          </div>
        </div>
      ) : (
        <div className="relative h-32 bg-gradient-to-br from-purple-600/10 via-purple-500/5 to-pink-600/10 flex items-center justify-center">
          <Package className="w-14 h-14 text-purple-500/30" />
          {/* Title for packs without image */}
          <div className="absolute bottom-3 left-5 right-5">
            <h3 className="font-bold text-lg text-white truncate">
              {pack.title}
            </h3>
            <p className="text-sm text-neutral-400">
              {pack.pubkeys?.length || 0} members ‚Ä¢ {
                isCreator
                  ? 'by you'
                  : currentUserInPack
                    ? `with you and @${creatorProfile?.name || creatorProfile?.displayName || pack.pubkey?.slice(0, 8) || 'unknown'}`
                    : `by @${creatorProfile?.name || creatorProfile?.displayName || pack.pubkey?.slice(0, 8) || 'unknown'}`
              }
            </p>
          </div>
        </div>
      )}
      {/* Content padding wrapper */}
      <div className="p-5 pt-3">
        {/* Description - show for all cards if exists */}
        {pack.description && (
          <p className="text-sm text-neutral-400 mb-4 line-clamp-2 leading-relaxed">
            {pack.description}
          </p>
        )}
        {/* Member Avatars and Follow Button */}
        <div className="flex items-center justify-between gap-3">
          <div className="flex -space-x-2 overflow-hidden">
            {previewPubkeys.map((pubkey: string, index: number) => (
              <div
                key={pubkey}
                className="relative hover:z-10 transition-all hover:scale-110"
                style={{ zIndex: 5 - index }}
              >
                <ProfileAvatar
                  pubkey={pubkey}
                  size="sm"
                  className="border-2 border-black/20"
                />
              </div>
            ))}
            {(pack.pubkeys?.length || 0) > 5 && (
              <div className="w-8 h-8 rounded-full bg-gradient-to-br from-purple-600 to-purple-700 border-2 border-black/20 flex items-center justify-center">
                <span className="text-xs text-white font-bold">
                  +{(pack.pubkeys?.length || 0) - 5}
                </span>
              </div>
            )}
          </div>
          <Button
            onClick={handleSubscribe}
            size="sm"
            variant={subscribed ? 'ghost' : 'default'}
            className={cn(
              "min-w-[90px] transition-all",
              subscribed
                ? "border border-purple-500/30 hover:bg-purple-500/10 text-purple-400"
                : "bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white shadow-lg shadow-purple-500/20"
            )}
          >
            {subscribed ? 'Following' : 'Follow'}
          </Button>
        </div>
      </div>
    </Link>
  );
}
</file>

<file path="src/features/followPacks/hooks/useProfileFollowPacks.ts">
import { useMemo } from 'react';
import { useSubscribe, NDKFollowPack } from '@nostr-dev-kit/ndk-hooks';
import { useFollowPacksStore } from '@/stores/followPacksStore';
import type { FollowPackWithMetadata } from '../types';
export function useProfileFollowPacks(profilePubkey: string) {
  const { isSubscribed, isFavorite } = useFollowPacksStore();
  // Single subscription: get packs created by user OR where user appears
  const filter = [{
    kinds: NDKFollowPack.kinds,
    authors: [profilePubkey]
  }, {
    kinds: NDKFollowPack.kinds,
    '#p': [profilePubkey]
  }];
  const { events } = useSubscribe(profilePubkey ? filter : false, { subId: `profile-packs-${profilePubkey.slice(0, 8)}` });
  // Process all events and categorize them
  const { createdPacks, appearsPacks, allPacks } = useMemo(() => {
    if (!events) return { createdPacks: [], appearsPacks: [], allPacks: [] };
    // Deduplicate events by ID
    const uniqueEvents = Array.from(
      new Map(events.map(e => [e.id, e])).values()
    );
    const processed = uniqueEvents.map((event) => {
      const followPack = NDKFollowPack.from(event);
      const pubkeys = followPack.pubkeys || [];
      Object.assign(followPack, {
        isCreator: event.pubkey === profilePubkey,
        appearsIn: pubkeys.includes(profilePubkey)
      });
      return followPack as NDKFollowPack & { isCreator: boolean; appearsIn: boolean };
    });
    const created = processed.filter(p => p.isCreator);
    const appears = processed.filter(p => p.appearsIn && !p.isCreator);
    return {
      createdPacks: created,
      appearsPacks: appears,
      allPacks: processed
    };
  }, [events, profilePubkey, isSubscribed, isFavorite]);
  return {
    createdPacks,
    appearsPacks,
    allPacks
  };
}
</file>

<file path="src/features/settings/BlossomSettings.tsx">
import { useState, useEffect } from 'react';
import { Plus, X, ExternalLink, Trash2 } from 'lucide-react';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
const DEFAULT_SERVERS = [
  'https://blossom.primal.net',
  'https://blossom.nostr.hu',
  'https://blossom.oxtr.dev'
];
export function BlossomSettings() {
  const [servers, setServers] = useState<string[]>([]);
  const [newServer, setNewServer] = useState('');
  const [isAddingServer, setIsAddingServer] = useState(false);
  useEffect(() => {
    const stored = localStorage.getItem('blossomServers');
    if (stored) {
      try {
        setServers(JSON.parse(stored));
      } catch {
        setServers([DEFAULT_SERVERS[0]]);
      }
    } else {
      setServers([DEFAULT_SERVERS[0]]);
    }
  }, []);
  const saveServers = (newServers: string[]) => {
    setServers(newServers);
    localStorage.setItem('blossomServers', JSON.stringify(newServers));
  };
  const addServer = () => {
    if (!newServer.trim()) return;
    try {
      const url = new URL(newServer.trim());
      if (!url.protocol.startsWith('http')) {
        alert('Please enter a valid HTTP or HTTPS URL');
        return;
      }
      const cleanUrl = url.origin + url.pathname.replace(/\/$/, '');
      if (servers.includes(cleanUrl)) {
        alert('This server is already in your list');
        return;
      }
      saveServers([...servers, cleanUrl]);
      setNewServer('');
      setIsAddingServer(false);
    } catch {
      alert('Please enter a valid URL');
    }
  };
  const removeServer = (serverToRemove: string) => {
    if (servers.length === 1) {
      alert('You must have at least one Blossom server');
      return;
    }
    saveServers(servers.filter(s => s !== serverToRemove));
  };
  const moveServerUp = (index: number) => {
    if (index === 0) return;
    const newServers = [...servers];
    [newServers[index - 1], newServers[index]] = [newServers[index], newServers[index - 1]];
    saveServers(newServers);
  };
  const moveServerDown = (index: number) => {
    if (index === servers.length - 1) return;
    const newServers = [...servers];
    [newServers[index], newServers[index + 1]] = [newServers[index + 1], newServers[index]];
    saveServers(newServers);
  };
  return (
    <div className="space-y-6">
      <div>
        <h3 className="text-lg font-semibold mb-2">Blossom Media Servers</h3>
        <p className="text-sm text-gray-600 dark:text-gray-400 mb-4">
          Configure your Blossom servers for uploading images and media. The first server is your primary upload destination, and additional servers are used as mirrors for redundancy.
        </p>
      </div>
      {/* Current servers */}
      <div className="space-y-3">
        <Label>Your Blossom Servers</Label>
        <div className="space-y-2">
          {servers.map((server, index) => (
            <div
              key={server}
              className="flex items-center justify-between p-3 bg-gray-50 dark:bg-black rounded-lg"
            >
              <div className="flex items-center space-x-3">
                <div className="flex flex-col space-y-1">
                  <button
                    onClick={() => moveServerUp(index)}
                    disabled={index === 0}
                    className="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 disabled:opacity-30 disabled:cursor-not-allowed p-0.5"
                    aria-label="Move up"
                  >
                    <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 15l7-7 7 7" />
                    </svg>
                  </button>
                  <button
                    onClick={() => moveServerDown(index)}
                    disabled={index === servers.length - 1}
                    className="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 disabled:opacity-30 disabled:cursor-not-allowed p-0.5"
                    aria-label="Move down"
                  >
                    <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                    </svg>
                  </button>
                </div>
                <div>
                  <div className="flex items-center space-x-2">
                    <span className="font-medium">{server}</span>
                    {index === 0 && (
                      <span className="text-xs bg-purple-100 dark:bg-purple-900/50 text-purple-700 dark:text-purple-300 px-2 py-0.5 rounded">
                        Primary
                      </span>
                    )}
                  </div>
                  <a
                    href={server}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="text-sm text-gray-500 dark:text-gray-400 hover:text-purple-600 dark:hover:text-purple-400 flex items-center space-x-1"
                  >
                    <span>Visit server</span>
                    <ExternalLink className="w-3 h-3" />
                  </a>
                </div>
              </div>
              {servers.length > 1 && (
                <button
                  onClick={() => removeServer(server)}
                  className="text-red-500 hover:text-red-600 p-2"
                  aria-label="Remove server"
                >
                  <Trash2 className="w-4 h-4" />
                </button>
              )}
            </div>
          ))}
        </div>
      </div>
      {/* Add server */}
      {isAddingServer ? (
        <div className="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
          <Label htmlFor="new-server">Add Blossom Server</Label>
          <div className="flex space-x-2 mt-2">
            <Input
              id="new-server"
              value={newServer}
              onChange={(e) => setNewServer(e.target.value)}
              placeholder="https://blossom.example.com"
              onKeyPress={(e) => e.key === 'Enter' && addServer()}
            />
            <button
              onClick={addServer}
              className="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors"
            >
              Add
            </button>
            <button
              onClick={() => {
                setIsAddingServer(false);
                setNewServer('');
              }}
              className="p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"
            >
              <X className="w-5 h-5" />
            </button>
          </div>
        </div>
      ) : (
        <button
          onClick={() => setIsAddingServer(true)}
          className="flex items-center space-x-2 px-4 py-2 text-purple-600 dark:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-lg transition-colors"
        >
          <Plus className="w-4 h-4" />
          <span>Add Server</span>
        </button>
      )}
      {/* Suggested servers */}
      <div className="border-t border-gray-200 dark:border-gray-700 pt-4">
        <Label>Suggested Servers</Label>
        <p className="text-sm text-gray-600 dark:text-gray-400 mb-3">
          Popular public Blossom servers you can add to your list
        </p>
        <div className="space-y-2">
          {DEFAULT_SERVERS.filter(s => !servers.includes(s)).map(server => (
            <div
              key={server}
              className="flex items-center justify-between p-3 bg-gray-50 dark:bg-black rounded-lg"
            >
              <span className="text-sm">{server}</span>
              <button
                onClick={() => saveServers([...servers, server])}
                className="text-sm text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300"
              >
                Add
              </button>
            </div>
          ))}
          {DEFAULT_SERVERS.every(s => servers.includes(s)) && (
            <p className="text-sm text-gray-500 dark:text-gray-400">
              All suggested servers have been added
            </p>
          )}
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/features/settings/ThemeSettings.tsx">
import { useEffect } from 'react';
import { useTranslation } from 'react-i18next';
import { useSettingsStore } from '@/stores/settingsStore';
import { Globe, Palette } from 'lucide-react';
export function ThemeSettings() {
  const { t, i18n } = useTranslation();
  const { language, theme, setLanguage, setTheme } = useSettingsStore();
  useEffect(() => {
    i18n.changeLanguage(language);
  }, [language, i18n]);
  const handleLanguageChange = (newLanguage: 'en' | 'es') => {
    setLanguage(newLanguage);
    i18n.changeLanguage(newLanguage);
  };
  const handleThemeChange = (newTheme: 'light' | 'dark' | 'system') => {
    setTheme(newTheme);
    // Apply theme to document
    if (newTheme === 'system') {
      const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      document.documentElement.classList.toggle('dark', systemTheme === 'dark');
    } else {
      document.documentElement.classList.toggle('dark', newTheme === 'dark');
    }
  };
  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">
          {t('settings.sections.appearance.title')}
        </h2>
        <p className="text-sm text-gray-600 dark:text-gray-400 mb-6">
          {t('settings.sections.appearance.description')}
        </p>
      </div>
      {/* Language Selection */}
      <div className="border-b border-gray-200 dark:border-gray-700 pb-6">
        <div className="flex items-center gap-3 mb-4">
          <Globe className="w-5 h-5 text-purple-600" />
          <h3 className="text-base font-medium text-gray-900 dark:text-gray-100">
            {t('settings.sections.appearance.language')}
          </h3>
        </div>
        <p className="text-sm text-gray-600 dark:text-gray-400 mb-4">
          {t('settings.sections.appearance.languageDescription')}
        </p>
        <div className="grid grid-cols-2 gap-3">
          <button
            onClick={() => handleLanguageChange('en')}
            className={`px-4 py-3 rounded-lg border transition-all ${
              language === 'en'
                ? 'bg-purple-50 dark:bg-purple-950/30 border-purple-500 text-purple-700 dark:text-purple-400'
                : 'bg-white dark:bg-black border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-neutral-900'
            }`}
          >
            <div className="flex items-center justify-center gap-2">
              <span className="text-lg">üá∫üá∏</span>
              <span className="font-medium">English</span>
            </div>
          </button>
          <button
            onClick={() => handleLanguageChange('es')}
            className={`px-4 py-3 rounded-lg border transition-all ${
              language === 'es'
                ? 'bg-purple-50 dark:bg-purple-950/30 border-purple-500 text-purple-700 dark:text-purple-400'
                : 'bg-white dark:bg-black border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-neutral-900'
            }`}
          >
            <div className="flex items-center justify-center gap-2">
              <span className="text-lg">üá™üá∏</span>
              <span className="font-medium">Espa√±ol</span>
            </div>
          </button>
        </div>
      </div>
      {/* Theme Selection */}
      <div>
        <div className="flex items-center gap-3 mb-4">
          <Palette className="w-5 h-5 text-purple-600" />
          <h3 className="text-base font-medium text-gray-900 dark:text-gray-100">
            {t('settings.sections.appearance.theme')}
          </h3>
        </div>
        <p className="text-sm text-gray-600 dark:text-gray-400 mb-4">
          {t('settings.sections.appearance.themeDescription')}
        </p>
        <div className="grid grid-cols-3 gap-3">
          <button
            onClick={() => handleThemeChange('light')}
            className={`px-4 py-3 rounded-lg border transition-all ${
              theme === 'light'
                ? 'bg-purple-50 dark:bg-purple-950/30 border-purple-500 text-purple-700 dark:text-purple-400'
                : 'bg-white dark:bg-black border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-neutral-900'
            }`}
          >
            <div className="flex flex-col items-center gap-2">
              <span className="text-2xl">‚òÄÔ∏è</span>
              <span className="text-sm font-medium">
                {t('settings.sections.appearance.themes.light')}
              </span>
            </div>
          </button>
          <button
            onClick={() => handleThemeChange('dark')}
            className={`px-4 py-3 rounded-lg border transition-all ${
              theme === 'dark'
                ? 'bg-purple-50 dark:bg-purple-950/30 border-purple-500 text-purple-700 dark:text-purple-400'
                : 'bg-white dark:bg-black border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-neutral-900'
            }`}
          >
            <div className="flex flex-col items-center gap-2">
              <span className="text-2xl">üåô</span>
              <span className="text-sm font-medium">
                {t('settings.sections.appearance.themes.dark')}
              </span>
            </div>
          </button>
          <button
            onClick={() => handleThemeChange('system')}
            className={`px-4 py-3 rounded-lg border transition-all ${
              theme === 'system'
                ? 'bg-purple-50 dark:bg-purple-950/30 border-purple-500 text-purple-700 dark:text-purple-400'
                : 'bg-white dark:bg-black border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-neutral-900'
            }`}
          >
            <div className="flex flex-col items-center gap-2">
              <span className="text-2xl">üíª</span>
              <span className="text-sm font-medium">
                {t('settings.sections.appearance.themes.system')}
              </span>
            </div>
          </button>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/marketplace/ListingDetailPage.tsx">
import { useParams, useNavigate, Link } from 'react-router-dom';
import { ArrowLeft, MapPin, Clock, Tag, Share2, MessageCircle, Edit, Trash2 } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Card, CardContent } from '@/components/ui/card';
import { UserAvatar } from '@/components/ui/UserAvatar';
import { PriceTag } from '@/features/classifieds/components/PriceTag';
import { useSubscribe, useNDKCurrentUser } from '@nostr-dev-kit/ndk-hooks';
import { CLASSIFIED_LISTING_KIND, parseListingFromEvent } from '@/features/classifieds/types';
import { formatDistanceToNow } from 'date-fns';
import { Loader2 } from 'lucide-react';
import { useCreateListing } from '@/features/classifieds/hooks/useCreateListing';
import { useState } from 'react';
export function ListingDetailPage() {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();
  const currentUser = useNDKCurrentUser();
  const { deleteListing } = useCreateListing();
  const [isDeleting, setIsDeleting] = useState(false);
  const { events, eose } = useSubscribe(id ? [{
    ids: [id],
    kinds: [CLASSIFIED_LISTING_KIND]
  }] : false, { subId: 'listing-detail' });
  if (!eose && events.length === 0) {
    return (
      <div className="container mx-auto px-4 py-12">
        <div className="flex items-center justify-center">
          <Loader2 className="w-8 h-8 animate-spin text-purple-600 dark:text-purple-400" />
        </div>
      </div>
    );
  }
  const event = events[0];
  if (!event) {
    return (
      <div className="container mx-auto px-4 py-12">
        <div className="max-w-2xl mx-auto text-center">
          <h2 className="text-2xl font-bold mb-4">Listing Not Found</h2>
          <p className="text-gray-600 dark:text-gray-400 mb-6">
            This listing may have been removed or doesn&apos;t exist.
          </p>
          <Button onClick={() => navigate('/marketplace')}>
            Back to Marketplace
          </Button>
        </div>
      </div>
    );
  }
  const listing = parseListingFromEvent(event);
  const isOwner = currentUser?.pubkey === listing.author;
  const timeAgo = listing.publishedAt
    ? formatDistanceToNow(new Date(listing.publishedAt * 1000), { addSuffix: true })
    : 'recently';
  const handleDelete = async () => {
    if (!confirm('Are you sure you want to delete this listing?')) return;
    try {
      setIsDeleting(true);
      await deleteListing(listing.id);
      navigate('/marketplace');
    } catch (error) {
      console.error('Failed to delete listing:', error);
      alert('Failed to delete listing. Please try again.');
    } finally {
      setIsDeleting(false);
    }
  };
  const handleShare = () => {
    const url = window.location.href;
    navigator.clipboard.writeText(url);
    alert('Link copied to clipboard!');
  };
  return (
    <div className="container mx-auto px-4 py-6">
      <div className="max-w-6xl mx-auto">
        <Button
          variant="ghost"
          onClick={() => navigate('/marketplace')}
          className="mb-6"
        >
          <ArrowLeft className="w-4 h-4 mr-2" />
          Back to Marketplace
        </Button>
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <div className="lg:col-span-2">
            {listing.images && listing.images.length > 0 && (
              <div className="mb-6">
                <div className="grid gap-4">
                  <img
                    src={listing.images[0]}
                    alt={listing.title}
                    className="w-full rounded-lg object-cover aspect-video"
                  />
                  {listing.images.length > 1 && (
                    <div className="grid grid-cols-4 gap-2">
                      {listing.images.slice(1).map((image, index) => (
                        <img
                          key={index}
                          src={image}
                          alt={`${listing.title} ${index + 2}`}
                          className="w-full h-24 rounded-lg object-cover cursor-pointer hover:opacity-75"
                        />
                      ))}
                    </div>
                  )}
                </div>
              </div>
            )}
            <Card>
              <CardContent className="p-6">
                <div className="mb-6">
                  <div className="flex items-start justify-between mb-4">
                    <h1 className="text-2xl font-bold text-gray-900 dark:text-white">
                      {listing.title}
                    </h1>
                    {listing.price && (
                      <PriceTag price={listing.price} className="text-lg px-4 py-2" />
                    )}
                  </div>
                  {listing.status === 'sold' && (
                    <div className="mb-4 p-4 bg-red-100 dark:bg-red-900/20 text-red-800 dark:text-red-400 rounded-lg text-center font-semibold">
                      This item has been sold
                    </div>
                  )}
                  <div className="flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400 mb-6">
                    {listing.location && (
                      <div className="flex items-center gap-1">
                        <MapPin className="w-4 h-4" />
                        <span>{listing.location}</span>
                      </div>
                    )}
                    <div className="flex items-center gap-1">
                      <Clock className="w-4 h-4" />
                      <span>Posted {timeAgo}</span>
                    </div>
                  </div>
                  {listing.categories && listing.categories.length > 0 && (
                    <div className="flex flex-wrap gap-2 mb-6">
                      {listing.categories.map(category => (
                        <span
                          key={category}
                          className="inline-flex items-center gap-1 px-3 py-1 bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-400 rounded-full text-sm"
                        >
                          <Tag className="w-3 h-3" />
                          {category}
                        </span>
                      ))}
                    </div>
                  )}
                  <div className="prose dark:prose-invert max-w-none">
                    <h3 className="text-lg font-semibold mb-2">Description</h3>
                    <div className="whitespace-pre-wrap">{listing.content}</div>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>
          <div className="lg:col-span-1">
            <Card className="sticky top-6">
              <CardContent className="p-6">
                <div className="flex items-center gap-3 mb-6">
                  <UserAvatar pubkey={listing.author} size="lg" />
                  <div>
                    <p className="text-sm text-gray-500 dark:text-gray-400">Listed by</p>
                    <p className="font-medium">User</p>
                  </div>
                </div>
                <div className="space-y-3">
                  {isOwner ? (
                    <>
                      <Link to={`/marketplace/edit/${listing.id}`} className="block">
                        <Button className="w-full" variant="outline">
                          <Edit className="w-4 h-4 mr-2" />
                          Edit Listing
                        </Button>
                      </Link>
                      <Button
                        className="w-full"
                        variant="destructive"
                        onClick={handleDelete}
                        disabled={isDeleting}
                      >
                        <Trash2 className="w-4 h-4 mr-2" />
                        {isDeleting ? 'Deleting...' : 'Delete Listing'}
                      </Button>
                    </>
                  ) : (
                    <Button className="w-full">
                      <MessageCircle className="w-4 h-4 mr-2" />
                      Contact Seller
                    </Button>
                  )}
                  <Button
                    className="w-full"
                    variant="outline"
                    onClick={handleShare}
                  >
                    <Share2 className="w-4 h-4 mr-2" />
                    Share Listing
                  </Button>
                </div>
              </CardContent>
            </Card>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/marketplace/MarketplacePage.tsx">
import { useState, useMemo, useEffect } from 'react';
import { useSearchParams } from 'react-router-dom';
import { Search } from 'lucide-react';
import { Input } from '@/components/ui/input';
import { ListingGrid } from '@/features/classifieds/components/ListingGrid';
import { CategorySection } from '@/features/classifieds/components/CategorySection';
import { FilterButton } from '@/features/classifieds/components/FilterButton';
import { useListings } from '@/features/classifieds/hooks/useListings';
import type { ClassifiedListing } from '@/features/classifieds/types';
const CATEGORIES = [
  { value: '', label: 'All Categories' },
  { value: 'electronics', label: 'Electronics' },
  { value: 'furniture', label: 'Furniture' },
  { value: 'clothing', label: 'Clothing' },
  { value: 'books', label: 'Books' },
  { value: 'services', label: 'Services' },
  { value: 'vehicles', label: 'Vehicles' },
  { value: 'real-estate', label: 'Real Estate' },
  { value: 'jobs', label: 'Jobs' },
  { value: 'free', label: 'Free' },
  { value: 'wanted', label: 'Wanted' }
];
export function MarketplacePage() {
  const [searchParams, setSearchParams] = useSearchParams();
  const [selectedCategory, setSelectedCategory] = useState(searchParams.get('category') || '');
  const [searchQuery, setSearchQuery] = useState('');
  const { listings } = useListings({
    category: selectedCategory || undefined
  });
  // Update URL when category changes
  useEffect(() => {
    if (selectedCategory) {
      setSearchParams({ category: selectedCategory });
    } else {
      setSearchParams({});
    }
  }, [selectedCategory, setSearchParams]);
  // Filter and group listings
  const { filteredListings, listingsByCategory } = useMemo(() => {
    // First filter by search query
    const filtered = listings.filter(listing => {
      if (!searchQuery) return true;
      const query = searchQuery.toLowerCase();
      return (
        listing.title.toLowerCase().includes(query) ||
        listing.summary?.toLowerCase().includes(query) ||
        listing.content.toLowerCase().includes(query) ||
        listing.location?.toLowerCase().includes(query)
      );
    });
    // Group by category for the category sections view
    const byCategory = filtered.reduce<Record<string, ClassifiedListing[]>>((acc, listing) => {
      if (listing.categories && listing.categories.length > 0) {
        listing.categories.forEach(category => {
          const key = category.toLowerCase();
          if (!acc[key]) acc[key] = [];
          acc[key].push(listing);
        });
      } else {
        if (!acc['uncategorized']) acc['uncategorized'] = [];
        acc['uncategorized'].push(listing);
      }
      return acc;
    }, {});
    return { filteredListings: filtered, listingsByCategory: byCategory };
  }, [listings, searchQuery]);
  // Determine view mode
  const isFilteredView = selectedCategory || searchQuery;
  return (
    <div className="min-h-screen bg-gray-50 dark:bg-black">
      <div className="container mx-auto px-4 py-4 max-w-7xl">
        {/* Header */}
        <div className="mb-6">
          <h1 className="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-primary-600 to-primary-400 bg-clip-text text-transparent mb-4">
            Marketplace
          </h1>
          {/* Search and Filter Bar */}
          <div className="flex gap-2 sm:gap-3">
            <div className="flex-1">
              <div className="relative">
                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5 pointer-events-none" />
                <Input
                  placeholder="Search listings..."
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  className="pl-10 h-12 bg-white/80 dark:bg-black/80 backdrop-blur border-gray-200 dark:border-gray-700 rounded-xl text-base focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all"
                />
              </div>
            </div>
            <FilterButton
              categories={CATEGORIES}
              selectedCategory={selectedCategory}
              onCategoryChange={setSelectedCategory}
            />
          </div>
        </div>
        {/* Content */}
        {isFilteredView ? (
          // Filtered view - show grid
          <div>
            {selectedCategory && (
              <div className="mb-6">
                <h2 className="text-xl font-semibold text-gray-900 dark:text-white">
                  {CATEGORIES.find(c => c.value === selectedCategory)?.label || selectedCategory}
                </h2>
                <p className="text-sm text-gray-500 dark:text-gray-400 mt-1">
                  {filteredListings.length} listings found
                </p>
              </div>
            )}
            <ListingGrid listings={filteredListings} />
          </div>
        ) : (
          // Category sections view
          <div>
            {Object.keys(listingsByCategory).length === 0 ? (
              <ListingGrid listings={[]} />
            ) : (
              <>
                {/* Featured/Recent listings */}
                {listings.length > 0 && (
                  <CategorySection
                    category="Recent Listings"
                    listings={listings.slice(0, 10)}
                    showViewAll={false}
                  />
                )}
                {/* Category sections */}
                {CATEGORIES.filter(c => c.value && listingsByCategory[c.value]?.length > 0).map(category => (
                  <CategorySection
                    key={category.value}
                    category={category.value}
                    listings={listingsByCategory[category.value]}
                  />
                ))}
                {/* Uncategorized section */}
                {listingsByCategory['uncategorized']?.length > 0 && (
                  <CategorySection
                    category="Other"
                    listings={listingsByCategory['uncategorized']}
                    showViewAll={false}
                  />
                )}
              </>
            )}
          </div>
        )}
      </div>
    </div>
  );
}
</file>

<file path="src/pages/TradePage.tsx">
import { useState, useEffect } from 'react';
import { Plus } from 'lucide-react';
import { OrderBook } from '@/features/trades/OrderBook';
import { CreateOrderModal } from '@/features/trades/CreateOrderModal';
import { QuickFilters } from '@/features/trades/QuickFilters';
import { CompactFilters } from '@/features/trades/CompactFilters';
import { useNDKCurrentUser } from '@nostr-dev-kit/ndk-hooks';
export function TradePage() {
  const currentUser = useNDKCurrentUser();
  const [showCreateModal, setShowCreateModal] = useState(false);
  const [isMobile, setIsMobile] = useState(false);
  const [filters, setFilters] = useState({
    currency: 'all',
    paymentMethod: 'all',
    orderType: 'all' as 'all' | 'buy' | 'sell',
    minAmount: 0,
    maxAmount: 1000000
  });
  useEffect(() => {
    const checkMobile = () => {
      setIsMobile(window.innerWidth < 768);
    };
    checkMobile();
    window.addEventListener('resize', checkMobile);
    return () => window.removeEventListener('resize', checkMobile);
  }, []);
  return (
    <div className="min-h-screen bg-gray-50 dark:bg-black">
      {/* Header */}
      <div className="bg-white dark:bg-black border-b border-gray-200 dark:border-gray-800 sticky top-0 z-20">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 md:py-4">
          <div className="flex items-center justify-between">
            <div>
              <h1 className="text-lg md:text-2xl font-bold text-gray-900 dark:text-white">P2P Trading</h1>
              <p className="text-xs md:text-sm text-gray-500 dark:text-gray-400 mt-0.5 md:mt-1 hidden sm:block">
                Buy and sell Bitcoin directly
              </p>
            </div>
            {currentUser && (
              <button
                onClick={() => setShowCreateModal(true)}
                className="hidden md:flex items-center gap-2 px-3 md:px-4 py-1.5 md:py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm md:text-base"
              >
                <Plus className="w-4 h-4" />
                <span>Create Order</span>
              </button>
            )}
          </div>
        </div>
      </div>
      {/* Filters - Mobile vs Desktop */}
      {isMobile ? (
        <CompactFilters
          filters={filters}
          onFiltersChange={setFilters}
        />
      ) : (
        <div className="bg-white dark:bg-black border-b border-gray-200 dark:border-gray-800">
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <QuickFilters
              selectedCurrency={filters.currency}
              selectedPaymentMethod={filters.paymentMethod}
              onCurrencyChange={(currency) => setFilters({ ...filters, currency })}
              onPaymentMethodChange={(method) => setFilters({ ...filters, paymentMethod: method })}
            />
          </div>
        </div>
      )}
      {/* Main Content */}
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <OrderBook filters={filters} />
      </div>
      {/* Create Order Modal */}
      {showCreateModal && (
        <CreateOrderModal onClose={() => setShowCreateModal(false)} />
      )}
    </div>
  );
}
</file>

<file path="src/main.tsx">
import React from 'react';
import { createRoot } from 'react-dom/client';
import { NDKHeadless, NDKSessionLocalStorage } from '@nostr-dev-kit/ndk-hooks';
import NDKCacheAdapterDexie from '@nostr-dev-kit/ndk-cache-dexie';
import { useSettingsStore } from './stores/settingsStore';
import './i18n/config';
import './app.css';
import App from './App.tsx';
const root = createRoot(document.getElementById('root')!);
function AppWithNDK() {
  // Get relay configuration from settings store
  const relays = useSettingsStore((state) => state.relays);
  const selectedRelay = useSettingsStore((state) => state.selectedRelay);
  // If a specific relay is selected, use only that one
  // Otherwise use all enabled relays
  let relayUrls: string[];
  if (selectedRelay) {
    // Single relay mode
    relayUrls = [selectedRelay];
  } else {
    // All enabled relays mode
    const enabledRelayUrls = relays
      .filter((relay) => relay.enabled)
      .map((relay) => relay.url);
    // Fallback to default relays if none are enabled
    relayUrls = enabledRelayUrls.length > 0
      ? enabledRelayUrls
      : ['wss://relay.damus.io', 'wss://nos.lol'];
  }
  return (
    <>
      <NDKHeadless
        ndk={{
          explicitRelayUrls: relayUrls,
          cacheAdapter: new NDKCacheAdapterDexie({ dbName: 'voces-ndk-cache' }),
        }}
        session={{
          storage: new NDKSessionLocalStorage(),
          opts: {
            follows: true,
            profile: true
          }
        }}
      />
      <App />
    </>
  );
}
root.render(
  <React.StrictMode>
    <AppWithNDK />
  </React.StrictMode>
);
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import react from 'eslint-plugin-react'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'
export default tseslint.config(
  { ignores: ['dist', 'node_modules', '.playwright-mcp'] },
  {
    extends: [js.configs.recommended, ...tseslint.configs.recommended],
    files: ['**/*.{ts,tsx}'],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
    plugins: {
      'react': react,
      'react-hooks': reactHooks,
      'react-refresh': reactRefresh,
    },
    rules: {
      ...react.configs.recommended.rules,
      ...react.configs['jsx-runtime'].rules,
      ...reactHooks.configs.recommended.rules,
      'react-refresh/only-export-components': [
        'warn',
        { allowConstantExport: true },
      ],
      'react/react-in-jsx-scope': 'off',
      'react/prop-types': 'off',
      '@typescript-eslint/no-unused-vars': ['error', {
        argsIgnorePattern: '^_',
        varsIgnorePattern: '^_',
        caughtErrorsIgnorePattern: '^_'
      }],
      '@typescript-eslint/no-explicit-any': 'warn',
    },
    settings: {
      react: {
        version: 'detect',
      },
    },
  },
)
</file>

<file path="postcss.config.js">
import tailwindcss from '@tailwindcss/postcss';
export default {
  plugins: [
    tailwindcss(),
  ],
};
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    './index.html',
    './src/**/*.{js,ts,jsx,tsx}',
  ],
  theme: {
    extend: {
      colors: {
        // Sophisticated monochrome base
        neutral: {
          50: '#FAFAFA',
          100: '#F5F5F5',
          150: '#EDEDED',
          200: '#E5E5E5',
          300: '#D4D4D4',
          400: '#A3A3A3',
          500: '#737373',
          600: '#525252',
          700: '#404040',
          800: '#262626',
          850: '#1A1A1A',
          900: '#171717',
          950: '#0A0A0A',
        },
        // Premium accent - deep blue/indigo
        accent: {
          50: '#EEF2FF',
          100: '#E0E7FF',
          200: '#C7D2FE',
          300: '#A5B4FC',
          400: '#818CF8',
          500: '#6366F1',
          600: '#4F46E5',
          700: '#4338CA',
          800: '#3730A3',
          900: '#312E81',
        },
        // Success - muted sage green
        success: {
          50: '#F0FDF4',
          100: '#DCFCE7',
          200: '#BBF7D0',
          300: '#86EFAC',
          400: '#4ADE80',
          500: '#22C55E',
          600: '#16A34A',
          700: '#15803D',
          800: '#166534',
          900: '#14532D',
        },
        // Warning - warm amber
        warning: {
          50: '#FFFBEB',
          100: '#FEF3C7',
          200: '#FDE68A',
          300: '#FCD34D',
          400: '#FBBF24',
          500: '#F59E0B',
          600: '#D97706',
          700: '#B45309',
          800: '#92400E',
          900: '#78350F',
        },
        // Error - muted red
        danger: {
          50: '#FEF2F2',
          100: '#FEE2E2',
          200: '#FECACA',
          300: '#FCA5A5',
          400: '#F87171',
          500: '#EF4444',
          600: '#DC2626',
          700: '#B91C1C',
          800: '#991B1B',
          900: '#7F1D1D',
        },
      },
      fontFamily: {
        sans: ['SF Pro Display', 'Inter', 'system-ui', '-apple-system', 'sans-serif'],
        mono: ['SF Mono', 'Monaco', 'Inconsolata', 'monospace'],
      },
      fontSize: {
        '2xs': '0.625rem',
        'xs': '0.75rem',
        'sm': '0.875rem',
        'base': '1rem',
        'lg': '1.125rem',
        'xl': '1.25rem',
        '2xl': '1.5rem',
        '3xl': '1.875rem',
        '4xl': '2.25rem',
        '5xl': '3rem',
      },
      animation: {
        'fade-in': 'fadeIn 0.15s ease-out',
        'slide-up': 'slideUp 0.2s ease-out',
        'scale-in': 'scaleIn 0.15s ease-out',
      },
      keyframes: {
        fadeIn: {
          '0%': { opacity: '0' },
          '100%': { opacity: '1' },
        },
        slideUp: {
          '0%': { transform: 'translateY(10px)', opacity: '0' },
          '100%': { transform: 'translateY(0)', opacity: '1' },
        },
        scaleIn: {
          '0%': { transform: 'scale(0.95)', opacity: '0' },
          '100%': { transform: 'scale(1)', opacity: '1' },
        },
      },
      boxShadow: {
        'soft': '0 1px 3px 0 rgb(0 0 0 / 0.02), 0 1px 2px -1px rgb(0 0 0 / 0.02)',
        'soft-md': '0 4px 6px -1px rgb(0 0 0 / 0.03), 0 2px 4px -2px rgb(0 0 0 / 0.03)',
        'soft-lg': '0 10px 15px -3px rgb(0 0 0 / 0.04), 0 4px 6px -4px rgb(0 0 0 / 0.04)',
        'soft-xl': '0 20px 25px -5px rgb(0 0 0 / 0.05), 0 8px 10px -6px rgb(0 0 0 / 0.05)',
        'glow': '0 0 20px rgba(99, 102, 241, 0.15)',
        'inner-soft': 'inset 0 1px 4px 0 rgb(0 0 0 / 0.05)',
      },
      backdropBlur: {
        xs: '2px',
      },
      borderRadius: {
        'sm': '0.25rem',
        'DEFAULT': '0.375rem',
        'md': '0.5rem',
        'lg': '0.75rem',
        'xl': '1rem',
        '2xl': '1.25rem',
        '3xl': '1.5rem',
      },
    },
  },
  plugins: [],
};
</file>

<file path="vite.config.ts">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'
// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  optimizeDeps: {
    exclude: ['@nostr-dev-kit/ndk-cache-sqlite-wasm']
  },
  server: {
    headers: {
      'Cross-Origin-Embedder-Policy': 'credentialless',
      'Cross-Origin-Opener-Policy': 'same-origin',
    },
    fs: {
      allow: ['..']
    }
  },
  assetsInclude: ['**/*.wasm'],
})
</file>

<file path="src/components/layout/Layout.tsx">
import { Outlet, useNavigate } from 'react-router-dom';
import { Sidebar } from '@/components/navigation/Sidebar';
import { BottomNav } from '@/components/navigation/BottomNav';
import { LoginButton } from '@/features/auth/LoginButton';
import { useNDKCurrentUser } from '@nostr-dev-kit/ndk-hooks';
import { FAB } from '@/components/ui/FAB';
import { Bell } from 'lucide-react';
import { RelaySelector } from '@/components/navigation/RelaySelector';
export function Layout() {
  const currentUser = useNDKCurrentUser();
  const navigate = useNavigate();
  return (
    <div className="min-h-screen bg-gray-50 dark:bg-black">
      {/* Sidebar for desktop */}
      <Sidebar />
      {/* Main content area */}
      <div className="md:ml-64 lg:ml-72 flex flex-col min-h-screen">
        {/* Mobile header */}
        <header className="md:hidden sticky top-0 z-50 bg-white/80 dark:bg-black/80 backdrop-blur-xl border-b border-gray-200 dark:border-gray-800">
          <div className="flex items-center justify-between px-4 h-14">
            <h1 className="text-lg font-bold text-gray-900 dark:text-white">
              Voces
            </h1>
            <div className="flex items-center gap-2">
              <RelaySelector />
              {currentUser && (
                <button
                  onClick={() => navigate('/notifications')}
                  className="relative p-2 hover:bg-neutral-200/50 dark:hover:bg-neutral-800/50 rounded-lg transition-all duration-200"
                >
                  <Bell className="w-5 h-5 text-neutral-600 dark:text-neutral-400" />
                  {/* Subtle notification dot */}
                  <span className="absolute top-1.5 right-1.5 w-1.5 h-1.5 bg-accent-500 rounded-full" />
                </button>
              )}
              {!currentUser && <LoginButton />}
            </div>
          </div>
        </header>
        {/* Page content */}
        <main className="flex-1 pb-20 md:pb-0">
          <Outlet />
        </main>
      </div>
      {/* Bottom navigation for mobile - always show */}
      <BottomNav />
      {/* FAB for compose */}
      {currentUser && <FAB />}
    </div>
  );
}
</file>

<file path="src/components/media/MediaGrid.tsx">
import { mapImetaTag } from '@nostr-dev-kit/ndk';
import type { NDKEvent, NDKImetaTag } from '@nostr-dev-kit/ndk';
import { Play, Music, FileImage, Download } from 'lucide-react';
import { useState } from 'react';
interface MediaGridProps {
  events: NDKEvent[];
}
interface MediaItemProps {
  event: NDKEvent;
  imeta: NDKImetaTag;
}
function MediaItem({ event, imeta }: MediaItemProps) {
  const [showFullscreen, setShowFullscreen] = useState(false);
  // Determine media type from mimetype or URL extension
  const getMediaType = (imeta: NDKImetaTag): 'image' | 'video' | 'audio' | 'file' => {
    const mime = imeta.m;
    const url = imeta.url;
    if (mime) {
      if (mime.startsWith('image/')) return 'image';
      if (mime.startsWith('video/')) return 'video';
      if (mime.startsWith('audio/')) return 'audio';
    } else if (url) {
      const ext = url.split('.').pop()?.toLowerCase();
      if (['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg', 'avif'].includes(ext || '')) return 'image';
      if (['mp4', 'webm', 'mov', 'avi', 'mkv'].includes(ext || '')) return 'video';
      if (['mp3', 'wav', 'ogg', 'flac', 'm4a'].includes(ext || '')) return 'audio';
    }
    return 'file';
  };
  const mediaType = getMediaType(imeta);
  const fileSize = imeta.size ? (parseInt(imeta.size) / (1024 * 1024)).toFixed(1) : null;
  // Format blurhash if available
  const blurhash = imeta.blurhash;
  return (
    <>
      <div
        className="group relative aspect-square overflow-hidden bg-gray-100 dark:bg-black cursor-pointer"
        onClick={() => setShowFullscreen(true)}
      >
        {mediaType === 'image' && (
          <img
            src={imeta.url}
            alt={imeta.alt || event.content || 'Image'}
            className="w-full h-full object-cover transition-transform group-hover:scale-105"
            loading="lazy"
            style={blurhash ? {
              backgroundImage: `url(data:image/svg+xml;base64,${btoa(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1 1"><rect width="1" height="1" fill="${blurhash}"/></svg>`)})`,
              backgroundSize: 'cover'
            } : undefined}
          />
        )}
        {mediaType === 'video' && (
          <div className="relative w-full h-full bg-black flex items-center justify-center">
            <video
              src={imeta.url}
              className="max-w-full max-h-full"
              preload="metadata"
            />
            <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
              <div className="w-16 h-16 bg-white/90 dark:bg-black/90 rounded-full flex items-center justify-center">
                <Play className="w-8 h-8 text-gray-900 dark:text-white ml-1" />
              </div>
            </div>
          </div>
        )}
        {mediaType === 'audio' && (
          <div className="w-full h-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center">
            <Music className="w-16 h-16 text-white" />
          </div>
        )}
        {mediaType === 'file' && (
          <div className="w-full h-full bg-gray-200 dark:bg-black flex flex-col items-center justify-center gap-2">
            <FileImage className="w-16 h-16 text-gray-500" />
            {imeta.url && (
              <span className="text-xs text-gray-600 dark:text-gray-400 px-2 text-center">
                {imeta.url.split('/').pop()?.substring(0, 20)}...
              </span>
            )}
          </div>
        )}
        {/* Overlay with metadata */}
        <div className="absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/70 to-transparent p-3 opacity-0 group-hover:opacity-100 transition-opacity">
          {event.content && (
            <p className="text-white text-sm line-clamp-2 mb-1">
              {event.content}
            </p>
          )}
          <div className="flex items-center gap-2 text-white/80 text-xs">
            {fileSize && <span>{fileSize} MB</span>}
            {imeta.dim && <span>{imeta.dim}</span>}
          </div>
        </div>
        {/* Media type indicator */}
        {mediaType !== 'image' && (
          <div className="absolute top-2 left-2 bg-black/50 backdrop-blur-sm px-2 py-1 rounded text-white text-xs">
            {mediaType === 'video' && 'Video'}
            {mediaType === 'audio' && 'Audio'}
            {mediaType === 'file' && 'File'}
          </div>
        )}
      </div>
      {/* Fullscreen modal */}
      {showFullscreen && (
        <div
          className="fixed inset-0 z-50 bg-black/95 flex items-center justify-center p-4"
          onClick={() => setShowFullscreen(false)}
        >
          <div className="relative max-w-full max-h-full" onClick={e => e.stopPropagation()}>
            {mediaType === 'image' && (
              <img
                src={imeta.url}
                alt={imeta.alt || event.content || 'Image'}
                className="max-w-full max-h-[90vh] object-contain"
              />
            )}
            {mediaType === 'video' && (
              <video
                src={imeta.url}
                className="max-w-full max-h-[90vh]"
                controls
                autoPlay
              />
            )}
            {mediaType === 'audio' && (
              <div className="bg-white dark:bg-black rounded-lg p-8 min-w-[400px]">
                <div className="flex items-center gap-4 mb-4">
                  <Music className="w-12 h-12 text-purple-600" />
                  <div>
                    <h3 className="font-semibold">{imeta.alt || 'Audio File'}</h3>
                    {fileSize && <p className="text-sm text-gray-500">{fileSize} MB</p>}
                  </div>
                </div>
                <audio src={imeta.url} controls autoPlay className="w-full" />
              </div>
            )}
            {mediaType === 'file' && imeta.url && (
              <div className="bg-white dark:bg-black rounded-lg p-8">
                <FileImage className="w-16 h-16 text-gray-500 mb-4" />
                <h3 className="font-semibold mb-2">{imeta.url.split('/').pop()}</h3>
                {fileSize && <p className="text-sm text-gray-500 mb-4">{fileSize} MB</p>}
                <a
                  href={imeta.url}
                  download
                  className="inline-flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700"
                  onClick={e => e.stopPropagation()}
                >
                  <Download className="w-4 h-4" />
                  Download
                </a>
              </div>
            )}
            {/* Close button */}
            <button
              onClick={() => setShowFullscreen(false)}
              className="absolute top-4 right-4 w-10 h-10 bg-white/10 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-white/20"
            >
              ‚úï
            </button>
          </div>
        </div>
      )}
    </>
  );
}
export function MediaGrid({ events }: MediaGridProps) {
  // Helper to extract media URLs from content
  const extractMediaUrls = (content: string): string[] => {
    const urlRegex = /(https?:\/\/[^\s]+\.(jpg|jpeg|png|gif|webp|svg|avif|mp4|webm|mov|avi|mkv))/gi;
    return content.match(urlRegex) || [];
  };
  // Process events to extract media items with imeta tags or content URLs
  const mediaItems = events.flatMap(event => {
    const imetaTags = event.tags.filter(tag => tag[0] === 'imeta');
    const imetas = imetaTags.map(tag => mapImetaTag(tag));
    // Items from imeta tags
    const imetaItems = imetas
      .filter(imeta => imeta.url)
      .map(imeta => ({ event, imeta }));
    // If we have imeta tags, use those
    if (imetaItems.length > 0) {
      return imetaItems;
    }
    // Otherwise, extract media URLs from content (for kind:1 events)
    const contentUrls = extractMediaUrls(event.content);
    return contentUrls.map(url => {
      // Create a simple imeta-like object from the URL
      const ext = url.split('.').pop()?.toLowerCase();
      const isVideo = ['mp4', 'webm', 'mov', 'avi', 'mkv'].includes(ext || '');
      return {
        event,
        imeta: {
          url,
          m: isVideo ? 'video/' + ext : 'image/' + ext,
        } as NDKImetaTag
      };
    });
  });
  if (mediaItems.length === 0) {
    return (
      <div className="text-center py-8 text-gray-500 dark:text-gray-400">
        No media uploaded yet
      </div>
    );
  }
  return (
    <div className="grid grid-cols-3 gap-1">
      {mediaItems.map(({ event, imeta }, index) => (
        <MediaItem key={`${event.id}-${index}`} event={event} imeta={imeta} />
      ))}
    </div>
  );
}
</file>

<file path="src/components/navigation/BottomNav.tsx">
import { Home, Store, Wallet, TrendingUp, User } from 'lucide-react';
import { Link, useLocation } from 'react-router-dom';
import { cn } from '@/lib/utils';
import { useTranslation } from 'react-i18next';
import { useNDKCurrentUser, useProfile } from '@nostr-dev-kit/ndk-hooks';
const navItemsConfig = [
  { path: '/', icon: Home, key: 'feed' },
  { path: '/marketplace', icon: Store, key: 'marketplace' },
  { path: '/wallet', icon: Wallet, key: 'wallet' },
  { path: '/trades', icon: TrendingUp, key: 'trades' },
  { path: '/profile', icon: User, key: 'profile' },
];
export function BottomNav() {
  const { t } = useTranslation();
  const location = useLocation();
  const currentUser = useNDKCurrentUser();
  const profile = useProfile(currentUser?.pubkey);
  const navItems = navItemsConfig.map(item => ({
    ...item,
    label: t(`navigation.${item.key}`)
  }));
  return (
    <nav className="fixed bottom-0 left-0 right-0 md:hidden z-40">
      {/* Clean bottom nav */}
      <div className="bg-white dark:bg-black border-t border-gray-200 dark:border-gray-800">
        <div className="flex items-center justify-around h-16 px-3">
          {navItems.map(({ path, icon: Icon, label, key }) => {
            const isActive = location.pathname === path;
            const isProfileTab = key === 'profile';
            const showAvatar = isProfileTab && currentUser && profile?.picture;
            return (
              <Link
                key={path}
                to={path}
                className="relative flex items-center justify-center w-full h-full group"
              >
                <div className="relative">
                  {showAvatar ? (
                    <div className={cn(
                      "w-7 h-7 rounded-full overflow-hidden ring-2 transition-all duration-200",
                      isActive
                        ? 'ring-gray-900 dark:ring-white'
                        : 'ring-gray-400 dark:ring-gray-500'
                    )}>
                      <img
                        src={profile.picture}
                        alt={profile?.name || 'Profile'}
                        className="w-full h-full object-cover"
                      />
                    </div>
                  ) : (
                    <Icon
                      className={cn(
                        'w-6 h-6 transition-colors duration-200',
                        isActive
                          ? 'text-gray-900 dark:text-white'
                          : 'text-gray-400 dark:text-gray-500'
                      )}
                      strokeWidth={isActive ? 2 : 1.5}
                    />
                  )}
                </div>
              </Link>
            );
          })}
        </div>
      </div>
    </nav>
  );
}
</file>

<file path="src/components/navigation/Sidebar.tsx">
import { useNDKCurrentUser } from '@nostr-dev-kit/ndk-hooks';
import { LoginButton } from '@/features/auth/LoginButton';
import { NavItems } from './NavItems';
import { UserMenu } from './UserMenu';
export function Sidebar() {
  const currentUser = useNDKCurrentUser();
  return (
    <aside className="hidden md:flex md:w-64 lg:w-72 flex-col h-screen fixed left-0 top-0 bg-black border-r border-neutral-800/50">
      <div className="flex items-center gap-3 px-6 py-6 border-b border-neutral-800/50">
        <h1 className="text-xl font-medium tracking-tight text-white">
          Voces
        </h1>
      </div>
      <NavItems />
      <div className="border-t border-neutral-800/50 p-4 mt-auto">
        {currentUser ? <UserMenu /> : <LoginButton />}
      </div>
    </aside>
  );
}
</file>

<file path="src/components/thread/ThreadNoteCard.tsx">
import { NDKEvent } from '@nostr-dev-kit/ndk-hooks';
import { NoteCard } from '@/features/feed/NoteCard';
import { cn } from '@/lib/utils';
interface ThreadNoteCardProps {
  event: NDKEvent;
  isMainNote?: boolean;
  showConnector?: boolean;
  isLastInThread?: boolean;
}
export function ThreadNoteCard({
  event,
  isMainNote = false,
  showConnector = false,
  isLastInThread = false
}: ThreadNoteCardProps) {
  return (
    <div className="relative">
      {/* Thread connector line before the note */}
      {showConnector && !isMainNote && (
        <div className="absolute left-[29px] -top-px h-[73px] w-0.5 bg-gray-300 dark:bg-black" />
      )}
      {/* The note itself with larger text for main note */}
      <div className="relative">
        <NoteCard event={event} isLargeText={isMainNote} />
      </div>
      {/* Thread connector line after the note */}
      {!isLastInThread && !isMainNote && (
        <div className="absolute left-[29px] top-[73px] bottom-0 w-0.5 bg-gray-300 dark:bg-black" />
      )}
    </div>
  );
}
</file>

<file path="src/components/ui/select.tsx">
import * as React from 'react';
import { ChevronDown } from 'lucide-react';
import { cn } from '@/lib/utils';
const SelectContext = React.createContext<{
  value: string;
  onValueChange: (value: string) => void;
  open: boolean;
  setOpen: (open: boolean) => void;
}>({
  value: '',
  onValueChange: () => {},
  open: false,
  setOpen: () => {},
});
interface SelectProps {
  value?: string;
  onValueChange?: (value: string) => void;
  children: React.ReactNode;
}
export function Select({ value = '', onValueChange = () => {}, children }: SelectProps) {
  const [open, setOpen] = React.useState(false);
  return (
    <SelectContext.Provider value={{ value, onValueChange, open, setOpen }}>
      <div className="relative">
        {children}
      </div>
    </SelectContext.Provider>
  );
}
interface SelectTriggerProps {
  className?: string;
  children: React.ReactNode;
}
export const SelectTrigger = React.forwardRef<HTMLButtonElement, SelectTriggerProps>(
  ({ className, children, ...props }, ref) => {
    const { open, setOpen } = React.useContext(SelectContext);
    return (
      <button
        ref={ref}
        type="button"
        onClick={() => setOpen(!open)}
        className={cn(
          'flex h-10 w-full items-center justify-between rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-800 dark:bg-black dark:ring-offset-gray-950 dark:placeholder:text-gray-400 dark:focus:ring-purple-400',
          className
        )}
        {...props}
      >
        {children}
        <ChevronDown className="h-4 w-4 opacity-50" />
      </button>
    );
  }
);
SelectTrigger.displayName = 'SelectTrigger';
export function SelectValue({ placeholder }: { placeholder?: string }) {
  const { value } = React.useContext(SelectContext);
  return <span>{value || placeholder || 'Select...'}</span>;
}
interface SelectContentProps {
  className?: string;
  children: React.ReactNode;
}
export function SelectContent({ className, children }: SelectContentProps) {
  const { open, setOpen } = React.useContext(SelectContext);
  const ref = React.useRef<HTMLDivElement>(null);
  React.useEffect(() => {
    function handleClickOutside(event: MouseEvent) {
      if (ref.current && !ref.current.contains(event.target as Node)) {
        setOpen(false);
      }
    }
    if (open) {
      document.addEventListener('mousedown', handleClickOutside);
    }
    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
    };
  }, [open, setOpen]);
  if (!open) return null;
  return (
    <div
      ref={ref}
      className={cn(
        'absolute z-50 mt-1 max-h-60 w-full overflow-auto rounded-md border border-gray-200 bg-white py-1 text-sm shadow-lg dark:border-gray-800 dark:bg-black',
        className
      )}
    >
      {children}
    </div>
  );
}
interface SelectItemProps {
  value: string;
  className?: string;
  children: React.ReactNode;
}
export function SelectItem({ value, className, children }: SelectItemProps) {
  const { value: selectedValue, onValueChange, setOpen } = React.useContext(SelectContext);
  const isSelected = selectedValue === value;
  return (
    <div
      onClick={() => {
        onValueChange(value);
        setOpen(false);
      }}
      className={cn(
        'relative cursor-pointer select-none px-3 py-2 hover:bg-gray-100 dark:hover:bg-neutral-900',
        isSelected && 'bg-gray-100 dark:bg-black',
        className
      )}
    >
      {children}
    </div>
  );
}
</file>

<file path="src/components/wallet/WalletWidget.tsx">
import { motion } from 'framer-motion';
import { Zap, Send, Download } from 'lucide-react';
import { Link } from 'react-router-dom';
import { useTranslation } from 'react-i18next';
import { useWallet } from '../../hooks/useWallet';
export function WalletWidget() {
  const { t } = useTranslation();
  const { balance } = useWallet();
  return (
    <Link to="/wallet">
      <motion.div
        whileHover={{ scale: 1.02 }}
        className="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-950/30 dark:to-pink-950/30 p-4 rounded-xl cursor-pointer transition-all hover:shadow-md"
      >
        <div className="flex items-center justify-between mb-3">
          <div className="flex items-center gap-2">
            <div className="w-8 h-8 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg flex items-center justify-center">
              <Zap className="w-4 h-4 text-white" />
            </div>
            <span className="text-sm font-medium text-gray-700 dark:text-gray-300">{t('navigation.wallet')}</span>
          </div>
        </div>
        <div className="mb-3">
          <div className="text-2xl font-light text-gray-900 dark:text-gray-100">
            {balance.toLocaleString()}
          </div>
          <div className="text-xs text-gray-500 dark:text-gray-400">{t('wallet.satsAvailable')}</div>
        </div>
        <div className="flex gap-2">
          <button
            onClick={(e) => {
              e.preventDefault();
              e.stopPropagation();
              // Quick send action
            }}
            className="flex-1 flex items-center justify-center gap-1 py-1.5 bg-white dark:bg-black rounded-lg text-xs font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-neutral-900 transition-colors"
          >
            <Send className="w-3 h-3" />
            {t('wallet.send')}
          </button>
          <button
            onClick={(e) => {
              e.preventDefault();
              e.stopPropagation();
              // Quick receive action
            }}
            className="flex-1 flex items-center justify-center gap-1 py-1.5 bg-white dark:bg-black rounded-lg text-xs font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-neutral-900 transition-colors"
          >
            <Download className="w-3 h-3" />
            {t('wallet.receive')}
          </button>
        </div>
      </motion.div>
    </Link>
  );
}
</file>

<file path="src/features/classifieds/components/FilterButton.tsx">
import { useState } from 'react';
import { Filter, X } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { motion, AnimatePresence } from 'framer-motion';
interface FilterButtonProps {
  categories: { value: string; label: string }[];
  selectedCategory: string;
  onCategoryChange: (category: string) => void;
}
export function FilterButton({ categories, selectedCategory, onCategoryChange }: FilterButtonProps) {
  const [isOpen, setIsOpen] = useState(false);
  const handleCategorySelect = (value: string) => {
    onCategoryChange(value);
    setIsOpen(false);
  };
  return (
    <div className="relative">
      <Button
        variant="outline"
        size="sm"
        onClick={() => setIsOpen(!isOpen)}
        className="flex items-center gap-2"
      >
        <Filter className="w-4 h-4" />
        {selectedCategory ? categories.find(c => c.value === selectedCategory)?.label : 'Filter'}
      </Button>
      <AnimatePresence>
        {isOpen && (
          <>
            {/* Backdrop */}
            <motion.div
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              exit={{ opacity: 0 }}
              className="fixed inset-0 z-40"
              onClick={() => setIsOpen(false)}
            />
            {/* Dropdown */}
            <motion.div
              initial={{ opacity: 0, y: -10 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: -10 }}
              className="absolute right-0 mt-2 w-56 bg-white dark:bg-black rounded-lg shadow-lg border border-gray-200 dark:border-gray-800 z-50"
            >
              <div className="p-2">
                {selectedCategory && (
                  <button
                    onClick={() => handleCategorySelect('')}
                    className="w-full flex items-center justify-between px-3 py-2 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-neutral-900 mb-1"
                  >
                    <span>Clear Filter</span>
                    <X className="w-4 h-4" />
                  </button>
                )}
                {categories.map(category => (
                  <button
                    key={category.value}
                    onClick={() => handleCategorySelect(category.value)}
                    className={`w-full text-left px-3 py-2 text-sm rounded-md hover:bg-gray-100 dark:hover:bg-neutral-900 ${
                      selectedCategory === category.value
                        ? 'bg-purple-50 text-purple-700 dark:bg-purple-950/50 dark:text-purple-400'
                        : ''
                    }`}
                  >
                    {category.label}
                  </button>
                ))}
              </div>
            </motion.div>
          </>
        )}
      </AnimatePresence>
    </div>
  );
}
</file>

<file path="src/features/followPacks/hooks/useFollowPacks.ts">
import { useMemo } from 'react';
import { useSubscribe, NDKFollowPack } from '@nostr-dev-kit/ndk-hooks';
export function useFollowPacks(pubkey?: string) {
  // Fetch lists created by a specific user or all lists
  const filters = pubkey
    ? [{
        kinds: NDKFollowPack.kinds,
        authors: [pubkey]
      }]
    : [{
        kinds: NDKFollowPack.kinds
      }];
  const { events } = useSubscribe(filters, { subId: pubkey ? `packs-by-${pubkey.slice(0, 8)}` : 'all-packs' });
  // Convert events to NDKFollowPack instances
  const packs = useMemo(() => {
    if (!events) return [];
    return events.map(event => NDKFollowPack.from(event));
  }, [events]);
  return { packs };
}
import { useFollowPacksStore } from '@/stores/followPacksStore';
export function useSubscribedFollowPacks() {
  const { subscribedPacks } = useFollowPacksStore();
  const { packs } = useFollowPacks();
  return useMemo(() => {
    return packs.filter(pack => subscribedPacks.includes(pack.id));
  }, [packs, subscribedPacks]);
}
</file>

<file path="src/features/profile/ProfileEditor.tsx">
import { useState, useRef } from 'react';
import { useNDK, useProfile } from '@nostr-dev-kit/ndk-hooks';
import { NDKEvent, NDKKind } from '@nostr-dev-kit/ndk';
import { BlossomClient } from 'blossom-client-sdk';
import { X, Upload, Loader2 } from 'lucide-react';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
interface ProfileEditorProps {
  pubkey: string;
  onClose: () => void;
  onSave: () => void;
}
export function ProfileEditor({ pubkey, onClose, onSave }: ProfileEditorProps) {
  const ndk = useNDK();
  const profile = useProfile(pubkey);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [isUploading, setIsUploading] = useState(false);
  const fileInputRef = useRef<HTMLInputElement>(null);
  const bannerInputRef = useRef<HTMLInputElement>(null);
  const [formData, setFormData] = useState({
    name: profile?.name || '',
    displayName: profile?.displayName || '',
    about: profile?.about || '',
    picture: profile?.picture || '',
    banner: profile?.banner || '',
    nip05: profile?.nip05 || '',
    lud16: profile?.lud16 || '',
    website: profile?.website || ''
  });
  const getBlossomServers = () => {
    const stored = localStorage.getItem('blossomServers');
    if (stored) {
      try {
        return JSON.parse(stored);
      } catch {
        // Failed to parse stored blossom servers, fall back to default
      }
    }
    return ['https://blossom.primal.net'];
  };
  const uploadToBlossoms = async (file: File): Promise<string> => {
    const servers = getBlossomServers();
    const mainServer = servers[0];
    const auth = await BlossomClient.createUploadAuth(file, async (event) => {
      const ndkEvent = new NDKEvent(ndk.ndk);
      ndkEvent.kind = event.kind;
      ndkEvent.content = event.content;
      ndkEvent.tags = event.tags;
      ndkEvent.created_at = event.created_at;
      await ndkEvent.sign();
      return ndkEvent.rawEvent();
    });
    const blob = await BlossomClient.uploadBlob(mainServer, file, auth);
    // Mirror to other servers if available
    for (let i = 1; i < servers.length; i++) {
      try {
        await BlossomClient.mirrorBlob(servers[i], blob.url, auth);
      } catch (error) {
        console.error(`Failed to mirror to ${servers[i]}:`, error);
      }
    }
    return blob.url;
  };
  const handleImageUpload = async (event: React.ChangeEvent<HTMLInputElement>, field: 'picture' | 'banner') => {
    const file = event.target.files?.[0];
    if (!file) return;
    if (!file.type.startsWith('image/')) {
      alert('Please select an image file');
      return;
    }
    if (file.size > 5 * 1024 * 1024) {
      alert('Image size must be less than 5MB');
      return;
    }
    setIsUploading(true);
    try {
      const url = await uploadToBlossoms(file);
      setFormData(prev => ({ ...prev, [field]: url }));
    } catch (error) {
      console.error('Upload failed:', error);
      alert('Failed to upload image. Please check your Blossom server settings.');
    } finally {
      setIsUploading(false);
    }
  };
  const handleSubmit = async () => {
    if (!ndk.ndk.signer) {
      alert('Please connect your wallet to save changes');
      return;
    }
    setIsSubmitting(true);
    try {
      const event = new NDKEvent(ndk.ndk);
      event.kind = NDKKind.Metadata;
      event.content = JSON.stringify({
        name: formData.name,
        display_name: formData.displayName,
        about: formData.about,
        picture: formData.picture,
        banner: formData.banner,
        nip05: formData.nip05,
        lud16: formData.lud16,
        website: formData.website
      });
      await event.sign();
      await event.publish();
      onSave();
    } catch (error) {
      console.error('Failed to save profile:', error);
      alert('Failed to save profile changes');
    } finally {
      setIsSubmitting(false);
    }
  };
  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white dark:bg-black rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        {/* Header */}
        <div className="sticky top-0 bg-white dark:bg-black border-b border-gray-200 dark:border-gray-800 p-4 flex items-center justify-between">
          <h2 className="text-xl font-semibold">Edit Profile</h2>
          <button
            onClick={onClose}
            className="p-2 hover:bg-gray-100 dark:hover:bg-neutral-900 rounded-lg transition-colors"
            disabled={isSubmitting}
          >
            <X className="w-5 h-5" />
          </button>
        </div>
        {/* Content */}
        <div className="p-4 space-y-6">
          {/* Banner */}
          <div>
            <Label>Banner</Label>
            <div className="mt-2">
              <div
                className="h-32 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg relative overflow-hidden cursor-pointer group"
                onClick={() => bannerInputRef.current?.click()}
                style={formData.banner ? { backgroundImage: `url(${formData.banner})`, backgroundSize: 'cover', backgroundPosition: 'center' } : undefined}
              >
                <div className="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                  <Upload className="w-8 h-8 text-white" />
                </div>
                <input
                  ref={bannerInputRef}
                  type="file"
                  accept="image/*"
                  className="hidden"
                  onChange={(e) => handleImageUpload(e, 'banner')}
                  disabled={isUploading}
                />
              </div>
            </div>
          </div>
          {/* Profile Picture */}
          <div>
            <Label>Profile Picture</Label>
            <div className="mt-2">
              <div className="flex items-center space-x-4">
                <div
                  className="w-24 h-24 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 relative overflow-hidden cursor-pointer group"
                  onClick={() => fileInputRef.current?.click()}
                >
                  {formData.picture ? (
                    <img src={formData.picture} alt="Profile" className="w-full h-full object-cover" />
                  ) : (
                    <div className="w-full h-full flex items-center justify-center text-white font-bold text-2xl">
                      {formData.name ? formData.name[0].toUpperCase() : 'A'}
                    </div>
                  )}
                  <div className="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                    {isUploading ? (
                      <Loader2 className="w-6 h-6 text-white animate-spin" />
                    ) : (
                      <Upload className="w-6 h-6 text-white" />
                    )}
                  </div>
                  <input
                    ref={fileInputRef}
                    type="file"
                    accept="image/*"
                    className="hidden"
                    onChange={(e) => handleImageUpload(e, 'picture')}
                    disabled={isUploading}
                  />
                </div>
                <div className="flex-1">
                  <Input
                    placeholder="Or enter image URL"
                    value={formData.picture}
                    onChange={(e) => setFormData(prev => ({ ...prev, picture: e.target.value }))}
                    disabled={isUploading}
                  />
                </div>
              </div>
            </div>
          </div>
          {/* Name */}
          <div>
            <Label htmlFor="name">Name</Label>
            <Input
              id="name"
              value={formData.name}
              onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}
              placeholder="Satoshi Nakamoto"
              className="mt-2"
            />
          </div>
          {/* Display Name */}
          <div>
            <Label htmlFor="displayName">Display Name</Label>
            <Input
              id="displayName"
              value={formData.displayName}
              onChange={(e) => setFormData(prev => ({ ...prev, displayName: e.target.value }))}
              placeholder="Optional display name"
              className="mt-2"
            />
          </div>
          {/* About - WYSIWYG */}
          <div>
            <Label htmlFor="about">About</Label>
            <div className="mt-2 border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden">
              <div className="bg-gray-50 dark:bg-black px-3 py-2 border-b border-gray-200 dark:border-gray-700 flex items-center space-x-2">
                <button
                  type="button"
                  className="px-2 py-1 text-sm font-medium hover:bg-gray-200 dark:hover:bg-neutral-900 rounded"
                  onClick={() => {
                    const textarea = document.getElementById('about') as HTMLTextAreaElement;
                    const start = textarea.selectionStart;
                    const end = textarea.selectionEnd;
                    const text = formData.about;
                    const selectedText = text.substring(start, end);
                    const newText = text.substring(0, start) + `**${selectedText}**` + text.substring(end);
                    setFormData(prev => ({ ...prev, about: newText }));
                  }}
                >
                  <strong>B</strong>
                </button>
                <button
                  type="button"
                  className="px-2 py-1 text-sm font-medium hover:bg-gray-200 dark:hover:bg-neutral-900 rounded italic"
                  onClick={() => {
                    const textarea = document.getElementById('about') as HTMLTextAreaElement;
                    const start = textarea.selectionStart;
                    const end = textarea.selectionEnd;
                    const text = formData.about;
                    const selectedText = text.substring(start, end);
                    const newText = text.substring(0, start) + `*${selectedText}*` + text.substring(end);
                    setFormData(prev => ({ ...prev, about: newText }));
                  }}
                >
                  <em>I</em>
                </button>
              </div>
              <Textarea
                id="about"
                value={formData.about}
                onChange={(e) => setFormData(prev => ({ ...prev, about: e.target.value }))}
                placeholder="Tell us about yourself..."
                className="border-0 focus:ring-0 min-h-[120px]"
                rows={5}
              />
            </div>
            <p className="text-sm text-gray-500 dark:text-gray-400 mt-1">
              Supports markdown formatting
            </p>
          </div>
          {/* NIP-05 */}
          <div>
            <Label htmlFor="nip05">NIP-05 Identifier</Label>
            <Input
              id="nip05"
              value={formData.nip05}
              onChange={(e) => setFormData(prev => ({ ...prev, nip05: e.target.value }))}
              placeholder="name@domain.com"
              className="mt-2"
            />
          </div>
          {/* Lightning Address */}
          <div>
            <Label htmlFor="lud16">Lightning Address</Label>
            <Input
              id="lud16"
              value={formData.lud16}
              onChange={(e) => setFormData(prev => ({ ...prev, lud16: e.target.value }))}
              placeholder="name@walletofsatoshi.com"
              className="mt-2"
            />
          </div>
          {/* Website */}
          <div>
            <Label htmlFor="website">Website</Label>
            <Input
              id="website"
              value={formData.website}
              onChange={(e) => setFormData(prev => ({ ...prev, website: e.target.value }))}
              placeholder="https://example.com"
              className="mt-2"
            />
          </div>
        </div>
        {/* Footer */}
        <div className="sticky bottom-0 bg-white dark:bg-black border-t border-gray-200 dark:border-gray-800 p-4 flex justify-end space-x-3">
          <button
            onClick={onClose}
            className="px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-neutral-900 rounded-lg transition-colors"
            disabled={isSubmitting}
          >
            Cancel
          </button>
          <button
            onClick={handleSubmit}
            disabled={isSubmitting || isUploading}
            className="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2"
          >
            {isSubmitting && <Loader2 className="w-4 h-4 animate-spin" />}
            <span>{isSubmitting ? 'Saving...' : 'Save Changes'}</span>
          </button>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/features/settings/RelaySettings.tsx">
import { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import {
  Plus,
  Trash2,
  Check,
  Zap,
  BookOpen,
  Edit2,
  Globe,
  AlertCircle,
  Wifi
} from 'lucide-react';
import { useSettingsStore } from '@/stores/settingsStore';
import { cn } from '@/lib/utils';
export function RelaySettings() {
  const { relays, addRelay, removeRelay, updateRelay, toggleRelay } = useSettingsStore();
  const [isAdding, setIsAdding] = useState(false);
  const [newRelay, setNewRelay] = useState({ url: '', read: true, write: true });
  const [testingRelay, setTestingRelay] = useState<string | null>(null);
  const [connectionStatus, setConnectionStatus] = useState<Record<string, 'connected' | 'disconnected' | 'testing'>>({});
  const handleAddRelay = () => {
    if (newRelay.url && !relays.some(r => r.url === newRelay.url)) {
      addRelay({
        ...newRelay,
        enabled: true,
        url: newRelay.url.startsWith('wss://') ? newRelay.url : `wss://${newRelay.url}`,
      });
      setNewRelay({ url: '', read: true, write: true });
      setIsAdding(false);
    }
  };
  const testRelayConnection = async (url: string) => {
    setTestingRelay(url);
    setConnectionStatus(prev => ({ ...prev, [url]: 'testing' }));
    // Mock connection test
    setTimeout(() => {
      const isConnected = Math.random() > 0.3; // 70% success rate for demo
      setConnectionStatus(prev => ({
        ...prev,
        [url]: isConnected ? 'connected' : 'disconnected'
      }));
      setTestingRelay(null);
    }, 1500);
  };
  const getRelayStatus = (url: string) => {
    if (testingRelay === url) return 'testing';
    return connectionStatus[url] || 'disconnected';
  };
  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2">
          Relay Configuration
        </h2>
        <p className="text-sm text-gray-600 dark:text-gray-400">
          Configure which Nostr relays your app connects to for reading and publishing events.
        </p>
      </div>
      {/* Stats */}
      <div className="grid grid-cols-3 gap-2 md:gap-4">
        <div className="bg-gray-50 dark:bg-black rounded-lg p-3 md:p-4">
          <div className="flex items-center gap-1 md:gap-2 text-green-600 dark:text-green-400 mb-1">
            <Wifi className="w-3 h-3 md:w-4 md:h-4" />
            <span className="text-xs md:text-sm font-medium">Active</span>
          </div>
          <div className="text-xl md:text-2xl font-bold text-gray-900 dark:text-gray-100">
            {relays.filter(r => r.enabled).length}
          </div>
        </div>
        <div className="bg-gray-50 dark:bg-black rounded-lg p-3 md:p-4">
          <div className="flex items-center gap-1 md:gap-2 text-blue-600 dark:text-blue-400 mb-1">
            <BookOpen className="w-3 h-3 md:w-4 md:h-4" />
            <span className="text-xs md:text-sm font-medium">Read</span>
          </div>
          <div className="text-xl md:text-2xl font-bold text-gray-900 dark:text-gray-100">
            {relays.filter(r => r.enabled && r.read).length}
          </div>
        </div>
        <div className="bg-gray-50 dark:bg-black rounded-lg p-3 md:p-4">
          <div className="flex items-center gap-1 md:gap-2 text-purple-600 dark:text-purple-400 mb-1">
            <Edit2 className="w-3 h-3 md:w-4 md:h-4" />
            <span className="text-xs md:text-sm font-medium">Write</span>
          </div>
          <div className="text-xl md:text-2xl font-bold text-gray-900 dark:text-gray-100">
            {relays.filter(r => r.enabled && r.write).length}
          </div>
        </div>
      </div>
      {/* Relay List */}
      <div className="space-y-2">
        <AnimatePresence>
          {relays.map((relay) => {
            const status = getRelayStatus(relay.url);
            return (
              <motion.div
                key={relay.url}
                initial={{ opacity: 0, x: -20 }}
                animate={{ opacity: 1, x: 0 }}
                exit={{ opacity: 0, x: 20 }}
                className={cn(
                  'border rounded-lg p-4 transition-all',
                  relay.enabled
                    ? 'bg-white dark:bg-black border-gray-200 dark:border-gray-700'
                    : 'bg-gray-50 dark:bg-black border-gray-200 dark:border-gray-800 opacity-60'
                )}
              >
                <div className="flex flex-col md:flex-row md:items-start md:justify-between gap-3">
                  <div className="flex-1">
                    <div className="flex items-start md:items-center gap-3">
                      <button
                        onClick={() => toggleRelay(relay.url)}
                        className={cn(
                          'w-5 h-5 rounded-full border-2 flex items-center justify-center transition-all flex-shrink-0 mt-0.5 md:mt-0',
                          relay.enabled
                            ? 'bg-purple-600 border-purple-600'
                            : 'bg-white dark:bg-black border-gray-300 dark:border-gray-600'
                        )}
                      >
                        {relay.enabled && <Check className="w-3 h-3 text-white" />}
                      </button>
                      <div className="flex-1 min-w-0">
                        <div className="flex flex-wrap items-center gap-2">
                          <Globe className="w-4 h-4 text-gray-400 flex-shrink-0" />
                          <span className="font-mono text-xs md:text-sm text-gray-900 dark:text-gray-100 break-all">
                            {relay.url}
                          </span>
                          {status === 'connected' && (
                            <span className="text-xs bg-green-100 dark:bg-green-950 text-green-700 dark:text-green-400 px-2 py-0.5 rounded-full">
                              Connected
                            </span>
                          )}
                          {status === 'disconnected' && connectionStatus[relay.url] !== undefined && (
                            <span className="text-xs bg-red-100 dark:bg-red-950 text-red-700 dark:text-red-400 px-2 py-0.5 rounded-full">
                              Offline
                            </span>
                          )}
                          {status === 'testing' && (
                            <span className="text-xs bg-yellow-100 dark:bg-yellow-950 text-yellow-700 dark:text-yellow-400 px-2 py-0.5 rounded-full">
                              Testing...
                            </span>
                          )}
                        </div>
                        <div className="flex items-center gap-4 mt-2">
                          <label className="flex items-center gap-2 cursor-pointer">
                            <input
                              type="checkbox"
                              checked={relay.read}
                              onChange={(e) => updateRelay(relay.url, { read: e.target.checked })}
                              className="w-4 h-4 text-purple-600 rounded focus:ring-purple-500"
                            />
                            <span className="text-sm text-gray-600 dark:text-gray-400">
                              Read
                            </span>
                          </label>
                          <label className="flex items-center gap-2 cursor-pointer">
                            <input
                              type="checkbox"
                              checked={relay.write}
                              onChange={(e) => updateRelay(relay.url, { write: e.target.checked })}
                              className="w-4 h-4 text-purple-600 rounded focus:ring-purple-500"
                            />
                            <span className="text-sm text-gray-600 dark:text-gray-400">
                              Write
                            </span>
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div className="flex items-center gap-2 ml-8 md:ml-0">
                    <button
                      onClick={() => testRelayConnection(relay.url)}
                      disabled={testingRelay === relay.url}
                      className="p-1.5 md:p-2 hover:bg-gray-100 dark:hover:bg-neutral-900 rounded-lg transition-colors disabled:opacity-50"
                      title="Test connection"
                    >
                      <Zap className="w-4 h-4 text-gray-500" />
                    </button>
                    <button
                      onClick={() => removeRelay(relay.url)}
                      className="p-1.5 md:p-2 hover:bg-red-50 dark:hover:bg-red-950/30 rounded-lg transition-colors group"
                      title="Remove relay"
                    >
                      <Trash2 className="w-4 h-4 text-gray-500 group-hover:text-red-600" />
                    </button>
                  </div>
                </div>
              </motion.div>
            );
          })}
        </AnimatePresence>
        {/* Add New Relay */}
        <AnimatePresence>
          {isAdding ? (
            <motion.div
              initial={{ opacity: 0, height: 0 }}
              animate={{ opacity: 1, height: 'auto' }}
              exit={{ opacity: 0, height: 0 }}
              className="border-2 border-dashed border-purple-300 dark:border-purple-700 rounded-lg p-4"
            >
              <div className="space-y-3">
                <input
                  type="text"
                  value={newRelay.url}
                  onChange={(e) => setNewRelay({ ...newRelay, url: e.target.value })}
                  placeholder="wss://relay.example.com"
                  className="w-full px-3 py-2 bg-white dark:bg-black border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                  autoFocus
                />
                <div className="flex items-center gap-4">
                  <label className="flex items-center gap-2 cursor-pointer">
                    <input
                      type="checkbox"
                      checked={newRelay.read}
                      onChange={(e) => setNewRelay({ ...newRelay, read: e.target.checked })}
                      className="w-4 h-4 text-purple-600 rounded focus:ring-purple-500"
                    />
                    <span className="text-sm text-gray-600 dark:text-gray-400">Read</span>
                  </label>
                  <label className="flex items-center gap-2 cursor-pointer">
                    <input
                      type="checkbox"
                      checked={newRelay.write}
                      onChange={(e) => setNewRelay({ ...newRelay, write: e.target.checked })}
                      className="w-4 h-4 text-purple-600 rounded focus:ring-purple-500"
                    />
                    <span className="text-sm text-gray-600 dark:text-gray-400">Write</span>
                  </label>
                </div>
                <div className="flex gap-2">
                  <button
                    onClick={handleAddRelay}
                    disabled={!newRelay.url}
                    className="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                  >
                    Add Relay
                  </button>
                  <button
                    onClick={() => {
                      setIsAdding(false);
                      setNewRelay({ url: '', read: true, write: true });
                    }}
                    className="px-4 py-2 bg-gray-200 dark:bg-black text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-neutral-900 transition-colors"
                  >
                    Cancel
                  </button>
                </div>
              </div>
            </motion.div>
          ) : (
            <motion.button
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              onClick={() => setIsAdding(true)}
              className="w-full border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-lg p-4 hover:border-purple-400 dark:hover:border-purple-600 transition-colors group"
            >
              <div className="flex items-center justify-center gap-2 text-gray-500 group-hover:text-purple-600 dark:group-hover:text-purple-400">
                <Plus className="w-5 h-5" />
                <span className="font-medium">Add Relay</span>
              </div>
            </motion.button>
          )}
        </AnimatePresence>
      </div>
      {/* Warning */}
      <div className="bg-yellow-50 dark:bg-yellow-950/30 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4">
        <div className="flex gap-3">
          <AlertCircle className="w-5 h-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5" />
          <div className="text-sm text-yellow-800 dark:text-yellow-300">
            <p className="font-medium mb-1">Important</p>
            <p>Changes to relay configuration will take effect after refreshing the app.</p>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/features/trades/CreateOrderModal.tsx">
import { useState } from 'react';
import { X, Bitcoin } from 'lucide-react';
import { useNDK } from '@nostr-dev-kit/ndk-hooks';
import { NDKEvent } from '@nostr-dev-kit/ndk';
interface CreateOrderModalProps {
  onClose: () => void;
}
const currencies = [
  { code: 'USD', symbol: '$', name: 'US Dollar' },
  { code: 'EUR', symbol: '‚Ç¨', name: 'Euro' },
  { code: 'GBP', symbol: '¬£', name: 'British Pound' },
  { code: 'BRL', symbol: 'R$', name: 'Brazilian Real' },
  { code: 'ARS', symbol: '$', name: 'Argentine Peso' },
  { code: 'PLN', symbol: 'z≈Ç', name: 'Polish Z≈Çoty' },
];
const paymentMethods = [
  { id: 'Cash', name: 'Cash (F2F)', icon: 'üíµ' },
  { id: 'Revolut', name: 'Revolut', icon: 'üí≥' },
  { id: 'PIX', name: 'PIX (Brazil)', icon: 'üîÑ' },
  { id: 'BLIK', name: 'BLIK (Poland)', icon: 'üì±' },
  { id: 'Zelle', name: 'Zelle', icon: 'üè¶' },
  { id: 'CashApp', name: 'Cash App', icon: 'üì≤' },
];
export function CreateOrderModal({ onClose }: CreateOrderModalProps) {
  const { ndk } = useNDK();
  const [orderType, setOrderType] = useState<'buy' | 'sell'>('buy');
  const [currency, setCurrency] = useState('USD');
  const [satsAmount, setSatsAmount] = useState('100000');
  const [fiatAmount, setFiatAmount] = useState('50');
  const [paymentMethod, setPaymentMethod] = useState('Cash');
  const [premium, setPremium] = useState('0');
  const [expirationHours, setExpirationHours] = useState('24');
  const [creating, setCreating] = useState(false);
  const handleCreate = async () => {
    if (!ndk) return;
    setCreating(true);
    try {
      const event = new NDKEvent(ndk);
      event.kind = 38383;
      // Generate unique ID
      const orderId = `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
      event.tags = [
        ['d', orderId],
        ['k', orderType],
        ['f', currency],
        ['s', 'pending'],
        ['amt', satsAmount],
        ['fa', fiatAmount],
        ['pm', paymentMethod],
        ['premium', premium],
        ['y', 'Voces'],
        ['z', 'order'],
        ['network', 'mainnet'],
        ['layer', 'lightning'],
        ['expiration', (Math.floor(Date.now() / 1000) + parseInt(expirationHours) * 3600).toString()]
      ];
      event.content = '';
      await event.publish();
      onClose();
    } catch (error) {
      console.error('Failed to create order:', error);
    } finally {
      setCreating(false);
    }
  };
  const btcAmount = parseInt(satsAmount) / 100000000;
  const pricePerBtc = parseFloat(fiatAmount) / btcAmount;
  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4">
      <div className="bg-white dark:bg-black rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto">
        <div className="sticky top-0 bg-white dark:bg-black border-b border-gray-200 dark:border-gray-800 p-6">
          <div className="flex items-center justify-between">
            <h2 className="text-2xl font-bold text-gray-900 dark:text-white">
              Create P2P Order
            </h2>
            <button
              onClick={onClose}
              className="p-2 hover:bg-gray-100 dark:hover:bg-neutral-900 rounded-lg transition-colors"
            >
              <X className="w-5 h-5" />
            </button>
          </div>
        </div>
        <div className="p-6 space-y-6">
          {/* Order Type */}
          <div>
            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
              Order Type
            </label>
            <div className="grid grid-cols-2 gap-3">
              <button
                onClick={() => setOrderType('buy')}
                className={`px-4 py-3 rounded-lg border-2 transition-colors ${
                  orderType === 'buy'
                    ? 'border-green-500 bg-green-50 text-green-700 dark:bg-green-900/30 dark:text-green-400'
                    : 'border-gray-300 dark:border-gray-700'
                }`}
              >
                I want to buy Bitcoin
              </button>
              <button
                onClick={() => setOrderType('sell')}
                className={`px-4 py-3 rounded-lg border-2 transition-colors ${
                  orderType === 'sell'
                    ? 'border-red-500 bg-red-50 text-red-700 dark:bg-red-900/30 dark:text-red-400'
                    : 'border-gray-300 dark:border-gray-700'
                }`}
              >
                I want to sell Bitcoin
              </button>
            </div>
          </div>
          {/* Bitcoin Amount */}
          <div>
            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
              Bitcoin Amount (sats)
            </label>
            <div className="relative">
              <Bitcoin className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-orange-500" />
              <input
                type="number"
                value={satsAmount}
                onChange={(e) => setSatsAmount(e.target.value)}
                className="w-full pl-10 pr-3 py-3 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-black text-gray-900 dark:text-white"
                placeholder="100000"
              />
            </div>
            <p className="mt-1 text-xs text-gray-500 dark:text-gray-400">
              = {btcAmount.toFixed(8)} BTC
            </p>
          </div>
          {/* Fiat Amount & Currency */}
          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Fiat Amount
              </label>
              <input
                type="number"
                value={fiatAmount}
                onChange={(e) => setFiatAmount(e.target.value)}
                className="w-full px-3 py-3 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-black text-gray-900 dark:text-white"
                placeholder="50"
              />
              <p className="mt-1 text-xs text-gray-500 dark:text-gray-400">
                ‚âà ${pricePerBtc.toFixed(2)}/BTC
              </p>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Currency
              </label>
              <select
                value={currency}
                onChange={(e) => setCurrency(e.target.value)}
                className="w-full px-3 py-3 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-black text-gray-900 dark:text-white"
              >
                {currencies.map((curr) => (
                  <option key={curr.code} value={curr.code}>
                    {curr.symbol} {curr.code}
                  </option>
                ))}
              </select>
            </div>
          </div>
          {/* Payment Method */}
          <div>
            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
              Payment Method
            </label>
            <div className="grid grid-cols-2 gap-3">
              {paymentMethods.map((method) => (
                <button
                  key={method.id}
                  onClick={() => setPaymentMethod(method.id)}
                  className={`flex items-center gap-2 px-3 py-2 rounded-lg border-2 transition-colors ${
                    paymentMethod === method.id
                      ? 'border-purple-500 bg-purple-50 dark:bg-purple-900/30'
                      : 'border-gray-300 dark:border-gray-700'
                  }`}
                >
                  <span className="text-lg">{method.icon}</span>
                  <span className="text-sm">{method.name}</span>
                </button>
              ))}
            </div>
          </div>
          {/* Premium */}
          <div>
            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
              Premium (%)
            </label>
            <input
              type="number"
              value={premium}
              onChange={(e) => setPremium(e.target.value)}
              className="w-full px-3 py-3 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-black text-gray-900 dark:text-white"
              placeholder="0"
            />
            <p className="mt-1 text-xs text-gray-500 dark:text-gray-400">
              Positive for above market, negative for below
            </p>
          </div>
          {/* Expiration */}
          <div>
            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
              Expiration (hours)
            </label>
            <select
              value={expirationHours}
              onChange={(e) => setExpirationHours(e.target.value)}
              className="w-full px-3 py-3 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-black text-gray-900 dark:text-white"
            >
              <option value="1">1 hour</option>
              <option value="6">6 hours</option>
              <option value="12">12 hours</option>
              <option value="24">24 hours</option>
              <option value="48">48 hours</option>
              <option value="72">72 hours</option>
            </select>
          </div>
          {/* Action Buttons */}
          <div className="flex gap-3">
            <button
              onClick={onClose}
              className="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-neutral-900 transition-colors"
            >
              Cancel
            </button>
            <button
              onClick={handleCreate}
              disabled={creating || !satsAmount || !fiatAmount}
              className="flex-1 px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            >
              {creating ? 'Creating...' : 'Create Order'}
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/features/trades/OrderCard.tsx">
import { useState } from 'react';
import { Bitcoin, Star, MessageSquare, ArrowRight, Shield } from 'lucide-react';
import { useProfile } from '@nostr-dev-kit/ndk-hooks';
import { formatDistanceToNow } from 'date-fns';
import { NDKEvent } from '@nostr-dev-kit/ndk';
import { TakeOrderModal } from './TakeOrderModal';
interface OrderCardProps {
  order: {
    id: string;
    pubkey: string;
    type: 'buy' | 'sell';
    currency: string;
    status: string;
    paymentMethod: string;
    satsAmount: number;
    fiatAmount: number;
    premium?: number;
    rating?: number;
    platform?: string;
    createdAt: number;
    event: NDKEvent;
  };
}
const currencyData: { [key: string]: { symbol: string; flag: string } } = {
  USD: { symbol: '$', flag: 'üá∫üá∏' },
  EUR: { symbol: '‚Ç¨', flag: 'üá™üá∫' },
  GBP: { symbol: '¬£', flag: 'üá¨üáß' },
  BRL: { symbol: 'R$', flag: 'üáßüá∑' },
  ARS: { symbol: '$', flag: 'üá¶üá∑' },
  PLN: { symbol: 'z≈Ç', flag: 'üáµüá±' },
  JPY: { symbol: '¬•', flag: 'üáØüáµ' },
  CHF: { symbol: 'Fr', flag: 'üá®üá≠' },
  PEN: { symbol: 'S/', flag: 'üáµüá™' },
  UYU: { symbol: '$', flag: 'üá∫üáæ' },
  VES: { symbol: 'Bs', flag: 'üáªüá™' },
  RUB: { symbol: '‚ÇΩ', flag: 'üá∑üá∫' },
  SEK: { symbol: 'kr', flag: 'üá∏üá™' },
  NOK: { symbol: 'kr', flag: 'üá≥üá¥' },
  AUD: { symbol: '$', flag: 'üá¶üá∫' },
  CUP: { symbol: '$', flag: 'üá®üá∫' },
};
const paymentMethodData: { [key: string]: { icon: string; region: string } } = {
  'Cash': { icon: 'üíµ', region: 'Universal' },
  'PIX': { icon: 'üîÑ', region: 'Brazil' },
  'BLIK': { icon: 'üì±', region: 'Poland' },
  'Revolut': { icon: 'üí≥', region: 'Europe' },
  'Zelle': { icon: 'üè¶', region: 'USA' },
  'CashApp': { icon: 'üì≤', region: 'USA' },
  'CVU': { icon: 'üèß', region: 'Argentina' },
  'MP': { icon: 'üì≤', region: 'Argentina' },
  'f2f': { icon: 'ü§ù', region: 'Local' },
  '–°–ë–ü': { icon: 'üè¶', region: 'Russia' },
};
export function OrderCard({ order }: OrderCardProps) {
  const profile = useProfile(order.pubkey);
  const [showTakeModal, setShowTakeModal] = useState(false);
  const currencyInfo = currencyData[order.currency] || { symbol: order.currency, flag: 'üåç' };
  const paymentInfo = paymentMethodData[order.paymentMethod] || { icon: 'üí∞', region: '' };
  // Calculate price per BTC
  const pricePerBtc = order.fiatAmount > 0 && order.satsAmount > 0
    ? (order.fiatAmount / order.satsAmount) * 100000000
    : 0;
  return (
    <>
      <div className="bg-white dark:bg-black rounded-lg md:rounded-xl border border-gray-200 dark:border-gray-800 p-3 md:p-4 hover:shadow-lg transition-shadow">
        <div className="flex items-start justify-between mb-2 md:mb-3">
          <div className="flex items-center gap-3">
            {profile?.picture ? (
              <img
                src={profile.picture}
                alt={profile.name || 'User'}
                className="w-10 h-10 md:w-12 md:h-12 rounded-full object-cover"
              />
            ) : (
              <div className="w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full" />
            )}
            <div>
              <div className="flex items-center gap-2">
                <h3 className="font-semibold text-sm md:text-base text-gray-900 dark:text-white">
                  {profile?.name || `@${order.pubkey.slice(0, 6)}...`}
                </h3>
                {order.rating && order.rating > 0 && (
                  <div className="flex items-center gap-1 text-yellow-500">
                    <Star className="w-4 h-4 fill-current" />
                    <span className="text-sm">{order.rating.toFixed(1)}</span>
                  </div>
                )}
              </div>
              <p className="text-xs text-gray-500 dark:text-gray-400">
                {formatDistanceToNow(order.createdAt * 1000, { addSuffix: true })}
                {order.platform && ` ‚Ä¢ ${order.platform}`}
              </p>
            </div>
          </div>
          <div className="flex items-center gap-1 md:gap-2">
            <span className="text-lg md:text-2xl">{currencyInfo.flag}</span>
            <div className={`px-2 md:px-3 py-0.5 md:py-1 rounded-full text-xs md:text-sm font-medium ${
              order.type === 'buy'
                ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400'
                : 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400'
            }`}>
              {order.type === 'buy' ? 'Buying' : 'Selling'}
            </div>
          </div>
        </div>
        <div className="grid grid-cols-3 gap-2 md:gap-4 mb-3 md:mb-4">
          <div>
            <p className="text-xs text-gray-500 dark:text-gray-400 mb-0.5 md:mb-1">Amount</p>
            <div className="flex items-center gap-1 md:gap-2">
              <Bitcoin className="w-3 h-3 md:w-4 md:h-4 text-orange-500" />
              <span className="font-mono font-semibold text-xs md:text-base text-gray-900 dark:text-white">
                {(order.satsAmount / 100000000).toFixed(4)}
              </span>
            </div>
            <p className="text-xs text-gray-500 dark:text-gray-400 mt-0.5 md:mt-1 hidden md:block">
              {order.satsAmount.toLocaleString()} sats
            </p>
          </div>
          <div>
            <p className="text-xs text-gray-500 dark:text-gray-400 mb-0.5 md:mb-1">Price</p>
            <div className="flex items-center gap-1">
              <span className="text-sm md:text-base hidden md:inline">{currencyInfo.flag}</span>
              <p className="text-sm md:text-lg font-semibold text-gray-900 dark:text-white">
                {currencyInfo.symbol}{order.fiatAmount.toFixed(0)}
              </p>
            </div>
            {pricePerBtc > 0 && (
              <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">
                {currencyInfo.symbol}{pricePerBtc.toFixed(2)}/BTC
                {order.premium && order.premium !== 0 && (
                  <span className={order.premium > 0 ? 'text-red-500' : 'text-green-500'}>
                    {' '}({order.premium > 0 ? '+' : ''}{order.premium}%)
                  </span>
                )}
              </p>
            )}
          </div>
          <div className="min-w-0">
            <p className="text-xs text-gray-500 dark:text-gray-400 mb-0.5 md:mb-1">Payment</p>
            <div className="flex items-center gap-1 md:gap-2">
              <span className="text-sm md:text-lg flex-shrink-0">{paymentInfo.icon}</span>
              <div className="flex flex-col min-w-0">
                <span className="font-medium text-xs md:text-base text-gray-900 dark:text-white truncate max-w-[80px] md:max-w-none">
                  {order.paymentMethod}
                </span>
                {paymentInfo.region && (
                  <span className="text-xs text-gray-500 dark:text-gray-400 hidden md:inline">
                    {paymentInfo.region}
                  </span>
                )}
              </div>
            </div>
          </div>
        </div>
        <div className="flex items-center gap-2">
          <button
            onClick={() => setShowTakeModal(true)}
            className="flex-1 flex items-center justify-center gap-1 md:gap-2 px-3 md:px-4 py-1.5 md:py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm md:text-base"
          >
            <ArrowRight className="w-3 h-3 md:w-4 md:h-4" />
            <span className="hidden md:inline">{order.type === 'buy' ? 'Sell to User' : 'Buy from User'}</span>
            <span className="md:hidden">{order.type === 'buy' ? 'Sell' : 'Buy'}</span>
          </button>
          <button className="p-1.5 md:p-2 border border-gray-300 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-neutral-900 transition-colors">
            <MessageSquare className="w-3 h-3 md:w-4 md:h-4" />
          </button>
          <button className="p-1.5 md:p-2 border border-gray-300 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-neutral-900 transition-colors hidden md:block">
            <Shield className="w-3 h-3 md:w-4 md:h-4" />
          </button>
        </div>
      </div>
      {showTakeModal && (
        <TakeOrderModal order={order} onClose={() => setShowTakeModal(false)} />
      )}
    </>
  );
}
</file>

<file path="src/features/trades/QuickFilters.tsx">
import { Globe, CreditCard, ChevronDown } from 'lucide-react';
import { useState, useRef, useEffect } from 'react';
import { useAvailableCurrencies } from './hooks/useAvailableCurrencies';
interface QuickFiltersProps {
  selectedCurrency: string;
  selectedPaymentMethod: string;
  onCurrencyChange: (currency: string) => void;
  onPaymentMethodChange: (method: string) => void;
}
const popularPaymentMethods = [
  { id: 'all', name: 'All Methods', icon: 'üí∞', countries: [] },
  { id: 'Cash', name: 'Cash', icon: 'üíµ', countries: ['Universal'] },
  { id: 'PIX', name: 'PIX', icon: 'üîÑ', countries: ['Brazil'] },
  { id: 'BLIK', name: 'BLIK', icon: 'üì±', countries: ['Poland'] },
  { id: 'Revolut', name: 'Revolut', icon: 'üí≥', countries: ['Europe'] },
  { id: 'Zelle', name: 'Zelle', icon: 'üè¶', countries: ['USA'] },
  { id: 'CashApp', name: 'CashApp', icon: 'üì≤', countries: ['USA'] },
  { id: 'CVU', name: 'CVU/MP', icon: 'üèß', countries: ['Argentina'] },
  { id: 'f2f', name: 'Face to Face', icon: 'ü§ù', countries: ['Local'] },
];
function CurrencyDropdown({
  currencies,
  selectedCurrency,
  onCurrencyChange,
}: {
  currencies: Array<{ code: string; name: string; flag: string }>;
  selectedCurrency: string;
  onCurrencyChange: (currency: string) => void;
}) {
  const [isOpen, setIsOpen] = useState(false);
  const dropdownRef = useRef<HTMLDivElement>(null);
  useEffect(() => {
    function handleClickOutside(event: MouseEvent) {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {
        setIsOpen(false);
      }
    }
    document.addEventListener('mousedown', handleClickOutside);
    return () => document.removeEventListener('mousedown', handleClickOutside);
  }, []);
  const selectedCurrencyData = currencies.find(c => c.code === selectedCurrency);
  return (
    <div ref={dropdownRef} className="relative">
      <button
        onClick={() => setIsOpen(!isOpen)}
        className={`
          flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all min-w-[140px]
          ${selectedCurrency !== 'all'
            ? 'bg-purple-600 text-white shadow-md hover:bg-purple-700'
            : 'bg-white dark:bg-black border border-gray-200 dark:border-gray-700 hover:border-purple-400 dark:hover:border-purple-600'
          }
        `}
      >
        <span className="text-base">{selectedCurrencyData?.flag}</span>
        <span className="flex-1 text-left">
          {selectedCurrency === 'all' ? 'All Currencies' : selectedCurrency}
        </span>
        <ChevronDown className={`w-4 h-4 transition-transform ${isOpen ? 'rotate-180' : ''}`} />
      </button>
      {isOpen && (
        <div className="absolute top-full mt-2 left-0 w-full min-w-[200px] bg-white dark:bg-black border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl z-[100] max-h-96 overflow-y-auto">
          <div className="py-1">
            {currencies.map((currency) => (
              <button
                key={currency.code}
                onClick={() => {
                  onCurrencyChange(currency.code);
                  setIsOpen(false);
                }}
                className={`
                  w-full flex items-center gap-3 px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-neutral-900 transition-colors text-left
                  ${selectedCurrency === currency.code ? 'bg-purple-50 dark:bg-purple-900/30' : ''}
                `}
              >
                <span className="text-lg">{currency.flag}</span>
                <div className="flex-1">
                  <div className="font-medium text-sm">
                    {currency.code === 'all' ? currency.name : currency.code}
                  </div>
                  {currency.code !== 'all' && (
                    <div className="text-xs text-gray-500 dark:text-gray-400">{currency.name}</div>
                  )}
                </div>
                {selectedCurrency === currency.code && (
                  <div className="w-2 h-2 bg-purple-600 rounded-full"></div>
                )}
              </button>
            ))}
          </div>
        </div>
      )}
    </div>
  );
}
export function QuickFilters({
  selectedCurrency,
  selectedPaymentMethod,
  onCurrencyChange,
  onPaymentMethodChange,
}: QuickFiltersProps) {
  const { currencies, loading } = useAvailableCurrencies();
  const showAsDropdown = currencies.length > 8;
  return (
    <div className="space-y-4">
      {/* Currency Filter */}
      <div>
        <div className="flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          <Globe className="w-4 h-4" />
          <span>Currency</span>
          {loading && (
            <span className="text-xs text-gray-500 dark:text-gray-400">(Loading currencies...)</span>
          )}
        </div>
        {showAsDropdown ? (
          <CurrencyDropdown
            currencies={currencies}
            selectedCurrency={selectedCurrency}
            onCurrencyChange={onCurrencyChange}
          />
        ) : (
          <div className="flex flex-wrap gap-2">
            {currencies.map((currency) => (
              <button
                key={currency.code}
                onClick={() => onCurrencyChange(currency.code)}
                className={`
                  flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium transition-all
                  ${selectedCurrency === currency.code
                    ? 'bg-purple-600 text-white shadow-md scale-105'
                    : 'bg-white dark:bg-black border border-gray-200 dark:border-gray-700 hover:border-purple-400 dark:hover:border-purple-600 hover:shadow-sm'
                  }
                `}
              >
                <span className="text-base">{currency.flag}</span>
                <span>{currency.code === 'all' ? currency.name : currency.code}</span>
              </button>
            ))}
          </div>
        )}
      </div>
      {/* Payment Method Filter */}
      <div>
        <div className="flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          <CreditCard className="w-4 h-4" />
          <span>Payment Method</span>
        </div>
        <div className="flex flex-wrap gap-2">
          {popularPaymentMethods.map((method) => (
            <button
              key={method.id}
              onClick={() => onPaymentMethodChange(method.id)}
              className={`
                group flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium transition-all
                ${selectedPaymentMethod === method.id
                  ? 'bg-purple-600 text-white shadow-md scale-105'
                  : 'bg-white dark:bg-black border border-gray-200 dark:border-gray-700 hover:border-purple-400 dark:hover:border-purple-600 hover:shadow-sm'
                }
              `}
            >
              <span className="text-base">{method.icon}</span>
              <span>{method.name}</span>
              {method.countries.length > 0 && method.id !== 'all' && (
                <span className={`
                  text-xs px-1.5 py-0.5 rounded-full ml-1
                  ${selectedPaymentMethod === method.id
                    ? 'bg-purple-700/50'
                    : 'bg-gray-100 dark:bg-black text-gray-500 dark:text-gray-400'
                  }
                `}>
                  {method.countries[0]}
                </span>
              )}
            </button>
          ))}
        </div>
      </div>
      {/* Active Filters Summary */}
      {(selectedCurrency !== 'all' || selectedPaymentMethod !== 'all') && (
        <div className="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400">
          <span>Active filters:</span>
          {selectedCurrency !== 'all' && (
            <span className="px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 rounded-full text-xs font-medium">
              {currencies.find(c => c.code === selectedCurrency)?.flag} {selectedCurrency}
            </span>
          )}
          {selectedPaymentMethod !== 'all' && (
            <span className="px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 rounded-full text-xs font-medium">
              {popularPaymentMethods.find(m => m.id === selectedPaymentMethod)?.icon} {selectedPaymentMethod}
            </span>
          )}
          <button
            onClick={() => {
              onCurrencyChange('all');
              onPaymentMethodChange('all');
            }}
            className="text-purple-600 hover:text-purple-700 dark:text-purple-400 dark:hover:text-purple-300 underline text-xs"
          >
            Clear all
          </button>
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/features/trades/TakeOrderModal.tsx">
import { useState } from 'react';
import { X, AlertTriangle, Bitcoin, Shield } from 'lucide-react';
import { useNDK } from '@nostr-dev-kit/ndk-hooks';
import { NDKEvent } from '@nostr-dev-kit/ndk';
import { useProfile } from '@nostr-dev-kit/ndk-hooks';
interface TakeOrderModalProps {
  order: {
    id: string;
    pubkey: string;
    type: 'buy' | 'sell';
    currency: string;
    status: string;
    paymentMethod: string;
    satsAmount: number;
    fiatAmount: number;
    premium?: number;
    rating?: number;
    platform?: string;
    createdAt: number;
    event: NDKEvent;
  };
  onClose: () => void;
}
export function TakeOrderModal({ order, onClose }: TakeOrderModalProps) {
  const { ndk } = useNDK();
  const profile = useProfile(order.pubkey);
  const [step, setStep] = useState<'confirm' | 'processing' | 'complete'>('confirm');
  const [accepted, setAccepted] = useState(false);
  const handleTakeOrder = async () => {
    if (!ndk) return;
    setStep('processing');
    try {
      // Create a take order event
      const event = new NDKEvent(ndk);
      event.kind = 38383;
      // Create response event with reference to original order
      event.tags = [
        ['d', `take-${order.id}-${Date.now()}`],
        ['e', order.event.id],
        ['p', order.pubkey],
        ['k', order.type === 'buy' ? 'sell' : 'buy'],
        ['f', order.currency],
        ['s', 'in-progress'],
        ['amt', order.satsAmount.toString()],
        ['fa', order.fiatAmount.toString()],
        ['pm', order.paymentMethod],
        ['y', 'Voces'],
        ['z', 'take-order']
      ];
      event.content = `Taking order ${order.id}`;
      await event.publish();
      // Update original order status (in real implementation, this would be handled by the maker)
      const statusUpdate = new NDKEvent(ndk);
      statusUpdate.kind = 38383;
      statusUpdate.tags = [
        ...order.event.tags.filter(t => t[0] !== 's'),
        ['s', 'in-progress']
      ];
      statusUpdate.content = '';
      await statusUpdate.publish();
      setStep('complete');
      // Close modal after a delay
      setTimeout(() => {
        onClose();
      }, 2000);
    } catch (error) {
      console.error('Failed to take order:', error);
      setStep('confirm');
    }
  };
  const currencySymbol = { USD: '$', EUR: '‚Ç¨', GBP: '¬£', BRL: 'R$' }[order.currency] || order.currency;
  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4">
      <div className="bg-white dark:bg-black rounded-2xl max-w-md w-full">
        {step === 'confirm' && (
          <>
            <div className="p-6 border-b border-gray-200 dark:border-gray-800">
              <div className="flex items-center justify-between">
                <h2 className="text-xl font-bold text-gray-900 dark:text-white">
                  Confirm Trade
                </h2>
                <button
                  onClick={onClose}
                  className="p-2 hover:bg-gray-100 dark:hover:bg-neutral-900 rounded-lg transition-colors"
                >
                  <X className="w-5 h-5" />
                </button>
              </div>
            </div>
            <div className="p-6 space-y-4">
              {/* Trade Summary */}
              <div className="bg-gray-50 dark:bg-black rounded-lg p-4 space-y-3">
                <div className="flex items-center justify-between">
                  <span className="text-sm text-gray-500 dark:text-gray-400">You will {order.type === 'buy' ? 'sell' : 'buy'}</span>
                  <div className="flex items-center gap-1">
                    <Bitcoin className="w-4 h-4 text-orange-500" />
                    <span className="font-mono font-semibold">{(order.satsAmount / 100000000).toFixed(8)} BTC</span>
                  </div>
                </div>
                <div className="flex items-center justify-between">
                  <span className="text-sm text-gray-500 dark:text-gray-400">For</span>
                  <span className="font-semibold">{currencySymbol}{order.fiatAmount.toFixed(2)}</span>
                </div>
                <div className="flex items-center justify-between">
                  <span className="text-sm text-gray-500 dark:text-gray-400">Via</span>
                  <span className="font-medium">{order.paymentMethod}</span>
                </div>
                <div className="flex items-center justify-between">
                  <span className="text-sm text-gray-500 dark:text-gray-400">Trading with</span>
                  <div className="flex items-center gap-2">
                    <span className="font-medium">{profile?.name || 'Anonymous'}</span>
                    {order.rating && (
                      <span className="text-yellow-500 text-sm">‚òÖ {order.rating.toFixed(1)}</span>
                    )}
                  </div>
                </div>
              </div>
              {/* Warning */}
              <div className="flex items-start gap-3 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">
                <AlertTriangle className="w-5 h-5 text-yellow-600 dark:text-yellow-500 flex-shrink-0 mt-0.5" />
                <div className="text-sm text-yellow-800 dark:text-yellow-300">
                  <p className="font-medium mb-1">Trade Safely</p>
                  <ul className="space-y-1 text-xs">
                    <li>‚Ä¢ Never release funds before confirming payment</li>
                    <li>‚Ä¢ Use escrow when available</li>
                    <li>‚Ä¢ Communicate only through secure channels</li>
                    <li>‚Ä¢ Report suspicious behavior immediately</li>
                  </ul>
                </div>
              </div>
              {/* Terms Acceptance */}
              <label className="flex items-start gap-3 cursor-pointer">
                <input
                  type="checkbox"
                  checked={accepted}
                  onChange={(e) => setAccepted(e.target.checked)}
                  className="mt-1 w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500"
                />
                <span className="text-sm text-gray-700 dark:text-gray-300">
                  I understand the risks and agree to proceed with this P2P trade
                </span>
              </label>
              {/* Actions */}
              <div className="flex gap-3">
                <button
                  onClick={onClose}
                  className="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-neutral-900 transition-colors"
                >
                  Cancel
                </button>
                <button
                  onClick={handleTakeOrder}
                  disabled={!accepted}
                  className="flex-1 px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                >
                  Take Order
                </button>
              </div>
            </div>
          </>
        )}
        {step === 'processing' && (
          <div className="p-12 text-center">
            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"></div>
            <p className="text-gray-900 dark:text-white font-medium">Processing Trade...</p>
            <p className="text-sm text-gray-500 dark:text-gray-400 mt-2">
              Connecting with trader
            </p>
          </div>
        )}
        {step === 'complete' && (
          <div className="p-12 text-center">
            <div className="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4">
              <Shield className="w-6 h-6 text-green-600 dark:text-green-400" />
            </div>
            <p className="text-gray-900 dark:text-white font-medium">Trade Initiated!</p>
            <p className="text-sm text-gray-500 dark:text-gray-400 mt-2">
              Check your messages for next steps
            </p>
          </div>
        )}
      </div>
    </div>
  );
}
</file>

<file path="src/features/trades/TradeFilters.tsx">
import { DollarSign, CreditCard, TrendingUp } from 'lucide-react';
import { useAvailableCurrencies } from './hooks/useAvailableCurrencies';
interface TradeFiltersProps {
  filters: {
    currency: string;
    paymentMethod: string;
    orderType: 'all' | 'buy' | 'sell';
    minAmount: number;
    maxAmount: number;
  };
  onChange: (filters: any) => void;
}
const paymentMethods = [
  { id: 'all', name: 'All Methods' },
  { id: 'Cash', name: 'Cash' },
  { id: 'Revolut', name: 'Revolut' },
  { id: 'PIX', name: 'PIX' },
  { id: 'BLIK', name: 'BLIK' },
  { id: 'Zelle', name: 'Zelle' },
  { id: 'CashApp', name: 'Cash App' },
];
export function TradeFilters({ filters, onChange }: TradeFiltersProps) {
  const { currencies } = useAvailableCurrencies();
  return (
    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
      {/* Currency Filter */}
      <div>
        <label className="flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          <DollarSign className="w-4 h-4" />
          Currency
        </label>
        <select
          value={filters.currency}
          onChange={(e) => onChange({ ...filters, currency: e.target.value })}
          className="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-black text-gray-900 dark:text-white"
        >
          {currencies.map((curr) => (
            <option key={curr.code} value={curr.code}>
              {curr.code === 'all' ? curr.name : `${curr.code} - ${curr.name}`}
            </option>
          ))}
        </select>
      </div>
      {/* Payment Method Filter */}
      <div>
        <label className="flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          <CreditCard className="w-4 h-4" />
          Payment Method
        </label>
        <select
          value={filters.paymentMethod}
          onChange={(e) => onChange({ ...filters, paymentMethod: e.target.value })}
          className="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-black text-gray-900 dark:text-white"
        >
          {paymentMethods.map((method) => (
            <option key={method.id} value={method.id}>
              {method.name}
            </option>
          ))}
        </select>
      </div>
      {/* Order Type Filter */}
      <div>
        <label className="flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          <TrendingUp className="w-4 h-4" />
          Order Type
        </label>
        <select
          value={filters.orderType}
          onChange={(e) => onChange({ ...filters, orderType: e.target.value as 'all' | 'buy' | 'sell' })}
          className="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-black text-gray-900 dark:text-white"
        >
          <option value="all">All Orders</option>
          <option value="buy">Buy Orders</option>
          <option value="sell">Sell Orders</option>
        </select>
      </div>
      {/* Amount Range */}
      <div>
        <label className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block">
          Amount Range (sats)
        </label>
        <div className="flex items-center gap-2">
          <input
            type="number"
            value={filters.minAmount}
            onChange={(e) => onChange({ ...filters, minAmount: parseInt(e.target.value) || 0 })}
            className="w-full px-2 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-black text-gray-900 dark:text-white text-sm"
            placeholder="Min"
          />
          <span className="text-gray-500">-</span>
          <input
            type="number"
            value={filters.maxAmount}
            onChange={(e) => onChange({ ...filters, maxAmount: parseInt(e.target.value) || 1000000 })}
            className="w-full px-2 py-2 border border-gray-300 dark:border-gray-700 rounded-lg bg-white dark:bg-black text-gray-900 dark:text-white text-sm"
            placeholder="Max"
          />
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/i18n/locales/en.json">
{
  "navigation": {
    "feed": "Home",
    "compose": "Compose",
    "notifications": "Notifications",
    "classifieds": "Classifieds",
    "marketplace": "Marketplace",
    "trades": "P2P Trades",
    "followPacks": "Follow Packs",
    "profile": "Profile",
    "wallet": "Wallet",
    "settings": "Settings",
    "logout": "Logout"
  },
  "auth": {
    "login": "Login with Nostr",
    "logout": "Logout",
    "loginSuccess": "Successfully logged in",
    "loginError": "Failed to login",
    "connecting": "Connecting..."
  },
  "feed": {
    "title": "Feed",
    "compose": {
      "placeholder": "What's on your mind?",
      "publish": "Publish",
      "publishing": "Publishing...",
      "publishSuccess": "Note published!",
      "publishError": "Failed to publish note"
    },
    "loading": "Loading notes...",
    "empty": "No notes to display",
    "error": "Error loading feed"
  },
  "classifieds": {
    "title": "Classifieds",
    "description": "Buy, sell, and trade with the Nostr community",
    "noListings": "No listings yet. Be the first to create one!",
    "createListing": "Create Listing",
    "filters": {
      "all": "All",
      "selling": "Selling",
      "buying": "Buying",
      "services": "Services"
    }
  },
  "trades": {
    "title": "Trades",
    "description": "Secure P2P trading with escrow protection",
    "noTrades": "No trades yet. Browse classifieds to start trading!",
    "browseClassifieds": "Browse Classifieds",
    "statuses": {
      "pending": "Pending",
      "active": "Active",
      "completed": "Completed",
      "disputed": "Disputed"
    }
  },
  "followPacks": {
    "title": "Follow Packs",
    "description": "Discover curated lists of people to follow",
    "noPacks": "No follow packs available yet",
    "followers": "followers"
  },
  "settings": {
    "title": "Settings",
    "description": "Manage your app preferences and configuration",
    "sections": {
      "relays": {
        "title": "Relays",
        "description": "Configure Nostr relay connections",
        "addRelay": "Add Relay",
        "relayUrl": "Relay URL",
        "urlPlaceholder": "wss://relay.example.com",
        "permissions": "Permissions",
        "read": "Read",
        "write": "Write",
        "enabled": "Enabled",
        "remove": "Remove",
        "confirmRemove": "Are you sure you want to remove this relay?",
        "invalidUrl": "Invalid relay URL",
        "relayExists": "This relay already exists",
        "connected": "Connected",
        "disconnected": "Disconnected",
        "connecting": "Connecting..."
      },
      "appearance": {
        "title": "Appearance",
        "description": "Customize app theme and display",
        "language": "Language",
        "languageDescription": "Choose your preferred language",
        "theme": "Theme",
        "themeDescription": "Choose your preferred theme",
        "themes": {
          "light": "Light",
          "dark": "Dark",
          "system": "System"
        }
      },
      "notifications": {
        "title": "Notifications",
        "description": "Control notification preferences"
      },
      "privacy": {
        "title": "Privacy",
        "description": "Manage privacy and security settings"
      },
      "profile": {
        "title": "Profile",
        "description": "Edit your profile information"
      },
      "blossom": {
        "title": "Media Servers",
        "description": "Configure Blossom media upload servers"
      },
      "followpacks": {
        "title": "Follow Packs",
        "description": "Discover and manage follow packs"
      }
    },
    "comingSoon": "Coming soon..."
  },
  "wallet": {
    "title": "Wallet",
    "balance": "Balance",
    "send": "Send",
    "receive": "Receive",
    "transactions": "Transactions",
    "noTransactions": "No transactions yet",
    "satsAvailable": "sats available"
  },
  "profile": {
    "following": "Following",
    "followers": "Followers",
    "posts": "Posts",
    "editProfile": "Edit Profile",
    "follow": "Follow",
    "unfollow": "Unfollow"
  },
  "common": {
    "loading": "Loading...",
    "error": "An error occurred",
    "retry": "Retry",
    "cancel": "Cancel",
    "save": "Save",
    "delete": "Delete",
    "edit": "Edit",
    "close": "Close",
    "confirm": "Confirm",
    "search": "Search",
    "more": "More",
    "less": "Less",
    "copy": "Copy",
    "copied": "Copied!",
    "share": "Share",
    "soon": "Soon"
  }
}
</file>

<file path="src/i18n/locales/es.json">
{
  "navigation": {
    "feed": "Inicio",
    "compose": "Redactar",
    "notifications": "Notificaciones",
    "classifieds": "Clasificados",
    "marketplace": "Mercado",
    "trades": "Intercambios P2P",
    "followPacks": "Paquetes de Seguimiento",
    "profile": "Perfil",
    "wallet": "Billetera",
    "settings": "Configuraci√≥n",
    "logout": "Cerrar sesi√≥n"
  },
  "auth": {
    "login": "Iniciar sesi√≥n con Nostr",
    "logout": "Cerrar sesi√≥n",
    "loginSuccess": "Sesi√≥n iniciada correctamente",
    "loginError": "Error al iniciar sesi√≥n",
    "connecting": "Conectando..."
  },
  "feed": {
    "title": "Inicio",
    "compose": {
      "placeholder": "¬øQu√© est√°s pensando?",
      "publish": "Publicar",
      "publishing": "Publicando...",
      "publishSuccess": "¬°Nota publicada!",
      "publishError": "Error al publicar la nota"
    },
    "loading": "Cargando notas...",
    "empty": "No hay notas para mostrar",
    "error": "Error al cargar el feed"
  },
  "classifieds": {
    "title": "Clasificados",
    "description": "Compra, vende e intercambia con la comunidad Nostr",
    "noListings": "No hay anuncios todav√≠a. ¬°S√© el primero en crear uno!",
    "createListing": "Crear Anuncio",
    "filters": {
      "all": "Todos",
      "selling": "Venta",
      "buying": "Compra",
      "services": "Servicios"
    }
  },
  "trades": {
    "title": "Intercambios",
    "description": "Intercambios P2P seguros con protecci√≥n de dep√≥sito",
    "noTrades": "No hay intercambios todav√≠a. ¬°Explora los clasificados para empezar!",
    "browseClassifieds": "Explorar Clasificados",
    "statuses": {
      "pending": "Pendiente",
      "active": "Activo",
      "completed": "Completado",
      "disputed": "En disputa"
    }
  },
  "followPacks": {
    "title": "Paquetes de Seguimiento",
    "description": "Descubre listas curadas de personas para seguir",
    "noPacks": "No hay paquetes de seguimiento disponibles a√∫n",
    "followers": "seguidores"
  },
  "settings": {
    "title": "Configuraci√≥n",
    "description": "Gestiona las preferencias y configuraci√≥n de la aplicaci√≥n",
    "sections": {
      "relays": {
        "title": "Rel√©s",
        "description": "Configurar conexiones de rel√© Nostr",
        "addRelay": "Agregar Rel√©",
        "relayUrl": "URL del Rel√©",
        "urlPlaceholder": "wss://relay.ejemplo.com",
        "permissions": "Permisos",
        "read": "Lectura",
        "write": "Escritura",
        "enabled": "Habilitado",
        "remove": "Eliminar",
        "confirmRemove": "¬øEst√°s seguro de que quieres eliminar este rel√©?",
        "invalidUrl": "URL de rel√© inv√°lida",
        "relayExists": "Este rel√© ya existe",
        "connected": "Conectado",
        "disconnected": "Desconectado",
        "connecting": "Conectando..."
      },
      "appearance": {
        "title": "Apariencia",
        "description": "Personaliza el tema y la visualizaci√≥n de la aplicaci√≥n",
        "language": "Idioma",
        "languageDescription": "Elige tu idioma preferido",
        "theme": "Tema",
        "themeDescription": "Elige tu tema preferido",
        "themes": {
          "light": "Claro",
          "dark": "Oscuro",
          "system": "Sistema"
        }
      },
      "notifications": {
        "title": "Notificaciones",
        "description": "Controla las preferencias de notificaci√≥n"
      },
      "privacy": {
        "title": "Privacidad",
        "description": "Gestiona la configuraci√≥n de privacidad y seguridad"
      },
      "profile": {
        "title": "Perfil",
        "description": "Edita tu informaci√≥n de perfil"
      },
      "blossom": {
        "title": "Servidores de Medios",
        "description": "Configura los servidores de carga de medios Blossom"
      },
      "followpacks": {
        "title": "Paquetes de Seguimiento",
        "description": "Descubre y gestiona paquetes de seguimiento"
      }
    },
    "comingSoon": "Pr√≥ximamente..."
  },
  "wallet": {
    "title": "Billetera",
    "balance": "Saldo",
    "send": "Enviar",
    "receive": "Recibir",
    "transactions": "Transacciones",
    "noTransactions": "No hay transacciones todav√≠a",
    "satsAvailable": "sats disponibles"
  },
  "profile": {
    "following": "Siguiendo",
    "followers": "Seguidores",
    "posts": "Publicaciones",
    "editProfile": "Editar Perfil",
    "follow": "Seguir",
    "unfollow": "Dejar de seguir"
  },
  "common": {
    "loading": "Cargando...",
    "error": "Ocurri√≥ un error",
    "retry": "Reintentar",
    "cancel": "Cancelar",
    "save": "Guardar",
    "delete": "Eliminar",
    "edit": "Editar",
    "close": "Cerrar",
    "confirm": "Confirmar",
    "search": "Buscar",
    "more": "M√°s",
    "less": "Menos",
    "copy": "Copiar",
    "copied": "¬°Copiado!",
    "share": "Compartir",
    "soon": "Pronto"
  }
}
</file>

<file path="src/pages/ComposePage.tsx">
import { ComposeNote } from '@/features/feed/ComposeNote';
import { useNavigate } from 'react-router-dom';
import { ArrowLeft } from 'lucide-react';
export function ComposePage() {
  const navigate = useNavigate();
  return (
    <div className="max-w-2xl mx-auto">
      {/* Page header */}
      <div className="sticky top-0 z-30 bg-white/80 dark:bg-black/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-800">
        <div className="flex items-center gap-4 px-4 py-3 sm:px-6">
          <button
            onClick={() => navigate(-1)}
            className="p-2 -ml-2 rounded-full hover:bg-gray-100 dark:hover:bg-neutral-900 transition-colors"
          >
            <ArrowLeft className="w-5 h-5" />
          </button>
          <h2 className="text-lg font-semibold text-gray-900 dark:text-gray-100">Compose</h2>
        </div>
      </div>
      {/* Compose section */}
      <div className="p-4 sm:p-6">
        <ComposeNote />
      </div>
    </div>
  );
}
</file>

<file path="src/pages/FollowPackDetailPage.tsx">
import { useState, useMemo } from 'react';
import { useParams, Link } from 'react-router-dom';
import { ArrowLeft, Users, Heart, UserPlus, Calendar } from 'lucide-react';
import { useNDKCurrentUser, useSubscribe, NDKKind, useProfileValue, useEvent, NDKFollowPack, useNDK } from '@nostr-dev-kit/ndk-hooks';
import { Button } from '@/components/ui/button';
import { NoteFeed } from '@/features/feed/NoteFeed';
import { ProfileAvatar } from '@/features/followPacks/components/ProfileAvatar';
import { useFollowPacksStore } from '@/stores/followPacksStore';
import { cn } from '@/lib/utils';
import { followMultipleUsers } from '@/utils/followUtils';
export function FollowPackDetailPage() {
  const { packId } = useParams<{ packId: string }>();
  const { ndk } = useNDK();
  const currentUser = useNDKCurrentUser();
  const [activeTab, setActiveTab] = useState<'feed' | 'members'>('feed');
  const [isFollowingAll, setIsFollowingAll] = useState(false);
  const { isFavorite, toggleFavorite } = useFollowPacksStore();
  // Get the event directly using the bech32 encoded ID
  const event = useEvent(packId || false, { subId: 'pack-detail' });
  // Convert to NDKFollowPack
  const pack = useMemo(() => {
    if (!event) return null;
    return NDKFollowPack.from(event);
  }, [event]);
  // Extract pubkeys from the pack
  const pubkeys = useMemo(() => {
    if (!event) return [];
    return event.tags
      .filter(t => t[0] === 'p')
      .map(t => t[1]);
  }, [event]);
  // Get pack creator profile
  const creatorProfile = useProfileValue(pack?.pubkey);
  const favorited = pack ? isFavorite(pack.id) : false;
  // Subscribe to notes from all pack members
  const { events: feedEvents } = useSubscribe(
    pubkeys.length > 0 && activeTab === 'feed' ? [{
      kinds: [NDKKind.Text],
      authors: pubkeys,
    }] : false,
    { subId: 'pack-feed' }
  );
  const handleFollowAll = async () => {
    if (!pack || !currentUser || !ndk || pubkeys.length === 0) return;
    setIsFollowingAll(true);
    try {
      await followMultipleUsers(ndk, currentUser, pubkeys);
    } catch (error) {
      console.error('Error following all users:', error);
    } finally {
      setIsFollowingAll(false);
    }
  };
  const handleFavorite = () => {
    if (!pack || !currentUser) return;
    toggleFavorite(pack.id);
  };
  if (!pack) {
    return (
      <div className="max-w-4xl mx-auto px-4 py-8">
        <div className="text-center py-12">
          <p className="text-neutral-400">Follow pack not found</p>
          <Link to="/packs" className="text-purple-400 hover:text-purple-300 mt-4 inline-block">
            Browse all packs
          </Link>
        </div>
      </div>
    );
  }
  return (
    <div className="max-w-4xl mx-auto px-4 py-8">
      {/* Back button */}
      <Link
        to="/packs"
        className="inline-flex items-center gap-2 text-neutral-400 hover:text-white mb-6 transition-colors"
      >
        <ArrowLeft className="w-4 h-4" />
        Back to Follow Packs
      </Link>
      {/* Pack Header */}
      <div className="bg-neutral-900 border border-neutral-800 rounded-xl overflow-hidden mb-6">
        {/* Pack Image */}
        {pack.image && (
          <div className="h-48 w-full">
            <img
              src={pack.image}
              alt={pack.title}
              className="w-full h-full object-cover"
            />
          </div>
        )}
        <div className="p-6">
          <div className="flex items-start justify-between mb-4">
            <div>
              <h1 className="text-2xl font-bold text-white mb-2">
                {pack.title}
              </h1>
              <p className="text-neutral-400">
                {pack.description || 'A curated list of accounts to follow'}
              </p>
            </div>
            <div className="flex items-center gap-2">
              <Button
                onClick={handleFollowAll}
                variant="primary"
                size="default"
                disabled={!currentUser || isFollowingAll}
                className="flex items-center gap-2"
              >
                <UserPlus className="w-4 h-4" />
                {isFollowingAll ? 'Following...' : 'Follow All'}
              </Button>
              <button
                onClick={handleFavorite}
                className={cn(
                  "p-2.5 rounded-lg transition-colors",
                  favorited
                    ? "bg-red-500/10 text-red-500"
                    : "bg-neutral-800 text-neutral-400 hover:text-white"
                )}
              >
                <Heart className={cn("w-5 h-5", favorited && "fill-current")} />
              </button>
            </div>
          </div>
        {/* Stats */}
        <div className="flex items-center gap-6 mb-6 text-sm">
          <div className="flex items-center gap-2 text-neutral-400">
            <Users className="w-4 h-4" />
            <span>{pubkeys.length} members</span>
          </div>
          {pack.lastUpdated && (
            <div className="flex items-center gap-2 text-neutral-400">
              <Calendar className="w-4 h-4" />
              <span>Updated {new Date(pack.lastUpdated * 1000).toLocaleDateString()}</span>
            </div>
          )}
        </div>
        {/* Creator */}
        {creatorProfile && (
          <div className="flex items-center gap-3">
            <ProfileAvatar pubkey={pack.pubkey} size="md" />
            <div>
              <p className="text-sm text-neutral-500">Created by</p>
              <Link
                to={`/p/${pack.pubkey}`}
                className="font-medium text-white hover:text-purple-400 transition-colors"
              >
                {creatorProfile.name || 'Anonymous'}
              </Link>
            </div>
          </div>
        )}
        </div>
      </div>
      {/* Tabs */}
      <div className="border-b border-neutral-800 mb-6">
        <div className="flex gap-6">
          <button
            onClick={() => setActiveTab('feed')}
            className={cn(
              "pb-3 px-1 font-medium transition-colors relative",
              activeTab === 'feed'
                ? "text-white"
                : "text-neutral-400 hover:text-neutral-200"
            )}
          >
            Feed
            {activeTab === 'feed' && (
              <div className="absolute bottom-0 left-0 right-0 h-0.5 bg-purple-500" />
            )}
          </button>
          <button
            onClick={() => setActiveTab('members')}
            className={cn(
              "pb-3 px-1 font-medium transition-colors relative",
              activeTab === 'members'
                ? "text-white"
                : "text-neutral-400 hover:text-neutral-200"
            )}
          >
            Members ({pubkeys.length})
            {activeTab === 'members' && (
              <div className="absolute bottom-0 left-0 right-0 h-0.5 bg-purple-500" />
            )}
          </button>
        </div>
      </div>
      {/* Content */}
      {activeTab === 'feed' ? (
        <NoteFeed events={feedEvents} showDebugInfo={false} />
      ) : (
        <div className="grid gap-4 md:grid-cols-2">
          {pubkeys.map(pubkey => (
            <MemberCard key={pubkey} pubkey={pubkey} />
          ))}
        </div>
      )}
    </div>
  );
}
function MemberCard({ pubkey }: { pubkey: string }) {
  const profile = useProfileValue(pubkey);
  return (
    <Link
      to={`/p/${pubkey}`}
      className="flex items-center gap-3 p-4 bg-neutral-900 border border-neutral-800 rounded-lg hover:border-neutral-700 transition-colors"
    >
      <ProfileAvatar pubkey={pubkey} size="md" />
      <div className="flex-1 min-w-0">
        <p className="font-medium text-white truncate">
          {profile?.name || 'Anonymous'}
        </p>
        {profile?.nip05 && (
          <p className="text-sm text-neutral-500 truncate">
            {profile.nip05}
          </p>
        )}
        {profile?.about && (
          <p className="text-sm text-neutral-400 line-clamp-1 mt-1">
            {profile.about}
          </p>
        )}
      </div>
    </Link>
  );
}
</file>

<file path="src/pages/FollowPacksPage.tsx">
import { useState } from 'react';
import { Link } from 'react-router-dom';
import { Package, Search } from 'lucide-react';
import { NDKFollowPack } from '@nostr-dev-kit/ndk-hooks';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import { useFollowPacks, useSubscribedFollowPacks } from '@/features/followPacks/hooks/useFollowPacks';
import { useFollowPacksStore } from '@/stores/followPacksStore';
import { ProfileAvatar } from '@/features/followPacks/components/ProfileAvatar';
import { mockFollowPacks } from '@/features/followPacks/mockData';
export function FollowPacksPage() {
  const [searchQuery, setSearchQuery] = useState('');
  const { packs } = useFollowPacks();
  const subscribedPacks = useSubscribedFollowPacks();
  // Use mock data if no packs from relays
  const displayPacks = packs.length > 0 ? packs : mockFollowPacks as any[];
  // Filter packs based on search
  const filteredPacks = displayPacks.filter(pack => {
    if (!searchQuery) return true;
    const search = searchQuery.toLowerCase();
    return pack.title.toLowerCase().includes(search) ||
           (pack.description && pack.description.toLowerCase().includes(search));
  });
  return (
    <div className="max-w-6xl mx-auto px-4 py-8">
      {/* Header */}
      <div className="mb-8">
        <h1 className="text-3xl font-bold text-white mb-2 flex items-center gap-3">
          <Package className="w-8 h-8 text-purple-500" />
          Follow Packs
        </h1>
        <p className="text-neutral-400">
          Discover curated lists of accounts to follow
        </p>
      </div>
      {/* Search */}
      <div className="mb-6">
        <div className="relative">
          <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-neutral-500" />
          <Input
            type="search"
            placeholder="Search follow packs..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            className="pl-10 bg-neutral-900 border-neutral-800 text-white placeholder:text-neutral-500"
          />
        </div>
      </div>
      {/* Your Subscribed Packs */}
      {subscribedPacks.length > 0 && (
        <div className="mb-8">
          <h2 className="text-xl font-semibold text-white mb-4">Your Packs</h2>
          <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
            {subscribedPacks.map(pack => (
              <PackCard key={pack.id} pack={pack} />
            ))}
          </div>
        </div>
      )}
      {/* All Packs Grid */}
      <div>
        <h2 className="text-xl font-semibold text-white mb-4">
          {subscribedPacks.length > 0 ? 'Discover More' : 'Popular Packs'}
        </h2>
        {filteredPacks.length > 0 ? (
          <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
            {filteredPacks.map(pack => (
              <PackCard key={pack.id} pack={pack} />
            ))}
          </div>
        ) : (
          <div className="text-center py-12">
            <Package className="w-16 h-16 text-neutral-600 mx-auto mb-4" />
            <p className="text-neutral-400">
              No follow packs found
            </p>
          </div>
        )}
      </div>
    </div>
  );
}
function PackCard({ pack }: { pack: NDKFollowPack }) {
  const { isSubscribed, subscribeToPack, unsubscribeFromPack } = useFollowPacksStore();
  const subscribed = isSubscribed(pack.id);
  const previewPubkeys = pack.pubkeys.slice(0, 4);
  const handleSubscribe = (e: React.MouseEvent) => {
    e.preventDefault();
    if (subscribed) {
      unsubscribeFromPack(pack.id);
    } else {
      subscribeToPack(pack.id);
    }
  };
  return (
    <Link
      to={`/packs/${pack.encode()}`}
      className="block bg-neutral-900 border border-neutral-800 rounded-xl overflow-hidden hover:border-neutral-700 transition-colors group"
    >
      {/* Image */}
      {pack.image && (
        <div className="h-32 w-full">
          <img
            src={pack.image}
            alt={pack.title}
            className="w-full h-full object-cover"
          />
        </div>
      )}
      {/* Content padding wrapper */}
      <div className="p-5">
        {/* Header */}
        <div className="mb-4">
          <h3 className="font-semibold text-white group-hover:text-purple-400 transition-colors">
            {pack.title}
          </h3>
          <p className="text-sm text-neutral-500 mt-1">
            {pack.pubkeys.length} members
          </p>
        </div>
        {/* Description */}
        {pack.description && (
          <p className="text-sm text-neutral-400 mb-4 line-clamp-2">
            {pack.description}
          </p>
        )}
        {/* Member Avatars */}
        <div className="flex items-center justify-between">
          <div className="flex -space-x-2">
            {previewPubkeys.map((pubkey: string, index: number) => (
              <div
                key={pubkey}
                className="relative"
                style={{ zIndex: 4 - index }}
              >
                <ProfileAvatar
                  pubkey={pubkey}
                  size="sm"
                  className="ring-2 ring-neutral-900"
                />
              </div>
            ))}
            {pack.pubkeys.length > 4 && (
              <div className="w-8 h-8 rounded-full bg-neutral-800 ring-2 ring-neutral-900 flex items-center justify-center">
                <span className="text-xs text-neutral-400">
                  +{pack.pubkeys.length - 4}
                </span>
              </div>
            )}
          </div>
          <Button
            onClick={handleSubscribe}
            size="sm"
            variant={subscribed ? 'outline' : 'primary'}
            className="ml-2"
          >
            {subscribed ? 'Following' : 'Follow'}
          </Button>
        </div>
      </div>
    </Link>
  );
}
</file>

<file path="src/pages/HomePage.tsx">
import { NoteFeed } from '@/features/feed/NoteFeed';
import { ComposeNote } from '@/features/feed/ComposeNote';
import { useNDKCurrentUser, useFollows } from '@nostr-dev-kit/ndk-hooks';
export function HomePage() {
  const currentUser = useNDKCurrentUser();
  const follows = useFollows();
  return (
    <div className="max-w-2xl mx-auto">
      {/* Feed header */}
      <div className="sticky top-0 z-30 bg-white/80 dark:bg-black/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-800">
        <div className="px-4 py-3 sm:px-6">
          <h2 className="text-lg font-semibold text-gray-900 dark:text-gray-100">Home</h2>
        </div>
      </div>
      {/* Compose section for logged-in users - hidden on mobile */}
      {currentUser && (
        <div className="hidden md:block border-b border-gray-200 dark:border-gray-800">
          <div className="p-4 sm:p-6">
            <ComposeNote />
          </div>
        </div>
      )}
      {/* Notes feed */}
      <NoteFeed authors={currentUser ? Array.from(follows) : undefined} />
    </div>
  );
}
</file>

<file path="src/pages/NoteDetailPage.tsx">
import { useParams, useNavigate } from 'react-router-dom';
import { useEvent, useProfile, useNDK, useNDKCurrentUser } from '@nostr-dev-kit/ndk-hooks';
import { NDKEvent, NDKKind } from '@nostr-dev-kit/ndk-hooks';
import { nip19 } from 'nostr-tools';
import { ArrowLeft } from 'lucide-react';
import { NoteCard } from '@/features/feed/NoteCard';
import { ThreadNoteCard } from '@/components/thread/ThreadNoteCard';
import { useState, useEffect } from 'react';
import { UserAvatar } from '@/components/ui/UserAvatar';
export function NoteDetailPage() {
  const { nevent } = useParams<{ nevent: string }>();
  const navigate = useNavigate();
  const { ndk } = useNDK();
  const currentUser = useNDKCurrentUser();
  const [replies, setReplies] = useState<NDKEvent[]>([]);
  const [parentNotes, setParentNotes] = useState<NDKEvent[]>([]);
  const [replyContent, setReplyContent] = useState('');
  const [isSubmitting, setIsSubmitting] = useState(false);
  // Decode the nevent to get the event ID
  let eventId: string | null = null;
  if (nevent) {
    try {
      const decoded = nip19.decode(nevent);
      if (decoded.type === 'nevent') {
        eventId = decoded.data.id;
      }
    } catch (error) {
      console.error('Failed to decode nevent:', error);
    }
  }
  // Fetch the main event
  const event = useEvent(eventId || '');
  const profile = useProfile(event?.pubkey);
  // Fetch parent notes (thread context)
  useEffect(() => {
    if (!event || !ndk) return;
    const fetchThreadContext = async () => {
      const parents: NDKEvent[] = [];
      let currentEvent = event;
      // Walk up the thread to find all parent notes
      while (currentEvent) {
        // Find the reply/root tag
        const replyTag = currentEvent.tags.find(tag =>
          tag[0] === 'e' && (tag[3] === 'reply' || tag[3] === 'root')
        );
        // If no reply tag, check for any 'e' tag (older format)
        const eTag = replyTag || currentEvent.tags.find(tag => tag[0] === 'e');
        if (!eTag) break;
        const parentId = eTag[1];
        const parentEvent = await ndk.fetchEvent(parentId);
        if (parentEvent) {
          parents.unshift(parentEvent); // Add to beginning to maintain order
          currentEvent = parentEvent;
        } else {
          break;
        }
      }
      setParentNotes(parents);
    };
    fetchThreadContext();
  }, [event, ndk]);
  // Fetch replies
  useEffect(() => {
    if (!event || !ndk) return;
    const fetchReplies = async () => {
      const replyEvents = await ndk.fetchEvents({
        kinds: [NDKKind.Text],
        '#e': [event.id],
      });
      const replyArray = Array.from(replyEvents);
      // Filter out only direct replies (not replies to replies)
      const directReplies = replyArray.filter(reply => {
        const replyTag = reply.tags.find(tag =>
          tag[0] === 'e' && tag[3] === 'reply'
        );
        // If there's a specific reply tag, check if it's replying to our event
        // Otherwise check if our event is the last 'e' tag (older format)
        if (replyTag) {
          return replyTag[1] === event.id;
        }
        const eTags = reply.tags.filter(tag => tag[0] === 'e');
        return eTags.length > 0 && eTags[eTags.length - 1][1] === event.id;
      });
      // Sort by creation time (oldest first for better thread reading)
      directReplies.sort((a, b) => (a.created_at || 0) - (b.created_at || 0));
      setReplies(directReplies);
    };
    fetchReplies();
  }, [event, ndk]);
  const handleReply = async () => {
    if (!currentUser || !ndk || !event || !replyContent.trim()) return;
    setIsSubmitting(true);
    try {
      const reply = new NDKEvent(ndk);
      reply.kind = NDKKind.Text;
      reply.content = replyContent;
      reply.tags = [
        ['e', event.id, '', 'reply'],
        ['p', event.pubkey]
      ];
      // Add root tag if this event is also a reply
      const rootTag = event.tags.find(tag => tag[0] === 'e' && tag[3] === 'root');
      if (rootTag) {
        reply.tags.push(['e', rootTag[1], '', 'root']);
      } else {
        reply.tags.push(['e', event.id, '', 'root']);
      }
      await reply.publish();
      // Add the new reply to the list
      setReplies(prev => [reply, ...prev]);
      setReplyContent('');
    } catch (error) {
      console.error('Failed to publish reply:', error);
    } finally {
      setIsSubmitting(false);
    }
  };
  if (!eventId) {
    return (
      <div className="flex flex-col items-center justify-center min-h-screen">
        <h1 className="text-2xl font-bold text-gray-900 dark:text-white mb-2">Invalid Note</h1>
        <p className="text-gray-600 dark:text-gray-400">The note ID is invalid or malformed.</p>
        <button
          onClick={() => navigate('/')}
          className="mt-4 px-4 py-2 bg-accent-600 text-white rounded-lg hover:bg-accent-700"
        >
          Go Home
        </button>
      </div>
    );
  }
  if (!event) {
    return (
      <div className="flex flex-col items-center justify-center min-h-screen">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-accent-600"></div>
        <p className="mt-4 text-gray-600 dark:text-gray-400">Loading note...</p>
      </div>
    );
  }
  return (
    <div className="min-h-screen bg-gray-50 dark:bg-black">
      {/* Header */}
      <header className="sticky top-0 z-10 bg-white/80 dark:bg-black/80 backdrop-blur-md border-b border-gray-200 dark:border-gray-800">
        <div className="flex items-center gap-4 px-4 py-3">
          <button
            onClick={() => navigate(-1)}
            className="p-2 hover:bg-gray-100 dark:hover:bg-neutral-900 rounded-lg transition-colors"
          >
            <ArrowLeft className="w-5 h-5" />
          </button>
          <h1 className="text-xl font-semibold">Thread</h1>
        </div>
      </header>
      {/* Main Content */}
      <main className="max-w-2xl mx-auto">
        {/* Parent Notes (Thread Context) */}
        {parentNotes.map((parentNote, index) => (
          <ThreadNoteCard
            key={parentNote.id}
            event={parentNote}
            showConnector={index > 0}
            isLastInThread={false}
          />
        ))}
        {/* Main Note - Highlighted */}
        <ThreadNoteCard
          event={event}
          isMainNote={true}
          showConnector={parentNotes.length > 0}
        />
        {/* Reply Box */}
        {currentUser && (
          <div className="border-b border-gray-200 dark:border-gray-800 p-4">
            <div className="flex gap-3">
              <UserAvatar
                pubkey={currentUser.pubkey}
                size="md"
                className="w-10 h-10 flex-shrink-0"
              />
              <div className="flex-1">
                <textarea
                  value={replyContent}
                  onChange={(e) => setReplyContent(e.target.value)}
                  placeholder={`Reply to ${profile?.name || 'this note'}...`}
                  className="w-full min-h-[100px] p-3 bg-gray-50 dark:bg-black border border-gray-200 dark:border-gray-700 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-accent-500"
                  disabled={isSubmitting}
                />
                <div className="flex justify-end mt-2">
                  <button
                    onClick={handleReply}
                    disabled={!replyContent.trim() || isSubmitting}
                    className="px-4 py-2 bg-accent-600 text-white rounded-lg hover:bg-accent-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                  >
                    {isSubmitting ? 'Posting...' : 'Reply'}
                  </button>
                </div>
              </div>
            </div>
          </div>
        )}
        {/* Replies */}
        <div>
          {replies.length > 0 ? (
            <>
              <div className="px-4 py-3 border-b border-gray-200 dark:border-gray-800">
                <h2 className="font-semibold text-gray-900 dark:text-white">
                  {replies.length} {replies.length === 1 ? 'Reply' : 'Replies'}
                </h2>
              </div>
              {replies.map(reply => (
                <NoteCard key={reply.id} event={reply} />
              ))}
            </>
          ) : (
            <div className="p-8 text-center text-gray-500 dark:text-gray-400">
              No replies yet. Be the first to reply!
            </div>
          )}
        </div>
      </main>
    </div>
  );
}
</file>

<file path="src/pages/NotificationsPage.tsx">
import { Bell } from 'lucide-react';
export function NotificationsPage() {
  return (
    <div className="max-w-2xl mx-auto">
      {/* Page header */}
      <div className="sticky top-0 z-30 bg-white/80 dark:bg-black/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-800">
        <div className="px-4 py-3 sm:px-6">
          <h2 className="text-lg font-semibold text-gray-900 dark:text-gray-100">Notifications</h2>
        </div>
      </div>
      {/* Empty state */}
      <div className="flex flex-col items-center justify-center py-16 px-4">
        <div className="w-16 h-16 bg-gray-100 dark:bg-black rounded-full flex items-center justify-center mb-4">
          <Bell className="w-8 h-8 text-gray-400 dark:text-gray-600" />
        </div>
        <h3 className="text-lg font-medium text-gray-900 dark:text-gray-100 mb-1">
          No notifications yet
        </h3>
        <p className="text-gray-500 dark:text-gray-400 text-center max-w-sm">
          When someone mentions you or interacts with your notes, you&apos;ll see it here.
        </p>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/SettingsPage.tsx">
import React, { useState, useEffect } from 'react';
import { useLocation } from 'react-router-dom';
import { motion } from 'framer-motion';
import { useTranslation } from 'react-i18next';
import {
  Server,
  Bell,
  Shield,
  Palette,
  User,
  ChevronRight,
  Settings as SettingsIcon,
  Image
} from 'lucide-react';
import { cn } from '@/lib/utils';
import { RelaySettings } from '@/features/settings/RelaySettings';
import { ThemeSettings } from '@/features/settings/ThemeSettings';
import { NotificationSettings } from '@/features/settings/NotificationSettings';
import { PrivacySettings } from '@/features/settings/PrivacySettings';
import { ProfileSettings } from '@/features/settings/ProfileSettings';
import { BlossomSettings } from '@/features/settings/BlossomSettings';
type SettingsSection = 'relays' | 'theme' | 'notifications' | 'privacy' | 'profile' | 'blossom';
interface SectionConfig {
  id: SettingsSection;
  label: string;
  description: string;
  icon: React.ElementType;
  component: React.ComponentType;
  available: boolean;
}
const sectionConfigs: Omit<SectionConfig, 'label' | 'description'>[] = [
  {
    id: 'relays',
    icon: Server,
    component: RelaySettings,
    available: true,
  },
  {
    id: 'blossom',
    icon: Image,
    component: BlossomSettings,
    available: true,
  },
  {
    id: 'profile',
    icon: User,
    component: ProfileSettings,
    available: false,
  },
  {
    id: 'theme',
    icon: Palette,
    component: ThemeSettings,
    available: true,
  },
  {
    id: 'notifications',
    icon: Bell,
    component: NotificationSettings,
    available: false,
  },
  {
    id: 'privacy',
    icon: Shield,
    component: PrivacySettings,
    available: false,
  },
];
export function SettingsPage() {
  const { t } = useTranslation();
  const location = useLocation();
  const [activeSection, setActiveSection] = useState<SettingsSection>('relays');
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
  // Build sections with translations
  const sections: SectionConfig[] = sectionConfigs.map(config => ({
    ...config,
    label: t(`settings.sections.${config.id}.title`),
    description: t(`settings.sections.${config.id}.description`),
  }));
  // Handle URL tab parameter
  useEffect(() => {
    const params = new URLSearchParams(location.search);
    const tab = params.get('tab');
    if (tab && sections.some(s => s.id === tab && s.available)) {
      setActiveSection(tab as SettingsSection);
    }
  }, [location.search, sections]);
  const currentSection = sections.find(s => s.id === activeSection);
  const SectionComponent = currentSection?.component;
  return (
    <div className="min-h-screen bg-gray-50 dark:bg-black pb-20 md:pb-0">
      <div className="max-w-7xl mx-auto px-4 py-4 md:py-8">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          className="mb-6"
        >
          <h1 className="text-2xl md:text-3xl font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2 md:gap-3">
            <SettingsIcon className="w-6 h-6 md:w-8 md:h-8 text-purple-600" />
            {t('settings.title')}
          </h1>
          <p className="mt-1 text-sm md:text-base text-gray-600 dark:text-gray-400">
            {t('settings.description')}
          </p>
        </motion.div>
        {/* Mobile Section Selector */}
        <div className="lg:hidden mb-4">
          <button
            onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
            className="w-full bg-white dark:bg-black rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 px-4 py-3 flex items-center justify-between"
          >
            <div className="flex items-center gap-3">
              {currentSection && (
                <>
                  {React.createElement(currentSection.icon, { className: "w-5 h-5 text-purple-600" })}
                  <span className="font-medium text-gray-900 dark:text-gray-100">
                    {currentSection.label}
                  </span>
                </>
              )}
            </div>
            <ChevronRight className={cn(
              "w-5 h-5 text-gray-400 transition-transform",
              mobileMenuOpen ? "rotate-90" : ""
            )} />
          </button>
          {mobileMenuOpen && (
            <motion.div
              initial={{ opacity: 0, y: -10 }}
              animate={{ opacity: 1, y: 0 }}
              className="absolute left-4 right-4 z-20 mt-2 bg-white dark:bg-black rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden"
            >
              {sections.map((section) => {
                const Icon = section.icon;
                return (
                  <button
                    key={section.id}
                    onClick={() => {
                      if (section.available) {
                        setActiveSection(section.id);
                        setMobileMenuOpen(false);
                      }
                    }}
                    disabled={!section.available}
                    className={cn(
                      'w-full px-4 py-3 flex items-center gap-3 transition-all border-b border-gray-100 dark:border-gray-700 last:border-0',
                      section.available
                        ? 'hover:bg-gray-50 dark:hover:bg-neutral-900'
                        : 'opacity-50 cursor-not-allowed'
                    )}
                  >
                    <Icon className="w-5 h-5" />
                    <span className="text-sm font-medium">
                      {section.label}
                      {!section.available && (
                        <span className="ml-2 text-xs bg-gray-100 dark:bg-black px-1.5 py-0.5 rounded">
                          {t('common.soon')}
                        </span>
                      )}
                    </span>
                  </button>
                );
              })}
            </motion.div>
          )}
        </div>
        <div className="flex flex-col lg:flex-row gap-6 lg:gap-8">
          {/* Desktop Sidebar Navigation */}
          <motion.nav
            initial={{ opacity: 0, x: -20 }}
            animate={{ opacity: 1, x: 0 }}
            className="hidden lg:block lg:w-64"
          >
            <div className="bg-white dark:bg-black rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
              {sections.map((section) => {
                const Icon = section.icon;
                const isActive = section.id === activeSection;
                return (
                  <button
                    key={section.id}
                    onClick={() => section.available && setActiveSection(section.id)}
                    disabled={!section.available}
                    className={cn(
                      'w-full px-4 py-3 flex items-center gap-3 transition-all border-b border-gray-100 dark:border-gray-700 last:border-0',
                      isActive
                        ? 'bg-purple-50 dark:bg-purple-950/30 text-purple-700 dark:text-purple-400'
                        : section.available
                        ? 'hover:bg-gray-50 dark:hover:bg-neutral-900 text-gray-700 dark:text-gray-300'
                        : 'opacity-50 cursor-not-allowed text-gray-400 dark:text-gray-500'
                    )}
                  >
                    <Icon className={cn(
                      'w-5 h-5',
                      isActive ? 'text-purple-600 dark:text-purple-400' : ''
                    )} />
                    <div className="flex-1 text-left">
                      <div className="font-medium text-sm flex items-center gap-2">
                        {section.label}
                        {!section.available && (
                          <span className="text-xs bg-gray-100 dark:bg-black px-1.5 py-0.5 rounded">
                            {t('common.soon')}
                          </span>
                        )}
                      </div>
                      <div className="text-xs text-gray-500 dark:text-gray-400 mt-0.5">
                        {section.description}
                      </div>
                    </div>
                    {section.available && (
                      <ChevronRight className={cn(
                        'w-4 h-4 transition-transform',
                        isActive ? 'translate-x-1' : ''
                      )} />
                    )}
                  </button>
                );
              })}
            </div>
          </motion.nav>
          {/* Main Content */}
          <motion.main
            key={activeSection}
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            className="flex-1"
          >
            <div className="bg-white dark:bg-black rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
              {SectionComponent && <SectionComponent />}
            </div>
          </motion.main>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/index.css">
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
@tailwind base;
@tailwind components;
@tailwind utilities;
@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 0 0% 9%;
    --card: 0 0% 100%;
    --card-foreground: 0 0% 9%;
    --popover: 0 0% 100%;
    --popover-foreground: 0 0% 9%;
    --primary: 0 0% 9%;
    --primary-foreground: 0 0% 100%;
    --secondary: 0 0% 96.1%;
    --secondary-foreground: 0 0% 9%;
    --muted: 0 0% 96.1%;
    --muted-foreground: 0 0% 45.1%;
    --accent: 0 0% 9%;
    --accent-foreground: 0 0% 100%;
    --destructive: 0 72% 51%;
    --destructive-foreground: 0 0% 98%;
    --border: 0 0% 89.8%;
    --input: 0 0% 89.8%;
    --ring: 0 0% 71%;
    --radius: 0.5rem;
  }
  .dark {
    --background: 0 0% 0%;
    --foreground: 0 0% 95%;
    --card: 0 0% 0%;
    --card-foreground: 0 0% 95%;
    --popover: 0 0% 4%;
    --popover-foreground: 0 0% 95%;
    --primary: 0 0% 100%;
    --primary-foreground: 0 0% 0%;
    --secondary: 0 0% 14.9%;
    --secondary-foreground: 0 0% 98%;
    --muted: 0 0% 14.9%;
    --muted-foreground: 0 0% 60%;
    --accent: 0 0% 100%;
    --accent-foreground: 0 0% 0%;
    --destructive: 0 62% 30%;
    --destructive-foreground: 0 0% 98%;
    --border: 0 0% 14.9%;
    --input: 0 0% 14.9%;
    --ring: 0 0% 71%;
  }
}
@layer base {
  * {
    border-color: hsl(var(--border));
  }
  html {
    scroll-behavior: smooth;
  }
  body {
    background: linear-gradient(180deg, #FFFFFF 0%, #F8F9FA 100%);
    min-height: 100vh;
    color: #1A1A1A;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', system-ui, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
  }
  .dark body {
    background: #000000;
    color: #FFFFFF;
  }
  /* Custom scrollbar */
  ::-webkit-scrollbar {
    width: 0.5rem;
    height: 0.5rem;
  }
  ::-webkit-scrollbar-track {
    background: transparent;
  }
  ::-webkit-scrollbar-thumb {
    background-color: rgb(209 213 219);
    border-radius: 9999px;
  }
  .dark ::-webkit-scrollbar-thumb {
    background-color: rgb(55 65 81);
  }
  ::-webkit-scrollbar-thumb:hover {
    background-color: rgb(156 163 175);
  }
  .dark ::-webkit-scrollbar-thumb:hover {
    background-color: rgb(75 85 99);
  }
  /* Focus visible improvements */
  :focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px hsl(var(--ring));
  }
  button:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px hsl(var(--ring));
  }
}
@layer utilities {
  /* Text selection */
  ::selection {
    background-color: rgb(233 213 255);
    color: rgb(88 28 135);
  }
  .dark ::selection {
    background-color: rgb(88 28 135);
    color: rgb(233 213 255);
  }
  /* Animation utilities */
  @keyframes fade-in {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
  @keyframes slide-up {
    from {
      transform: translateY(10px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }
  .animate-fade-in {
    animation: fade-in 0.5s ease-in-out;
  }
  .animate-slide-up {
    animation: slide-up 0.3s ease-out;
  }
  /* Hide scrollbar for horizontal scrolling sections */
  .scrollbar-hide {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }
  .scrollbar-hide::-webkit-scrollbar {
    display: none;  /* Chrome, Safari and Opera */
  }
  /* Animation delays for loading indicators */
  .animation-delay-200 {
    animation-delay: 200ms;
  }
  .animation-delay-400 {
    animation-delay: 400ms;
  }
}
</file>

<file path="src/features/auth/LoginButton.tsx">
import { useState } from 'react';
import {
  useNDKCurrentUser,
  useNDKSessionLogout
} from '@nostr-dev-kit/ndk-hooks';
import { User, LogOut } from 'lucide-react';
import { LoginModal } from './LoginModal';
export function LoginButton() {
  const currentUser = useNDKCurrentUser();
  const logout = useNDKSessionLogout();
  const [showLoginModal, setShowLoginModal] = useState(false);
  const handleLogout = () => {
    logout();
    localStorage.removeItem('nostr_private_key');
    localStorage.removeItem('nostr_bunker_url');
    localStorage.removeItem('nostr_extension_auto_login');
  };
  if (currentUser) {
    return (
      <div className="flex items-center gap-4">
        <button
          onClick={handleLogout}
          className="px-4 py-2 rounded-full bg-gray-100 hover:bg-gray-200 dark:bg-black dark:hover:bg-neutral-900 transition-colors text-sm font-medium flex items-center gap-2"
        >
          <LogOut className="w-4 h-4" />
          <span className="hidden sm:inline">Logout</span>
        </button>
      </div>
    );
  }
  return (
    <>
      <button
        onClick={() => setShowLoginModal(true)}
        className="px-4 py-2 rounded-lg bg-white hover:bg-neutral-100 dark:bg-neutral-900 dark:hover:bg-neutral-800 text-neutral-900 dark:text-white border border-neutral-200 dark:border-neutral-700 transition-all text-sm font-medium flex items-center gap-2"
      >
        <User className="w-4 h-4" />
        <span className="hidden sm:inline">Login</span>
        <span className="sm:hidden">Login</span>
      </button>
      <LoginModal isOpen={showLoginModal} onClose={() => setShowLoginModal(false)} />
    </>
  );
}
</file>

<file path="src/features/feed/ComposeNote.tsx">
import { useState, type FormEvent, useRef, useEffect } from 'react';
import { useNDK, NDKEvent, useNDKCurrentUser, NDKKind, useProfile } from '@nostr-dev-kit/ndk-hooks';
import { Image, Smile, MapPin } from 'lucide-react';
import { cn } from '@/lib/utils';
export function ComposeNote() {
  const { ndk } = useNDK();
  const currentUser = useNDKCurrentUser();
  const profile = useProfile(currentUser?.pubkey);
  const [content, setContent] = useState('');
  const [isPublishing, setIsPublishing] = useState(false);
  const textareaRef = useRef<HTMLTextAreaElement>(null);
  // Auto-resize textarea
  useEffect(() => {
    const textarea = textareaRef.current;
    if (textarea) {
      textarea.style.height = 'auto';
      textarea.style.height = `${Math.min(textarea.scrollHeight, 300)}px`;
    }
  }, [content]);
  const handleSubmit = async (e: FormEvent) => {
    e.preventDefault();
    if (!content.trim() || !currentUser || !ndk) return;
    setIsPublishing(true);
    try {
      const event = new NDKEvent(ndk);
      event.kind = NDKKind.Text;
      event.content = content;
      await event.publish();
      setContent('');
    } catch (error) {
      console.error('Failed to publish note:', error);
    } finally {
      setIsPublishing(false);
    }
  };
  if (!currentUser) {
    return null;
  }
  const displayName = profile?.name || 'Anonymous';
  const remainingChars = 280 - content.length;
  const isOverLimit = remainingChars < 0;
  return (
    <div className="bg-white dark:bg-black rounded-lg">
      <form onSubmit={handleSubmit}>
        <div className="flex gap-3">
          {/* Avatar */}
          <div className="flex-shrink-0">
            {profile?.picture ? (
              <img
                src={profile.picture}
                alt={displayName}
                className="w-10 h-10 sm:w-12 sm:h-12 rounded-full object-cover"
              />
            ) : (
              <div className="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-semibold">
                {displayName[0]?.toUpperCase()}
              </div>
            )}
          </div>
          {/* Input area */}
          <div className="flex-1">
            <textarea
              ref={textareaRef}
              value={content}
              onChange={(e) => setContent(e.target.value)}
              placeholder="What's happening?"
              className="w-full p-0 text-lg placeholder:text-gray-500 dark:placeholder:text-gray-400 bg-transparent resize-none focus:outline-none text-gray-900 dark:text-gray-100 min-h-[60px]"
              disabled={isPublishing}
            />
            {/* Actions bar */}
            <div className="flex items-center justify-between mt-3 pt-3 border-t border-gray-200 dark:border-gray-800">
              <div className="flex items-center gap-1">
                <button
                  type="button"
                  className="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-neutral-900 transition-colors text-gray-500 dark:text-gray-400"
                  title="Add image (coming soon)"
                >
                  <Image className="w-5 h-5" />
                </button>
                <button
                  type="button"
                  className="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-neutral-900 transition-colors text-gray-500 dark:text-gray-400"
                  title="Add emoji (coming soon)"
                >
                  <Smile className="w-5 h-5" />
                </button>
                <button
                  type="button"
                  className="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-neutral-900 transition-colors text-gray-500 dark:text-gray-400"
                  title="Add location (coming soon)"
                >
                  <MapPin className="w-5 h-5" />
                </button>
              </div>
              <div className="flex items-center gap-3">
                {/* Character counter */}
                {content.length > 0 && (
                  <div className="relative">
                    <svg className="w-8 h-8 -rotate-90">
                      <circle
                        cx="16"
                        cy="16"
                        r="14"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="2"
                        className="text-gray-200 dark:text-gray-700"
                      />
                      <circle
                        cx="16"
                        cy="16"
                        r="14"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="2"
                        strokeDasharray={`${Math.max(0, (Math.min(280, content.length) / 280) * 88)} 88`}
                        strokeLinecap="round"
                        className={cn(
                          "transition-all duration-150",
                          isOverLimit ? "text-red-500" : 
                          remainingChars < 20 ? "text-yellow-500" : 
                          "text-purple-500"
                        )}
                      />
                    </svg>
                    {remainingChars < 20 && (
                      <span className={cn(
                        "absolute inset-0 flex items-center justify-center text-xs font-medium",
                        isOverLimit ? "text-red-500" : "text-gray-500 dark:text-gray-400"
                      )}>
                        {remainingChars}
                      </span>
                    )}
                  </div>
                )}
                {/* Publish button */}
                <button
                  type="submit"
                  disabled={!content.trim() || isPublishing || isOverLimit}
                  className={cn(
                    "px-4 py-1.5 rounded-full font-medium transition-all",
                    (!content.trim() || isOverLimit)
                      ? "bg-gray-200 text-gray-400 dark:bg-black dark:text-gray-600 cursor-not-allowed"
                      : "bg-purple-600 text-white hover:bg-purple-700 dark:bg-purple-500 dark:hover:bg-purple-600"
                  )}
                >
                  {isPublishing ? (
                    <span className="flex items-center gap-2">
                      <span className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin" />
                      Publishing
                    </span>
                  ) : (
                    'Publish'
                  )}
                </button>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  );
}
</file>

<file path="src/features/feed/NoteCard.tsx">
import { useProfile, useNDK, useNDKCurrentUser, useEvent } from '@nostr-dev-kit/ndk-hooks';
import { NDKEvent, NDKKind } from '@nostr-dev-kit/ndk-hooks';
import { Heart, MessageCircle, Repeat2, Share, MoreHorizontal, Copy, Code2, ChevronDown, ChevronUp } from 'lucide-react';
import { useState, useRef, useEffect } from 'react';
import { cn } from '@/lib/utils';
import { ZapButton } from '@/components/wallet/ZapButton';
import { UserAvatar } from '@/components/ui/UserAvatar';
import { Link, useNavigate } from 'react-router-dom';
import { ContentRenderer } from '@/components/content/ContentRenderer';
import { nip19 } from 'nostr-tools';
// Custom function for abbreviated timestamps
function formatTimeAgo(timestamp: number): string {
  const now = Date.now();
  const then = timestamp * 1000;
  const seconds = Math.floor((now - then) / 1000);
  if (seconds < 60) return 'now';
  const minutes = Math.floor(seconds / 60);
  if (minutes < 60) return `${minutes}m`;
  const hours = Math.floor(minutes / 60);
  if (hours < 24) return `${hours}h`;
  const days = Math.floor(hours / 24);
  if (days < 7) return `${days}d`;
  const weeks = Math.floor(days / 7);
  if (weeks < 4) return `${weeks}w`;
  const months = Math.floor(days / 30);
  if (months < 12) return `${months}mo`;
  const years = Math.floor(days / 365);
  return `${years}y`;
}
interface NoteCardProps {
  event: NDKEvent;
  isLargeText?: boolean;
}
export function NoteCard({ event, isLargeText = false }: NoteCardProps) {
  const profile = useProfile(event.pubkey);
  const { ndk } = useNDK();
  const currentUser = useNDKCurrentUser();
  const navigate = useNavigate();
  const [isLiked, setIsLiked] = useState(false);
  const [likeCount, setLikeCount] = useState(0);
  const [dropdownOpen, setDropdownOpen] = useState(false);
  const [showRawEvent, setShowRawEvent] = useState(false);
  const [isExpanded, setIsExpanded] = useState(false);
  const [needsExpansion, setNeedsExpansion] = useState(false);
  const contentRef = useRef<HTMLDivElement>(null);
  // Determine what this note is replying to
  let replyToEventId: string | undefined;
  // First, check for explicit 'reply' marker
  const replyTag = event.tags.find(tag =>
    tag[0] === 'e' && tag[3] === 'reply'
  );
  if (replyTag) {
    replyToEventId = replyTag[1];
  } else {
    // Check for 'root' marker as fallback
    const rootTag = event.tags.find(tag =>
      tag[0] === 'e' && tag[3] === 'root'
    );
    if (rootTag) {
      replyToEventId = rootTag[1];
    } else {
      // If there's only a single 'e' tag with no marker, it's likely a reply to that event
      const eTags = event.tags.filter(tag => tag[0] === 'e');
      if (eTags.length === 1) {
        replyToEventId = eTags[0][1];
      }
    }
  }
  // Fetch the event being replied to
  const replyToEvent = useEvent(replyToEventId || '');
  const replyToProfile = useProfile(replyToEvent?.pubkey || '');
  const handleLike = async () => {
    if (!currentUser || !ndk) return;
    try {
      const reaction = new NDKEvent(ndk);
      reaction.kind = NDKKind.Reaction;
      reaction.content = isLiked ? '-' : '+';
      reaction.tags = [
        ['e', event.id],
        ['p', event.pubkey]
      ];
      await reaction.publish();
      setIsLiked(!isLiked);
      setLikeCount(prev => isLiked ? prev - 1 : prev + 1);
    } catch (error) {
      console.error('Failed to publish reaction:', error);
    }
  };
  const handleRepost = async () => {
    if (!currentUser || !ndk) return;
    try {
      const repost = new NDKEvent(ndk);
      repost.kind = NDKKind.Repost;
      repost.content = '';
      repost.tags = [
        ['e', event.id],
        ['p', event.pubkey]
      ];
      await repost.publish();
    } catch (error) {
      console.error('Failed to repost:', error);
    }
  };
  const displayName = profile?.name || 'Anonymous';
  const npub = nip19.npubEncode(event.pubkey);
  const handle = profile?.nip05 ? `@${profile.nip05.split('@')[0]}` : `@${npub.slice(5, 12)}`;
  // Check if content exceeds 60vh
  useEffect(() => {
    if (contentRef.current) {
      const viewportHeight = window.innerHeight;
      const maxHeight = viewportHeight * 0.6; // 60vh
      const contentHeight = contentRef.current.scrollHeight;
      setNeedsExpansion(contentHeight > maxHeight);
    }
  }, [event.content]);
  const handleNoteClick = (e: React.MouseEvent) => {
    // Don't navigate if clicking on interactive elements
    const target = e.target as HTMLElement;
    if (
      target.closest('a') ||
      target.closest('button') ||
      target.closest('[role="button"]')
    ) {
      return;
    }
    const neventId = event.encode();
    navigate(`/e/${neventId}`);
  };
  const handleCopyId = () => {
    navigator.clipboard.writeText(event.encode());
    setDropdownOpen(false);
  };
  const handleViewRaw = () => {
    setShowRawEvent(true);
    setDropdownOpen(false);
  };
  return (
    <>
    <article
      className="bg-white dark:bg-black border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50/50 dark:hover:bg-neutral-900/50 transition-all duration-150 cursor-pointer"
      onClick={handleNoteClick}>
      <div className="px-4 py-3 sm:px-5 sm:py-4 relative">
        {/* Timestamp in top right corner */}
        <time
          className="absolute top-3 right-4 sm:top-4 sm:right-5 text-gray-500 dark:text-gray-400 text-[13px] sm:text-sm hover:underline cursor-help"
          title={new Date(event.created_at! * 1000).toLocaleString()}
        >
          {formatTimeAgo(event.created_at!)}
        </time>
        {/* Mobile: Stack layout, Desktop: Side-by-side */}
        <div className="flex flex-col sm:flex-row sm:gap-3">
          {/* Mobile header (avatar + author info) */}
          <div className="flex items-start gap-3 mb-2 sm:hidden">
            <Link to={`/p/${npub}`} className="flex-shrink-0">
              <UserAvatar
                pubkey={event.pubkey}
                size="md"
                className="w-10 h-10 ring-1 ring-neutral-200/50 dark:ring-neutral-800/50 shadow-soft"
              />
            </Link>
            <div className="flex-1 min-w-0 pr-24">
              <Link
                to={`/p/${npub}`}
                className="flex items-center gap-1 hover:opacity-75 transition-opacity"
              >
                <span className="font-medium text-[15px] text-gray-900 dark:text-white whitespace-nowrap">
                  {displayName}
                </span>
                <span className="text-gray-500 dark:text-gray-400 text-[13px] whitespace-nowrap">
                  {handle}
                </span>
              </Link>
            </div>
          </div>
          {/* Desktop avatar */}
          <Link to={`/p/${npub}`} className="hidden sm:block flex-shrink-0">
            <UserAvatar
              pubkey={event.pubkey}
              size="md"
              className="w-11 h-11 ring-1 ring-neutral-200/50 dark:ring-neutral-800/50 shadow-soft"
            />
          </Link>
          {/* Content */}
          <div className="flex-1 min-w-0">
            {/* Desktop author info */}
            <div className="hidden sm:flex items-center gap-2 pr-32">
              <Link
                to={`/p/${npub}`}
                className="flex items-center gap-1.5 hover:opacity-75 transition-opacity min-w-0"
              >
                <span className="font-medium text-base text-gray-900 dark:text-white whitespace-nowrap">
                  {displayName}
                </span>
                <span className="text-gray-500 dark:text-gray-400 text-sm whitespace-nowrap">
                  {handle}
                </span>
              </Link>
            </div>
            {/* Reply indicator */}
            {replyToEvent && (
              <div className="flex items-center gap-1 mt-1 text-sm text-gray-500 dark:text-gray-400">
                <span>Replying to</span>
                <Link
                  to={`/p/${nip19.npubEncode(replyToEvent.pubkey)}`}
                  className="font-medium hover:underline text-gray-700 dark:text-gray-300"
                >
                  @{replyToProfile?.name || replyToProfile?.displayName || `${replyToEvent.pubkey.slice(0, 8)}...`}
                </Link>
              </div>
            )}
            {/* Note content */}
            <div className="mt-2 relative">
              <div
                ref={contentRef}
                className={cn(
                  "overflow-hidden transition-all duration-300",
                  !isExpanded && needsExpansion && "max-h-[60vh]"
                )}
              >
                <ContentRenderer
                  content={event.content}
                  className={cn(
                    "text-gray-800 dark:text-gray-200 leading-relaxed",
                    isLargeText ? "text-lg sm:text-xl" : "text-[15px] sm:text-base"
                  )}
                />
                {/* Gradient fade when collapsed */}
                {!isExpanded && needsExpansion && (
                  <div className="absolute bottom-0 left-0 right-0 h-24 bg-gradient-to-t from-white dark:from-gray-900 to-transparent pointer-events-none" />
                )}
              </div>
              {/* Read More/Less Button */}
              {needsExpansion && (
                <button
                  onClick={(e) => {
                    e.stopPropagation();
                    setIsExpanded(!isExpanded);
                  }}
                  className="mt-3 flex items-center gap-1.5 px-4 py-2 bg-gray-900 dark:bg-white text-white dark:text-gray-900 text-sm font-medium rounded-full hover:bg-gray-800 dark:hover:bg-neutral-900 transition-all duration-200"
                >
                  <span>{isExpanded ? 'Read Less' : 'Read More'}</span>
                  {isExpanded ? (
                    <ChevronUp className="w-4 h-4" />
                  ) : (
                    <ChevronDown className="w-4 h-4" />
                  )}
                </button>
              )}
            </div>
            {/* Action buttons */}
            <div className="flex items-center justify-between mt-4 -ml-2">
              <div className="flex items-center gap-1">
                <button
                  onClick={() => {/* TODO: Implement reply */}}
                  className="group flex items-center gap-1.5 p-2.5 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800/50 transition-all duration-200"
                  disabled={!currentUser}
                >
                  <MessageCircle className="w-4 h-4 text-neutral-500 group-hover:text-gray-700 dark:text-neutral-500 dark:group-hover:text-gray-300" strokeWidth={1.5} />
                  {/* Reply count will be shown when implemented */}
                </button>
                <button
                  onClick={handleRepost}
                  className="group flex items-center gap-1.5 p-2.5 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800/50 transition-all duration-200"
                  disabled={!currentUser}
                >
                  <Repeat2 className="w-4 h-4 text-neutral-500 group-hover:text-success-600 dark:text-neutral-500 dark:group-hover:text-success-400" strokeWidth={1.5} />
                  {/* Repost count will be shown when implemented */}
                </button>
                <button
                  onClick={handleLike}
                  className={cn(
                    "group flex items-center gap-1.5 p-2.5 rounded-lg transition-all duration-200",
                    isLiked
                      ? "bg-danger-50 dark:bg-danger-950/20"
                      : "hover:bg-neutral-100 dark:hover:bg-neutral-800/50"
                  )}
                  disabled={!currentUser}
                >
                  <Heart
                    className={cn(
                      "w-4 h-4 transition-all duration-200",
                      isLiked
                        ? "fill-current text-danger-500 dark:text-danger-400"
                        : "text-neutral-500 group-hover:text-danger-500 dark:text-neutral-500 dark:group-hover:text-danger-400"
                    )}
                    strokeWidth={1.5}
                  />
                  {likeCount > 0 && (
                    <span className={cn(
                      "text-sm font-medium",
                      isLiked
                        ? "text-pink-500 dark:text-pink-400"
                        : "text-gray-500 group-hover:text-pink-500 dark:text-gray-400 dark:group-hover:text-pink-400"
                    )}>
                      {likeCount}
                    </span>
                  )}
                </button>
                {/* Zap Button */}
                <ZapButton
                  eventId={event.id}
                  authorPubkey={event.pubkey}
                  onZap={(amount) => console.log(`Zapped ${amount} sats to`, event.pubkey)}
                />
                <button
                  onClick={() => {/* TODO: Implement share */}}
                  className="group p-2.5 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800/50 transition-all duration-200"
                >
                  <Share className="w-4 h-4 text-neutral-500 group-hover:text-gray-700 dark:text-neutral-500 dark:group-hover:text-gray-300" strokeWidth={1.5} />
                </button>
              </div>
              <div className="relative">
                <button
                  onClick={(e) => {
                    e.stopPropagation();
                    setDropdownOpen(!dropdownOpen);
                  }}
                  className="p-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800/50 transition-all duration-200"
                >
                  <MoreHorizontal className="w-4 h-4 text-neutral-400 dark:text-neutral-600" strokeWidth={1.5} />
                </button>
                {dropdownOpen && (
                  <div className="absolute right-0 mt-2 w-48 bg-white dark:bg-black rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50">
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        handleCopyId();
                      }}
                      className="w-full px-4 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-neutral-900 flex items-center gap-2 rounded-t-lg"
                    >
                      <Copy className="w-4 h-4" />
                      Copy ID
                    </button>
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        handleViewRaw();
                      }}
                      className="w-full px-4 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-neutral-900 flex items-center gap-2 rounded-b-lg"
                    >
                      <Code2 className="w-4 h-4" />
                      View Raw Event
                    </button>
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      </div>
    </article>
    {/* Raw Event Modal */}
    {showRawEvent && (
      <>
        <div
          className="fixed inset-0 bg-black/50 z-50"
          onClick={() => setShowRawEvent(false)}
        />
        <div className="fixed inset-4 md:inset-auto md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 md:max-w-2xl md:w-full z-50">
          <div className="bg-white dark:bg-black rounded-lg shadow-xl h-full md:h-auto max-h-[80vh] flex flex-col">
            <div className="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
              <h3 className="text-lg font-semibold">Raw Event</h3>
              <button
                onClick={() => setShowRawEvent(false)}
                className="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-neutral-900"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
            <div className="p-4 overflow-auto flex-1">
              <pre className="text-xs font-mono whitespace-pre-wrap break-all bg-gray-50 dark:bg-black p-4 rounded-lg">
                <code className="language-json">
                  {event.inspect}
                </code>
              </pre>
            </div>
          </div>
        </div>
      </>
    )}
    </>
  );
}
</file>

<file path="src/features/followPacks/components/FollowPackCard.tsx">
import { useState } from 'react';
import { Heart, UserPlus, UserMinus } from 'lucide-react';
import { useNavigate } from 'react-router-dom';
import { useNDKCurrentUser, NDKFollowPack, useProfileValue } from '@nostr-dev-kit/ndk-hooks';
import { Button } from '@/components/ui/button';
import { cn } from '@/lib/utils';
import { useFollowPacksStore } from '@/stores/followPacksStore';
import { ProfileAvatar } from './ProfileAvatar';
interface FollowPackCardProps {
  pack: NDKFollowPack;
  onSubscribe?: () => void;
  variant?: 'default' | 'compact';
}
export function FollowPackCard({ pack, onSubscribe, variant = 'default' }: FollowPackCardProps) {
  const navigate = useNavigate();
  const currentUser = useNDKCurrentUser();
  const { isSubscribed, subscribeToPack, unsubscribeFromPack, toggleFavorite, isFavorite } = useFollowPacksStore();
  const [isExpanded, setIsExpanded] = useState(false);
  const creatorProfile = useProfileValue(pack.pubkey);
  // Get preview pubkeys (first 5 users)
  const previewPubkeys = pack.pubkeys?.slice(0, 5) || [];
  // Check if current user is in the pack
  const currentUserInPack = currentUser && pack.pubkeys?.includes(currentUser.pubkey);
  const isCreator = currentUser && pack.pubkey && pack.pubkey === currentUser.pubkey;
  const subscribed = isSubscribed(pack.id);
  const favorited = isFavorite(pack.id);
  const handleSubscribe = async (e: React.MouseEvent) => {
    e.stopPropagation();
    if (!currentUser) return;
    if (subscribed) {
      unsubscribeFromPack(pack.id);
    } else {
      subscribeToPack(pack.id);
      onSubscribe?.();
    }
  };
  const handleFavorite = (e: React.MouseEvent) => {
    e.stopPropagation();
    if (!currentUser) return;
    toggleFavorite(pack.id);
  };
  const handleCardClick = () => {
    navigate(`/packs/${pack.encode()}`);
  };
  if (variant === 'compact') {
    return (
      <div
        className="p-4 bg-white dark:bg-black hover:bg-gray-50 dark:hover:bg-neutral-900 border border-gray-200 dark:border-gray-800 rounded-lg transition-colors cursor-pointer"
        onClick={handleCardClick}
      >
        <div className="flex items-center justify-between">
          <div className="flex-1 min-w-0">
            <h4 className="font-medium text-gray-900 dark:text-gray-100 truncate">
              {pack.title}
            </h4>
            <p className="text-sm text-gray-500 dark:text-gray-400">
              {pack.pubkeys?.length || 0} members
            </p>
          </div>
        </div>
      </div>
    );
  }
  return (
    <div
      className="bg-white dark:bg-black border border-gray-200 dark:border-gray-800 rounded-xl overflow-hidden hover:shadow-md transition-shadow cursor-pointer h-full flex flex-col"
      onClick={handleCardClick}
    >
      {/* Fixed height header image */}
      {pack.image && (
        <div className="h-32 bg-gray-100 dark:bg-black">
          <img
            src={pack.image}
            alt={pack.title}
            className="w-full h-full object-cover"
          />
        </div>
      )}
      {/* Content area with fixed layout */}
      <div className="p-6 flex flex-col flex-1">
        {/* Title and member count - fixed position */}
        <div className="mb-3">
          <h3 className="text-lg font-semibold text-gray-900 dark:text-gray-100 truncate">
            {pack.title}
          </h3>
          <div className="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400">
            <span>{pack.pubkeys?.length || 0} members</span>
            <span>‚Ä¢</span>
            <span>
              {isCreator
                ? 'by you'
                : currentUserInPack
                  ? `with you and @${creatorProfile?.name || creatorProfile?.displayName || pack.pubkey?.slice(0, 8) || 'unknown'}`
                  : `by @${creatorProfile?.name || creatorProfile?.displayName || pack.pubkey?.slice(0, 8) || 'unknown'}`
              }
            </span>
          </div>
        </div>
        {/* Description - fixed height area */}
        <div className="h-12 mb-4">
          {pack.description && (
            <p className="text-sm text-gray-600 dark:text-gray-300 line-clamp-2">
              {pack.description}
            </p>
          )}
        </div>
        {/* User avatars preview - always at bottom */}
        <div className="mt-auto">
          <div className="flex -space-x-2">
            {previewPubkeys.map((pubkey, index) => (
              <ProfileAvatar
                key={pubkey}
                pubkey={pubkey}
                size="sm"
                style={{ zIndex: 5 - index }}
              />
            ))}
            {(pack.pubkeys?.length || 0) > 5 && (
              <div className="w-8 h-8 rounded-full border-2 border-white dark:border-black bg-gray-200 dark:bg-black flex items-center justify-center text-xs font-medium text-gray-600 dark:text-gray-300">
                +{(pack.pubkeys?.length || 0) - 5}
              </div>
            )}
          </div>
        </div>
        {/* Favorite button */}
        <button
          onClick={(e) => {
            e.stopPropagation();
            handleFavorite(e);
          }}
          className={cn(
            "absolute top-4 right-4 p-2 rounded-lg transition-colors bg-white/90 dark:bg-black/90 backdrop-blur-sm",
            favorited
              ? "text-red-600 dark:text-red-400"
              : "hover:bg-gray-100 dark:hover:bg-neutral-900 text-gray-500"
          )}
          aria-label={favorited ? "Remove from favorites" : "Add to favorites"}
        >
          <Heart className={cn("w-4 h-4", favorited && "fill-current")} />
        </button>
      </div>
    </div>
  );
}
</file>

<file path="src/features/trades/CompactFilters.tsx">
import { ChevronDown } from 'lucide-react';
import { useState, useRef, useEffect } from 'react';
import { useAvailableCurrencies } from './hooks/useAvailableCurrencies';
interface CompactFiltersProps {
  filters: {
    currency: string;
    paymentMethod: string;
    orderType: 'all' | 'buy' | 'sell';
  };
  onFiltersChange: (filters: any) => void;
}
const orderTypes = [
  { value: 'all', label: 'All', color: 'text-gray-700' },
  { value: 'buy', label: 'Buy', color: 'text-green-600' },
  { value: 'sell', label: 'Sell', color: 'text-red-600' },
];
const paymentMethods = [
  { id: 'all', name: 'All', icon: 'üí∞' },
  { id: 'Cash', name: 'Cash', icon: 'üíµ' },
  { id: 'PIX', name: 'PIX', icon: 'üîÑ' },
  { id: 'BLIK', name: 'BLIK', icon: 'üì±' },
  { id: 'Revolut', name: 'Revolut', icon: 'üí≥' },
  { id: 'Zelle', name: 'Zelle', icon: 'üè¶' },
  { id: 'CashApp', name: 'CashApp', icon: 'üì≤' },
];
function Dropdown({
  value,
  options,
  onChange,
  renderOption,
  renderValue,
  className = ''
}: any) {
  const [isOpen, setIsOpen] = useState(false);
  const dropdownRef = useRef<HTMLDivElement>(null);
  useEffect(() => {
    function handleClickOutside(event: MouseEvent) {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {
        setIsOpen(false);
      }
    }
    document.addEventListener('mousedown', handleClickOutside);
    return () => document.removeEventListener('mousedown', handleClickOutside);
  }, []);
  return (
    <div ref={dropdownRef} className={`relative ${className}`}>
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="flex items-center gap-1 px-3 py-1.5 bg-white dark:bg-black border border-gray-300 dark:border-gray-700 rounded-lg text-sm font-medium hover:bg-gray-50 dark:hover:bg-neutral-900 transition-colors"
      >
        {renderValue(value)}
        <ChevronDown className={`w-3 h-3 transition-transform ${isOpen ? 'rotate-180' : ''}`} />
      </button>
      {isOpen && (
        <div className="absolute top-full mt-1 left-0 w-max min-w-[120px] bg-white dark:bg-black border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-[100] max-h-64 overflow-y-auto">
          {options.map((option: any) => (
            <button
              key={option.value || option.code || option.id}
              onClick={() => {
                onChange(option);
                setIsOpen(false);
              }}
              className="w-full flex items-center gap-2 px-3 py-2 hover:bg-gray-100 dark:hover:bg-neutral-900 transition-colors text-left"
            >
              {renderOption(option)}
            </button>
          ))}
        </div>
      )}
    </div>
  );
}
export function CompactFilters({ filters, onFiltersChange }: CompactFiltersProps) {
  const { currencies } = useAvailableCurrencies();
  const selectedOrderType = orderTypes.find(t => t.value === filters.orderType);
  const selectedCurrency = currencies.find(c => c.code === filters.currency);
  const selectedPayment = paymentMethods.find(p => p.id === filters.paymentMethod);
  return (
    <div className="relative flex items-center gap-2 p-3 bg-white dark:bg-black border-b border-gray-200 dark:border-gray-800 overflow-visible">
      {/* Order Type Dropdown */}
      <Dropdown
        value={filters.orderType}
        options={orderTypes}
        onChange={(option: any) => onFiltersChange({ ...filters, orderType: option.value })}
        renderValue={() => (
          <span className={selectedOrderType?.color}>
            {selectedOrderType?.label}
          </span>
        )}
        renderOption={(option: any) => (
          <span className={`text-sm font-medium ${option.color}`}>
            {option.label}
          </span>
        )}
      />
      {/* Currency Dropdown */}
      <Dropdown
        value={filters.currency}
        options={currencies}
        onChange={(option: any) => onFiltersChange({ ...filters, currency: option.code })}
        renderValue={() => (
          <>
            <span>{selectedCurrency?.flag}</span>
            <span>{selectedCurrency?.code === 'all' ? 'Currency' : selectedCurrency?.name}</span>
          </>
        )}
        renderOption={(option: any) => (
          <>
            <span className="text-lg">{option.flag}</span>
            <span className="text-sm">{option.code === 'all' ? 'All Currencies' : option.name}</span>
          </>
        )}
      />
      {/* Payment Method Dropdown */}
      <Dropdown
        value={filters.paymentMethod}
        options={paymentMethods}
        onChange={(option: any) => onFiltersChange({ ...filters, paymentMethod: option.id })}
        renderValue={() => (
          <>
            <span>{selectedPayment?.icon}</span>
            <span>{selectedPayment?.id === 'all' ? 'Payment' : selectedPayment?.name}</span>
          </>
        )}
        renderOption={(option: any) => (
          <>
            <span className="text-lg">{option.icon}</span>
            <span className="text-sm">{option.id === 'all' ? 'All Methods' : option.name}</span>
          </>
        )}
      />
      {/* Clear filters button - only show if filters are active */}
      {(filters.currency !== 'all' || filters.paymentMethod !== 'all' || filters.orderType !== 'all') && (
        <button
          onClick={() => onFiltersChange({
            ...filters,
            currency: 'all',
            paymentMethod: 'all',
            orderType: 'all'
          })}
          className="ml-auto px-2 py-1 text-xs text-purple-600 dark:text-purple-400 hover:underline"
        >
          Clear
        </button>
      )}
    </div>
  );
}
</file>

<file path="src/features/trades/MobileFilters.tsx">
import { useState } from 'react';
import { Filter, X } from 'lucide-react';
import { useAvailableCurrencies } from './hooks/useAvailableCurrencies';
interface MobileFiltersProps {
  selectedCurrency: string;
  selectedPaymentMethod: string;
  onCurrencyChange: (currency: string) => void;
  onPaymentMethodChange: (method: string) => void;
}
const paymentMethods = [
  { id: 'all', name: 'All', icon: 'üí∞' },
  { id: 'Cash', name: 'Cash', icon: 'üíµ' },
  { id: 'PIX', name: 'PIX', icon: 'üîÑ' },
  { id: 'BLIK', name: 'BLIK', icon: 'üì±' },
  { id: 'Revolut', name: 'Revolut', icon: 'üí≥' },
  { id: 'Zelle', name: 'Zelle', icon: 'üè¶' },
];
export function MobileFilters({
  selectedCurrency,
  selectedPaymentMethod,
  onCurrencyChange,
  onPaymentMethodChange,
}: MobileFiltersProps) {
  const [showFilters, setShowFilters] = useState(false);
  const { currencies } = useAvailableCurrencies();
  const selectedCurrencyData = currencies.find(c => c.code === selectedCurrency);
  const selectedPaymentData = paymentMethods.find(p => p.id === selectedPaymentMethod);
  return (
    <>
      {/* Compact Filter Bar */}
      <div className="flex gap-2 p-3 bg-white dark:bg-black border-b border-gray-200 dark:border-gray-800">
        <button
          onClick={() => setShowFilters(true)}
          className="flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-gray-100 dark:bg-black rounded-lg text-sm"
        >
          <Filter className="w-4 h-4" />
          <span className="font-medium">Filters</span>
          {(selectedCurrency !== 'all' || selectedPaymentMethod !== 'all') && (
            <span className="px-2 py-0.5 bg-purple-600 text-white rounded-full text-xs">
              {[selectedCurrency !== 'all' && selectedCurrency, selectedPaymentMethod !== 'all' && selectedPaymentMethod].filter(Boolean).length}
            </span>
          )}
        </button>
        {selectedCurrency !== 'all' && (
          <button
            onClick={() => onCurrencyChange('all')}
            className="flex items-center gap-1 px-3 py-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg text-sm"
          >
            <span>{selectedCurrencyData?.flag}</span>
            <span className="font-medium">{selectedCurrency}</span>
            <X className="w-3 h-3" />
          </button>
        )}
        {selectedPaymentMethod !== 'all' && (
          <button
            onClick={() => onPaymentMethodChange('all')}
            className="flex items-center gap-1 px-3 py-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg text-sm"
          >
            <span>{selectedPaymentData?.icon}</span>
            <span className="font-medium">{selectedPaymentMethod}</span>
            <X className="w-3 h-3" />
          </button>
        )}
      </div>
      {/* Full Screen Filter Modal */}
      {showFilters && (
        <div className="fixed inset-0 z-50 bg-white dark:bg-black">
          {/* Header */}
          <div className="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-800">
            <h2 className="text-lg font-semibold">Filters</h2>
            <button
              onClick={() => setShowFilters(false)}
              className="p-2 hover:bg-gray-100 dark:hover:bg-neutral-900 rounded-lg"
            >
              <X className="w-5 h-5" />
            </button>
          </div>
          {/* Filter Content */}
          <div className="p-4 space-y-6 overflow-y-auto max-h-[calc(100vh-140px)]">
            {/* Currency */}
            <div>
              <h3 className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Currency</h3>
              <div className="grid grid-cols-4 gap-2">
                {currencies.map((currency) => (
                  <button
                    key={currency.code}
                    onClick={() => onCurrencyChange(currency.code)}
                    className={`
                      flex flex-col items-center gap-1 p-3 rounded-lg transition-all
                      ${selectedCurrency === currency.code
                        ? 'bg-purple-600 text-white'
                        : 'bg-gray-100 dark:bg-black hover:bg-gray-200 dark:hover:bg-neutral-900'
                      }
                    `}
                  >
                    <span className="text-2xl">{currency.flag}</span>
                    <span className="text-xs font-medium">{currency.code === 'all' ? 'All' : currency.code}</span>
                  </button>
                ))}
              </div>
            </div>
            {/* Payment Method */}
            <div>
              <h3 className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Payment Method</h3>
              <div className="space-y-2">
                {paymentMethods.map((method) => (
                  <button
                    key={method.id}
                    onClick={() => onPaymentMethodChange(method.id)}
                    className={`
                      w-full flex items-center gap-3 p-3 rounded-lg transition-all
                      ${selectedPaymentMethod === method.id
                        ? 'bg-purple-600 text-white'
                        : 'bg-gray-100 dark:bg-black hover:bg-gray-200 dark:hover:bg-neutral-900'
                      }
                    `}
                  >
                    <span className="text-xl">{method.icon}</span>
                    <span className="font-medium">{method.name}</span>
                  </button>
                ))}
              </div>
            </div>
          </div>
          {/* Footer */}
          <div className="absolute bottom-0 left-0 right-0 p-4 bg-white dark:bg-black border-t border-gray-200 dark:border-gray-800">
            <div className="flex gap-2">
              <button
                onClick={() => {
                  onCurrencyChange('all');
                  onPaymentMethodChange('all');
                }}
                className="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-neutral-900"
              >
                Clear All
              </button>
              <button
                onClick={() => setShowFilters(false)}
                className="flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700"
              >
                Apply Filters
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  );
}
</file>

<file path="src/App.tsx">
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import { Layout } from './components/layout/Layout';
import { HomePage } from './pages/HomePage';
import { ComposePage } from './pages/ComposePage';
import { NotificationsPage } from './pages/NotificationsPage';
import { ProfilePage } from './pages/ProfilePage';
import { WalletPage } from './pages/WalletPage';
import { WalletSettingsPage } from './pages/WalletSettingsPage';
import { SettingsPage } from './pages/SettingsPage';
import { TradePage } from './pages/TradePage';
import { MarketplacePage } from './pages/marketplace/MarketplacePage';
import { CreateListingPage } from './pages/marketplace/CreateListingPage';
import { ListingDetailPage } from './pages/marketplace/ListingDetailPage';
import { FollowPacksPage } from './pages/FollowPacksPageImproved';
import { FollowPackDetailPage } from './pages/FollowPackDetailPage';
import { NoteDetailPage } from './pages/NoteDetailPage';
import { useNDKCurrentUser } from '@nostr-dev-kit/ndk-hooks';
import { useAutoLogin } from './features/auth/useAutoLogin';
const queryClient = new QueryClient();
function AppRoutes() {
  const currentUser = useNDKCurrentUser();
  useAutoLogin();
  return (
    <Routes>
      <Route path="/" element={<Layout />}>
        <Route index element={<HomePage />} />
        <Route path="compose" element={currentUser ? <ComposePage /> : <Navigate to="/" />} />
        <Route path="notifications" element={currentUser ? <NotificationsPage /> : <Navigate to="/" />} />
        <Route path="profile" element={currentUser ? <ProfilePage /> : <Navigate to="/" />} />
        <Route path="p/:identifier" element={<ProfilePage />} />
        <Route path="e/:nevent" element={<NoteDetailPage />} />
        <Route path="packs" element={<FollowPacksPage />} />
        <Route path="packs/:packId" element={<FollowPackDetailPage />} />
        <Route path="wallet" element={<WalletPage />} />
        <Route path="wallet/settings" element={<WalletSettingsPage />} />
        <Route path="trades" element={<TradePage />} />
        <Route path="marketplace" element={<MarketplacePage />} />
        <Route path="marketplace/create" element={<CreateListingPage />} />
        <Route path="marketplace/:id" element={<ListingDetailPage />} />
        <Route path="settings" element={<SettingsPage />} />
      </Route>
    </Routes>
  );
}
function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <BrowserRouter>
        <AppRoutes />
      </BrowserRouter>
    </QueryClientProvider>
  );
}
export default App;
</file>

<file path="src/features/feed/NoteFeed.tsx">
import { useSubscribe, NDKKind, NDKEvent } from '@nostr-dev-kit/ndk-hooks';
import { NoteCard } from './NoteCard';
import { useState, useEffect, useRef, useCallback } from 'react';
const INITIAL_LOAD = 20;
const BATCH_SIZE = 10;
interface NoteFeedProps {
  events?: NDKEvent[];
  showDebugInfo?: boolean;
  authors?: string[];
}
export function NoteFeed({ events: externalEvents, showDebugInfo = true, authors }: NoteFeedProps = {}) {
  // If no external events provided, use the default subscription
  const { events: subscribedEvents } = useSubscribe(externalEvents ? false : [{
    kinds: [NDKKind.Text],
    ...(authors && authors.length > 0 ? { authors } : {}),
  }], { subId: 'note-feed' }, [authors?.length]);
  const events = externalEvents || subscribedEvents;
  const [visibleCount, setVisibleCount] = useState(INITIAL_LOAD);
  const [isLoadingMore, setIsLoadingMore] = useState(false);
  const observerRef = useRef<IntersectionObserver | null>(null);
  const loadMoreRef = useRef<HTMLDivElement | null>(null);
  const sortedEvents = events
    .sort((a, b) => (b.created_at || 0) - (a.created_at || 0))
    .slice(0, visibleCount);
  const hasMore = visibleCount < events.length;
  const loadMore = useCallback(() => {
    if (isLoadingMore || !hasMore) return;
    setIsLoadingMore(true);
    // Simulate async loading for smooth UX
    setTimeout(() => {
      setVisibleCount(prev => Math.min(prev + BATCH_SIZE, events.length));
      setIsLoadingMore(false);
    }, 100);
  }, [isLoadingMore, hasMore, events.length]);
  // Set up intersection observer
  useEffect(() => {
    if (observerRef.current) {
      observerRef.current.disconnect();
    }
    observerRef.current = new IntersectionObserver(
      (entries) => {
        const target = entries[0];
        if (target.isIntersecting && hasMore && !isLoadingMore) {
          loadMore();
        }
      },
      {
        root: null,
        rootMargin: '100px',
        threshold: 0.1
      }
    );
    if (loadMoreRef.current) {
      observerRef.current.observe(loadMoreRef.current);
    }
    return () => {
      if (observerRef.current) {
        observerRef.current.disconnect();
      }
    };
  }, [hasMore, isLoadingMore, loadMore]);
  // Reset visible count when events change significantly
  useEffect(() => {
    if (events.length < visibleCount) {
      setVisibleCount(Math.min(INITIAL_LOAD, events.length));
    }
  }, [events.length, visibleCount]);
  if (events.length === 0) {
    return (
      <div className="text-center py-12 px-4">
        <p className="text-gray-500 dark:text-gray-400">
          {authors && authors.length > 0
            ? "No notes from people you follow yet. Check out the global feed or follow more people!"
            : "No notes yet. Be the first to share something!"}
        </p>
      </div>
    );
  }
  return (
    <div className="divide-y divide-gray-200 dark:divide-gray-800">
      {/* Show count for debugging - remove in production */}
      {showDebugInfo && (
        <div className="text-xs text-gray-500 dark:text-gray-400 px-4 py-2 bg-gray-50 dark:bg-black/50">
          Showing {sortedEvents.length} of {events.length} notes
        </div>
      )}
      {sortedEvents.map((event) => (
        <NoteCard key={event.id} event={event} />
      ))}
      {/* Load more trigger */}
      {hasMore && (
        <div
          ref={loadMoreRef}
          className="py-8 text-center"
        >
          {isLoadingMore ? (
            <div className="flex items-center justify-center gap-2">
              <div className="w-4 h-4 rounded-full bg-accent-500 animate-pulse" />
              <div className="w-4 h-4 rounded-full bg-accent-500 animate-pulse animation-delay-200" />
              <div className="w-4 h-4 rounded-full bg-accent-500 animate-pulse animation-delay-400" />
            </div>
          ) : (
            <button
              onClick={loadMore}
              className="text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors"
            >
              Load more notes
            </button>
          )}
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/pages/ProfilePage.tsx">
import { useState } from 'react';
import { useNDKCurrentUser, useProfile, useSubscribe, NDKKind, useUser } from '@nostr-dev-kit/ndk-hooks';
import { Calendar, Link as LinkIcon, Edit2, Package } from 'lucide-react';
import { NoteCard } from '@/features/feed/NoteCard';
import { useParams } from 'react-router-dom';
import { ProfileEditor } from '@/features/profile/ProfileEditor';
import { PackCard } from '@/features/followPacks/components/PackCard';
import { useProfileFollowPacks } from '@/features/followPacks/hooks/useProfileFollowPacks';
import { MediaGrid } from '@/components/media/MediaGrid';
import { FollowButton } from '@/components/ui/FollowButton';
import { ContentRenderer } from '@/components/content/ContentRenderer';
export function ProfilePage() {
  const { identifier } = useParams<{ identifier?: string }>();
  const currentUser = useNDKCurrentUser();
  const [isEditingProfile, setIsEditingProfile] = useState(false);
  const [activeTab, setActiveTab] = useState<'notes' | 'replies' | 'media' | 'packs'>('notes');
  // Resolve user from identifier (npub, hex pubkey, nip05, or nprofile)
  const user = useUser(identifier || currentUser?.pubkey);
  const profile = useProfile(user?.pubkey);
  const isOwnProfile = user?.pubkey === currentUser?.pubkey;
  const { events: allTextEvents } = useSubscribe(user?.pubkey ? [{
    kinds: [NDKKind.Text],
    authors: [user.pubkey],
    limit: 100,
  }] : false, { subId: 'profile-notes' });
  // Helper to check if content has media URLs
  const hasMediaUrl = (content: string): boolean => {
    const urlRegex = /(https?:\/\/[^\s]+\.(jpg|jpeg|png|gif|webp|svg|avif|mp4|webm|mov|avi|mkv))/gi;
    return urlRegex.test(content);
  };
  // Filter notes (kind:1 without 'e' tag) and replies (kind:1 with 'e' tag)
  const notes = allTextEvents.filter(event => !event.tags.some(tag => tag[0] === 'e'));
  const replies = allTextEvents.filter(event => event.tags.some(tag => tag[0] === 'e'));
  // Media: kind:1 events with media URLs in content
  const textMediaEvents = allTextEvents.filter(event => hasMediaUrl(event.content));
  // Fetch kind:20, 21, 22 media events for the media tab (NIP-68)
  const { events: nip68MediaEvents } = useSubscribe(user?.pubkey && activeTab === 'media' ? [{
    kinds: [
      NDKKind.Image,       // kind:20 - Image file metadata
      NDKKind.Video,       // kind:21 - Video file metadata
      NDKKind.ShortVideo,  // kind:22 - Short video file metadata
    ],
    authors: [user.pubkey],
  }] : false, { subId: 'profile-media' });
  // Combine NIP-68 media events with kind:1 text events that have media
  const allMediaEvents = [...nip68MediaEvents, ...textMediaEvents];
  const [packFilter, setPackFilter] = useState<'all' | 'created' | 'appears'>('all');
  const { createdPacks, appearsPacks, allPacks } = useProfileFollowPacks(user?.pubkey || '');
  // Select which packs to show based on filter
  const packs = packFilter === 'created' ? createdPacks :
                packFilter === 'appears' ? appearsPacks :
                allPacks;
  if (!user?.pubkey) return null;
  return (
    <div className="max-w-2xl mx-auto">
      {/* Profile header */}
      <div className="bg-white dark:bg-black border-b border-gray-200 dark:border-gray-800">
        {/* Cover image */}
        <div className="h-32 sm:h-48 bg-gradient-to-br from-purple-500 to-pink-500 relative">
          {profile?.banner && (
            <img
              src={profile.banner}
              alt="Banner"
              className="w-full h-full object-cover"
            />
          )}
          {isOwnProfile && (
            <button
              onClick={() => setIsEditingProfile(true)}
              className="absolute top-4 right-4 p-2 bg-white/90 dark:bg-black/90 hover:bg-white dark:hover:bg-neutral-900 rounded-lg transition-colors backdrop-blur-sm"
              aria-label="Edit profile"
            >
              <Edit2 className="w-4 h-4" />
            </button>
          )}
        </div>
        {/* Profile info */}
        <div className="px-4 sm:px-6 pb-4">
          {/* Avatar */}
          <div className="relative -mt-12 sm:-mt-16 mb-4">
            {profile?.picture ? (
              <img
                src={profile.picture}
                alt={profile?.name || 'Profile'}
                className="w-24 h-24 sm:w-32 sm:h-32 rounded-full border-4 border-white dark:border-gray-950 object-cover"
              />
            ) : (
              <div className="w-24 h-24 sm:w-32 sm:h-32 rounded-full border-4 border-white dark:border-gray-950 bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold text-3xl">
                {(profile?.name || 'A')[0].toUpperCase()}
              </div>
            )}
          </div>
          {/* Name and bio */}
          <div className="mb-4">
            <div className="flex items-start justify-between gap-4">
              <div className="flex-1">
                <h1 className="text-xl sm:text-2xl font-bold text-gray-900 dark:text-gray-100">
                  {profile?.name || 'Anonymous'}
                </h1>
                {profile?.nip05 && (
                  <p className="text-gray-500 dark:text-gray-400">
                    @{profile.nip05.split('@')[0]}
                  </p>
                )}
              </div>
              <FollowButton pubkey={user.pubkey} />
            </div>
            {profile?.about && (
              <div className="mt-3">
                <ContentRenderer
                  content={profile.about}
                  className="text-gray-700 dark:text-gray-300"
                />
              </div>
            )}
          </div>
          {/* Meta info */}
          <div className="flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400">
            {profile?.website && (
              <a 
                href={profile.website} 
                target="_blank" 
                rel="noopener noreferrer"
                className="flex items-center gap-1 hover:text-purple-600 dark:hover:text-purple-400"
              >
                <LinkIcon className="w-4 h-4" />
                <span>{profile.website.replace(/^https?:\/\//, '')}</span>
              </a>
            )}
            <div className="flex items-center gap-1">
              <Calendar className="w-4 h-4" />
              <span>Joined recently</span>
            </div>
          </div>
          {/* Stats */}
          <div className="flex gap-6 mt-4">
            <div>
              <span className="font-semibold text-gray-900 dark:text-gray-100">
                {notes.length}
              </span>
              <span className="text-gray-500 dark:text-gray-400 ml-1">Notes</span>
            </div>
            <div>
              <span className="font-semibold text-gray-900 dark:text-gray-100">0</span>
              <span className="text-gray-500 dark:text-gray-400 ml-1">Following</span>
            </div>
            <div>
              <span className="font-semibold text-gray-900 dark:text-gray-100">0</span>
              <span className="text-gray-500 dark:text-gray-400 ml-1">Followers</span>
            </div>
          </div>
        </div>
      </div>
      {/* Tabs */}
      <div className="sticky top-0 z-30 bg-white/80 dark:bg-black/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-800">
        <div className="flex px-4 sm:px-6 overflow-x-auto">
          <button
            onClick={() => setActiveTab('notes')}
            className={`px-4 py-3 font-medium whitespace-nowrap ${
              activeTab === 'notes'
                ? 'text-purple-600 dark:text-purple-400 border-b-2 border-purple-600 dark:border-purple-400'
                : 'text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300'
            }`}>
            Notes
          </button>
          <button
            onClick={() => setActiveTab('replies')}
            className={`px-4 py-3 font-medium whitespace-nowrap ${
              activeTab === 'replies'
                ? 'text-purple-600 dark:text-purple-400 border-b-2 border-purple-600 dark:border-purple-400'
                : 'text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300'
            }`}>
            Replies
          </button>
          <button
            onClick={() => setActiveTab('media')}
            className={`px-4 py-3 font-medium whitespace-nowrap ${
              activeTab === 'media'
                ? 'text-purple-600 dark:text-purple-400 border-b-2 border-purple-600 dark:border-purple-400'
                : 'text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300'
            }`}>
            Media
          </button>
          <button
            onClick={() => setActiveTab('packs')}
            className={`px-4 py-3 font-medium whitespace-nowrap flex items-center gap-1.5 ${
              activeTab === 'packs'
                ? 'text-purple-600 dark:text-purple-400 border-b-2 border-purple-600 dark:border-purple-400'
                : 'text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300'
            }`}>
            <Package className="w-4 h-4" />
            Follow Packs
          </button>
        </div>
      </div>
      {/* Tab content */}
      <div>
        {activeTab === 'notes' && (
          <>
            {notes.map((event) => (
              <NoteCard key={event.id} event={event} />
            ))}
            {notes.length === 0 && (
              <div className="text-center py-8 text-gray-500 dark:text-gray-400">
                No notes yet
              </div>
            )}
          </>
        )}
        {activeTab === 'replies' && (
          <>
            {replies.map((event) => (
              <NoteCard key={event.id} event={event} />
            ))}
            {replies.length === 0 && (
              <div className="text-center py-8 text-gray-500 dark:text-gray-400">
                No replies yet
              </div>
            )}
          </>
        )}
        {activeTab === 'media' && (
          <div className="p-4">
            <MediaGrid events={allMediaEvents} />
          </div>
        )}
        {activeTab === 'packs' && (
          <div className="p-4 space-y-4">
            {/* Filter tabs for follow packs */}
            <div className="flex gap-2 mb-4">
              <button
                onClick={() => setPackFilter('all')}
                className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
                  packFilter === 'all'
                    ? 'bg-purple-600 text-white'
                    : 'bg-gray-100 dark:bg-black text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-neutral-900'
                }`}
              >
                All
              </button>
              <button
                onClick={() => setPackFilter('created')}
                className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
                  packFilter === 'created'
                    ? 'bg-purple-600 text-white'
                    : 'bg-gray-100 dark:bg-black text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-neutral-900'
                }`}
              >
                {isOwnProfile ? 'by you' : `by @${profile?.name || profile?.displayName || user.pubkey.slice(0, 8)}`}
              </button>
              <button
                onClick={() => setPackFilter('appears')}
                className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
                  packFilter === 'appears'
                    ? 'bg-purple-600 text-white'
                    : 'bg-gray-100 dark:bg-black text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-neutral-900'
                }`}
              >
                {isOwnProfile ? 'with you' : `with @${profile?.name || profile?.displayName || user.pubkey.slice(0, 8)}`}
              </button>
            </div>
            {packs.length > 0 ? (
              <div className="grid gap-4 md:grid-cols-2">
                {packs.map((pack) => (
                  <PackCard key={pack.id} pack={pack} variant="compact" />
                ))}
              </div>
            ) : (
              <div className="text-center py-8 text-gray-500 dark:text-gray-400">
                {packFilter === 'created'
                  ? (isOwnProfile
                      ? "You haven't created any follow packs yet"
                      : `@${profile?.name || 'user'} hasn't created any follow packs yet`)
                  : packFilter === 'appears'
                  ? (isOwnProfile
                      ? "You don't appear on any follow packs yet"
                      : `@${profile?.name || 'user'} doesn't appear on any follow packs yet`)
                  : "No follow packs found"}
              </div>
            )}
          </div>
        )}
      </div>
      {/* Profile Editor Modal */}
      {isEditingProfile && user?.pubkey && (
        <ProfileEditor
          pubkey={user.pubkey}
          onClose={() => setIsEditingProfile(false)}
          onSave={() => {
            setIsEditingProfile(false);
            // Profile will auto-update via the useProfile hook
          }}
        />
      )}
    </div>
  );
}
</file>

<file path="package.json">
{
  "name": "voces-app",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@cashu/cashu-ts": "^2.7.2",
    "@nostr-dev-kit/ndk": "^2.14.35",
    "@nostr-dev-kit/ndk-cache-dexie": "^2.0.10",
    "@nostr-dev-kit/ndk-hooks": "^1.3.0",
    "@nostr-dev-kit/ndk-wallet": "^0.6.2",
    "@radix-ui/react-dialog": "^1.1.15",
    "@radix-ui/react-dropdown-menu": "^2.1.16",
    "@radix-ui/react-slot": "^1.2.3",
    "@radix-ui/react-tabs": "^1.1.13",
    "@tanstack/react-query": "^5.90.2",
    "axios": "^1.12.2",
    "blossom-client-sdk": "^4.1.0",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "date-fns": "^4.1.0",
    "framer-motion": "^12.23.22",
    "i18next": "^25.5.2",
    "i18next-browser-languagedetector": "^8.2.0",
    "lucide-react": "^0.544.0",
    "nostr-tools": "^2.17.0",
    "react": "^19.1.1",
    "react-dom": "^19.1.1",
    "react-i18next": "^16.0.0",
    "react-router-dom": "^7.9.1",
    "tailwind-merge": "^3.3.1",
    "tailwindcss-animate": "^1.0.7",
    "zustand": "^5.0.8"
  },
  "devDependencies": {
    "@eslint/js": "^9.36.0",
    "@tailwindcss/postcss": "^4.1.13",
    "@tailwindcss/typography": "^0.5.18",
    "@types/react": "^19.1.13",
    "@types/react-dom": "^19.1.9",
    "@vitejs/plugin-react": "^5.0.3",
    "autoprefixer": "^10.4.21",
    "eslint": "^9.36.0",
    "eslint-plugin-react": "^7.37.5",
    "eslint-plugin-react-hooks": "^5.2.0",
    "eslint-plugin-react-refresh": "^0.4.20",
    "globals": "^16.4.0",
    "postcss": "^8.5.6",
    "tailwindcss": "^4.1.13",
    "tsx": "^4.20.6",
    "typescript": "~5.8.3",
    "typescript-eslint": "^8.44.0",
    "vite": "^7.1.7"
  }
}
</file>

</files>
